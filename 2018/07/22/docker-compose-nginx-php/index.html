<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>docker+compose+nginx+php | 麦田麦穗</title>

  
  <meta name="author" content="vison">
  

  
  <meta name="description" content="">
  

  
  
  <meta name="keywords" content="docker">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="docker+compose+nginx+php"/>

  <meta property="og:site_name" content="麦田麦穗"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="麦田麦穗" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">麦田麦穗</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>docker+compose+nginx+php</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/07/22/docker-compose-nginx-php/" rel="bookmark">
        <time class="entry-date published" datetime="2018-07-22T08:52:09.000Z">
          2018-07-22
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p><img src="http://img.rc5j.cn/blog20200722165520.png" alt=""></p>
<span id="more"></span>

<blockquote>
<p>Docker 可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。</p>
</blockquote>
<h2 id="我用docker做什么？"><a href="#我用docker做什么？" class="headerlink" title="我用docker做什么？"></a>我用docker做什么？</h2><p>快速搭建开发所需环境，测试实验新组件(如rabbitmq,kafka).避免因安装而浪费太多时间，我的目的是快速尝试使用。</p>
<h2 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装docker</h2><pre><code class="shell">brew cask install docker</code></pre>
<h2 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h2><p>Compose 是一个用户定义和运行多个容器的 Docker 应用程序。在 Compose 中你可以使用 YAML 文件来配置你的应用服务。然后，只需要一个简单的命令，就可以创建并启动你配置的所有服务。</p>
<h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><p><img src="http://upload-images.jianshu.io/upload_images/4033700-1a2d2c681ac9df9c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2018-08-07-14-17-25"></p>
<p>一组服务建立一个目录</p>
<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><pre><code class="yaml">version: &#39;2&#39;
services:
  php7.2:
    image: php:7.2-fpm
    ports:
      - &quot;9000:9000&quot;
    volumes: 
      - ./php:/usr/local/etc/php
      - /Users/caowenpeng/www:/www
  nginx:
    image: nginx
    ports: 
      - &quot;80:80&quot;
    volumes:
      - /Users/caowenpeng/www:/www
      - ./nginx:/etc/nginx
</code></pre>
<h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><pre><code class="shell">docker-compose up -d</code></pre>
<h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>up</td>
<td>创建和启动容器</td>
</tr>
<tr>
<td>ps</td>
<td>列出所有容器</td>
</tr>
<tr>
<td>down</td>
<td>停止并删除容器，镜像，挂载</td>
</tr>
<tr>
<td>start</td>
<td>启动服务</td>
</tr>
<tr>
<td>stop</td>
<td>停止服务</td>
</tr>
<tr>
<td>restart</td>
<td>重启服务</td>
</tr>
</tbody></table>
<p><strong>第一次使用up,之后使用start,如果再次使用up将会重新创建容器，一些对容器的修改将会丢失</strong></p>
<h2 id="其他问题"><a href="#其他问题" class="headerlink" title="其他问题"></a>其他问题</h2><p>进入容器 </p>
<pre><code class="bash"> docker-compose exec php7.2 bash</code></pre>
<p>进入容器后会发现只能用少量命令，连ps等都没有，这个时候需要安装一些程序</p>
<pre><code class="bash">apt-get update  ##更新元
apt-get install procps  ## 安装 ps</code></pre>
<p>安装php-rdkafka拓展</p>
<pre><code class="bash">apt-get install wget
wget https://github.com/edenhill/librdkafka/archive/master.zip

apt-get install unzip

unzip master.zip

cd librdkafka

./configure 

make

make install 

pecl install http://pecl.php.net/get/rdkafka-3.0.4.tgz

#在php.ini 配置启用 rdkafka拓展


</code></pre>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/docker/">docker</a>
    </span>
    

    </div>

    
  </div>
</article>

  






    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2021 vison
    
  </p>
</footer>
    
    
  </div>
</div>
</body>
</html>