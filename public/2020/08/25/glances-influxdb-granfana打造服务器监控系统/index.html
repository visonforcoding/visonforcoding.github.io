<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>glances+influxdb+granfana打造服务器监控系统 | 麦田麦穗</title>

  
  <meta name="author" content="vison">
  

  
  <meta name="description" content="服务监控就是你的眼睛，当你对服务器运行状况一无所知时，你应该感到坐立不安。">
  

  
  
  <meta name="keywords" content="devops">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="glances+influxdb+granfana打造服务器监控系统"/>

  <meta property="og:site_name" content="麦田麦穗"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="麦田麦穗" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">麦田麦穗</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>glances+influxdb+granfana打造服务器监控系统</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2020/08/25/glances-influxdb-granfana打造服务器监控系统/" rel="bookmark">
        <time class="entry-date published" datetime="2020-08-25T09:56:32.000Z">
          2020-08-25
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210430141234.png" alt=""></p>
<p>服务监控就是你的眼睛，当你对服务器运行状况一无所知时，你应该感到坐立不安。</p>
<span id="more"></span>

<h2 id="glances安装"><a href="#glances安装" class="headerlink" title="glances安装"></a>glances安装</h2><p>glances是由python编写的，因此可以使用pip直接安装</p>
<pre><code>pip3 install glances</code></pre><h2 id="influxdb安装"><a href="#influxdb安装" class="headerlink" title="influxdb安装"></a>influxdb安装</h2><pre><code>wget https://dl.influxdata.com/influxdb/releases/influxdb-1.8.2.x86_64.rpm
sudo yum localinstall influxdb-1.8.2.x86_64.rpm</code></pre><h2 id="收集数据到influxdb"><a href="#收集数据到influxdb" class="headerlink" title="收集数据到influxdb"></a>收集数据到influxdb</h2><p>配置 glances</p>
<p><code>vim /etc/glances/glances.conf</code></p>
<pre><code class="ini">[influxdb]
# Configuration for the --export influxdb option
# https://influxdb.com/
host=localhost
port=8086
user=root
password=root
db=glances
prefix=localhost
#tags=foo:bar,spam:eggs</code></pre>
<pre><code>pip3 install influxdb
glances --export influxdb</code></pre><p>执行 <code>glances --export influxdb</code> 测试下，报错</p>
<p><code>InfluxDB database &#39;glances&#39; did not exist. Please create it</code>需要新建数据库。</p>
<p>执行shell <code>influx</code></p>
<pre><code>CREATE DATABASE glances  #创建数据
SHOW DATABASES   # 查看数据库</code></pre><p>再次执行<code>glances --export influxdb</code> ,可显示如下代表目前一切正常</p>
<p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210430141339.png" alt=""></p>
<h2 id="granfana安装"><a href="#granfana安装" class="headerlink" title="granfana安装"></a>granfana安装</h2><pre><code>wget https://dl.grafana.com/oss/release/grafana-7.1.5-1.x86_64.rpm
sudo yum install grafana-7.1.5-1.x86_64.rpm</code></pre><h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><pre><code class="shell">systemctl daemon-reload
systemctl start grafana-server
systemctl status grafana-server

systemctl enable grafana-server.service</code></pre>
<h3 id="docker-granfana安装"><a href="#docker-granfana安装" class="headerlink" title="docker-granfana安装"></a>docker-granfana安装</h3><pre><code class="yml"># docker-compose.yml
version: &quot;3.1&quot;

services:
  grafana:
    image: grafana/grafana:5.1.0
    ports:
      - 3001:3000
    environment:
        - GF_SECURITY_ADMIN_PASSWORD__FILE=/run/secrets/granfa_admin_pwd # 5.2.0之后才可用</code></pre>
<h3 id="nginx配置"><a href="#nginx配置" class="headerlink" title="nginx配置"></a>nginx配置</h3><pre><code class="conf"> server &#123;
        listen       80;
        server_name  grafana-dev.domain.cn;

        #charset koi8-r;
        location / &#123;
           proxy_pass  http://127.0.0.1:3001;
           proxy_http_version 1.1;
           proxy_set_header Upgrade $http_upgrade;
           proxy_set_header Connection &quot;upgrade&quot;;
        &#125;

&#125;</code></pre>
<p>就可以在web上进行访问,初始的账号密码都是<code>admin</code></p>
<h3 id="配置数据源"><a href="#配置数据源" class="headerlink" title="配置数据源"></a>配置数据源</h3><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210430141408.png" alt=""></p>
<p>docker安装情况应注意docker容器ip 和宿主机ip</p>
<pre><code class="shell">docker network ls # 查看docker网络
docker network inspect $networkid # 查看具体网络信息</code></pre>
<p>在配置<code>influxdb</code> 数据源时，如果你是用<code>docker</code>安装，需要保持<code>granfana</code>和<code>influxdb</code>是在同一个网段</p>
<p>grafana 还支持zipkin</p>
<p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210430141436.png" alt=""></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/devops/">devops</a>
    </span>
    

    </div>

    
  </div>
</article>

  






    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2021 vison
    
  </p>
</footer>
    
    
  </div>
</div>
</body>
</html>