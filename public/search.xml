<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>mysqlçš„waitimeout</title>
      <link href="2021/06/02/mysql%E7%9A%84waitimeout/"/>
      <url>2021/06/02/mysql%E7%9A%84waitimeout/</url>
      
        <content type="html"><![CDATA[<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹</p><pre><code class="shell">show GLOBAL VARIABLES like &#39;%timeout%&#39;;</code></pre><p>é»˜è®¤å€¼ä¸º28800så³8å°æ—¶,æˆ‘ä»¬æ”¹ä¸º100s</p><pre><code class="ini"># Default Homebrew MySQL server config[mysqld]# Only allow connections from localhostbind-address = 0.0.0.0wait_timeout=100interactive_timeout=100</code></pre><p>é‡æ–°æŸ¥çœ‹ç»“æœ</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210603144255.png" alt=""></p><p>æŸ¥çœ‹å¯¹å®ˆæŠ¤è¿›ç¨‹è¿æ¥çš„å½±å“</p><pre><code class="php"> public function longT()    &#123;        $TicketModel = new TicketModel();        $this-&gt;success(&#39;å¼€å§‹å»ºç«‹è¿æ¥...&#39;);        while (true) &#123;            sleep(120);            dump($TicketModel-&gt;select(&#39;t_id&#39;)-&gt;fetch());        &#125;    &#125;</code></pre><p>å‘ç°åœ¨100såçš„è¿æ¥å·²è¢«ä¸»åŠ¨æ–­å¼€</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210603144315.png" alt=""></p><p>ä»£ç ä¸­çš„åœºæ™¯æ˜¯ï¼Œ<strong>åœ¨wait_timeoutä¹‹å†…æ— ä»»ä½•æ“ä½œä¼šè‡ªåŠ¨å…³é—­</strong></p><h2 id="å®˜æ–¹è§£é‡Š"><a href="#å®˜æ–¹è§£é‡Š" class="headerlink" title="å®˜æ–¹è§£é‡Š"></a>å®˜æ–¹è§£é‡Š</h2><p>interactive_timeout 28800</p><blockquote><p>The number of seconds the server waits for activity on an interactive connection before closing it. An interactive client is defined as a client that uses the <strong>CLIENT_INTERACTIVE</strong> option to mysql_real_connect(). See also wait_timeout.</p></blockquote><p>waitimeout 28800</p><p>The number of seconds the server waits for activity on a noninteractive connection before closing it.</p><p>On thread startup, the session wait_timeout value is initialized from the global wait_timeout value or from the global interactive_timeout value, depending on the type of client (as defined by the CLIENT_INTERACTIVE connect option to mysql_real_connect()). See also interactive_timeout.</p><p>é€šè¿‡MySQLå®¢æˆ·ç«¯è¿æ¥dbçš„æ˜¯äº¤äº’ä¼šè¯ï¼Œé€šè¿‡jdbcç­‰ç¨‹åºè¿æ¥dbçš„æ˜¯éäº¤äº’ä¼šè¯ã€‚ </p><p>æ€»ç»“ï¼š</p><p>å¦‚æœåº”ç”¨ç¨‹åºé•¿æ—¶é—´çš„ä½¿ç”¨ä¸€ä¸ªè¿æ¥ï¼Œè€Œæœ‰æœºä¼šé•¿æ—¶é—´ä¸è¿›è¡Œä»»ä½•æ“ä½œã€‚åˆ™ä¼šå¯¼è‡´è¿æ¥è¢«å…³é—­ã€‚</p><p>å‚è€ƒæ–‡çŒ®:</p><p>1.<a href="https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html">https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html</a><br>2.<a href="https://cloud.tencent.com/developer/article/1181515">https://cloud.tencent.com/developer/article/1181515</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue+quasar+electron+springboot+mysqlæ’¸ä¸€ä¸ªTODO LIST çœ‹æ¿</title>
      <link href="2021/04/09/vue-quasar-electron-springboot-mysql%E6%92%B8%E4%B8%80%E4%B8%AATODO-LIST-%E7%9C%8B%E6%9D%BF/"/>
      <url>2021/04/09/vue-quasar-electron-springboot-mysql%E6%92%B8%E4%B8%80%E4%B8%AATODO-LIST-%E7%9C%8B%E6%9D%BF/</url>
      
        <content type="html"><![CDATA[<p>å…ˆçœ‹æ•ˆæœ</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210330200044.png" alt=""></p><p>å†™æœ¬é¡¹ç›®çš„ç›®çš„æœ‰å‡ ç‚¹ï¼š</p><ol><li>å­¦ä¹ ä¸‹vue+electronæ¡Œé¢å¼€å‘</li><li>å­¦ä¹ ä¸‹javaå’Œspringå¼€å‘(æœ¬äººä¸€ç›´ä½¿ç”¨PHP)</li><li>ä¸€ç›´ç¼ºå°‘ä¸€æ¬¾èƒ½é€‚åˆè‡ªå·±çš„TODO LISTè½¯ä»¶ï¼Œèƒ½æœ‰æ¡Œé¢ç«¯çš„</li></ol><span id="more"></span><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210409114201.png" alt=""></p><p>å¯ç›´æ¥æ‰“åŒ…æˆdmgã€exe ç­‰äºŒè¿›åˆ¶æ–‡ä»¶ä½¿ç”¨ã€‚<br>è¿™æ˜¯æˆ‘æ‰“åŒ…åçš„æ•ˆæœã€‚</p><h2 id="æŠ€æœ¯æ ˆ"><a href="#æŠ€æœ¯æ ˆ" class="headerlink" title="æŠ€æœ¯æ ˆ"></a>æŠ€æœ¯æ ˆ</h2><ul><li>vue</li><li>quasar</li><li>electron</li><li>springboot</li><li>mysql</li></ul><h2 id="è‡ªå®šä¹‰æ³¨è§£"><a href="#è‡ªå®šä¹‰æ³¨è§£" class="headerlink" title="è‡ªå®šä¹‰æ³¨è§£"></a>è‡ªå®šä¹‰æ³¨è§£</h2><h2 id="æºç åœ°å€"><a href="#æºç åœ°å€" class="headerlink" title="æºç åœ°å€"></a>æºç åœ°å€</h2><ul><li>å‰ç«¯ <a href="https://github.com/visonforcoding/carambola-todo">https://github.com/visonforcoding/carambola-todo</a></li><li>åç«¯ <a href="https://github.com/visonforcoding/carambola-todo-service">https://github.com/visonforcoding/carambola-todo-service</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¹¶å‘ç¼–ç¨‹æ—¥è®°-çº¿ç¨‹ä¸å®‰å…¨çš„å±å®³</title>
      <link href="2021/03/03/%E7%BC%96%E5%8F%91%E7%BC%96%E7%A8%8B%E6%97%A5%E8%AE%B0-%E7%BA%BF%E7%A8%8B%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E5%8D%B1%E5%AE%B3/"/>
      <url>2021/03/03/%E7%BC%96%E5%8F%91%E7%BC%96%E7%A8%8B%E6%97%A5%E8%AE%B0-%E7%BA%BF%E7%A8%8B%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E5%8D%B1%E5%AE%B3/</url>
      
        <content type="html"><![CDATA[<p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210303192545.png" alt=""></p><span id="more"></span><h2 id="è®¡æ•°å™¨"><a href="#è®¡æ•°å™¨" class="headerlink" title="è®¡æ•°å™¨"></a>è®¡æ•°å™¨</h2><pre><code class="java">@WebServlet(name = &quot;HelloServlet&quot;, urlPatterns = &#123;&quot;/hello&quot;&#125;)public class HelloServlet extends HttpServlet &#123;    private static final Logger LOG = Logger.getLogger(HelloServlet.class.getName());    private Integer count = 0;    @Override    protected void doGet(HttpServletRequest request, HttpServletResponse response)            throws ServletException, IOException &#123;        ++count;        processRequest(request, response);        LOG.info(String.format(&quot;è®¡æ•° %d&quot;, count));    &#125;&#125;</code></pre><p>æŒ‰å¸¸ç†å¤šå°‘æ¬¡è¯·æ±‚åå°±ä¼šæ‰“å°å‡ºè®¡æ•°å¤šå°‘ã€‚</p><pre><code>ab -n300 -c20 http://localhost:8080/servlet-demo/hello</code></pre><p>æ­£å¸¸ä¸‹ï¼Œæ‰§è¡Œç¬¬ä¸€æ¬¡ è®¡æ•°åº”ä¸º300</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210303194840.png" alt=""></p><p>äº‹å®ä¸Šå¾—åˆ°çš„å´ä¸æ˜¯</p><p>å†æ‰§è¡Œ..</p><p>2 ~ 590<br>3 ~ 879<br>4 ~ 1170</p><p>å‡ ä¹æ²¡æœ‰è§„å¾‹ï¼Œå¹¶ä¸æ˜¯é¢„æœŸçš„ 300çš„å€æ•°ã€‚</p><h2 id="è§£é‡Š"><a href="#è§£é‡Š" class="headerlink" title="è§£é‡Š"></a>è§£é‡Š</h2><p>å®é™…ä¸Š<code>++count</code>æ˜¯ä¸€ä¸ªè¯»å–-ä¿®æ”¹-å†™å…¥çš„æ“ä½œã€‚</p><p>å‡è®¾çº¿ç¨‹Aã€B åŒæ—¶è¯»å–åˆ°äº†å€¼æ˜¯m,åŒæ—¶å†™å…¥+1åçš„å€¼m+1ã€‚ç»“æœcount = m+1,åˆ™äº‹å®ä¸Šæ•´ä¸ªè®¡æ•°å°±å°‘äº†1,åº”è¯¥ä¸ºm+2ã€‚</p><h2 id="å¤„ç†"><a href="#å¤„ç†" class="headerlink" title="å¤„ç†"></a>å¤„ç†</h2><p>å°†<code>count</code>å£°æ˜ä¸º<code>AtomicInter</code></p><pre><code class="java">    private Integer count = 0;    private AtomicInteger atomicCount = new AtomicInteger(0);    @Override    protected void doGet(HttpServletRequest request, HttpServletResponse response)            throws ServletException, IOException &#123;        ++count;        processRequest(request, response);        LOG.info(String.format(&quot;è®¡æ•°count %d&quot;, count));        LOG.info(String.format(&quot;è®¡æ•°atomicCount %d&quot;, atomicCount.incrementAndGet()));    &#125;</code></pre><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210309095018.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>AtomicInteger</code>ç»Ÿè®¡çš„æ˜¯æ­£ç¡®çš„äº†ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>spring-bootè®°å½•sqlæ¢ç´¢</title>
      <link href="2021/02/23/java/spring-boot%E8%AE%B0%E5%BD%95sql%E6%8E%A2%E7%B4%A2/"/>
      <url>2021/02/23/java/spring-boot%E8%AE%B0%E5%BD%95sql%E6%8E%A2%E7%B4%A2/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ç›®æ ‡è®°å½•æ¯æ¬¡è¯·æ±‚å†…çš„httpã€esã€mysqlè€—æ—¶ï¼Œæœ¬ç¯‡è®¨è®ºmysqléƒ¨åˆ†</p></blockquote><p>ä¸ºä»€ä¹ˆè¯´è¦æ¢ç´¢ï¼Œè¿™ä¸æ˜¯å¾ˆç®€å•çš„äº‹ä¹ˆï¼Ÿä½†æ˜¯èƒ½æ»¡è¶³ä»¥ä¸‹å‡ ç‚¹ä¹ˆï¼Ÿ</p><ul><li>èƒ½è®°å½•limitç­‰å‚æ•°</li><li>èƒ½å°†å‚æ•°å’Œsqlå†™ä¸€èµ·ï¼Œèƒ½ç›´æ¥ä½¿ç”¨</li><li>èƒ½è®°å½•è€—æ—¶</li><li>èƒ½è®¡æ•°ç´¯åŠ ,ç»Ÿè®¡ä¸€æ¬¡è¯·æ±‚ä¸­sqlæ‰§è¡Œçš„æ€»æ•°å’Œæ€»è€—æ—¶</li></ul><span id="more"></span><h2 id="springåŸç”Ÿèƒ½åŠ›"><a href="#springåŸç”Ÿèƒ½åŠ›" class="headerlink" title="springåŸç”Ÿèƒ½åŠ›"></a>springåŸç”Ÿèƒ½åŠ›</h2><pre><code class="ini">logging.level.org.hibernate.SQL=debuglogging.level.org.hibernate.type.descriptor.sql.BasicBinder=trace</code></pre><p>é€šè¿‡ä¸Šé¢ä¸¤æ¡é…ç½®ã€‚</p><ul><li>âœ”ï¸å¯ä»¥æ˜¾ç¤ºsql.</li><li>âŒä¸èƒ½å’Œå‚æ•°ä¸€è¡Œæ˜¾ç¤º</li><li>âŒä¸èƒ½æ˜¾ç¤ºlimitå‚æ•°</li><li>âŒä¸èƒ½è®¡æ•°å’Œè®°å½•è€—æ—¶</li></ul><pre><code>2021-02-23 19:35:42.932 DEBUG 97586 --- [  restartedMain] org.hibernate.SQL                        : select admin0_.id as id1_0_, admin0_.create_time as create_t2_0_, admin0_.modify_time as modify_t3_0_, admin0_.email as email4_0_, admin0_.password as password5_0_, admin0_.status as status6_0_, admin0_.username as username7_0_ from admin admin0_ where admin0_.username=?2021-02-23 19:35:42.949 TRACE 97586 --- [  restartedMain] o.h.type.descriptor.sql.BasicBinder      : binding parameter [1] as [VARCHAR] - [root]</code></pre><h2 id="åŸç”Ÿlog-org-hibernate-EmptyInterceptor"><a href="#åŸç”Ÿlog-org-hibernate-EmptyInterceptor" class="headerlink" title="åŸç”Ÿlog+org.hibernate.EmptyInterceptor"></a>åŸç”Ÿlog+org.hibernate.EmptyInterceptor</h2><p><code>org.hibernate.EmptyInterceptor</code>æä¾›é’©å­ï¼Œhibernateæœ¬èº«æä¾›entityçš„curdé’©å­ã€‚é‡å†™<code>EmptyInterceptor</code>æ–¹æ³•ï¼Œå¯ä»¥å®ç°è®¡æ•°ã€‚ä½†æ˜¯<code>onPrepareStatement</code>æ–¹æ³•åªæ˜¯è£…é…sqlå‰çš„äº‹ä»¶ï¼Œè€Œä¸”ä¸æ˜¯å®Œæ•´çš„sqlã€‚</p><ul><li>âœ”ï¸ å¯ä»¥æ˜¾ç¤ºsql</li><li>âŒ ä¸èƒ½å’Œå‚æ•°ä¸€è¡Œæ˜¾ç¤º</li><li>âŒ ä¸èƒ½æ˜¾ç¤ºlimitå‚æ•°</li><li>âœ”ï¸ èƒ½è®¡æ•°</li><li>âŒ ä¸èƒ½è®°å½•è€—æ—¶</li></ul><pre><code class="ini">spring.jpa.properties.hibernate.ejb.interceptor=com.vison.itdoc.config.HibernateInterceptor</code></pre><pre><code class="java">public class HibernateInterceptor extends EmptyInterceptor &#123;    @Override    public boolean onLoad(Object entity, Serializable id, Object[] state, String[] propertyNames, Type[] types) &#123;//        Log.info(&quot;onload...&quot;, entity)        return true;    &#125;    @Override    public String onPrepareStatement(String string) &#123;        // count++        return INSTANCE.onPrepareStatement(string);    &#125;    @Override    public void afterTransactionCompletion(Transaction t) &#123;        INSTANCE.afterTransactionCompletion(t);        Log.info(&quot;after trans complete&quot;, t);    &#125;&#125;</code></pre><h2 id="log4jdbc"><a href="#log4jdbc" class="headerlink" title="log4jdbc"></a>log4jdbc</h2><p>log4jdbcèƒ½å¾ˆå¥½çš„è§£å†³sqlå®Œæ•´æ˜¾ç¤ºå’Œè®°å½•è€—æ—¶çš„é—®é¢˜</p><pre><code>2021-02-23 19:59:13.709  INFO 97586 --- [nio-8081-exec-1] jdbc.sqltiming                           : select posts0_.id as id1_2_, posts0_.create_time as create_t2_2_, posts0_.modify_time as modify_t3_2_, posts0_.content as content4_2_, posts0_.title as title5_2_ from posts posts0_ where 1=1 order by posts0_.id asc limit 10 ; &#123;executed in 1 msec&#125;</code></pre><p>è¿˜èƒ½å¤Ÿå®šä¹‰è¶…è¿‡1å®šæ—¶é—´çš„æ‰§è¡Œsqlè®°å½•ä¸ºerrorç±»å‹ã€‚</p><pre><code class="xml">        &lt;dependency&gt;            &lt;groupId&gt;com.googlecode.log4jdbc&lt;/groupId&gt;            &lt;artifactId&gt;log4jdbc&lt;/artifactId&gt;            &lt;version&gt;1.2&lt;/version&gt;            &lt;scope&gt;runtime&lt;/scope&gt;        &lt;/dependency&gt;</code></pre><pre><code class="ini">spring.datasource.driver-class-name: net.sf.log4jdbc.DriverSpy#ä½¿ç”¨log4jdbcåmysqlçš„urlspring.datasource.url=jdbc:log4jdbc:mysql://localhost:3306/xxxx?useUnicode=true&amp;characterEncoding=UTF-8#ä½¿ç”¨log4jdbcåoracleçš„url#spring.datasource.url: jdbc:log4jdbc:oracle:thin:@127.0.0.1:1521:orcl</code></pre><p>æ³¨æ„éœ€è¦æ·»åŠ <code>spring.datasource.driver-class-name</code> å’Œæ›´æ”¹ <code>spring.datasource.url</code> å°†jdbcæ”¹ä¸º jdbc:log4jdbc</p><p><em>log4jdbc.properties</em>å¯ä»¥å®šä¹‰æ›´å¤šé…ç½®</p><pre><code class="ini">#é…ç½®ä¸ºéœ€è¦è®°å½•çš„åŒ…æˆ–ç±»åŒ¹é…è·¯å¾„#log4jdbc.debug.stack.prefix=com.drp#log4jdbcåŠ è½½çš„drivers (é©±åŠ¨å)#log4jdbc.drivers=oracle.jdbc.OracleDriverlog4jdbc.auto.load.popular.drivers=true#åœ¨æ—¥å¿—ä¸­æ˜¾ç¤ºwarnè­¦å‘Šlog4jdbc.statement.warn=true#æ¯«ç§’å€¼.æ‰§è¡Œæ—¶é—´è¶…è¿‡è¯¥å€¼çš„SQLè¯­å¥å°†è¢«è®°å½•ä¸ºwarnçº§åˆ«.log4jdbc.sqltiming.warn.threshold=2000#æ¯«ç§’å€¼.æ‰§è¡Œæ—¶é—´è¶…è¿‡è¯¥å€¼çš„SQLè¯­å¥å°†è¢«è®°å½•ä¸ºerrorçº§åˆ«.log4jdbc.sqltiming.error.threshold=3000#æ˜¯æŠŠbooleanè®°å½•ä¸º &#39;true&#39;/&#39;false&#39; è¿˜æ˜¯ 1/0. é»˜è®¤è®¾ç½®ä¸ºfalse,ä¸å¯ç”¨,ä¸ºäº†ç§»æ¤æ€§.#log4jdbc.dump.booleanastruefalse=true#è¾“å‡ºçš„sql,ä¸€è¡Œæœ€å¤§çš„å­—ç¬¦æ•°ï¼Œé»˜è®¤90. ä»¥åæ–°ç‰ˆå¯èƒ½ä¸º0#log4jdbc.dump.sql.maxlinelength=90#å¦‚æœåœ¨è°ƒè¯•æ¨¡å¼ä¸‹è½¬å‚¨ï¼Œåˆ™è½¬å‚¨æ•´ä¸ªå †æ ˆè·Ÿè¸ª  é»˜è®¤falselog4jdbc.dump.fulldebugstacktrace=false#æ˜¯å¦è®°å½•æŸäº›ç±»å‹çš„è¯­å¥ï¼Œé»˜è®¤truelog4jdbc.dump.sql.select=truelog4jdbc.dump.sql.insert=truelog4jdbc.dump.sql.delete=truelog4jdbc.dump.sql.update=truelog4jdbc.dump.sql.create=true#è¾“å‡ºsqlæœ«å°¾å¤„åŠ å…¥åˆ†å·ï¼Œé»˜è®¤falselog4jdbc.dump.sql.addsemicolon=true#å°†æ­¤è®¾ç½®ä¸ºfalseä»¥ä¸ä¿®å‰ªå·²è®°å½•çš„SQLlog4jdbc.trim.sql=true#å°†æ­¤è®¾ç½®ä¸ºfalseä¸åˆ é™¤é¢å¤–çš„ç©ºè¡Œlog4jdbc.trim.sql.extrablanklines=true#log4jdbc.suppress.generated.keys.exception=false</code></pre><ul><li>âœ”ï¸ å¯ä»¥æ˜¾ç¤ºsql</li><li>âœ”ï¸ ä¸èƒ½å’Œå‚æ•°ä¸€èµ·æ˜¾ç¤º</li><li>âœ”ï¸ ä¸èƒ½æ˜¾ç¤ºlimitå‚æ•°</li><li>âŒ èƒ½è®¡æ•°</li><li>âœ”ï¸  èƒ½è®°å½•å•ä¸ªsqlè€—æ—¶</li><li>âŒ ä¸èƒ½ç»Ÿè®¡æ€»è€—æ—¶</li></ul><p>ä¸è¶³çš„æ˜¯ï¼Œå•çº¯log4jdbcå¹¶ä¸èƒ½æ»¡è¶³æ‰€æœ‰ã€‚ç†è®ºä¸Šlog4jdbc+org.hibernate.EmptyInterceptorå¯ä»¥æ»¡è¶³éœ€æ±‚äº†</p><h2 id="P6Spy"><a href="#P6Spy" class="headerlink" title="P6Spy"></a>P6Spy</h2><p>æµ‹è¯•å®Œæ¯•ï¼Œå‘ç°P6Spyç›®å‰æœ€èƒ½æ»¡è¶³éœ€æ±‚ï¼š</p><ul><li>âœ”ï¸ å¯ä»¥æ˜¾ç¤ºsql</li><li>âœ”ï¸ ä¸èƒ½å’Œå‚æ•°ä¸€èµ·æ˜¾ç¤º</li><li>âœ”ï¸ ä¸èƒ½æ˜¾ç¤ºlimitå‚æ•°</li><li>âœ”ï¸ èƒ½è®¡æ•°</li><li>âœ”ï¸ ä¸èƒ½è®°å½•è€—æ—¶</li><li>âœ”ï¸ æ”¯æŒcurdäº‹ä»¶å‰åé’©å­ï¼Œé’©å­å‚æ•°è¿”å›sqlå’Œæ‰§è¡Œè€—æ—¶åŠå¼‚å¸¸ä¿¡æ¯ğŸš€</li></ul><pre><code class="xml">        &lt;dependency&gt;            &lt;groupId&gt;p6spy&lt;/groupId&gt;            &lt;artifactId&gt;p6spy&lt;/artifactId&gt;            &lt;version&gt;3.9.1&lt;/version&gt;        &lt;/dependency&gt;</code></pre><p>åŒ<code>log4jdbc</code>éœ€è¦æ”¹driverå’Œurl</p><pre><code class="ini">spring.datasource.driver-class-name=com.p6spy.engine.spy.P6SpyDriverspring.datasource.url=jdbc:p6spy:mysql://localhost:3306/test?useLegacyDatetimeCode=false&amp;serverTimezone=UTC</code></pre><p><em>psy.properties</em>å¯ä»¥å®šä¹‰æ›´å¤šé…ç½®</p><pre><code class="ini">#modulelist=com.p6spy.engine.spy.P6SpyFactory,com.p6spy.engine.logging.P6LogFactory,com.p6spy.engine.outage.P6OutageFactorymodulelist=com.vison.itdoc.config.CustomeP6Factory,com.p6spy.engine.logging.P6LogFactory,com.p6spy.engine.outage.P6OutageFactory#moduelistå¾ˆå…³é”®ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨äº†è‡ªå®šä¹‰çš„Factoryï¼Œå› ä¸ºæˆ‘éœ€è¦è‡ªå®šä¹‰eventappender=com.p6spy.engine.spy.appender.Slf4JLoggerlogMessageFormat=com.p6spy.engine.spy.appender.CustomLineFormatcustomLogMessageFormat=%(executionTime) ms|%(category)|%(sql)excludecategories=result,resultset,info,debug</code></pre><p>æ­£å¸¸ä½¿ç”¨é»˜è®¤é…ç½®å°±å¯ä»¥æ˜¾ç¤ºå‡ºsqlå’Œè€—æ—¶ä¿¡æ¯</p><pre><code> 4 ms|statement|select admin0_.id as id1_0_, admin0_.create_time as create_t2_0_, admin0_.modify_time as modify_t3_0_, admin0_.email as email4_0_, admin0_.password as password5_0_, admin0_.status as status6_0_, admin0_.username as username7_0_ from admin admin0_ where admin0_.username=&#39;root&#39;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œè€—æ—¶ä¿¡æ¯å’Œå®é™…å‚æ•°</p><h3 id="è‡ªå®šä¹‰äº‹ä»¶"><a href="#è‡ªå®šä¹‰äº‹ä»¶" class="headerlink" title="è‡ªå®šä¹‰äº‹ä»¶"></a>è‡ªå®šä¹‰äº‹ä»¶</h3><p><code>modulelist=com.p6spy.engine.spy.P6SpyFactory</code>æ”¹æˆ<code>è‡ªå®šä¹‰Factory</code></p><p>è‡ªå®šä¹‰Factory</p><pre><code class="java">public class CustomeP6Factory implements com.p6spy.engine.spy.P6Factory &#123;    @Override    public P6LoadableOptions getOptions(P6OptionsRepository optionsRepository) &#123;        return new P6SpyOptions(optionsRepository);    &#125;    @Override    public JdbcEventListener getJdbcEventListener() &#123;        return new P6spyListener(); //ä½¿ç”¨è‡ªå®šä¹‰Listener    &#125;&#125;</code></pre><p>è‡ªå®šä¹‰äº‹ä»¶</p><pre><code class="java">public class P6spyListener extends JdbcEventListener &#123;    @Override    public void onAfterExecuteQuery(PreparedStatementInformation statementInformation, long timeElapsedNanos, SQLException e) &#123;        App.sqlCount.incrementAndGet();        Log.info(&quot;execute query...&quot;, statementInformation.getSqlWithValues());    &#125;    @Override    public void onAfterExecuteUpdate(PreparedStatementInformation statementInformation, long timeElapsedNanos, int rowCount, SQLException e) &#123;        App.sqlCount.incrementAndGet();        Log.info(&quot;execute update..&quot;, statementInformation.getSqlWithValues());    &#125;    @Override    public void onAfterExecute(StatementInformation statementInformation, long timeElapsedNanos, String sql, SQLException e) &#123;        Log.info(&quot;execute..&quot;, statementInformation.getSqlWithValues());    &#125;&#125;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘åœ¨è‡ªå®šä¹‰äº‹ä»¶ä¸­è¿›è¡Œäº†sqlè®¡æ•°.äºæ˜¯æˆ‘å¯ä»¥åœ¨è¯·æ±‚ç»“æŸæ—¶æ‰“å°æ¯æ¬¡è¯·æ±‚çš„æ€»sqlæ‰§è¡Œæ¬¡æ•°ã€‚</p><pre><code class="java">public class RequestInitInterceptor implements HandlerInterceptor &#123;    public RequestInitInterceptor() &#123;    &#125;    @Override    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler)            throws Exception &#123;        App._uniq_req_no = UUID.randomUUID().toString();        App.sqlCount = new AtomicInteger(0);        Log.setMsgTraceNo(App._uniq_req_no);        Log.info(&quot;request start...&quot;, handler);        return true;    &#125;    @Override    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)            throws Exception &#123;        Log.info(String.format(&quot;finish request sqlæ‰§è¡Œæ¬¡æ•°:%s&quot;, App.sqlCount));    &#125;&#125;</code></pre><p>ç”±äºäº‹ä»¶å‚æ•°è¿˜ç»™å‡ºäº†<code>timeElapsedNanos</code>,æœ€ç»ˆæˆ‘ä»¬è¿˜èƒ½ç»Ÿè®¡å‡ºæ‰€æœ‰sqlæ‰§è¡Œçš„è€—æ—¶ã€‚è¿™æ ·ä¸€æ¥æˆ‘ä»¬å°±èƒ½çœ‹å‡ºä¸€æ¬¡è¯·æ±‚å†…ï¼Œæœ€è€—æ—¶çš„æ“ä½œå…·ä½“æ˜¯ä»€ä¹ˆã€‚è¾¾åˆ°ç±»ä¼¼ä»¥ä¸‹æ•ˆæœï¼š</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210224141855.png" alt=""></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="http://knes1.github.io/blog/2015/2015-07-08-counting-queries-per-request-with-hibernate-and-spring.html">Counting Queries per Request with Hibernate and Spring</a></li><li><a href="https://github.com/p6spy/p6spy/issues/362">register an event handler</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>spring-boot+vue+supervisor+nginxçš„å‰åç«¯åˆ†ç¦»éƒ¨ç½²</title>
      <link href="2021/02/22/spring-boot-vue%E7%9A%84%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%83%A8%E7%BD%B2/"/>
      <url>2021/02/22/spring-boot-vue%E7%9A%84%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%83%A8%E7%BD%B2/</url>
      
        <content type="html"><![CDATA[<ul><li>è¦ä¿è¯åŒåŸŸéƒ¨ç½²,å› ä¸ºè·¨åŸŸä¼šæœ‰å¾ˆå¤šé—®é¢˜è¦é‡æ–°è§£å†³</li></ul><p>é¡ºä¾¿æ ‘ä¸‹ï¼Œä½†å…¶å®ç°åœ¨äº’è”ç½‘äº§å“ä¸€èˆ¬éƒ½æœ‰å¤šå®¢æˆ·ç«¯ï¼Œpc web ã€å°ç¨‹åºã€appã€‚ä¿å®ˆçš„åŒåŸŸsessionæ¨¡å¼ä¿æŒä¼šè¯å·²ç»æ»¡è¶³ä¸äº†ä¸€äº›éœ€æ±‚ã€‚æ¯”å¦‚ï¼Œå•ç«¯ç™»å½•ç­‰ã€‚</p><p>è¨€å½’æ­£ä¼ ï¼Œæˆ‘é‡‡å–çš„æ€è·¯æ˜¯ï¼Œå‰ç«¯è¯·æ±‚æ¥å£æ—¶ç»Ÿä¸€åŠ ä¸Šapiå‰ç¼€ï¼Œnginxå°†apiå‰ç¼€çš„è·¯ç”±è¯·æ±‚ä»£ç†è½¬å‘åˆ°spring-boot</p><span id="more"></span><h2 id="nginxé…ç½®"><a href="#nginxé…ç½®" class="headerlink" title="nginxé…ç½®"></a>nginxé…ç½®</h2><pre><code class="nginx">server &#123;    server_name admin.domain.xyz;    index index.html;    location  / &#123;                index index.html;                root /home/wwwuser/webroot/itdoc-admin-web/dist/spa;        &#125;    location /api/ &#123;              proxy_pass  http://127.0.0.1:8081/;        &#125;    # optionally disable falling back to PHP script for the asset directories;    # nginx will return a 404 error when files are not found instead of passing the    # request to Symfony (improves performance but Symfony&#39;s 404 page is not displayed)    # location /bundles &#123;    #     try_files $uri =404;    # &#125;    error_log /var/log/nginx/admin_error.log;    access_log /var/log/nginx/admin_access.log;&#125;</code></pre><h2 id="supervisorå®ˆæŠ¤java-jar"><a href="#supervisorå®ˆæŠ¤java-jar" class="headerlink" title="supervisorå®ˆæŠ¤java -jar"></a>supervisorå®ˆæŠ¤java -jar</h2><p>æˆ‘è¿™é‡Œé‡‡å–java -jaræ¨¡å¼éƒ¨ç½²ï¼Œä½†æ˜¯å•çº¯çš„è¿™ç§æ¨¡å¼å¹¶ä¸èƒ½ä¿è¯è‡ªå¯åŠ¨å’Œè¿›ç¨‹ç›‘æ§ç­‰ã€‚å› æ­¤éœ€è¦å€ŸåŠ©supervisorã€‚</p><pre><code class="ini">[program:itdoc]command=/usr/local/jdk-11.0.2/bin/java -jar itdoc-0.0.2-SNAPSHOT.jarprocess_name=%(program_name)snumprocs=1directory=/home/wwwuser/webrootumask=022priority=999autostart=trueautorestart=unexpectedstartsecs=10startretries=3exitcodes=0stopsignal=TERMstopwaitsecs=10stopasgroup=falsekillasgroup=falseuser=wwwuserredirect_stderr=falsestdout_logfile=/var/log/webroot/itdoc-out.logstdout_logfile_maxbytes=1MBstdout_logfile_backups=10stdout_capture_maxbytes=1MBstdout_events_enabled=falsestderr_logfile=/var/log/webroot/itdoc-err.logstderr_logfile_maxbytes=1MBstderr_logfile_backups=10stderr_capture_maxbytes=1MB</code></pre><p>è¿™é‡Œçš„<code>autostart</code> å’Œ <code>autorestart</code> èƒ½ä¿è¯è‡ªå¯åŠ¨å’Œå¯åŠ¨é‡å¯</p>]]></content>
      
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ©ç”¨Locustè¿›è¡Œæ€§èƒ½æµ‹è¯•</title>
      <link href="2021/01/23/%E5%88%A9%E7%94%A8Locust%E8%BF%9B%E8%A1%8C%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/"/>
      <url>2021/01/23/%E5%88%A9%E7%94%A8Locust%E8%BF%9B%E8%A1%8C%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<ul><li>è¦çœ‹ä¸€ä¸ªé¡¹ç›®çš„æœ€å¤§å¯ç”¨èƒ½åŠ›æ˜¯å¤šå°‘ï¼Œæ€§èƒ½æµ‹è¯•å·¥ä½œå°‘ä¸äº†.</li><li>æ¯ä¸€ä¸ªé¡¹ç›®éƒ½åº”è¯¥åšå‹æµ‹</li><li>å¤šçº¿ç¨‹å¹¶å‘æ¨¡å‹ä¸€å®šè¦åšå‹æµ‹</li></ul><span id="more"></span><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><pre><code>$ pip3 install locust</code></pre><h2 id="ç¼–å†™è„šæœ¬"><a href="#ç¼–å†™è„šæœ¬" class="headerlink" title="ç¼–å†™è„šæœ¬"></a>ç¼–å†™è„šæœ¬</h2><pre><code class="python">import timefrom locust import HttpUser, task, betweenclass QuickstartUser(HttpUser):    wait_time = between(1, 2.5)    @task    def hello_world(self):        self.client.get(&quot;/hello&quot;)        self.client.get(&quot;/world&quot;)    @task(3)    def view_items(self):        for item_id in range(10):            self.client.get(f&quot;/item?id=&#123;item_id&#125;&quot;, name=&quot;/item&quot;)            time.sleep(1)    def on_start(self):        self.client.post(&quot;/login&quot;, json=&#123;&quot;username&quot;:&quot;foo&quot;, &quot;password&quot;:&quot;bar&quot;&#125;)</code></pre><p><code>wait_time = between(1, 2.5)</code></p><p>Our class defines a wait_time that will make the simulated users wait between 1 and 2.5 seconds after each task (see below) is executed. For more info see wait_time attribute.</p><p><code>def hello_world(self):</code></p><pre><code class="python">@taskdef hello_world(self):    self.client.get(&quot;/hello&quot;)    self.client.get(&quot;/world&quot;)@task(3)def view_items(self):...</code></pre><p><code>task(3)</code> å†…çš„å‚æ•°è¡¨ç¤ºä»»åŠ¡æ‰§è¡Œçš„æƒé‡ï¼Œ<code>view_items</code>çš„æ¬¡æ•°å°†æ˜¯<code>hello_world</code>æ¬¡æ•°çš„3å€ã€‚</p><h2 id="æ‰§è¡Œ"><a href="#æ‰§è¡Œ" class="headerlink" title="æ‰§è¡Œ"></a>æ‰§è¡Œ</h2><pre><code>$ locust -f locust_files/my_locust_file.py</code></pre><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210330151409.png" alt=""></p><p>ä»»åŠ¡æ‰§è¡Œç•Œé¢å’Œç»“æœ</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210330151426.png" alt=""></p>]]></content>
      
      
      
        <tags>
            
            <tag> è½¯ä»¶å·¥ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é»‘å¯åŠ¨</title>
      <link href="2021/01/21/%E9%BB%91%E5%90%AF%E5%8A%A8/"/>
      <url>2021/01/21/%E9%BB%91%E5%90%AF%E5%8A%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="facebookæ¡ˆä¾‹"><a href="#facebookæ¡ˆä¾‹" class="headerlink" title="facebookæ¡ˆä¾‹"></a>facebookæ¡ˆä¾‹</h2><p>ä½œä¸ºé»‘å¯åŠ¨æµç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œæ¯ä¸ªFacebook ç”¨æˆ·ä¼šè¯ï¼ˆåœ¨ç”¨æˆ·ç«¯æµè§ˆå™¨ä¸­è¿è¡Œ<br>JavaScript ä»£ç ï¼‰éƒ½åŠ è½½äº†æµ‹è¯•å·¥å…·ã€‚è™½ç„¶èŠå¤©åŠŸèƒ½çš„ç”¨æˆ·ç•Œé¢å…ƒç´ è¢«éšè—èµ·æ¥ï¼Œä½†æµè§ˆå™¨<br>è¿˜æ˜¯ä¼šå‘å·²éƒ¨ç½²åœ¨ç”Ÿäº§ç¯å¢ƒä¸­çš„åå°èŠå¤©æœåŠ¡å™¨å‘é€ç”¨æˆ·ä¸å¯è§çš„èŠå¤©æµ‹è¯•ä¿¡æ¯ï¼Œè¿™ä½¿å¼€</p><p>å‘å›¢é˜Ÿèƒ½å¤Ÿåœ¨æ•´ä¸ªé¡¹ç›®è¿‡ç¨‹ä¸­æ¨¡æ‹Ÿå‡ºç±»ç”Ÿäº§è´Ÿè½½ï¼Œä»è€Œåœ¨å‘å¸ƒä¹‹å‰æ‰¾å‡ºå¹¶è§£å†³æ€§èƒ½é—®é¢˜ã€‚</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210121214126.jpeg" alt=""></p><p>è€å­æƒŠäº†,è¿™æœ‰ç‚¹ç‰›çš®</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>servleté›†æˆmybatis-æ— xml&amp;æ³¨è§£æ–¹å¼</title>
      <link href="2021/01/06/java/servlet%E9%9B%86%E6%88%90mybatis-%E6%97%A0xml-%E6%B3%A8%E8%A7%A3%E6%96%B9%E5%BC%8F/"/>
      <url>2021/01/06/java/servlet%E9%9B%86%E6%88%90mybatis-%E6%97%A0xml-%E6%B3%A8%E8%A7%A3%E6%96%B9%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ä¹ æƒ¯äº†phpé¡¹ç›®ä¹‹åï¼Œææ€•éå¸¸ä¸å–œæ¬¢æ“ä½œxmlå§.æœ¬ç« å°†ä»‹ç»servlet+mybatisæ— xmlé…ç½®æ¨¡å¼ã€‚</p></blockquote><span id="more"></span><h2 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h2><pre><code class="xml">     &lt;dependency&gt;            &lt;groupId&gt;mysql&lt;/groupId&gt;            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;            &lt;version&gt;5.1.26&lt;/version&gt;        &lt;/dependency&gt;        &lt;!-- https://mvnrepository.com/artifact/org.mybatis/mybatis --&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.mybatis&lt;/groupId&gt;            &lt;artifactId&gt;mybatis&lt;/artifactId&gt;            &lt;version&gt;3.5.6&lt;/version&gt;        &lt;/dependency&gt;</code></pre><h2 id="å¼•å…¥"><a href="#å¼•å…¥" class="headerlink" title="å¼•å…¥"></a>å¼•å…¥</h2><p>é¦–å…ˆå®šä¹‰datasource</p><pre><code class="java">public class DatabaseConfig &#123;    static String driver = &quot;com.mysql.jdbc.Driver&quot;;    static String url = &quot;jdbc:mysql://localhost:3306/db_itdoc?useSSL=false&quot;;    static String username = &quot;root&quot;;    static String password = &quot;12345678&quot;;    public static DataSource getDataSource() &#123;        Properties properties = new Properties();        properties.setProperty(&quot;driver&quot;, driver);        properties.setProperty(&quot;url&quot;, url);        properties.setProperty(&quot;username&quot;, username);        properties.setProperty(&quot;password&quot;, password);        UnpooledDataSourceFactory unpooledDataSourceFactory = new UnpooledDataSourceFactory();        unpooledDataSourceFactory.setProperties(properties);        DataSource dataSource = unpooledDataSourceFactory.getDataSource();        return dataSource;    &#125;&#125;</code></pre><p>è·å–sessionFactory</p><pre><code class="java">public class MybatisLoader &#123;    static SqlSessionFactory sqlSessionFactory = null;    public static SqlSessionFactory getSqlSessionFactory() &#123;        if (sqlSessionFactory == null) &#123;            DataSource dataSource = DatabaseConfig.getDataSource();            TransactionFactory transactionFactory                    = new JdbcTransactionFactory();            Environment environment                    = new Environment(&quot;development&quot;, transactionFactory, dataSource);            Configuration configuration = new Configuration(environment);            configuration.addMapper(UserMapper.class);            sqlSessionFactory                    = new SqlSessionFactoryBuilder().build(configuration);        &#125;        return sqlSessionFactory;    &#125;&#125;</code></pre><h2 id="å®šä¹‰mapper"><a href="#å®šä¹‰mapper" class="headerlink" title="å®šä¹‰mapper"></a>å®šä¹‰mapper</h2><pre><code class="java">public interface UserMapper &#123;    @Select(&quot;SELECT * FROM user WHERE id = #&#123;id&#125;&quot;)    User selectUser(int id);    @Insert(&quot;INSERT INTO user(name,email) VALUES(#&#123;name&#125;, #&#123;email&#125;)&quot;)    int insertUser(User user);&#125;</code></pre><h2 id="æŸ¥è¯¢å’Œæ’å…¥"><a href="#æŸ¥è¯¢å’Œæ’å…¥" class="headerlink" title="æŸ¥è¯¢å’Œæ’å…¥"></a>æŸ¥è¯¢å’Œæ’å…¥</h2><pre><code class="java">public class UserController &#123;    public UserController() &#123;    &#125;    @GetMapping(path = &quot;/user/profile&quot;)    public String profile(HttpServletRequest request, HttpServletResponse response) &#123;        System.out.print(request.getCookies());        return &quot;i am user profile&quot;;    &#125;    @GetMapping(path = &quot;/user&quot;)    public Response user(HttpServletRequest request, int id) &#123;        User user = null;        SqlSession session = MybatisLoader.getSqlSessionFactory().openSession();        UserMapper mapper = session.getMapper(UserMapper.class);        user = mapper.selectUser(id);        return new Response(0, &quot;è·å–æˆåŠŸ&quot;, user);    &#125;    @PostMapping(path = &quot;/user/add&quot;)    public Response add(User user) &#123;        Log.info(&quot;request user&quot;, user);        try &#123;            SqlSession session = MybatisLoader.getSqlSessionFactory().openSession();            UserMapper mapper = session.getMapper(UserMapper.class);            int id = mapper.insertUser(user);            session.commit();            Log.debug(&quot;è¿”å›&quot;, id);        &#125; catch (Exception e) &#123;            Log.error(&quot;ä¿å­˜å¤±è´¥&quot;, e);        &#125;        return new Response(0, &quot;ä¿å­˜&quot;, user);    &#125;&#125;</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ‰‹æ’•javawebå¼€å‘</title>
      <link href="2020/12/22/java/%E6%89%8B%E6%92%95javaweb%E5%BC%80%E5%8F%91/"/>
      <url>2020/12/22/java/%E6%89%8B%E6%92%95javaweb%E5%BC%80%E5%8F%91/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç³»åˆ—æ–‡ç« å°†ä»¥å‡ ä¹0åŸºç¡€javawebä¸ºèƒŒæ™¯æ‰‹å†™ä¸€ä¸ªjavawebæ¡†æ¶å¹¶è¿›è¡Œå¼€å‘ã€‚</p><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><ul><li>0åŸºç¡€javaweb,æ²¡æœ‰javawebå¼€å‘çš„å®é™…ç»éªŒ</li><li>æœ‰å¤šå¹´PHPwebå®æˆ˜ç»éªŒ</li><li>æœ‰ä¸€å®šjavaè¯­æ³•åŸºç¡€</li><li>æœ‰5åˆ†(æ»¡åˆ†100)çš„spring bootçŸ¥è¯†å‚¨å¤‡ï¼Œæ¯•ç«Ÿç”¨spring bootå¯åŠ¨ä¸€ä¸ªhello worldè¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚</li></ul><h2 id="å®—æ—¨"><a href="#å®—æ—¨" class="headerlink" title="å®—æ—¨"></a>å®—æ—¨</h2><p>æœ¬æ–‡å®—æ—¨æ˜¯æƒ³é€šè¿‡æ‰‹å†™java webæ¡†æ¶çš„æ–¹å¼ï¼Œè®©æœ‰å…¶ä»–è¯­è¨€webå¼€å‘ç»éªŒçš„åŒäº‹èƒ½ç”±æµ…å…¥æ·±å­¦ä¼šjava webå¼€å‘å’Œç†è§£å…¶ä¸­åŸç†ã€‚æœ¬ç³»åˆ—æ–‡ç« å°†æœ‰ä»¥ä¸‹å‡ ç‚¹åŸåˆ™ã€‚</p><ul><li>æ³¨é‡å®è·µï¼Œä¸€å®šä¼šæœ‰æºä»£ç è¿è¡ŒæˆåŠŸæ¡ˆä¾‹</li><li>æœ‰ç†æœ‰æ®ï¼Œä¸€äº›å®ç°å¿…é¡»æœ‰å®˜æ–¹æˆ–æƒå¨æ–‡çŒ®è§£é‡Š</li></ul><h2 id="æ›´æ–°ç›®å½•"><a href="#æ›´æ–°ç›®å½•" class="headerlink" title="æ›´æ–°ç›®å½•"></a>æ›´æ–°ç›®å½•</h2><ol><li><a href="https://visonforcoding.github.io/2020/12/18/java/%E6%98%A5%E5%A4%A9%E4%B9%8B%E5%89%8D-http/">æ‰‹æ’•javaweb-HTTPå‰ä¸–</a></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>log4jä½¿ç”¨æŒ‡å—</title>
      <link href="2020/12/21/java/log4j%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/"/>
      <url>2020/12/21/java/log4j%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<p>å¯¹äºåˆšå¼€å§‹æ¥è§¦javaçš„äººæ¥è¯´ï¼Œç”¨ä»€ä¹ˆæ¥æ‰“æ—¥å¿—ä¼¼ä¹å¿«è¢«javaçš„è¿™ä¹ˆå¤šæ¦‚å¿µææ‡µäº†ã€‚log4jã€log4j2ã€slf4jã€logback?!!</p><span id="more"></span><h2 id="log4j"><a href="#log4j" class="headerlink" title="log4j"></a>log4j</h2><p>Apache Log4j æ˜¯ä¸€ä¸ªéå¸¸å¤è€çš„æ—¥å¿—æ¡†æ¶ï¼Œå¹¶ä¸”æ˜¯å¤šå¹´æ¥æœ€å—æ¬¢è¿çš„æ—¥å¿—æ¡†æ¶ã€‚ å®ƒå¼•å…¥äº†ç°ä»£æ—¥å¿—æ¡†æ¶ä»åœ¨ä½¿ç”¨çš„åŸºæœ¬æ¦‚å¿µï¼Œå¦‚åˆ†å±‚æ—¥å¿—çº§åˆ«å’Œè®°å½•å™¨ã€‚</p><p>2015 å¹´ 8 æœˆ 5 æ—¥ï¼Œè¯¥é¡¹ç›®ç®¡ç†å§”å‘˜ä¼šå®£å¸ƒ Log4j 1.x å·²è¾¾åˆ°ä½¿ç”¨å¯¿å‘½ã€‚ å»ºè®®ç”¨æˆ·ä½¿ç”¨ Log4j 1 å‡çº§åˆ° Apache<br>Log4j 2ã€‚</p><h2 id="log4j2"><a href="#log4j2" class="headerlink" title="log4j2"></a>log4j2</h2><p>Apache Log4j 2æ˜¯å¯¹ Log4j çš„å‡çº§ï¼Œå®ƒæ¯”å…¶å‰èº« Log4j 1.x æä¾›äº†é‡å¤§æ”¹è¿›ï¼Œå¹¶æä¾›äº† Logback ä¸­å¯ç”¨çš„è®¸å¤šæ”¹è¿›ï¼ŒåŒæ—¶ä¿®å¤äº† Logback æ¶æ„ä¸­çš„ä¸€äº›å›ºæœ‰é—®é¢˜ã€‚</p><p>ä¸ Logback ä¸€æ ·ï¼ŒLog4j2 æä¾›å¯¹ SLF4J çš„æ”¯æŒï¼Œè‡ªåŠ¨é‡æ–°åŠ è½½æ—¥å¿—é…ç½®ï¼Œå¹¶æ”¯æŒé«˜çº§è¿‡æ»¤é€‰é¡¹ã€‚ é™¤äº†è¿™äº›åŠŸèƒ½å¤–ï¼Œå®ƒè¿˜å…è®¸åŸºäº lambda è¡¨è¾¾å¼å¯¹æ—¥å¿—è¯­å¥è¿›è¡Œå»¶è¿Ÿè¯„ä¼°ï¼Œä¸ºä½å»¶è¿Ÿç³»ç»Ÿæä¾›å¼‚æ­¥è®°å½•å™¨ï¼Œå¹¶æä¾›æ— åƒåœ¾æ¨¡å¼ä»¥é¿å…ç”±åƒåœ¾æ”¶é›†å™¨æ“ä½œå¼•èµ·çš„ä»»ä½•å»¶è¿Ÿã€‚</p><p>æ‰€æœ‰è¿™äº›åŠŸèƒ½ä½¿ Log4j2 æˆä¸ºè¿™ä¸‰ä¸ªæ—¥å¿—æ¡†æ¶ä¸­æœ€å…ˆè¿›å’Œæœ€å¿«çš„ã€‚</p><h2 id="Logback"><a href="#Logback" class="headerlink" title="Logback"></a>Logback</h2><p>logback æ˜¯ç”± log4j åˆ›å§‹äººè®¾è®¡çš„åˆä¸€ä¸ªå¼€æºæ—¥å¿—ç»„ä»¶ï¼Œä½œä¸ºæµè¡Œçš„ log4j é¡¹ç›®çš„åç»­ç‰ˆæœ¬ï¼Œä»è€Œæ›¿ä»£ log4jã€‚</p><p>Logback çš„ä½“ç³»ç»“æ„è¶³å¤Ÿé€šç”¨ï¼Œä»¥ä¾¿åœ¨ä¸åŒæƒ…å†µä¸‹åº”ç”¨ã€‚ ç›®å‰ï¼Œlogback åˆ†ä¸ºä¸‰ä¸ªæ¨¡å—ï¼šlogback-coreï¼Œlogback-classicå’Œlogback-accessã€‚</p><p>logback-coreï¼šæ¨¡å—ä¸ºå…¶ä»–ä¸¤ä¸ªæ¨¡å—çš„åŸºç¡€ã€‚<br>logback-classicï¼šæ¨¡å—å¯ä»¥è¢«çœ‹åšæ˜¯log4jçš„æ”¹è¿›ç‰ˆæœ¬ã€‚æ­¤å¤–ï¼Œlogback-classic æœ¬èº«å®ç°äº† SLF4J APIï¼Œå› æ­¤å¯ä»¥åœ¨ logback å’Œå…¶ä»–æ—¥å¿—æ¡†æ¶ï¼ˆå¦‚ log4j æˆ– java.util.loggingï¼ˆJULï¼‰ï¼‰ä¹‹é—´æ¥å›åˆ‡æ¢ã€‚<br>logback-accessï¼šæ¨¡å—ä¸ Servlet å®¹å™¨ï¼ˆå¦‚ Tomcat å’Œ Jettyï¼‰é›†æˆï¼Œä»¥æä¾› HTTP è®¿é—®æ—¥å¿—åŠŸèƒ½ã€‚</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20201221143239.png" alt=""></p>]]></content>
      
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ˜¥å¤©ä¹‹å‰-HTTPå‰ä¸–</title>
      <link href="2020/12/18/java/%E6%98%A5%E5%A4%A9%E4%B9%8B%E5%89%8D-http/"/>
      <url>2020/12/18/java/%E6%98%A5%E5%A4%A9%E4%B9%8B%E5%89%8D-http/</url>
      
        <content type="html"><![CDATA[<blockquote><p>è¯•å›¾è·³è¿‡spring,è€Œå­¦ä¹ spring bootæ˜¯ä¸å¯èƒ½çš„ã€‚å­¦ä¹ java webå¼€å‘ï¼Œä»åŸºç¡€å¼€å§‹å­¦ä¹ ã€‚å°±åº”å½“äº†è§£httpã€servletã€tomcat</p></blockquote><span id="more"></span><ul><li>èµ·æº</li><li>å®ƒè§£å†³ä»€ä¹ˆé—®é¢˜</li><li>å®ç°åŸç†</li></ul><h1 id="èµ·æº"><a href="#èµ·æº" class="headerlink" title="èµ·æº"></a>èµ·æº</h1><p>1980å¹´6æœˆè‡³12æœˆé—´ï¼Œä¼¯çº³æ–¯-æåœ¨çš„CERNï¼ˆæ¬§æ´²æ ¸å­ç ”ç©¶ç»„ç»‡ï¼‰æ‹…ä»»å·¥ä½œã€‚å®éªŒå®¤çš„ç ”ç©¶äººå‘˜éœ€è¦å¤§é‡çš„ä¿¡æ¯æŸ¥é˜…æˆ–æ²Ÿé€šã€‚åœ¨é‚£æ®µæ—¶é—´é‡Œï¼Œä»–æå‡ºäº†ä¸ªæ„æƒ³ï¼šåˆ›å»ºä¸€ä¸ªä»¥è¶…æ–‡æœ¬ç³»ç»Ÿä¸ºåŸºç¡€çš„é¡¹ç›®ï¼Œæ–¹ä¾¿ç ”ç©¶äººå‘˜åˆ†äº«åŠæ›´æ–°è®¯æ¯ã€‚</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20201222144257.png" alt=""></p><p>1989å¹´3æœˆï¼Œä»–å†™ä¸‹äº†ä»–çš„åˆæ­¥æ„æƒ³ï¼Œå¹¶åœ¨1990å¹´é‡æ–°é…ç½®ã€‚ç„¶åè¢«ä»–çš„ç»ç†éº¦å…‹Â·æ£®å¾·å°”ï¼ˆMike Sendallï¼‰æ‰€æ¥å—ã€‚ä»–ä½¿ç”¨ä¸ENQUIREç³»ç»Ÿç›¸ä¼¼çš„æ¦‚å¿µæ¥åˆ›å»ºä¸‡ç»´ç½‘ï¼Œä¸ºæ­¤ä»–è®¾è®¡å¹¶æ„å»ºäº†ç¬¬ä¸€ä¸ªç½‘é¡µæµè§ˆå™¨ã€‚</p><p>ä¸–ç•Œä¸Šç¬¬ä¸€ä¸ªç½‘ç«™åœ¨CERNæ­å»ºï¼Œè€ŒCERNåˆ™ä½äºæ³•å›½è¾¹å¢ƒã€‚ç½‘ç«™åœ¨1991å¹´8æœˆ6æ—¥ä¸Šçº¿ã€‚</p><p>ä¸Šçº¿ çš„ç¬¬ä¸€ä¸ªç½‘å€ï¼Œ<a href="http://info.cern.ch/hypertext/WWW/TheProject.html">http://info.cern.ch/hypertext/WWW/TheProject.html</a> å‘Šè¯‰äººä»¬ä¸‡ç»´ç½‘æ˜¯ä»€ä¹ˆï¼Œç”¨æˆ·å¦‚ä½•ä½¿ç”¨æµè§ˆå™¨ï¼Œå¦‚ä½•åˆ›å»ºç½‘é¡µæœåŠ¡å™¨ã€‚</p><h1 id="ç›®çš„"><a href="#ç›®çš„" class="headerlink" title="ç›®çš„"></a>ç›®çš„</h1><p>è®¾è®¡HTTPæœ€åˆçš„ç›®çš„æ˜¯ä¸ºäº†æä¾›ä¸€ç§å‘å¸ƒå’Œæ¥æ”¶HTMLé¡µé¢çš„æ–¹æ³•ã€‚</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20201218163846.png" alt=""></p><h1 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h1><p>ä¸€ä¸ªè¿æ¥æ˜¯ç”±ä¼ è¾“å±‚æ¥æ§åˆ¶çš„ï¼Œè¿™ä»æ ¹æœ¬ä¸Šä¸å±äºHTTPçš„èŒƒå›´ã€‚HTTPå¹¶ä¸éœ€è¦å…¶åº•å±‚çš„ä¼ è¾“å±‚åè®®æ˜¯é¢å‘è¿æ¥çš„ï¼Œåªéœ€è¦å®ƒæ˜¯å¯é çš„ï¼Œæˆ–ä¸ä¸¢å¤±æ¶ˆæ¯çš„ï¼ˆè‡³å°‘è¿”å›é”™è¯¯ï¼‰ã€‚åœ¨äº’è”ç½‘ä¸­ï¼Œæœ‰ä¸¤ä¸ªæœ€å¸¸ç”¨çš„ä¼ è¾“å±‚åè®®ï¼šTCPæ˜¯å¯é çš„ï¼Œè€ŒUDPä¸æ˜¯ã€‚å› æ­¤ï¼ŒHTTPä¾èµ–äºé¢å‘è¿æ¥çš„TCPè¿›è¡Œæ¶ˆæ¯ä¼ é€’ï¼Œä½†è¿æ¥å¹¶ä¸æ˜¯å¿…é¡»çš„ã€‚å› æ­¤é€šè¿‡socketç¼–ç¨‹å°±èƒ½å®ç°httpåè®®ã€‚</p><pre><code class="java">public class Server &#123;    private static int port = 8081;    public static void main(String[] args) throws IOException &#123;        ServerSocket ss = new ServerSocket(port); // ç›‘å¬æŒ‡å®šç«¯å£        System.out.println(&quot;server is running...&quot;);        for (;;) &#123;            Socket sock = ss.accept();            System.out.println(&quot;connected from &quot; + sock.getRemoteSocketAddress());            Thread t = new Handler(sock);            t.start();        &#125;    &#125;&#125;public class Handler extends Thread &#123;    Socket sock;    public Handler(Socket sock) &#123;        this.sock = sock;    &#125;    public void run() &#123;        try ( InputStream input = this.sock.getInputStream()) &#123;            try ( OutputStream output = this.sock.getOutputStream()) &#123;                handle(input, output);            &#125;        &#125; catch (Exception e) &#123;            try &#123;                this.sock.close();            &#125; catch (IOException ioe) &#123;            &#125;            System.out.println(&quot;client disconnected.&quot;);        &#125;    &#125;    private void handle(InputStream input, OutputStream output) throws IOException &#123;        System.out.println(&quot;Process new http request...&quot;);        var reader = new BufferedReader(new InputStreamReader(input, StandardCharsets.UTF_8));        var writer = new BufferedWriter(new OutputStreamWriter(output, StandardCharsets.UTF_8));        // è¯»å–HTTPè¯·æ±‚:        boolean requestOk = false;        String first = reader.readLine();        if (first.startsWith(&quot;GET / HTTP/1.&quot;)) &#123;            requestOk = true;        &#125;        for (;;) &#123;            String header = reader.readLine();            if (header.isEmpty()) &#123; // è¯»å–åˆ°ç©ºè¡Œæ—¶, HTTP Headerè¯»å–å®Œæ¯•                break;            &#125;            System.out.println(header);        &#125;        System.out.println(requestOk ? &quot;Response OK&quot; : &quot;Response Error&quot;);        if (!requestOk) &#123;            // å‘é€é”™è¯¯å“åº”:            writer.write(&quot;HTTP/1.0 404 Not Found\r\n&quot;);            writer.write(&quot;Content-Length: 0\r\n&quot;);            writer.write(&quot;\r\n&quot;);            writer.flush();        &#125; else &#123;            // å‘é€æˆåŠŸå“åº”:            String data = &quot;&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hello, world!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&quot;;            int length = data.getBytes(StandardCharsets.UTF_8).length;            writer.write(&quot;HTTP/1.0 200 OK\r\n&quot;);            writer.write(&quot;Connection: close\r\n&quot;);            writer.write(&quot;Content-Type: text/html\r\n&quot;);            writer.write(&quot;Content-Length: &quot; + length + &quot;\r\n&quot;);            writer.write(&quot;\r\n&quot;); // ç©ºè¡Œæ ‡è¯†Headerå’ŒBodyçš„åˆ†éš”            writer.write(data);            writer.flush();        &#125;        // TODO: å¤„ç†HTTPè¯·æ±‚    &#125;&#125;</code></pre><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ul><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP">https://developer.mozilla.org/zh-CN/docs/Web/HTTP</a></p></li><li><p><a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1304265903570978">å»–é›ªå³°-webåŸºç¡€</a></p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Introduction to Spring MVC HandlerInterceptoræ‹¦æˆªå™¨ä»‹ç»</title>
      <link href="2020/09/24/java/Introduction-to-Spring-MVC-HandlerInterceptor%E6%8B%A6%E6%88%AA%E5%99%A8%E4%BB%8B%E7%BB%8D/"/>
      <url>2020/09/24/java/Introduction-to-Spring-MVC-HandlerInterceptor%E6%8B%A6%E6%88%AA%E5%99%A8%E4%BB%8B%E7%BB%8D/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
        <tags>
            
            <tag> JAVA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java JPAæ€è€ƒ</title>
      <link href="2020/09/23/java/Java-JPA%E6%80%9D%E8%80%83/"/>
      <url>2020/09/23/java/Java-JPA%E6%80%9D%E8%80%83/</url>
      
        <content type="html"><![CDATA[<p><img src="http://img.rc5j.cn/blog20200923170827.png" alt=""></p><p>JPAå³Java Persistence API. 2006å¹´5æœˆ11å·ï¼ŒJPA 1.0 è§„èŒƒä½œä¸º JCP JSR 220 çš„ä¸€éƒ¨åˆ†æœ€ç»ˆè¢«å‘å¸ƒã€‚</p><p>åœ¨PHPä¸–ç•Œå½“ä¸­doctrineã€cake ORM éƒ½æœ‰JPAçš„å½±å­ã€‚</p><span id="more"></span><h2 id="Entity"><a href="#Entity" class="headerlink" title="Entity"></a>Entity</h2><p>æŒä¹…åŒ–å®ä½“æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ Java ç±»ï¼Œå…¶çŠ¶æ€é€šå¸¸æŒä¹…åœ°ä¿å­˜åˆ°å…³ç³»æ•°æ®åº“çš„è¡¨ä¸­ã€‚ è¿™ç§å®ä½“çš„å®ä¾‹å¯¹åº”äºè¡¨ä¸­çš„å„ä¸ªè¡Œã€‚ å®ä½“ä¹‹é—´é€šå¸¸æœ‰å…³ç³»ï¼Œè¿™äº›å…³ç³»é€šè¿‡å¯¹è±¡/å…³ç³»å…ƒæ•°æ®è¡¨ç¤ºã€‚ å¯ä»¥åœ¨å®ä½“ç±»æ–‡ä»¶ä¸­ç›´æ¥ä½¿ç”¨æ³¨é‡Šæ¥æŒ‡å®šè¿™ç§å…³ç³»ï¼Œä¹Ÿå¯ä»¥åœ¨éšåº”ç”¨ç¨‹åºåˆ†å‘çš„å•ç‹¬XMLæè¿°æ–‡ä»¶ä¸­æŒ‡å®šã€‚</p><h2 id="JPQL"><a href="#JPQL" class="headerlink" title="JPQL"></a>JPQL</h2><p>JavaæŒä¹…åŒ–æŸ¥è¯¢è¯­è¨€ ï¼ˆJPQLï¼‰å¯¹å­˜å‚¨åœ¨å…³ç³»æ•°æ®åº“ä¸­çš„å®ä½“è¿›è¡ŒæŸ¥è¯¢ã€‚æŸ¥è¯¢åœ¨è¯­æ³•ä¸Šç±»ä¼¼äºSQLæŸ¥è¯¢ï¼Œä½†æ˜¯æ“ä½œçš„æ˜¯å®ä½“å¯¹è±¡è€Œä¸æ˜¯ç›´æ¥å¯¹æ•°æ®åº“è¡¨è¿›è¡Œæ“ä½œã€‚</p><h2 id="åŠ¨æœº"><a href="#åŠ¨æœº" class="headerlink" title="åŠ¨æœº"></a>åŠ¨æœº</h2><p>åœ¨å¼•å…¥EJB 3.0è§„èŒƒä¹‹å‰ï¼Œè®¸å¤šä¼ä¸šçº§Javaå¼€å‘äººå‘˜ä½¿ç”¨ç”±æŒä¹…åŒ–æ¡†æ¶ï¼ˆä¾‹å¦‚Hibernateï¼‰æˆ–æ•°æ®è®¿é—®å¯¹è±¡ï¼ˆDAOï¼‰æä¾›çš„è½»é‡çº§æŒä¹…åŒ–å¯¹è±¡ï¼Œæ¥ä»£æ›¿å®ä½“beanï¼ˆEJBçš„ä¸€ç§ï¼‰ã€‚ è¿™æ˜¯å› ä¸ºåœ¨ä»¥å‰çš„EJBè§„èŒƒä¸­ï¼Œå®ä½“beanéœ€è¦å¤ªå¤šå¤æ‚çš„ä»£ç å’Œç¹é‡çš„èµ„æºå ç”¨ï¼Œå¹¶ä¸”ç”±äºbeanå’ŒDAOå¯¹è±¡æˆ–æŒä¹…åŒ–æ¡†æ¶ä¹‹é—´çš„æºä»£ç ä¸­çš„äº’è¿å’Œä¾èµ–æ€§ï¼Œå®ƒä»¬åªèƒ½åœ¨Java EEåº”ç”¨ç¨‹åºæœåŠ¡å™¨ä¸­ä½¿ç”¨ã€‚ å› æ­¤ï¼Œæœ€åˆåœ¨ç¬¬ä¸‰æ–¹æŒä¹…æ€§æ¡†æ¶ä¸­æä¾›çš„è®¸å¤šåŠŸèƒ½éƒ½è¢«åˆå¹¶åˆ°Java Persistence APIä¸­ï¼Œå¹¶ä¸”ä»2006å¹´å¼€å§‹ï¼Œ<code>åƒHibernateï¼ˆç‰ˆæœ¬3.2ï¼‰å’ŒTopLink Essentialsè¿™æ ·çš„é¡¹ç›®å·²ç»å®ç°Java Persistence APIè§„èŒƒã€‚</code></p><h2 id="JPAæä¾›å•†"><a href="#JPAæä¾›å•†" class="headerlink" title="JPAæä¾›å•†"></a>JPAæä¾›å•†</h2><p>JPAæ˜¯ä¸€ä¸ªå¼€æºAPIï¼Œå› æ­¤Oracleï¼ŒRedhatï¼ŒEclipseç­‰å„ç§ä¼ä¸šä¾›åº”å•†é€šè¿‡åœ¨å…¶ä¸­æ·»åŠ JPAæŒä¹…æ€§é£æ ¼æ¥æä¾›æ–°äº§å“ã€‚ å…¶ä¸­ä¸€äº›äº§å“åŒ…æ‹¬:</p><p>Hibernate, Eclipselink, Toplink, Spring Data JPA, etc.</p><p>JSRå®šä¹‰äº†æ ‡å‡†ï¼Œä¼—å¤šç»„ç»‡å¯¹è¿™ä¸ªæ ‡å‡†è¿›è¡Œäº†å®ç°ï¼Œè¿™ä½¿å¾—å¼€å‘è€…å‡ ä¹å¯ä»¥åœ¨ä¸åŒçš„å®ç°ç‰ˆæœ¬é‡Œæ— ç¼åˆ‡æ¢ã€‚</p><h2 id="æ³¨è§£-Annotations"><a href="#æ³¨è§£-Annotations" class="headerlink" title="æ³¨è§£ Annotations"></a>æ³¨è§£ Annotations</h2><p>é€šå¸¸ï¼ŒXmlæ–‡ä»¶ç”¨äºé…ç½®ç‰¹å®šç»„ä»¶ï¼Œæˆ–æ˜ å°„ä¸¤ç§ä¸åŒè§„æ ¼çš„ç»„ä»¶ã€‚ åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨æ¡†æ¶ä¸­å•ç‹¬ç»´æŠ¤xmlã€‚ è¿™æ„å‘³ç€åœ¨ç¼–å†™æ˜ å°„xmlæ–‡ä»¶æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°†POJOç±»å±æ€§ä¸mapping.xmlæ–‡ä»¶ä¸­çš„å®ä½“æ ‡è®°è¿›è¡Œæ¯”è¾ƒã€‚</p><p>è¿™æ˜¯è§£å†³æ–¹æ¡ˆ:åœ¨ç±»å®šä¹‰ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ³¨é‡Šç¼–å†™é…ç½®éƒ¨åˆ†ã€‚ æ³¨é‡Šç”¨äºç±»ï¼Œå±æ€§å’Œæ–¹æ³•ã€‚ æ³¨é‡Šä»¥â€œ@â€ç¬¦å·å¼€å¤´ã€‚ åœ¨å£°æ˜ç±»ï¼Œå±æ€§æˆ–æ–¹æ³•ä¹‹å‰å£°æ˜æ³¨é‡Šã€‚ JPAçš„æ‰€æœ‰æ³¨é‡Šéƒ½åœ¨javax.persistenceåŒ…ä¸­å®šä¹‰ã€‚</p><p>ä»¥ä¸‹æ˜¯æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ä½¿ç”¨çš„æ³¨é‡Šåˆ—è¡¨</p><p>æ³¨è§£    æè¿°</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>@Entity</td><td>æ­¤æ‰¹æ³¨æŒ‡å®šå°†ç±»å£°æ˜ä¸ºå®ä½“æˆ–è¡¨</td></tr><tr><td>@Table</td><td>æ­¤æ‰¹æ³¨æŒ‡å®šå£°æ˜è¡¨åã€‚</td></tr><tr><td>@Basic</td><td>æ­¤æ‰¹æ³¨æ˜ç¡®æŒ‡å®šéçº¦æŸå­—æ®µ</td></tr><tr><td>@Embedded</td><td>æ­¤æ‰¹æ³¨æŒ‡å®šç±»æˆ–å®ä½“çš„å±æ€§ï¼Œè¯¥å®ä½“çš„å¯åµŒå…¥ç±»çš„å€¼å®ä¾‹ã€‚</td></tr><tr><td>@Id</td><td>æ­¤æ‰¹æ³¨æŒ‡å®šå±æ€§ï¼Œç”¨äºç±»çš„æ ‡è¯†ï¼ˆè¡¨çš„ä¸»é”®ï¼‰ã€‚</td></tr><tr><td>@GeneratedValue</td><td>æ­¤æ‰¹æ³¨æŒ‡å®šäº†å¦‚ä½•åˆå§‹åŒ–æ ‡è¯†å±æ€§ï¼Œä¾‹å¦‚è‡ªåŠ¨ï¼Œæ‰‹åŠ¨æˆ–ä»åºåˆ—è¡¨ä¸­è·å–çš„å€¼ã€‚</td></tr><tr><td>@Transient</td><td>æ­¤æ‰¹æ³¨æŒ‡å®šäº†ä¸æŒä¹…çš„å±æ€§ï¼Œå³è¯¥å€¼æ°¸è¿œä¸ä¼šå­˜å‚¨åˆ°æ•°æ®åº“ä¸­ã€‚</td></tr><tr><td>@Column</td><td>æ­¤æ‰¹æ³¨ç”¨äºæŒ‡å®šæŒä¹…æ€§å±æ€§çš„åˆ—æˆ–å±æ€§ã€‚</td></tr><tr><td>@SequenceGenerator</td><td>æ­¤æ‰¹æ³¨ç”¨äºå®šä¹‰@GeneratedValueæ‰¹æ³¨ä¸­æŒ‡å®šçš„å±æ€§çš„å€¼ã€‚ å®ƒåˆ›å»ºäº†ä¸€ä¸ªåºåˆ—ã€‚</td></tr><tr><td>@TableGenerator</td><td>æ­¤æ‰¹æ³¨ç”¨äºæŒ‡å®š@GeneratedValueæ‰¹æ³¨ä¸­æŒ‡å®šçš„å±æ€§çš„å€¼ç”Ÿæˆå™¨ã€‚ å®ƒåˆ›å»ºäº†ä¸€ä¸ªä»·å€¼ç”Ÿæˆè¡¨ã€‚</td></tr><tr><td>@AccessType</td><td>æ­¤ç±»æ³¨é‡Šç”¨äºè®¾ç½®è®¿é—®ç±»å‹ã€‚ å¦‚æœè®¾ç½®@AccessTypeï¼ˆFIELDï¼‰ï¼Œåˆ™ä¼šå‘ç”Ÿå­—æ®µè®¿é—®ã€‚ å¦‚æœè®¾ç½®@AccessTypeï¼ˆPROPERTYï¼‰ï¼Œåˆ™å°†è¿›è¡ŒProperty wiseè¯„ä¼°ã€‚</td></tr><tr><td>@JoinColumn</td><td>æ­¤æ‰¹æ³¨ç”¨äºæŒ‡å®šå®ä½“å…³è”æˆ–å®ä½“é›†åˆã€‚ è¿™ç”¨äºå¤šå¯¹ä¸€å’Œä¸€å¯¹å¤šå…³è”ã€‚</td></tr><tr><td>@UniqueConstraint</td><td>æ­¤æ‰¹æ³¨ç”¨äºæŒ‡å®šä¸»è¦æˆ–è¾…åŠ©è¡¨çš„å­—æ®µï¼Œå”¯ä¸€çº¦æŸã€‚</td></tr><tr><td>@ColumnResult</td><td>æ­¤æ‰¹æ³¨ä½¿ç”¨selectå­å¥å¼•ç”¨SQLæŸ¥è¯¢ä¸­çš„åˆ—çš„åç§°ã€‚</td></tr><tr><td>@ManyToMany</td><td>æ­¤æ‰¹æ³¨ç”¨äºå®šä¹‰è¿æ¥è¡¨ä¹‹é—´çš„å¤šå¯¹å¤šå…³ç³»ã€‚</td></tr><tr><td>@ManyToOne</td><td>æ­¤æ‰¹æ³¨ç”¨äºå®šä¹‰è¿æ¥è¡¨ä¹‹é—´çš„å¤šå¯¹ä¸€å…³ç³»ã€‚</td></tr><tr><td>@OneToMany</td><td>æ­¤æ‰¹æ³¨ç”¨äºå®šä¹‰è¿æ¥è¡¨ä¹‹é—´çš„ä¸€å¯¹å¤šå…³ç³»ã€‚</td></tr><tr><td>@OneToOne</td><td>æ­¤æ‰¹æ³¨ç”¨äºå®šä¹‰è¿æ¥è¡¨ä¹‹é—´çš„ä¸€å¯¹ä¸€å…³ç³»ã€‚</td></tr><tr><td>@NamedQueries</td><td>æ­¤æ‰¹æ³¨ç”¨äºæŒ‡å®šå‘½åæŸ¥è¯¢çš„åˆ—è¡¨ã€‚</td></tr><tr><td>@NamedQuery</td><td>æ­¤æ‰¹æ³¨ç”¨äºä½¿ç”¨é™æ€åç§°æŒ‡å®šæŸ¥è¯¢ã€‚</td></tr></tbody></table>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHP QA</title>
      <link href="2020/09/17/php/PHP-QA%E4%B9%8BPHPStan/"/>
      <url>2020/09/17/php/PHP-QA%E4%B9%8BPHPStan/</url>
      
        <content type="html"><![CDATA[<p><img src="http://img.rc5j.cn/blog20200917210020.png" alt=""></p><p>å†™åœ¨å‰é¢ï¼Œå·¥ä½œ7å¹´ï¼ŒPHPä¹Ÿå†™äº†7å¹´äº†ã€‚æœŸé—´ä¹Ÿå†™ä¸€äº›javaå’Œpythonï¼Œä¹Ÿå¯¹å„è¯­è¨€çš„ç‰¹ç‚¹æœ‰ä¸€äº›è‡ªå·±çš„ä½“ä¼šã€‚<br>è¿™æ¬¡å’±ä»¬èŠèŠQAä¹‹ä½™ä¹Ÿæ¥èŠèŠPHPè¯­è¨€æœ¬èº«ã€‚</p><span id="more"></span><p>æ¥åˆ°<code>PHPStan</code>çš„å®˜ç½‘ï¼Œæˆ‘çœ‹åˆ°äº†ä¸€æ®µè¯ã€‚</p><blockquote><p>I really like how much productivity a web developer gains by switching from compiled languages like Java or C# to an interpreted one like PHP. Aside from the dead simple execution model (start, handle one request, and die) and a much shorter feedback loop (no need to wait for the compiler), thereâ€™s a healthy ecosystem of open-source frameworks and libraries to help developers with their everyday tasks. Because of these reasons, PHP is the most popular language for web development by far.</p></blockquote><p>å¤§æ„æ˜¯ä½œè€…å¾ˆä¹æ„çœ‹åˆ°webå¼€å‘è€…ä»¬ä»C#æˆ–Javaè¿™äº›ç¼–è¯‘æ€§è¯­è¨€é‡Œåˆ‡æ¢åˆ°è§£é‡Šè¯­è¨€ã€‚é™¤äº†ç®€å•çš„æ‰§è¡Œæ¨¡å‹ï¼ˆå¯åŠ¨ï¼Œå¤„ç†ä¸€ä¸ªè¯·æ±‚å’Œç»ˆæ­¢ï¼‰å’Œè¾ƒçŸ­çš„åé¦ˆå‘¨æœŸï¼ˆæ— éœ€ç­‰å¾…ç¼–è¯‘ï¼‰ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå¥åº·çš„å¼€æºæ¡†æ¶å’Œåº“ç”Ÿæ€ç³»ç»Ÿå¯å¸®åŠ©å¼€å‘äººå‘˜å®Œæˆæ—¥å¸¸å·¥ä½œä»»åŠ¡ã€‚ç”±äºè¿™äº›åŸå› ï¼ŒPHPæ˜¯è¿„ä»Šä¸ºæ­¢æœ€æµè¡Œçš„Webå¼€å‘è¯­è¨€ã€‚</p><p>è¿™ç¯‡æ–‡ç« æ˜¯ä½œè€…2016å¹´12æœˆ4æ—¥å†™çš„ï¼Œè¯´å®è¯å¯¹äº<code>PHPæ˜¯è¿„ä»Šä¸ºæ­¢æœ€æµè¡Œçš„Webå¼€å‘è¯­è¨€</code>è¿™å¥è¯æˆ‘å·²ç»å¼€å§‹æ€€ç–‘äº†ã€‚è‡³å°‘åœ¨æœ€è¿‘è¿™äº›å¹´ï¼Œåœ¨å›½å†…PHPçš„å¸‚åœºå·²ç»ä¸é‚£ä¹ˆå¥½äº†ã€‚å¹¶ä¸”æˆ‘ä¹Ÿåœ¨è¶‹å‘ä»è§£é‡Šæ€§è¯­è¨€å‘ç¼–è¯‘è¯­è¨€åˆ‡æ¢äº†ã€‚ä½†æ˜¯å…¶ä¸­å¯¹äºè§£é‡Šæ€§è¯­è¨€çš„ä¼˜åŠ¿æè¿°æˆ‘æ˜¯éå¸¸èµåŒçš„ï¼Œè¿™ä¹Ÿæ˜¯å®ƒå®è´µçš„ä¼˜åŠ¿ã€‚</p><ul><li>ç®€å•çš„æ‰§è¡Œæ¨¡å‹</li><li>è¾ƒçŸ­çš„åé¦ˆå‘¨æœŸ</li></ul><h2 id="QAä¹‹PHPStan"><a href="#QAä¹‹PHPStan" class="headerlink" title="QAä¹‹PHPStan"></a>QAä¹‹PHPStan</h2><p>è¨€å½’æ­£ä¼ ï¼Œç»§ç»­PHPStan</p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><pre><code>composer require --dev phpstan/phpstan</code></pre><h3 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h3><pre><code>vendor/bin/phpstan analyse src tests</code></pre><h2 id="PHPmd"><a href="#PHPmd" class="headerlink" title="PHPmd"></a>PHPmd</h2><pre><code>~/vendor/bin/phpmd src/Service/OrderService.php text codesize,unusedcode,naming</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue+vuex+axios+vant+vue-routerç®€å•å•é¡µç™»å½•æ€demo</title>
      <link href="2020/09/15/web/vue-vuex-axios-vant-vue-router%E7%AE%80%E5%8D%95%E5%8D%95%E9%A1%B5%E7%99%BB%E5%BD%95%E6%80%81demo/"/>
      <url>2020/09/15/web/vue-vuex-axios-vant-vue-router%E7%AE%80%E5%8D%95%E5%8D%95%E9%A1%B5%E7%99%BB%E5%BD%95%E6%80%81demo/</url>
      
        <content type="html"><![CDATA[<p><img src="http://img.rc5j.cn/blog20200915182645.png" alt=""></p><span id="more"></span><h2 id="åˆ›å»ºvanté¡¹ç›®"><a href="#åˆ›å»ºvanté¡¹ç›®" class="headerlink" title="åˆ›å»ºvanté¡¹ç›®"></a>åˆ›å»ºvanté¡¹ç›®</h2><pre><code class="shell"># å®‰è£… Vue Clinpm install -g @vue/cli# åˆ›å»ºä¸€ä¸ªé¡¹ç›®vue create hello-world# åˆ›å»ºå®Œæˆåï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤æ‰“å¼€å›¾å½¢åŒ–ç•Œé¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºvue ui# æˆ–è€… é€šè¿‡ yarn å®‰è£…yarn add vant</code></pre><p><img src="http://img.rc5j.cn/blog20200915181419.png" alt=""></p><p>åœ¨å›¾å½¢åŒ–ç•Œé¢ä¸­ï¼Œç‚¹å‡»<code>ä¾èµ–</code> -&gt; <code>å®‰è£…ä¾èµ–</code>ï¼Œç„¶åå°† <code>vant</code> æ·»åŠ åˆ°ä¾èµ–ä¸­å³å¯ã€‚</p><h2 id="vue-router"><a href="#vue-router" class="headerlink" title="vue-router"></a>vue-router</h2><pre><code class="shell">yarn add vue-router</code></pre><pre><code class="html">&lt;template&gt;  &lt;div id=&quot;app&quot;&gt;    &lt;van-nav-bar    title=&quot;æ ‡é¢˜&quot;    left-text=&quot;è¿”å›&quot;    right-text=&quot;æŒ‰é’®&quot;    left-arrow    @click-left=&quot;onClickLeft&quot;    @click-right=&quot;onClickRight&quot;      /&gt;    &lt;router-view&gt;&lt;/router-view&gt;    &lt;van-tabbar v-model=&quot;active&quot;&gt;      &lt;van-tabbar-item icon=&quot;home-o&quot; to=&quot;/&quot;&gt;ä¸»é¡µ&lt;/van-tabbar-item&gt;      &lt;van-tabbar-item icon=&quot;search&quot;&gt;æ ‡ç­¾&lt;/van-tabbar-item&gt;      &lt;van-tabbar-item icon=&quot;friends-o&quot;&gt;æ ‡ç­¾&lt;/van-tabbar-item&gt;      &lt;van-tabbar-item icon=&quot;user-o&quot; to=&quot;/user/detail&quot;&gt;æˆ‘çš„&lt;/van-tabbar-item&gt;    &lt;/van-tabbar&gt;  &lt;/div&gt;&lt;/template&gt;&lt;template&gt;  &lt;div id=&quot;app&quot;&gt;    &lt;van-nav-bar    title=&quot;æ ‡é¢˜&quot;    left-text=&quot;è¿”å›&quot;    right-text=&quot;æŒ‰é’®&quot;    left-arrow    @click-left=&quot;onClickLeft&quot;    @click-right=&quot;onClickRight&quot;      /&gt;    &lt;router-view&gt;&lt;/router-view&gt;    &lt;van-tabbar v-model=&quot;active&quot;&gt;      &lt;van-tabbar-item icon=&quot;home-o&quot; to=&quot;/&quot;&gt;ä¸»é¡µ&lt;/van-tabbar-item&gt;      &lt;van-tabbar-item icon=&quot;search&quot;&gt;æ ‡ç­¾&lt;/van-tabbar-item&gt;      &lt;van-tabbar-item icon=&quot;friends-o&quot;&gt;æ ‡ç­¾&lt;/van-tabbar-item&gt;      &lt;van-tabbar-item icon=&quot;user-o&quot; to=&quot;/user/detail&quot;&gt;æˆ‘çš„&lt;/van-tabbar-item&gt;    &lt;/van-tabbar&gt;  &lt;/div&gt;&lt;/template&gt;</code></pre><p>è·¯ç”±é…ç½®å’Œç™»å½•æ€æ§åˆ¶</p><pre><code class="js">import Vue from &#39;vue&#39;import VueRouter from &#39;vue-router&#39;// import store from &#39;@/store&#39;// import layout from &#39;@/layout/layout&#39;Vue.use(VueRouter)const routes = [  &#123;    path: &#39;/&#39;,    name: &#39;home&#39;,    component: () =&gt; import(&quot;@/views/Home&quot;)  &#125;,  &#123;    path: &#39;/user/detail&#39;,    name: &#39;user_detail&#39;,    meta:&#123;      requireLogin:true    &#125;,    component: () =&gt; import(&quot;@/views/User/detail.vue&quot;)  &#125;,  &#123;    path: &#39;/login&#39;,    name: &#39;login&#39;,    meta:&#123;      requireLogin:false    &#125;,    component: () =&gt; import(&quot;@/views/Login/login.vue&quot;)  &#125;,]const router = new VueRouter(&#123;  mode: &#39;history&#39;,  base: process.env.BASE_URL,  routes&#125;)router.beforeEach((to, from, next) =&gt; &#123;  const token = sessionStorage.getItem(&#39;token&#39;);  // store.getters(&#39;isLogin&#39;)  if (to.meta.requireLogin) &#123;    //éœ€è¦æ£€æµ‹ç™»å½•    if (token) &#123;      next();    &#125; else &#123;      console.log(&#39;å‰å¾€ç™»å½•...&#39;)      next(&#123;        path: &#39;/login&#39;      &#125;);    &#125;  &#125; else &#123;    next();  &#125;&#125;)export default router</code></pre><p><img src="http://img.rc5j.cn/blog20200915181827.png" alt=""></p><h2 id="ç™»å½•"><a href="#ç™»å½•" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h2><p>å¼•å…¥<code>axios</code></p><pre><code>yarn add axios</code></pre><pre><code class="js">import &#123; login &#125; from &quot;@/api/loginReq&quot;;export default &#123;    data() &#123;    return &#123;      loading: false,      loginInfo:&#123;          username:&quot;&quot;,          pwd:&quot;&quot;      &#125;    &#125;;  &#125;,  methods: &#123;    onSubmit(values) &#123;      this.loading = true;      login(this.loginInfo).then((response) =&gt; &#123;        console.log(response);        if(response.code===0)&#123;            sessionStorage.setItem(&#39;token&#39;,response.data.username);        &#125;        this.$router.push(&#39;/&#39;)      &#125;);      this.loading = false;    &#125;,  &#125;&#125;</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>spring-boot validationæ•°æ®éªŒè¯</title>
      <link href="2020/09/14/java/spring-boot-validation%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81/"/>
      <url>2020/09/14/java/spring-boot-validation%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81/</url>
      
        <content type="html"><![CDATA[<p><img src="http://img.rc5j.cn/blog20200914225941.png" alt=""></p><p>åšä¸šåŠ¡å¤„ç†ï¼Œä¸å¯é¿å…çš„è¦å¯¹å‚æ•°è¿›è¡Œæ ¡éªŒï¼Œä¸€å¥—å®Œæ•´è§„èŒƒçš„æ ¡éªŒä½“ç³»å¯ä»¥æé«˜ä¸å°‘çš„æ•ˆç‡ã€‚</p><p>åœ¨å†™äº†PHPã€javaã€python ç­‰ç¼–ç¨‹è¯­è¨€ä¹‹åï¼Œæˆ‘å‘ç°javaçš„ä¼˜åŠ¿å°±æ˜¯å®ƒçš„è§„èŒƒã€å®ƒçš„ä¸¥è°¨ã€‚åœ¨<code>jsr</code>ä¹‹ä¸‹å»ºç«‹å„ç§åœºæ™¯çš„æ ‡å‡†ï¼Œæ‰€æœ‰äººéƒ½åœ¨è¿™å¥—è§„èŒƒä¸‹æ‹“å±•ã€è¿­ä»£ã€å‡çº§ã€‚æœ€ç»ˆè¿™å¥—ä½“ç³»å˜å¾—è¶Šæ¥è¶Šå®Œç¾ã€ç¬¦åˆä½“ç³»çš„ç”Ÿæ€äº§å“ä¹Ÿè¶Šæ¥è¶Šå¤šã€‚ è¿™å¤§æ¦‚å°±æ˜¯javaæœ€å¼ºä¹‹å¤„å§ã€‚</p><p>æœ¬èŠ‚ä»‹ç»ä¸‹spring-bootçš„éªŒè¯ï¼Œå®ƒä¹Ÿæ˜¯åŸºäº<code>jsr</code>çš„validationä¹‹ä¸‹ã€‚</p><span id="more"></span><h2 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h2><pre><code class="xml">    &lt;dependency&gt;            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;        &lt;/dependency&gt;      &lt;dependency&gt;             &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;             &lt;artifactId&gt;spring-boot-starter-validation&lt;/artifactId&gt;         &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;javax.validation&lt;/groupId&gt;            &lt;artifactId&gt;validation-api&lt;/artifactId&gt;            &lt;version&gt;2.0.1.Final&lt;/version&gt;            &lt;type&gt;jar&lt;/type&gt;        &lt;/dependency&gt;</code></pre><p>javax.validation æ­£æ˜¯ jsrçš„è§„èŒƒã€‚</p><h2 id="å®šä¹‰éªŒè¯è§„åˆ™"><a href="#å®šä¹‰éªŒè¯è§„åˆ™" class="headerlink" title="å®šä¹‰éªŒè¯è§„åˆ™"></a>å®šä¹‰éªŒè¯è§„åˆ™</h2><pre><code class="java">    @NotBlank(message = &quot;ç”¨æˆ·åä¸å¯ä¸ºç©º&quot;)    @NotNull(message = &quot;ä¸å¯ä¸ºç©º&quot;)    private String username;    @NotBlank(message = &quot;å¯†ç ä¸å¯ä¸ºç©º&quot;)    @NotNull(message = &quot;å¯†ç ä¸å¯ä¸ºç©º&quot;)    private String pwd;</code></pre><h2 id="controllerä½¿ç”¨"><a href="#controllerä½¿ç”¨" class="headerlink" title="controllerä½¿ç”¨"></a>controllerä½¿ç”¨</h2><pre><code class="java"> public Response login(@Valid @RequestBody LoginInfo loginInfo, HttpServletRequest request, HttpSession session) &#123; &#125;</code></pre><p>è¿™é‡Œè¦å¯¹<code>@Valid</code> è¿›è¡Œä½¿ç”¨</p><h2 id="å…¨å±€å¤„ç†"><a href="#å…¨å±€å¤„ç†" class="headerlink" title="å…¨å±€å¤„ç†"></a>å…¨å±€å¤„ç†</h2><pre><code class="java">@RestControllerAdvicepublic class ControllerAdvice &#123;    /**     * ConstraintViolationException     */    @ExceptionHandler(MethodArgumentNotValidException.class)    public Response handleConstraintViolationException(MethodArgumentNotValidException ex) &#123;        Map&lt;String, String&gt; errors = new HashMap&lt;&gt;();        ex.getBindingResult().getAllErrors().forEach((error) -&gt; &#123;            String fieldName = ((FieldError) error).getField();            System.out.println(fieldName);            String errorMessage = error.getDefaultMessage();            errors.put(fieldName, errorMessage);            System.out.println(errorMessage);        &#125;);        return new Response(ResponseCode.parametrErrror, &quot;å‚æ•°é”™è¯¯&quot;, errors);    &#125;&#125;</code></pre><p>ç”±äºä½¿ç”¨<code>@Valid</code>å¯¹å‚æ•°è¿›è¡Œæ ¡éªŒä¹‹åï¼Œå¦‚æœæœ‰æ ¡éªŒä¸é€šè¿‡ä¼šæŠ›å‡ºä¸€ä¸ª<code>MethodArgumentNotValidException</code>å¼‚å¸¸ã€‚å…¨å±€è¿›è¡Œæ•è·ä¹‹åå¯ä»¥å…¨å±€å¤„ç†å‚æ•°ä¸æ­£ç¡®çš„æƒ…å†µã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://www.cnblogs.com/fqybzhangji/p/10384347.html">https://www.cnblogs.com/fqybzhangji/p/10384347.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> spring-boot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IOCå’Œspringå¯¹å®ƒçš„å®ç°</title>
      <link href="2020/09/09/java/IOC%E5%92%8Cspring%E5%AF%B9%E5%AE%83%E7%9A%84%E5%AE%9E%E7%8E%B0/"/>
      <url>2020/09/09/java/IOC%E5%92%8Cspring%E5%AF%B9%E5%AE%83%E7%9A%84%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p><img src="http://img.rc5j.cn/blog20200909211506.png" alt=""></p><span id="more"></span><h2 id="IOSæ¦‚è¿°"><a href="#IOSæ¦‚è¿°" class="headerlink" title="IOSæ¦‚è¿°"></a>IOSæ¦‚è¿°</h2><p><a href="https://www.cnblogs.com/DebugLZQ/archive/2013/06/05/3107957.html">https://www.cnblogs.com/DebugLZQ/archive/2013/06/05/3107957.html</a> è¿™ç¯‡æ–‡ç« å·²ç»è®²çš„å¾ˆå¥½ã€‚</p><p>æˆ‘åšä¸‹æ€»ç»“ã€‚</p><ul><li>é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¸–ç•Œï¼Œç¨‹åºä¹‹é—´çš„è€¦åˆä¸å¯é¿å…ï¼Œè€Œä¸”ä¼šä½¿å¾—ç³»ç»Ÿå˜å¾—éš¾ä»¥ç»´æŠ¤</li><li>IOCå°±æ˜¯ä¸ºäº†é™ä½è¿™ç§è€¦åˆ</li><li>IOSä¹Ÿä¸æ˜¯å®Œç¾çš„ï¼Œæ‰€æœ‰äº‹æƒ…éƒ½æœ‰ä¼˜ç¼ºç‚¹</li></ul><p><img src="http://img.rc5j.cn/blog20200909212010.png" alt=""></p><p>IOCå°±æ˜¯ä¸ºäº†æŠŠåŸæœ¬äº’ç›¸ä¹‹é—´æœ‰è€¦åˆåœ¨ä¸€èµ·ï¼Œä¼šé€ æˆç‰µä¸€å‘è€ŒåŠ¨å…¨èº«çš„ç°è±¡ã€‚é€šè¿‡å®¹å™¨è§£è€¦å¼€,å„è‡ªèƒ½ç‹¬ç«‹è¿ä½œã€‚</p><p><img src="http://img.rc5j.cn/blog20200909212051.png" alt=""></p><h2 id="springçš„å®ç°"><a href="#springçš„å®ç°" class="headerlink" title="springçš„å®ç°"></a>springçš„å®ç°</h2><p>org.springframework.beans å’Œorg.springframework.context åŒ…æ˜¯Spring Framework çš„IoC å®¹å™¨çš„åŸºç¡€ã€‚</p><p>BeanFactory æ¥å£æä¾›é«˜çº§çš„é…ç½®æœºåˆ¶ï¼Œå¯ä»¥ç®¡ç†ä»»æ„ç±»å‹çš„å¯¹è±¡ã€‚</p><ul><li>ApplicationContext æ˜¯BeanFactory çš„å­æ¥å£ã€‚</li><li>å®ƒæ·»åŠ äº†å’ŒSpring çš„AOP ç‰¹æ€§å¾ˆç®€ä¾¿çš„æ•´åˆï¼›</li><li>æ¶ˆæ¯èµ„æºå¤„ç†ï¼ˆç”¨äºå›½é™…åŒ–i18nï¼‰ï¼Œäº‹ä»¶å‘å¸ƒï¼›</li><li>åº”ç”¨å±‚ç‰¹å®šçš„ä¸Šä¸‹æ–‡ï¼Œ æ¯”å¦‚ç”¨äºWeb åº”ç”¨ç¨‹åºçš„WebApplicationContextã€‚</li></ul><p>æ€»ä¹‹ï¼ŒBeanFactory æä¾›äº†é…ç½®æ¡†æ¶å’ŒåŸºæœ¬åŠŸèƒ½ï¼Œè€ŒApplicationContext æ·»åŠ äº†æ›´å¤šä¼ä¸šçº§å¼€å‘ç‰¹å®šçš„åŠŸèƒ½ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>phpç¼–è¯‘å‚æ•°è¯¦è§£</title>
      <link href="2020/09/03/php%E7%BC%96%E8%AF%91%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3/"/>
      <url>2020/09/03/php%E7%BC%96%E8%AF%91%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<p>å°½ç®¡ç»å†äº†Næ¬¡çš„æ‰‹åŠ¨ç¼–è¯‘ï¼Œä½ å¯èƒ½è¿˜æ˜¯ä¸çŸ¥é“å“ªäº›ç¼–è¯‘å‚æ•°éœ€è¦å“ªäº›ä¸éœ€è¦</p><span id="more"></span><h2 id="help"><a href="#help" class="headerlink" title="help"></a>help</h2><p>æ‰§è¡Œå¸®åŠ©å‘½ä»¤æŸ¥çœ‹ç¼–è¯‘é…ç½®å¸®åŠ©</p><pre><code>./configure --help=short</code></pre><p>å¾—åˆ°ç»“æœ</p><pre><code>Optional Features and Packages:  --disable-option-checking  ignore unrecognized --enable/--with options  --disable-FEATURE       do not include FEATURE (same as --enable-FEATURE=no)  --enable-FEATURE[=ARG]  include FEATURE [ARG=yes]  --with-PACKAGE[=ARG]    use PACKAGE [ARG=yes]  --without-PACKAGE       do not use PACKAGE (same as --with-PACKAGE=no)  --with-libdir=NAME      Look for libraries in .../NAME rather than .../lib  --disable-rpath         Disable passing additional runtime library                          search paths  --enable-re2c-cgoto     Enable -g flag to re2c to use computed goto gcc extension  --disable-gcc-global-regs                          whether to enable GCC global register variablesSAPI modules:  --with-apxs2=FILE       Build shared Apache 2.0 Handler module. FILE is the optional                          pathname to the Apache apxs tool apxs  --disable-cli           Disable building CLI version of PHP                          (this forces --without-pear)  --enable-embed=TYPE     EXPERIMENTAL: Enable building of embedded SAPI library                          TYPE is either &#39;shared&#39; or &#39;static&#39;. TYPE=shared  --enable-fpm            Enable building of the fpm SAPI executable  fastcgiè¿›ç¨‹ç®¡ç†,è¿™ä¸ªåº”è¯¥å¿…ä¸å¯å°‘  --with-fpm-user=USER    Set the user for php-fpm to run as. (default: nobody)  --with-fpm-group=GRP    Set the group for php-fpm to run as. For a system user, this                          should usually be set to match the fpm username (default: nobody)  --with-fpm-systemd      Activate systemd integration  --with-fpm-acl          Use POSIX Access Control Lists  --with-litespeed        Build PHP as litespeed module  --enable-phpdbg            Build phpdbg  --enable-phpdbg-webhelper  Build phpdbg web SAPI support  --enable-phpdbg-debug      Build phpdbg in debug mode  --enable-phpdbg-readline   Enable readline support in phpdbg (depends on static ext/readline)  --disable-cgi           Disable building CGI version of PHP   ç¦ç”¨cgi  --with-valgrind=DIR     Enable valgrind supportGeneral settings:  --enable-gcov           Enable GCOV code coverage (requires LTP) - FOR DEVELOPERS ONLY!!  --enable-debug          Compile with debugging symbols  --with-layout=TYPE      Set how installed files will be laid out.  Type can                          be either PHP or GNU [PHP]  --with-config-file-path=PATH                          Set the path in which to look for php.ini [PREFIX/lib]  --with-config-file-scan-dir=PATH                          Set the path where to scan for configuration files  --enable-sigchild       Enable PHP&#39;s own SIGCHLD handler  --enable-libgcc         Enable explicitly linking against libgcc  --disable-short-tags    Disable the short-form &lt;? start tag by default  --enable-dmalloc        Enable dmalloc  --disable-ipv6          Disable IPv6 support  --enable-dtrace         Enable DTrace support  --enable-fd-setsize     Set size of descriptor setsExtensions:  --with-EXTENSION=shared[,PATH]    NOTE: Not all extensions can be build as &#39;shared&#39;.    Example: --with-foobar=shared,/usr/local/foobar/      o Builds the foobar extension as shared extension.      o foobar package install prefix is /usr/local/foobar/  --disable-all           Disable all extensions which are enabled by default  --disable-libxml        Disable LIBXML support  --with-libxml-dir=DIR   LIBXML: libxml2 install prefix  --with-openssl=DIR      Include OpenSSL support (requires OpenSSL &gt;= 1.0.1)  --with-kerberos=DIR     OPENSSL: Include Kerberos support  --with-system-ciphers   OPENSSL: Use system default cipher list instead of hardcoded value  --with-pcre-regex=DIR   Include Perl Compatible Regular Expressions support.                          DIR is the PCRE install prefix BUNDLED  --with-pcre-jit         Enable PCRE JIT functionality (BUNDLED only)  --with-pcre-valgrind=DIR                          Enable PCRE valgrind support. Developers only!  --without-sqlite3=DIR   Do not include SQLite3 support. DIR is the prefix to                          SQLite3 installation directory.  --with-zlib=DIR         Include ZLIB support (requires zlib &gt;= 1.2.0.4)  --with-zlib-dir=&lt;DIR&gt;   Define the location of zlib install directory  --enable-bcmath         Enable bc style precision math functions  --with-bz2=DIR          Include BZip2 support  --enable-calendar       Enable support for calendar conversion  --disable-ctype         Disable ctype functions  --with-curl=DIR         Include cURL support  --enable-dba            Build DBA with bundled modules. To build shared DBA                          extension use --enable-dba=shared  --with-qdbm=DIR         DBA: QDBM support  --with-gdbm=DIR         DBA: GDBM support  --with-ndbm=DIR         DBA: NDBM support  --with-db4=DIR          DBA: Oracle Berkeley DB 4.x or 5.x support  --with-db3=DIR          DBA: Oracle Berkeley DB 3.x support  --with-db2=DIR          DBA: Oracle Berkeley DB 2.x support  --with-db1=DIR          DBA: Oracle Berkeley DB 1.x support/emulation  --with-dbm=DIR          DBA: DBM support  --with-tcadb=DIR        DBA: Tokyo Cabinet abstract DB support  --with-lmdb=DIR        DBA: Lightning memory-mapped database support  --without-cdb=DIR       DBA: CDB support (bundled)  --disable-inifile       DBA: INI support (bundled)  --disable-flatfile      DBA: FlatFile support (bundled)  --disable-dom           Disable DOM support  --with-libxml-dir=DIR   DOM: libxml2 install prefix  --with-enchant=DIR      Include enchant support.                          GNU Aspell version 1.1.3 or higher required.  --enable-exif           Enable EXIF (metadata from images) support  --disable-fileinfo      Disable fileinfo support  --disable-filter        Disable input filter support  --with-pcre-dir         FILTER: pcre install prefix  --enable-ftp            Enable FTP support  --with-openssl-dir=DIR  FTP: openssl install prefix  --with-gd=DIR           Include GD support.  DIR is the GD library base                          install directory BUNDLED  --with-webp-dir=DIR      GD: Set the path to libwebp install prefix  --with-jpeg-dir=DIR     GD: Set the path to libjpeg install prefix  --with-png-dir=DIR      GD: Set the path to libpng install prefix  --with-zlib-dir=DIR     GD: Set the path to libz install prefix  --with-xpm-dir=DIR      GD: Set the path to libXpm install prefix  --with-freetype-dir=DIR GD: Set the path to FreeType 2 install prefix  --enable-gd-jis-conv    GD: Enable JIS-mapped Japanese font support  --with-gettext=DIR      Include GNU gettext support  --with-gmp=DIR          Include GNU MP support  --with-mhash=DIR        Include mhash support  --disable-hash          Disable hash support  --without-iconv=DIR     Exclude iconv support  --with-imap=DIR         Include IMAP support. DIR is the c-client install prefix  --with-kerberos=DIR     IMAP: Include Kerberos support. DIR is the Kerberos install prefix  --with-imap-ssl=DIR     IMAP: Include SSL support. DIR is the OpenSSL install prefix  --with-interbase=DIR    Include Firebird support.  DIR is the Firebird base                          install directory /opt/firebird  --enable-intl           Enable internationalization support  --with-icu-dir=DIR      Specify where ICU libraries and headers can be found  --disable-json          Disable JavaScript Object Serialization support  --with-ldap=DIR         Include LDAP support  --with-ldap-sasl=DIR    LDAP: Include Cyrus SASL support  --enable-mbstring       Enable multibyte string support  --disable-mbregex       MBSTRING: Disable multibyte regex support  --disable-mbregex-backtrack                          MBSTRING: Disable multibyte regex backtrack check  --with-libmbfl=DIR      MBSTRING: Use external libmbfl.  DIR is the libmbfl base                          install directory BUNDLED  --with-onig=DIR         MBSTRING: Use external oniguruma. DIR is the oniguruma install prefix.                          If DIR is not set, the bundled oniguruma will be used  --with-mysqli=FILE      Include MySQLi support.  FILE is the path                          to mysql_config.  If no value or mysqlnd is passed                          as FILE, the MySQL native driver will be used  --enable-embedded-mysqli                          MYSQLi: Enable embedded support                          Note: Does not work with MySQL native driver!  --with-mysql-sock=SOCKPATH                          MySQLi/PDO_MYSQL: Location of the MySQL unix socket pointer.                          If unspecified, the default locations are searched  --with-oci8=DIR         Include Oracle Database OCI8 support. DIR defaults to $ORACLE_HOME.                          Use --with-oci8=instantclient,/path/to/instant/client/lib                          to use an Oracle Instant Client installation  --with-odbcver=HEX      Force support for the passed ODBC version. A hex number is expected, default 0x0350.                             Use the special value of 0 to prevent an explicit ODBCVER to be defined.  --with-adabas=DIR       Include Adabas D support /usr/local  --with-sapdb=DIR        Include SAP DB support /usr/local  --with-solid=DIR        Include Solid support /usr/local/solid  --with-ibm-db2=DIR      Include IBM DB2 support /home/db2inst1/sqllib  --with-ODBCRouter=DIR   Include ODBCRouter.com support /usr  --with-empress=DIR      Include Empress support \$EMPRESSPATH                          (Empress Version &gt;= 8.60 required)  --with-empress-bcs=DIR                          Include Empress Local Access support \$EMPRESSPATH                          (Empress Version &gt;= 8.60 required)  --with-birdstep=DIR     Include Birdstep support /usr/local/birdstep  --with-custom-odbc=DIR  Include user defined ODBC support. DIR is ODBC install base                          directory /usr/local. Make sure to define CUSTOM_ODBC_LIBS and                          have some odbc.h in your include dirs. f.e. you should define                          following for Sybase SQL Anywhere 5.5.00 on QNX, prior to                          running this configure script:                            CPPFLAGS=\&quot;-DODBC_QNX -DSQLANY_BUG\&quot;                            LDFLAGS=-lunix                            CUSTOM_ODBC_LIBS=\&quot;-ldblib -lodbc\&quot;  --with-iodbc=DIR        Include iODBC support /usr/local  --with-esoob=DIR        Include Easysoft OOB support /usr/local/easysoft/oob/client  --with-unixODBC=DIR     Include unixODBC support /usr/local  --with-dbmaker=DIR      Include DBMaker support  --disable-opcache       Disable Zend OPcache support  --disable-opcache-file  Disable file based caching  --disable-huge-code-pages                          Disable copying PHP CODE pages into HUGE PAGES  --enable-pcntl          Enable pcntl support (CLI/CGI only)  --disable-pdo           Disable PHP Data Objects support  --with-pdo-dblib=DIR    PDO: DBLIB-DB support.  DIR is the FreeTDS home directory  --with-pdo-firebird=DIR PDO: Firebird support.  DIR is the Firebird base                          install directory /opt/firebird  --with-pdo-mysql=DIR    PDO: MySQL support. DIR is the MySQL base directory                          If no value or mysqlnd is passed as DIR, the                          MySQL native driver will be used  --with-zlib-dir=DIR     PDO_MySQL: Set the path to libz install prefix  --with-pdo-oci=DIR      PDO: Oracle OCI support. DIR defaults to $ORACLE_HOME.                          Use --with-pdo-oci=instantclient,/path/to/instant/client/lib                          for an Oracle Instant Client installation.  --with-pdo-odbc=flavour,dir                          PDO: Support for &#39;flavour&#39; ODBC driver.              include and lib dirs are looked for under &#39;dir&#39;.              &#39;flavour&#39; can be one of:  ibm-db2, iODBC, unixODBC, generic              If &#39;,dir&#39; part is omitted, default for the flavour              you have selected will be used. e.g.:                --with-pdo-odbc=unixODBC              will check for unixODBC under /usr/local. You may attempt              to use an otherwise unsupported driver using the \&quot;generic\&quot;              flavour.  The syntax for generic ODBC support is:                --with-pdo-odbc=generic,dir,libname,ldflags,cflags              When built as &#39;shared&#39; the extension filename is always pdo_odbc.so  --with-pdo-pgsql=DIR    PDO: PostgreSQL support.  DIR is the PostgreSQL base                          install directory or the path to pg_config  --without-pdo-sqlite=DIR                          PDO: sqlite 3 support.  DIR is the sqlite base                          install directory BUNDLED  --with-pgsql=DIR        Include PostgreSQL support.  DIR is the PostgreSQL                          base install directory or the path to pg_config  --disable-phar          Disable phar support  --disable-posix         Disable POSIX-like functions  --with-pspell=DIR       Include PSPELL support.                          GNU Aspell version 0.50.0 or higher required  --with-libedit=DIR      Include libedit readline replacement (CLI/CGI only)  --with-readline=DIR     Include readline support (CLI/CGI only)  --with-recode=DIR       Include recode support  --disable-session       Disable session support  --with-mm=DIR           SESSION: Include mm support for session storage  --enable-shmop          Enable shmop support  --disable-simplexml     Disable SimpleXML support  --with-libxml-dir=DIR   SimpleXML: libxml2 install prefix  --with-snmp=DIR         Include SNMP support  --with-openssl-dir=DIR  SNMP: openssl install prefix  --enable-soap           Enable SOAP support  --with-libxml-dir=DIR   SOAP: libxml2 install prefix  --enable-sockets        Enable sockets support  --with-sodium=DIR     Include sodium support  --with-password-argon2=DIR           Include Argon2 support in password_*. DIR is the Argon2 shared library path]  --enable-sysvmsg        Enable sysvmsg support  --enable-sysvsem        Enable System V semaphore support  --enable-sysvshm        Enable the System V shared memory support  --with-tidy=DIR         Include TIDY support  --disable-tokenizer     Disable tokenizer support  --enable-wddx           Enable WDDX support  --with-libxml-dir=DIR   WDDX: libxml2 install prefix  --with-libexpat-dir=DIR WDDX: libexpat dir for XMLRPC-EPI (deprecated)  --disable-xml           Disable XML support  --with-libxml-dir=DIR   XML: libxml2 install prefix  --with-libexpat-dir=DIR XML: libexpat install prefix (deprecated)  --disable-xmlreader     Disable XMLReader support  --with-libxml-dir=DIR   XMLReader: libxml2 install prefix  --with-xmlrpc=DIR       Include XMLRPC-EPI support  --with-libxml-dir=DIR   XMLRPC-EPI: libxml2 install prefix  --with-libexpat-dir=DIR XMLRPC-EPI: libexpat dir for XMLRPC-EPI (deprecated)  --with-iconv-dir=DIR    XMLRPC-EPI: iconv dir for XMLRPC-EPI  --disable-xmlwriter     Disable XMLWriter support  --with-libxml-dir=DIR   XMLWriter: libxml2 install prefix  --with-xsl=DIR          Include XSL support.  DIR is the libxslt base                          install directory (libxslt &gt;= 1.1.0 required)  --enable-zend-test           Enable zend-test extension  --enable-zip            Include Zip read/write support  --with-zlib-dir=DIR     ZIP: Set the path to libz install prefix  --with-pcre-dir         ZIP: pcre install prefix  --with-libzip=DIR       ZIP: use libzip  --enable-mysqlnd        Enable mysqlnd explicitly, will be done implicitly                          when required by other extensions  --disable-mysqlnd-compression-support                          Disable support for the MySQL compressed protocol in mysqlnd  --with-zlib-dir=DIR     mysqlnd: Set the path to libz install prefixPEAR:  --with-pear=DIR         Install PEAR in DIR [PREFIX/lib/php]  --without-pear          Do not install PEARZend:  --enable-maintainer-zts Enable thread safety - for code maintainers only!!  --disable-inline-optimization                          If building zend_execute.lo fails, try this switch  --disable-zend-signals  whether to enable zend signal handlingTSRM:  --with-tsrm-pth=pth-config                          Use GNU Pth  --with-tsrm-st          Use SGI&#39;s State Threads  --with-tsrm-pthreads    Use POSIX threads (default)Libtool:  --enable-shared=PKGS    Build shared libraries default=yes  --enable-static=PKGS    Build static libraries default=yes  --enable-fast-install=PKGS                          Optimize for fast installation default=yes  --with-gnu-ld           Assume the C compiler uses GNU ld default=no  --disable-libtool-lock  Avoid locking (might break parallel builds)  --with-pic              Try to use only PIC/non-PIC objects default=use both  --with-tags=TAGS        Include additional configurations automaticSome influential environment variables:  CC          C compiler command  CFLAGS      C compiler flags  LDFLAGS     linker flags, e.g. -L&lt;lib dir&gt; if you have libraries in a              nonstandard directory &lt;lib dir&gt;  LIBS        libraries to pass to the linker, e.g. -l&lt;library&gt;  CPPFLAGS    (Objective) C/C++ preprocessor flags, e.g. -I&lt;include dir&gt; if              you have headers in a nonstandard directory &lt;include dir&gt;  CPP         C preprocessor  YACC        The `Yet Another Compiler Compiler&#39; implementation to use.              Defaults to the first program found out of: `bison -y&#39;, `byacc&#39;,              `yacc&#39;.  YFLAGS      The list of arguments that will be passed by default to $YACC.              This script will default YFLAGS to the empty string to avoid a              default value of `-d&#39; given by some make applications.  CXX         C++ compiler command  CXXFLAGS    C++ compiler flags  CXXCPP      C++ preprocessorUse these variables to override the choices made by `configure&#39; or to helpit to find libraries and programs with nonstandard names/locations.</code></pre><h2 id="é»˜è®¤æ‹“å±•"><a href="#é»˜è®¤æ‹“å±•" class="headerlink" title="é»˜è®¤æ‹“å±•"></a>é»˜è®¤æ‹“å±•</h2><p>å½“ä¸é…ç½®ä»»ä½•å‚æ•°æ—¶ï¼Œå®ƒé»˜è®¤ä¼šæœ‰å“ªäº›æ‹“å±•å‘¢ï¼Ÿ</p><pre><code>php -m</code></pre><pre><code>[PHP Modules]CorectypedatedomfileinfofilterhashiconvjsonlibxmlpcrePDOpdo_sqlitePharposixReflectionsessionSimpleXMLSPLsqlite3standardtokenizerxmlxmlreaderxmlwriter[Zend Modules]</code></pre><p>æ­¤æ—¶ä½ ä¼šå‘ç°è¿<code>php-fpm</code>éƒ½æ²¡æœ‰</p><h2 id="å¸¸ç”¨é…ç½®"><a href="#å¸¸ç”¨é…ç½®" class="headerlink" title="å¸¸ç”¨é…ç½®"></a>å¸¸ç”¨é…ç½®</h2><h3 id="ä¾èµ–å®‰è£…"><a href="#ä¾èµ–å®‰è£…" class="headerlink" title="ä¾èµ–å®‰è£…"></a>ä¾èµ–å®‰è£…</h3><pre><code>yum install -y libxml2-devel openssl-devel</code></pre><pre><code>./configure --enable-fpm  --enable-bcmath  --with-openssl \--enable-mbstring --with-mysqli --enable-mysqlnd</code></pre><h3 id="ç¼–è¯‘å®‰è£…"><a href="#ç¼–è¯‘å®‰è£…" class="headerlink" title="ç¼–è¯‘å®‰è£…"></a>ç¼–è¯‘å®‰è£…</h3><pre><code>make &amp;&amp; make install</code></pre><h2 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h2><h3 id="æŸ¥çœ‹inié…ç½®"><a href="#æŸ¥çœ‹inié…ç½®" class="headerlink" title="æŸ¥çœ‹inié…ç½®"></a>æŸ¥çœ‹inié…ç½®</h3><pre><code>php -ini | grep &#39;ini&#39;</code></pre><pre><code>Configuration File (php.ini) Path =&gt; /usr/local/libLoaded Configuration File =&gt; /usr/local/lib/php.iniScan this dir for additional .ini files =&gt; (none)Additional .ini files parsed =&gt; (none)user_ini.cache_ttl =&gt; 300 =&gt; 300user_ini.filename =&gt; .user.ini =&gt; .user.iniinit_command_executed_count =&gt; 0init_command_failed_count =&gt; 0com_init_db =&gt; 0</code></pre><p>ä»æºä»£ç ç›®å½• å¤åˆ¶é…ç½®æ–‡ä»¶åˆ°<code>Configuration File (php.ini) Path</code></p><pre><code>cp php.ini-production /usr/local/lib/php.ini</code></pre><h2 id="è®¾ç½®æœåŠ¡-amp-å¼€æœºå¯åŠ¨-centos-7"><a href="#è®¾ç½®æœåŠ¡-amp-å¼€æœºå¯åŠ¨-centos-7" class="headerlink" title="è®¾ç½®æœåŠ¡&amp;å¼€æœºå¯åŠ¨(centos 7+)"></a>è®¾ç½®æœåŠ¡&amp;å¼€æœºå¯åŠ¨(centos 7+)</h2><p>æœåŠ¡æœåŠ¡è„šæœ¬åˆ°systemd</p><pre><code>cp sapi/fpm/php-fpm.service /etc/systemd/system/</code></pre><p>æŸ¥çœ‹å¯åŠ¨è„šæœ¬</p><pre><code>cat sapi/fpm/php-fpm.service</code></pre><p>ç»“æœ</p><pre><code># It&#39;s not recommended to modify this file in-place, because it# will be overwritten during upgrades.  If you want to customize,# the best way is to use the &quot;systemctl edit&quot; command.[Unit]Description=The PHP FastCGI Process ManagerAfter=network.target[Service]Type=simplePIDFile=/usr/local/var/run/php-fpm.pidExecStart=/usr/local/sbin/php-fpm --nodaemonize --fpm-config /usr/local/etc/php-fpm.confExecReload=/bin/kill -USR2 $MAINPIDPrivateTmp=true[Install]WantedBy=multi-user.target</code></pre><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><pre><code>cp sapi/fpm/php-fpm.conf /usr/local/etc/php-fpm.conf</code></pre><p>ä¿®æ”¹php-fpm.conf ç›¸åº”é…ç½®ä½¿å¾—PIDFileæ–‡ä»¶ä½ç½®ä¸php-fpm.serviceé…ç½®çš„ä¸€è‡´ã€‚å¹¶å¤åˆ¶<a href="http://www.confåˆ°å¯¹åº”ç›®å½•">www.confåˆ°å¯¹åº”ç›®å½•</a></p><h3 id="å¯åŠ¨-1"><a href="#å¯åŠ¨-1" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h3><pre><code>systemctl daemon-reloadsystemctl start php-fpm.servicesystemctl status php-fpm.servicesystemctl enable php-fpm.service</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>supervisorä½¿ç”¨</title>
      <link href="2020/09/02/supervisor%E4%BD%BF%E7%94%A8/"/>
      <url>2020/09/02/supervisor%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>ä½œä¸ºä¸€æ¬¾è¿›ç¨‹ç®¡ç†å·¥å…·ï¼Œsupervisoræ™®éç”¨æ¥ç®¡ç†åº”ç”¨çš„å®ˆæŠ¤è¿›ç¨‹</p><span id="more"></span><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>å¸¸è§„å®‰è£…çš„æ–¹å¼æœ‰ä¸¤ç§,pipå®‰è£…æˆ–å‘è¡Œç‰ˆå®‰è£…</p><p>ä»¥centos 8ä¸ºpipå®‰è£…æ–¹å¼ä¸ºä¾‹ã€‚</p><h3 id="pipå®‰è£…"><a href="#pipå®‰è£…" class="headerlink" title="pipå®‰è£…"></a>pipå®‰è£…</h3><pre><code class="shell">pip install supervisor</code></pre><h2 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h2><h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><pre><code>echo_supervisord_conf &gt; /etc/supervisord.conf</code></pre><p>ç”Ÿæˆé…ç½®æ–‡ä»¶</p><h3 id="é…ç½®systemdæœåŠ¡"><a href="#é…ç½®systemdæœåŠ¡" class="headerlink" title="é…ç½®systemdæœåŠ¡"></a>é…ç½®systemdæœåŠ¡</h3><p>å¦‚æœæ˜¯å‘è¡Œç‰ˆå®‰è£…ï¼Œé»˜è®¤ä¼šé…ç½®å¥½å¼€æœºå¯åŠ¨æœåŠ¡ã€‚å¦‚æœéå‘è¡Œç‰ˆå®‰è£…ï¼Œå¯ä»¥æ‰‹åŠ¨é…ç½®ã€‚</p><p>There are user-contributed scripts for various operating systems at: <a href="https://github.com/Supervisor/initscripts">https://github.com/Supervisor/initscripts</a></p><p>æ³¨æ„ï¼Œäº‹å®ä¸Šgithubä¸Šçš„è„šæœ¬æœ‰ç‚¹é—®é¢˜ï¼Œä¸å®é™…å®‰è£…çš„ç›®å½•ä½ç½®ä¸åŒ¹é…ã€‚ç¨ä½œä¿®æ”¹</p><pre><code class="ini"># supervisord service for systemd (CentOS 7.0+)# by ET-CS (https://github.com/ET-CS)[Unit]Description=Supervisor daemon[Service]Type=forkingExecStart=/usr/local/bin/supervisordExecStop=/usr/local/bin/supervisorctl $OPTIONS shutdownExecReload=/usr/local/bin/supervisorctl $OPTIONS reloadKillMode=processRestart=on-failureRestartSec=42s[Install]WantedBy=multi-user.target</code></pre><p>å°†æ­¤æ–‡ä»¶ä¸ºä¿å­˜ä¸º <code>vim /etc/systemd/system/supervisord.service</code></p><h3 id="å¯åŠ¨æœåŠ¡"><a href="#å¯åŠ¨æœåŠ¡" class="headerlink" title="å¯åŠ¨æœåŠ¡"></a>å¯åŠ¨æœåŠ¡</h3><p>é‡æ–°è¯»å–æ‰€æœ‰æœåŠ¡é¡¹</p><pre><code>systemctl daemon-reload</code></pre><p>å¯åŠ¨æœåŠ¡</p><pre><code>systemctl start supervisord.service</code></pre><p>å¼€æœºå¯åŠ¨</p><pre><code>systemctl enable supervisord.service</code></pre><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><h3 id="å¯ç”¨å­é…ç½®ç›®å½•"><a href="#å¯ç”¨å­é…ç½®ç›®å½•" class="headerlink" title="å¯ç”¨å­é…ç½®ç›®å½•"></a>å¯ç”¨å­é…ç½®ç›®å½•</h3><p><code>vim /etc/supervisord.conf</code><br>æœ€å2è¡Œæ‰“å¼€æ³¨é‡Šå¹¶ç¼–è¾‘ä¸º</p><pre><code>[include]files = ./supervisord.d/*.ini</code></pre><p>é‡å¯</p><pre><code>systemctl reload supervisord.service# æˆ–è€…supervisorctl reload</code></pre><h3 id="æ·»åŠ é¡¹ç›®"><a href="#æ·»åŠ é¡¹ç›®" class="headerlink" title="æ·»åŠ é¡¹ç›®"></a>æ·»åŠ é¡¹ç›®</h3><p><code>vim /etc/supervisord.d/glances.ini</code></p><pre><code class="ini">[program:glances]command=glances --export influxdb -qprocess_name=%(program_name)snumprocs=1directory=/tmpumask=022priority=999autostart=trueautorestart=unexpectedstartsecs=10startretries=3exitcodes=0stopsignal=TERMstopwaitsecs=10stopasgroup=falsekillasgroup=falseuser=rootredirect_stderr=falsestdout_logfile=/var/log/glances/glances-out.logstdout_logfile_maxbytes=1MBstdout_logfile_backups=10stdout_capture_maxbytes=1MBstdout_events_enabled=falsestderr_logfile=/var/log/glances/glances-err.logstderr_logfile_maxbytes=1MBstderr_logfile_backups=10stderr_capture_maxbytes=1MB</code></pre><p>æ³¨æ„å…ˆå»ºå¥½ç›®å½• <code>/var/log/glances</code></p><h3 id="é‡æ–°è¯»å–é…ç½®å¹¶å¯ç”¨"><a href="#é‡æ–°è¯»å–é…ç½®å¹¶å¯ç”¨" class="headerlink" title="é‡æ–°è¯»å–é…ç½®å¹¶å¯ç”¨"></a>é‡æ–°è¯»å–é…ç½®å¹¶å¯ç”¨</h3><pre><code>supervisorctl reloadsupervisorctl start glances</code></pre><h3 id="å¯æŸ¥çœ‹è¿è¡ŒçŠ¶æ€"><a href="#å¯æŸ¥çœ‹è¿è¡ŒçŠ¶æ€" class="headerlink" title="å¯æŸ¥çœ‹è¿è¡ŒçŠ¶æ€"></a>å¯æŸ¥çœ‹è¿è¡ŒçŠ¶æ€</h3><pre><code>supervisorctl status</code></pre><p>ç»“æœ</p><pre><code>glances                          RUNNING   pid 46026, uptime 0:05:05</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> è¿ç»´ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysqlå­—ç¬¦é›†é—®é¢˜</title>
      <link href="2020/09/01/mysql%E5%AD%97%E7%AC%A6%E9%9B%86%E9%97%AE%E9%A2%98/"/>
      <url>2020/09/01/mysql%E5%AD%97%E7%AC%A6%E9%9B%86%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>ç°ä»£äº§å“å’Œå›½é™…åŒ–äº§å“å»ºè®®éƒ½ä½¿ç”¨utf8mb4å­—ç¬¦é›†ï¼Œè¡¨æƒ…å·²æ— å¤„ä¸åœ¨ğŸ¤–ğŸ¦–ã€‚äººç”Ÿè‹¦çŸ­å»ºè®®mb4.</p><span id="more"></span><p>mysql å¯ä»¥è®¾ç½®æ•°æ®åº“çº§åˆ«ï¼Œè¡¨çº§åˆ«ï¼Œåˆ—çº§åˆ« å­—ç¬¦é›†ç¼–ç ï¼›æ§åˆ¶ç²’åº¦ä¾æ¬¡ç»†åŒ–ï¼Œä¹Ÿå°±æ˜¯å¦‚æœéƒ½è®¾ç½®äº†ï¼Œåˆ—çº§åˆ«ä¼˜å…ˆçº§æœ€é«˜ã€‚</p><p>å®šä¹‰æ•°æ®è¡¨ç»“æ„æ—¶å»ºè®®ä¸è¦å®šä¹‰åˆ—çš„å­—ç¬¦é›†ï¼Œä»¥å…å°†æ¥ä¿®æ”¹å˜å¾—éº»çƒ¦ã€‚</p><h2 id="ä¿®æ”¹è¡¨çš„å­—ç¬¦é›†"><a href="#ä¿®æ”¹è¡¨çš„å­—ç¬¦é›†" class="headerlink" title="ä¿®æ”¹è¡¨çš„å­—ç¬¦é›†"></a>ä¿®æ”¹è¡¨çš„å­—ç¬¦é›†</h2><h3 id="ä¿®æ”¹è¡¨çš„å­—ç¬¦é›†-å¹¶åˆ·æ–°ä¹‹å‰å·²å­˜åœ¨çš„æ•°æ®"><a href="#ä¿®æ”¹è¡¨çš„å­—ç¬¦é›†-å¹¶åˆ·æ–°ä¹‹å‰å·²å­˜åœ¨çš„æ•°æ®" class="headerlink" title="ä¿®æ”¹è¡¨çš„å­—ç¬¦é›† å¹¶åˆ·æ–°ä¹‹å‰å·²å­˜åœ¨çš„æ•°æ®"></a>ä¿®æ”¹è¡¨çš„å­—ç¬¦é›† å¹¶åˆ·æ–°ä¹‹å‰å·²å­˜åœ¨çš„æ•°æ®</h3><pre><code>ALTER table table_name CONVERT to CHARACTER set  æ–°çš„å­—ç¬¦é›†; </code></pre><h3 id="ä¿®æ”¹è¡¨çš„å­—ç¬¦é›†ï¼Œä½†ä¸å¯¹ä¹‹å‰å·²å­˜åœ¨çš„æ•°æ®åˆ·æ–°"><a href="#ä¿®æ”¹è¡¨çš„å­—ç¬¦é›†ï¼Œä½†ä¸å¯¹ä¹‹å‰å·²å­˜åœ¨çš„æ•°æ®åˆ·æ–°" class="headerlink" title="ä¿®æ”¹è¡¨çš„å­—ç¬¦é›†ï¼Œä½†ä¸å¯¹ä¹‹å‰å·²å­˜åœ¨çš„æ•°æ®åˆ·æ–°"></a>ä¿®æ”¹è¡¨çš„å­—ç¬¦é›†ï¼Œä½†ä¸å¯¹ä¹‹å‰å·²å­˜åœ¨çš„æ•°æ®åˆ·æ–°</h3><pre><code>ALTER table table_name DEFAULT to CHARACTER set  æ–°çš„å­—ç¬¦é›†; </code></pre><h2 id="æ‰¹é‡ä¿®æ”¹"><a href="#æ‰¹é‡ä¿®æ”¹" class="headerlink" title="æ‰¹é‡ä¿®æ”¹"></a>æ‰¹é‡ä¿®æ”¹</h2><pre><code class="sql">SELECT    CONCAT(        &#39;ALTER TABLE &#39;,        TABLE_NAME,        &#39; CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;&#39;    )FROM    information_schema.`TABLES`WHERE    TABLE_SCHEMA = &#39;DATABASE_NAME&#39;;</code></pre><p>å¾—åˆ°ä¿®æ”¹è¯­å¥ï¼Œå¤åˆ¶å‡ºæ‰§è¡Œè¯­å¥ï¼Œè¿›è¡Œæ‰§è¡Œã€‚å¦‚æœæ•°æ®åº“æ•°æ®è¾ƒå¤šï¼Œå°†ä¼šæ¯”è¾ƒè€—æ—¶ã€‚</p><p>å¦‚æœåªæ˜¯ä¿®æ”¹é»˜è®¤å­—ç¬¦é›†ä¸ä¿®æ”¹æ•°æ®ã€‚</p><pre><code class="sql">SELECT    CONCAT(        &#39;ALTER TABLE &#39;,        TABLE_NAME,        &#39; DEFAULT  CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;&#39;    )FROM    information_schema.`TABLES`WHERE    TABLE_SCHEMA = &#39;DATABASE_NAME&#39;;</code></pre><p>è¿™æ ·æ‰§è¡Œåº”è¯¥è¾ƒä¸ºå®‰å…¨ï¼Œä¹Ÿæ»¡è¶³ä¸€èˆ¬éœ€æ±‚ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨openjdk 11</title>
      <link href="2020/08/27/mac%E4%B8%8B%E4%BD%BF%E7%94%A8openjdk-11/"/>
      <url>2020/08/27/mac%E4%B8%8B%E4%BD%BF%E7%94%A8openjdk-11/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘ä¼¼ä¹java 8ä»¥ä¸Šçš„ç‰ˆæœ¬éƒ½ä¸èƒ½ä»oracleå®˜ç½‘ä¸‹è½½äº†ï¼Œäºæ˜¯å°±å°è¯•ä½¿ç”¨open jdk11</p><p><img src="http://img.rc5j.cn/blog20200827114344.png" alt=""></p><span id="more"></span><h2 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h2><p>å¯ä»¥ä» <a href="https://mirrors.huaweicloud.com/openjdk/">https://mirrors.huaweicloud.com/openjdk/</a> ä¸‹è½½å¾—åˆ°</p><h2 id="macå®‰è£…"><a href="#macå®‰è£…" class="headerlink" title="macå®‰è£…"></a>macå®‰è£…</h2><pre><code>sudo mv /Downloads/jdk11 /Library/Java/JavaVirtualMachines/jdk-11.jdk</code></pre><h2 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h2><p>é…ç½®bash_profile</p><p><code>vim ~/.bash_profile</code></p><pre><code>JAVA_HOME=&quot;/usr/local/jdk-11.0.2&quot;PATH=$PATH:$HOME/bin:$JAVA_HOME/binexport PATH</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>glances+influxdb+granfanaæ‰“é€ æœåŠ¡å™¨ç›‘æ§ç³»ç»Ÿ</title>
      <link href="2020/08/25/glances-influxdb-granfana%E6%89%93%E9%80%A0%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F/"/>
      <url>2020/08/25/glances-influxdb-granfana%E6%89%93%E9%80%A0%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F/</url>
      
        <content type="html"><![CDATA[<p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210430141234.png" alt=""></p><p>æœåŠ¡ç›‘æ§å°±æ˜¯ä½ çš„çœ¼ç›ï¼Œå½“ä½ å¯¹æœåŠ¡å™¨è¿è¡ŒçŠ¶å†µä¸€æ— æ‰€çŸ¥æ—¶ï¼Œä½ åº”è¯¥æ„Ÿåˆ°åç«‹ä¸å®‰ã€‚</p><span id="more"></span><h2 id="glanceså®‰è£…"><a href="#glanceså®‰è£…" class="headerlink" title="glanceså®‰è£…"></a>glanceså®‰è£…</h2><p>glancesæ˜¯ç”±pythonç¼–å†™çš„ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨pipç›´æ¥å®‰è£…</p><pre><code>pip3 install glances</code></pre><h2 id="influxdbå®‰è£…"><a href="#influxdbå®‰è£…" class="headerlink" title="influxdbå®‰è£…"></a>influxdbå®‰è£…</h2><pre><code>wget https://dl.influxdata.com/influxdb/releases/influxdb-1.8.2.x86_64.rpmsudo yum localinstall influxdb-1.8.2.x86_64.rpm</code></pre><h2 id="æ”¶é›†æ•°æ®åˆ°influxdb"><a href="#æ”¶é›†æ•°æ®åˆ°influxdb" class="headerlink" title="æ”¶é›†æ•°æ®åˆ°influxdb"></a>æ”¶é›†æ•°æ®åˆ°influxdb</h2><p>é…ç½® glances</p><p><code>vim /etc/glances/glances.conf</code></p><pre><code class="ini">[influxdb]# Configuration for the --export influxdb option# https://influxdb.com/host=localhostport=8086user=rootpassword=rootdb=glancesprefix=localhost#tags=foo:bar,spam:eggs</code></pre><pre><code>pip3 install influxdbglances --export influxdb</code></pre><p>æ‰§è¡Œ <code>glances --export influxdb</code> æµ‹è¯•ä¸‹ï¼ŒæŠ¥é”™</p><p><code>InfluxDB database &#39;glances&#39; did not exist. Please create it</code>éœ€è¦æ–°å»ºæ•°æ®åº“ã€‚</p><p>æ‰§è¡Œshell <code>influx</code></p><pre><code>CREATE DATABASE glances  #åˆ›å»ºæ•°æ®SHOW DATABASES   # æŸ¥çœ‹æ•°æ®åº“</code></pre><p>å†æ¬¡æ‰§è¡Œ<code>glances --export influxdb</code> ,å¯æ˜¾ç¤ºå¦‚ä¸‹ä»£è¡¨ç›®å‰ä¸€åˆ‡æ­£å¸¸</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210430141339.png" alt=""></p><h2 id="granfanaå®‰è£…"><a href="#granfanaå®‰è£…" class="headerlink" title="granfanaå®‰è£…"></a>granfanaå®‰è£…</h2><pre><code>wget https://dl.grafana.com/oss/release/grafana-7.1.5-1.x86_64.rpmsudo yum install grafana-7.1.5-1.x86_64.rpm</code></pre><h3 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h3><pre><code class="shell">systemctl daemon-reloadsystemctl start grafana-serversystemctl status grafana-serversystemctl enable grafana-server.service</code></pre><h3 id="docker-granfanaå®‰è£…"><a href="#docker-granfanaå®‰è£…" class="headerlink" title="docker-granfanaå®‰è£…"></a>docker-granfanaå®‰è£…</h3><pre><code class="yml"># docker-compose.ymlversion: &quot;3.1&quot;services:  grafana:    image: grafana/grafana:5.1.0    ports:      - 3001:3000    environment:        - GF_SECURITY_ADMIN_PASSWORD__FILE=/run/secrets/granfa_admin_pwd # 5.2.0ä¹‹åæ‰å¯ç”¨</code></pre><h3 id="nginxé…ç½®"><a href="#nginxé…ç½®" class="headerlink" title="nginxé…ç½®"></a>nginxé…ç½®</h3><pre><code class="conf"> server &#123;        listen       80;        server_name  grafana-dev.domain.cn;        #charset koi8-r;        location / &#123;           proxy_pass  http://127.0.0.1:3001;           proxy_http_version 1.1;           proxy_set_header Upgrade $http_upgrade;           proxy_set_header Connection &quot;upgrade&quot;;        &#125;&#125;</code></pre><p>å°±å¯ä»¥åœ¨webä¸Šè¿›è¡Œè®¿é—®,åˆå§‹çš„è´¦å·å¯†ç éƒ½æ˜¯<code>admin</code></p><h3 id="é…ç½®æ•°æ®æº"><a href="#é…ç½®æ•°æ®æº" class="headerlink" title="é…ç½®æ•°æ®æº"></a>é…ç½®æ•°æ®æº</h3><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210430141408.png" alt=""></p><p>dockerå®‰è£…æƒ…å†µåº”æ³¨æ„dockerå®¹å™¨ip å’Œå®¿ä¸»æœºip</p><pre><code class="shell">docker network ls # æŸ¥çœ‹dockerç½‘ç»œdocker network inspect $networkid # æŸ¥çœ‹å…·ä½“ç½‘ç»œä¿¡æ¯</code></pre><p>åœ¨é…ç½®<code>influxdb</code> æ•°æ®æºæ—¶ï¼Œå¦‚æœä½ æ˜¯ç”¨<code>docker</code>å®‰è£…ï¼Œéœ€è¦ä¿æŒ<code>granfana</code>å’Œ<code>influxdb</code>æ˜¯åœ¨åŒä¸€ä¸ªç½‘æ®µ</p><p>grafana è¿˜æ”¯æŒzipkin</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210430141436.png" alt=""></p>]]></content>
      
      
      
        <tags>
            
            <tag> devops </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vuetifyjså›¾æ ‡è§£å†³æ–¹æ¡ˆ</title>
      <link href="2020/08/24/web/vuetifyjs%E5%9B%BE%E6%A0%87%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
      <url>2020/08/24/web/vuetifyjs%E5%9B%BE%E6%A0%87%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</url>
      
        <content type="html"><![CDATA[<p><img src="http://img.rc5j.cn/blog20200824102537.png" alt=""></p><p>vuetifyjså®˜æ–¹æä¾›çš„æ–¹æ³•å®é™…è¿ç”¨å½“ä¸­ä¼¼ä¹ä¼šå­˜åœ¨ä¸€äº›å…¼å®¹é—®é¢˜ï¼Œæ¯”å¦‚ä½¿ç”¨Font Awesomeæ—¶æœ‰äº›å›¾æ ‡å°±ä¸ä¼šæ­£å¸¸æ˜¾ç¤ºã€‚</p><span id="more"></span><h2 id="Font-Awesome"><a href="#Font-Awesome" class="headerlink" title="Font Awesome"></a>Font Awesome</h2><pre><code class="html">    &lt;!-- å®˜æ–¹ --&gt;    &lt;v-icon&gt;fas fa-php&lt;/v-icon&gt;    &lt;!-- æ›¿ä»£ --&gt;    &lt;i class=&quot;fab fa-php v-icon&quot;&gt;&lt;/i&gt;</code></pre><p>æœ‰äº›å›¾æ ‡ä¸æ˜¾ç¤ºçš„é—®é¢˜å¯ä»¥ä½¿ç”¨ä¸Šè¿°æ–¹æ³•æ›¿ä»£è§£å†³</p><h2 id="ä½¿ç”¨é˜¿é‡Œå·´å·´å­—ä½“"><a href="#ä½¿ç”¨é˜¿é‡Œå·´å·´å­—ä½“" class="headerlink" title="ä½¿ç”¨é˜¿é‡Œå·´å·´å­—ä½“"></a>ä½¿ç”¨é˜¿é‡Œå·´å·´å­—ä½“</h2><p>é˜¿é‡Œå·´å·´å­—ä½“éå¸¸å¤šéå¸¸åºå¤§ï¼ŒåŸºæœ¬æƒ³è¦çš„éƒ½æœ‰ï¼Œè€Œå›½å¤–çš„å¾ˆå¤šä¸èƒ½ç”¨ã€‚æ‰€ä»¥å¯ä»¥ä½¿ç”¨é˜¿é‡Œå·´å·´å­—ä½“æ›¿ä»£ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼šæ‹·è´é¡¹ç›®ä¸‹é¢ç”Ÿæˆçš„fontclassä»£ç ï¼š</p><p>å¯ä»¥åœ¨public/index.html ä¸‹ç”¨ link æ ‡ç­¾å¼•å…¥</p><p>//at.alicdn.com/t/font_8d5l8fzk5b87iudi.css</p><p>ç¬¬äºŒæ­¥ï¼šæŒ‘é€‰ç›¸åº”å›¾æ ‡å¹¶è·å–ç±»åï¼Œåº”ç”¨äºé¡µé¢ï¼š</p><pre><code class="html">&lt;i class=&quot;iconfont icon-xxx&quot;&gt;&lt;/i&gt;</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> webå‰ç«¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gunicorn+flask_restæ„å»ºéƒ¨ç½²è½»é‡çº§apiæœåŠ¡</title>
      <link href="2020/08/20/python/gunicorn-flask-rest%E6%9E%84%E5%BB%BA%E9%83%A8%E7%BD%B2%E8%BD%BB%E9%87%8F%E7%BA%A7api%E6%9C%8D%E5%8A%A1/"/>
      <url>2020/08/20/python/gunicorn-flask-rest%E6%9E%84%E5%BB%BA%E9%83%A8%E7%BD%B2%E8%BD%BB%E9%87%8F%E7%BA%A7api%E6%9C%8D%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<p><img src="http://img.rc5j.cn/blog20200820155306.png" alt=""></p><span id="more"></span><h2 id="flask-ç»“æ„"><a href="#flask-ç»“æ„" class="headerlink" title="flask ç»“æ„"></a>flask ç»“æ„</h2><p>é¦–å…ˆç®€å•çœ‹çœ‹ flask_restçš„ç›®å½•ç»“æ„ã€‚</p><p><img src="http://img.rc5j.cn/blog20200820155423.png" alt=""></p><h3 id="å…¥å£æ–‡ä»¶"><a href="#å…¥å£æ–‡ä»¶" class="headerlink" title="å…¥å£æ–‡ä»¶"></a>å…¥å£æ–‡ä»¶</h3><pre><code class="python">#app.pyfrom flask import Flaskfrom flask_restful import Resource, Apifrom resources.bd import Index,Formatfrom flask_cors import CORS# from common import configapp = Flask(__name__)CORS(app)api = Api(app)api.add_resource(Format, &#39;/bd/format&#39;)# if __name__ == &#39;__main__&#39;:#     app.run(debug=True)</code></pre><p>å¦‚æœä½¿ç”¨gunicornå¯åŠ¨ï¼Œåˆ™æ³¨é‡Šæ‰app.run</p><h2 id="gunicornå¯åŠ¨é…ç½®"><a href="#gunicornå¯åŠ¨é…ç½®" class="headerlink" title="gunicornå¯åŠ¨é…ç½®"></a>gunicornå¯åŠ¨é…ç½®</h2><pre><code class="python"># config.pyimport osimport gevent.monkeygevent.monkey.patch_all()import multiprocessingdebug = Trueloglevel = &#39;debug&#39;bind = &quot;0.0.0.0:5000&quot;pidfile = &quot;logs/gunicorn.pid&quot;accesslog = &quot;logs/access.log&quot;errorlog = &quot;logs/debug.log&quot;daemon = True# å¯åŠ¨çš„è¿›ç¨‹æ•°workers = multiprocessing.cpu_count()worker_class = &#39;gevent&#39;x_forwarded_for_header = &#39;X-FORWARDED-FOR&#39;</code></pre><h2 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h2><pre><code class="shell">python3 -m venv webpjsource webpj/bin/activatepip install -r requirements.txt -i http://mirrors.aliyun.com/pypi/simple/ --trusted-host mirrors.aliyun.compip install xlrd -i http://mirrors.aliyun.com/pypi/simple/ --trusted-host mirrors.aliyun.compip install openpyxl -i http://mirrors.aliyun.com/pypi/simple/ --trusted-host mirrors.aliyun.comgunicorn -c config.py app:app</code></pre><h2 id="å¹³æ»‘é‡å¯"><a href="#å¹³æ»‘é‡å¯" class="headerlink" title="å¹³æ»‘é‡å¯"></a>å¹³æ»‘é‡å¯</h2><pre><code class="shell">cat logs/gunicorn.pid | xargs kill -HUP</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pandasæ•°æ®å¿«é€Ÿå¤„ç†</title>
      <link href="2020/07/31/pandas%E6%95%B0%E6%8D%AE%E5%BF%AB%E9%80%9F%E5%A4%84%E7%90%86/"/>
      <url>2020/07/31/pandas%E6%95%B0%E6%8D%AE%E5%BF%AB%E9%80%9F%E5%A4%84%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p><img src="http://img.rc5j.cn/blog20200731122918.png" alt=""></p><p>é”€å”®åŒäº‹æ‹¿åˆ°ä¸€ä»½æ•°æ®ï¼Œä½†æ˜¯æ•°æ®å¯¼å‡ºåˆ—æ˜¯json,æˆ‘é¡ºæ‰‹å°±å¸®ä»–å¤„ç†äº†ä¸‹ã€‚ä¸å¾—ä¸è¯´ pandasåœ¨å¤„ç†è¿™ç±»é—®é¢˜è¿˜æ˜¯éå¸¸æ•ˆç‡é«˜çš„.</p><span id="more"></span><pre><code class="python">import pandasimport jsondata = pandas.read_excel(&#39;data.xlsx&#39;)address = data[&#39;address&#39;].values.tolist()ordertime_list = data[&#39;order_datetime&#39;].values.tolist()address_new_list = []for ad in address:    addressJson = json.loads(ad)    address_new_list.append(addressJson[0])for ad in address_new_list:    for t in ordertime_list:        ad[&#39;order_time&#39;] = tdf = pandas.DataFrame.from_records(address_new_list)df.to_excel(&#39;new_data.xlsx&#39;)</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>phpç”Ÿæ€ä¹‹æ€§èƒ½åˆ†æ</title>
      <link href="2020/07/23/php%E7%94%9F%E6%80%81%E4%B9%8B%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/"/>
      <url>2020/07/23/php%E7%94%9F%E6%80%81%E4%B9%8B%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p><img src="http://img.rc5j.cn/blog20200724153643.png" alt=""></p><p>ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬å¹¶ä¸ä¼šå¤ªå…³æ³¨PHPçš„æ‰§è¡Œæ•ˆç‡ï¼Œå› ä¸ºä¸€èˆ¬è€Œè¨€ä»–éƒ½è¡¨ç°æ­£å¸¸æ»¡è¶³éœ€æ±‚ã€‚ä½†å½“çœŸæ­£é‡åˆ°é—®é¢˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æœ‰åˆ†ææ€§èƒ½åœ¨å“ªä¸¢å¤±çš„èƒ½åŠ›ã€‚</p><span id="more"></span><p><code>xhprof</code>æ­£æ˜¯è¿™æ ·çš„å·¥å…·ã€‚ä½†æ˜¯ç”±äºå¹´ä¹…å¤±ä¿®ï¼Œç›®å‰å·²ç»ä¸æ”¯æŒPHP7 .</p><p><img src="http://img.rc5j.cn/blog20200724154122.png" alt=""></p><p>ä¸è¿‡ï¼Œå¥½åœ¨è¿˜æœ‰éå®˜æ–¹å•†ä¸šç»„ç»‡å¼€æºäº†PHP7ç‰ˆæœ¬,<code>tideways-xhprof</code>ã€‚</p><p><img src="http://img.rc5j.cn/blog20200724154306.gif" alt=""></p><p>å®˜ç½‘  <a href="https://tideways.com/profiler/xhprof-for-php7">https://tideways.com/profiler/xhprof-for-php7</a></p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><pre><code class="shell">git clone &quot;https://github.com/tideways/php-xhprof-extension.git&quot;cd php-xhprof-extensionphpize./configuremakesudo make install</code></pre><p>é…ç½®å¥½iniï¼Œé‡å¯æŸ¥çœ‹ä¸‹php -m</p><h2 id="å›¾å½¢åŒ–"><a href="#å›¾å½¢åŒ–" class="headerlink" title="å›¾å½¢åŒ–"></a>å›¾å½¢åŒ–</h2><p><code>tideways-xhprof</code> å¯ä»¥å°†åˆ†æå‡ºæ–¹æ³•è°ƒç”¨ã€æ–¹æ³•è°ƒç”¨è¿‡ç¨‹å’Œæ€§èƒ½æ¶ˆè€—æ•°æ®ã€‚</p><p><code>tideways-xhprof</code> æœ¬èº«è¿˜æä¾›å•†ä¸šåŒ–æœåŠ¡ï¼Œæœ‰ç€æ¯”è¾ƒå¥½çš„ä½“éªŒã€‚ä¸è¿‡ä¹ŸåŒæ—¶æœ‰å¼€æºçš„å›¾å½¢åŒ–å·¥å…·ã€‚æ¯”è¾ƒå¥½çš„æ˜¯<code>xhgui</code>å’Œä»–é…å¥—çš„æ˜¯<code>perftools/php-profiler</code>.çœ‹äº†ä¸‹ä½œè€…ï¼Œè¿˜æ˜¯<code>markstory</code>ï¼Œcakephpçš„ä½œè€…ï¼Œå‡ å¹´å‰ä½¿ç”¨cakephpçš„æ—¶å€™ï¼Œè¿˜æœ‰è¿‡äº¤æµã€‚</p><h2 id="xguiå®‰è£…"><a href="#xguiå®‰è£…" class="headerlink" title="xguiå®‰è£…"></a>xguiå®‰è£…</h2><p>å¯ä»¥é€‰æ‹©æºç éƒ¨ç½²ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©dockeréƒ¨ç½²ã€‚æ–¹ä¾¿ç‚¹é€‰æ‹©ä½¿ç”¨dockerã€‚</p><ol><li><p>Clone or download xhgui from GitHub.</p></li><li><p>Startup the containers: docker-compose up -d</p></li><li><p>Open your browser at <a href="http://xhgui.127.0.0.1.xip.io:8142">http://xhgui.127.0.0.1.xip.io:8142</a> or just <a href="http://localhost:8142">http://localhost:8142</a></p></li></ol><h2 id="php-profilerä½¿ç”¨"><a href="#php-profilerä½¿ç”¨" class="headerlink" title="php-profilerä½¿ç”¨"></a>php-profilerä½¿ç”¨</h2><p>å®˜æ–¹githubä¸Šå†™å‡ ç§æ¥å…¥æ–¹å¼ï¼Œæˆ‘æ¨èç”¨æ³¨å†Œshutdownæ–¹å¼ï¼Œæ­£åœ¨å¯¹é¡¹ç›®ä»£ç æ— å…¥ä¾µã€‚ä¿å­˜è¿‡ç¨‹åœ¨shutdownä¹‹åã€‚</p><pre><code class="PHP"> $profiler = new \Xhgui\Profiler\Profiler($config);    // The profiler itself checks whether it should be enabled    // for request (executes lambda function from config)$profiler-&gt;enable();    // shutdown handler collects and stores the data.$profiler-&gt;registerShutdownHandler();</code></pre><p>ä¸Šé¢çš„<code>$config</code>ï¼Œåœ¨ä½¿ç”¨éæ–‡ä»¶å­˜å‚¨çš„æ—¶å€™è¦æ³¨æ„ä¸è¦å®‰è£…å®˜æ–¹é…ç½®æ¥ï¼Œå®˜æ–¹é…ç½®ç›®å‰å­˜åœ¨ä¸€ç‚¹é—®é¢˜ï¼Œæ–°é…ç½®ä¼šä¸ç”Ÿæ•ˆã€‚æˆ‘çœ‹äº†æºç ï¼Œå¹¶ä¸”æäº¤äº†PRã€‚</p><pre><code class="PHP">//    &#39;db.host&#39; =&gt; &#39;mongodb://127.0.0.1:27018&#39;,//    &#39;db.db&#39; =&gt; &#39;xhprof&#39;,    &#39;save.handler.mongodb&#39; =&gt; array(        &#39;dsn&#39; =&gt; &#39;mongodb://127.0.0.1:27018&#39;,        &#39;database&#39; =&gt; &#39;xhprof&#39;,        // Allows you to pass additional options like replicaSet to MongoClient.        // &#39;username&#39;, &#39;password&#39; and &#39;db&#39; (where the user is added)        &#39;options&#39; =&gt; array(),    ),</code></pre><p>æ³¨é‡Šéƒ¨åˆ†æ‰æœ‰æ•ˆ.</p><h2 id="é»˜è®¤é…ç½®"><a href="#é»˜è®¤é…ç½®" class="headerlink" title="é»˜è®¤é…ç½®"></a>é»˜è®¤é…ç½®</h2><pre><code class="PHP">&lt;?php/** * Default configuration for Xhgui */$mongoUri = getenv(&#39;XHGUI_MONGO_URI&#39;) ?: &#39;127.0.0.1:27017&#39;;$mongoUri = str_replace(&#39;mongodb://&#39;, &#39;&#39;, $mongoUri);$mongoDb = getenv(&#39;XHGUI_MONGO_DB&#39;) ?: &#39;xhprof&#39;;return array(    &#39;debug&#39; =&gt; false,    &#39;mode&#39; =&gt; &#39;development&#39;,    // Can be mongodb, file or upload.    // For file    //    //&#39;save.handler&#39; =&gt; &#39;file&#39;,    //&#39;save.handler.filename&#39; =&gt; dirname(__DIR__) . &#39;/cache/&#39; . &#39;xhgui.data.&#39; . microtime(true) . &#39;_&#39; . substr(md5($url), 0, 6),    // For upload    //    // Saving profile data by upload is only recommended with HTTPS    // endpoints that have IP whitelists applied.    //    // The timeout option is in seconds and defaults to 3 if unspecified.    //    //&#39;save.handler&#39; =&gt; &#39;upload&#39;,    //&#39;save.handler.upload.uri&#39; =&gt; &#39;https://example.com/run/import&#39;,    //&#39;save.handler.upload.timeout&#39; =&gt; 3,    // For MongoDB    &#39;save.handler&#39; =&gt; &#39;mongodb&#39;,    &#39;db.host&#39; =&gt; sprintf(&#39;mongodb://%s&#39;, $mongoUri),    &#39;db.db&#39; =&gt; $mongoDb,    &#39;pdo&#39; =&gt; array(        &#39;dsn&#39; =&gt; &#39;sqlite:/tmp/xhgui.sqlite3&#39;,        &#39;user&#39; =&gt; null,        &#39;pass&#39; =&gt; null,        &#39;table&#39; =&gt; &#39;results&#39;    ),    // Allows you to pass additional options like replicaSet to MongoClient.    // &#39;username&#39;, &#39;password&#39; and &#39;db&#39; (where the user is added)    &#39;db.options&#39; =&gt; array(),    &#39;templates.path&#39; =&gt; dirname(__DIR__) . &#39;/src/templates&#39;,    &#39;date.format&#39; =&gt; &#39;M jS H:i:s&#39;,    &#39;detail.count&#39; =&gt; 6,    &#39;page.limit&#39; =&gt; 25,    // call fastcgi_finish_request() in shutdown handler    &#39;fastcgi_finish_request&#39; =&gt; true,    // Profile x in 100 requests. (E.g. set XHGUI_PROFLING_RATIO=50 to profile 50% of requests)    // You can return true to profile every request.    &#39;profiler.enable&#39; =&gt; function() &#123;        $ratio = getenv(&#39;XHGUI_PROFILING_RATIO&#39;) ?: 100;        return (getenv(&#39;XHGUI_PROFILING&#39;) !== false) &amp;&amp; (mt_rand(1, 100) &lt;= $ratio);    &#125;,    &#39;profiler.simple_url&#39; =&gt; function($url) &#123;        return preg_replace(&#39;/\=\d+/&#39;, &#39;&#39;, $url);    &#125;,    //&#39;profiler.replace_url&#39; =&gt; function($url) &#123;    //    return str_replace(&#39;token&#39;, &#39;&#39;, $url);    //&#125;,    &#39;profiler.options&#39; =&gt; array(),    &#39;profiler.skip_built_in&#39; =&gt; false,);</code></pre><p>ä»¥ä¸Šæ˜¯é»˜è®¤é…ç½®</p><h2 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h2><p><img src="http://img.rc5j.cn/blog20200724134032.png" alt=""></p><p>å›¾ä¸­å¯ä»¥çœ‹åˆ°,æ¯æ¬¡è¯·æ±‚çš„èŠ±è´¹æ—¶é—´ã€‚</p><p><img src="http://img.rc5j.cn/blog20200724165205.png" alt=""></p><p><img src="http://img.rc5j.cn/blog20200724165354.png" alt=""></p><p>é€šè¿‡è§‚å¯Ÿæ–¹æ³•è°ƒç”¨æ¬¡æ•°ï¼Œå¯ä»¥å‘ç°symfony ErrorHandlerè¿™ä¸ªç»„ä»¶æ–¹æ³•æ‰§è¡Œçš„ç‰¹åˆ«å¤šã€‚</p><p>äºæ˜¯æˆ‘å–æ¶ˆäº†è¿™ä¸ªç»„ä»¶ï¼Œå‘ç°æ¥å£è¯·æ±‚æ—¶é—´ä»<code>113ms</code>ç›´æ¥å°±é™åˆ°äº†<code>71ms</code>.</p><p><strong>è¿™å°±æ˜¯å¾ˆç›´è§‚çš„æ€§èƒ½å®šä½äº†</strong></p>]]></content>
      
      
      
        <tags>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>edgeä½¿ç”¨google theme</title>
      <link href="2020/07/10/edge%E4%BD%BF%E7%94%A8google-theme/"/>
      <url>2020/07/10/edge%E4%BD%BF%E7%94%A8google-theme/</url>
      
        <content type="html"><![CDATA[<p>ç”¨edgeæ‰“å¼€ edge://flags/#edge-allow-store-extension-themes</p><p><img src="http://img.rc5j.cn/blog20200710172834.png" alt=""></p><p>æ”¹ä¸ºå¯ç”¨ï¼</p><p>è®¿é—® <a href="https://chrome.google.com/webstore/category/themes">https://chrome.google.com/webstore/category/themes</a><br>å®‰è£…å³å¯ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>kafkaæ­å»ºå’Œä½¿ç”¨(PHPè¯­è¨€ç‰ˆæœ¬)</title>
      <link href="2020/07/08/kafka%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8-PHP%E8%AF%AD%E8%A8%80%E7%89%88%E6%9C%AC/"/>
      <url>2020/07/08/kafka%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8-PHP%E8%AF%AD%E8%A8%80%E7%89%88%E6%9C%AC/</url>
      
        <content type="html"><![CDATA[<p><img src="http://img.rc5j.cn/blog20200723094704.png" alt=""></p><p>é¦–å…ˆ,å®‰è£…ç¡®å®æ˜¯ä¸€ä¸ªè´¹æ—¶è´¹åŠ›çš„äº‹æƒ…ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨dockerå®‰è£…ã€‚</p><span id="more"></span><h2 id="dockeræ­å»ºkafka"><a href="#dockeræ­å»ºkafka" class="headerlink" title="dockeræ­å»ºkafka"></a>dockeræ­å»ºkafka</h2><pre><code class="yml">## docker-compose.ymlversion: &#39;3.1&#39;services:    zookeeper:        image: wurstmeister/zookeeper        ports:          - &quot;2181:2181&quot;    kafka:        image: wurstmeister/kafka        ports:          - &quot;9092:9092&quot;        environment:           KAFKA_ADVERTISED_HOST_NAME: 172.17.0.1           KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181           KAFKA_ADVERTISED_PORT: 9092</code></pre><p>æ›´å¤šç»†èŠ‚å»ºè®®è®¿é—®å®˜æ–¹æ–‡æ¡£æŸ¥é˜…ã€‚</p><h2 id="PHPå®ç°"><a href="#PHPå®ç°" class="headerlink" title="PHPå®ç°"></a>PHPå®ç°</h2><h3 id="ç”Ÿäº§è€…"><a href="#ç”Ÿäº§è€…" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h3><pre><code class="PHP"> public function kafka(Request $request)    &#123;        $faker = Factory::create(&#39;zh_CN&#39;);        $message = $faker-&gt;name();        Log::debug(&#39;æ¶ˆæ¯&#39;, [&#39;message&#39; =&gt; $message]);        $conf = new Conf();        $conf-&gt;set(&#39;log_level&#39;, (string) LOG_DEBUG);        $conf-&gt;set(&#39;debug&#39;, &#39;all&#39;);        $conf-&gt;set(&#39;metadata.broker.list&#39;, &#39;127.0.0.1:9092&#39;);        $conf-&gt;setDrMsgCb(function ($kafka, $message) &#123;            Log::debug(&quot;kafkaä¿¡æ¯&quot;, [&#39;message&#39; =&gt; var_export($message, true)]);        &#125;);        $conf-&gt;setErrorCb(function ($kafka, $err, $reason) &#123;            Log::debug(&quot;kafkaé”™è¯¯&quot;, [&#39;err&#39; =&gt; $err, &#39;reason&#39; =&gt; $reason]);        &#125;);        $conf-&gt;setLogCb(function ($kafka, $level, $facility, $message) &#123;            Log::debug(vsprintf(&quot;Kafka %s: %s (level: %d)\n&quot;, [$facility, $message, $level]));        &#125;);        //If you need to produce exactly once and want to keep the original produce order, uncomment the line below        //$conf-&gt;set(&#39;enable.idempotence&#39;, &#39;true&#39;);        $producer = new Producer($conf);        $topic = $producer-&gt;newTopic(&quot;test&quot;);        $topic-&gt;produce(RD_KAFKA_PARTITION_UA, 0, $faker-&gt;name());        $producer-&gt;poll(0);        $result = $producer-&gt;flush(10000);        if (RD_KAFKA_RESP_ERR_NO_ERROR !== $result) &#123;            throw new \RuntimeException(&#39;Was unable to flush, messages might be lost!&#39;);        &#125;        return new ActionResponse($result);    &#125;</code></pre><h3 id="æ¶ˆè´¹è€…"><a href="#æ¶ˆè´¹è€…" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h3><pre><code class="PHP">public function consume()    &#123;        $conf = new Conf();// Configure the group.id. All consumer with the same group.id will consume// different partitions.        $conf-&gt;set(&#39;group.id&#39;, &#39;myConsumerGroup&#39;);// Initial list of Kafka brokers        $conf-&gt;set(&#39;metadata.broker.list&#39;, &#39;127.0.0.1&#39;);// Set where to start consuming messages when there is no initial offset in// offset store or the desired offset is out of range.// &#39;smallest&#39;: start from the beginning        $conf-&gt;set(&#39;auto.offset.reset&#39;, &#39;smallest&#39;);        $consumer = new KafkaConsumer($conf);// Subscribe to topic &#39;test&#39;        $consumer-&gt;subscribe([&#39;test&#39;]);        echo &quot;Waiting for partition assignment... (make take some time when\n&quot;;        echo &quot;quickly re-joining the group after leaving it.)\n&quot;;        while (true) &#123;            $message = $consumer-&gt;consume(120 * 1000);            switch ($message-&gt;err) &#123;                case RD_KAFKA_RESP_ERR_NO_ERROR:                    $this-&gt;info($message-&gt;payload);                    break;                case RD_KAFKA_RESP_ERR__PARTITION_EOF:                    echo &quot;No more messages; will wait for more\n&quot;;                    break;                case RD_KAFKA_RESP_ERR__TIMED_OUT:                    $this-&gt;info(&quot;Timed out&quot;);                    break;                default:                    throw new Exception($message-&gt;errstr(), $message-&gt;err);                    break;            &#125;        &#125;    &#125;</code></pre><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>ç”Ÿäº§è€…æ˜¯ä¸€ä¸ªrestfulçš„apiï¼Œç›´æ¥è°ƒç”¨ä¼šå¾€kafkaé‡Œå†™å…¥1ä¸ªä¸­æ–‡å§“åçš„æ¶ˆæ¯ã€‚</p><p>æ¶ˆè´¹è€…æ˜¯ä¸€ä¸ªPHPè„šæœ¬è¿›ç¨‹ï¼Œå¯åŠ¨ä¼šå¼€å§‹æ¶ˆè´¹kafkaæ¶ˆæ¯</p><pre><code class="shell">php bin/cli.php kafka consume</code></pre><p><img src="http://img.rc5j.cn/blog20200709115956.png" alt=""></p><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>è™½ç„¶å·²ç»æ­å»ºäº†kafka<code>æ¶ˆæ¯ä¸­é—´ä»¶</code>,å’Œç¼–å†™äº†<code>ç”Ÿäº§è€…</code>å’Œ<code>æ¶ˆè´¹è€…</code>.ä½†æ˜¯å…³äºå…¶ä¸­çš„è®¸å¤šç»†èŠ‚è¿˜è¦ææ¸…é™¤ã€‚åŒ…æ‹¬:</p><ul><li>ä»€ä¹ˆæ˜¯broken</li><li>ä»€ä¹ˆæ˜¯partition</li><li>æ¶ˆæ¯flushæ˜¯åšä»€ä¹ˆ</li><li>pollåˆæ˜¯åšä»€ä¹ˆ</li><li>ç­‰ç­‰æ›´å¤šç»†èŠ‚</li></ul><h2 id="broken"><a href="#broken" class="headerlink" title="broken"></a>broken</h2>]]></content>
      
      
      
        <tags>
            
            <tag> kafka </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€ä¸ªçº¿ä¸Šé—®é¢˜å¼•å‘çš„å¯¹PHPç”Ÿå‘½å‘¨æœŸå’ŒSESSIONæœºåˆ¶æ€è€ƒ</title>
      <link href="2020/07/01/php/%E4%B8%80%E4%B8%AA%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E5%BC%95%E5%8F%91%E7%9A%84%E5%AF%B9PHP%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%92%8CSESSION%E6%9C%BA%E5%88%B6%E6%80%9D%E8%80%83/"/>
      <url>2020/07/01/php/%E4%B8%80%E4%B8%AA%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E5%BC%95%E5%8F%91%E7%9A%84%E5%AF%B9PHP%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%92%8CSESSION%E6%9C%BA%E5%88%B6%E6%80%9D%E8%80%83/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>PHPç”Ÿæ€ä¹‹è‡ªåŠ¨åŒ–æµ‹è¯•</title>
      <link href="2020/07/01/PHP%E7%94%9F%E6%80%81%E4%B9%8B%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/"/>
      <url>2020/07/01/PHP%E7%94%9F%E6%80%81%E4%B9%8B%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<p>PHP TESTING FOR EVERYONE</p><span id="more"></span><p><img src="http://img.rc5j.cn/blog20200701101728.png" alt=""></p><p>åœ¨é•¿ä¹…çš„å·¥ä½œç»å†ä¸­ï¼Œæµ‹è¯•å¤§ä½¬å¸¸ä¼šåœ¨ä½ è€³æ—å˜€å’•å¼€å‘è¦è‡ªæµ‹è¦è‡ªæµ‹ã€‚ä½†æ˜¯å®é™…ä¸Šå¼€å‘å¾€å¾€åªä¼šå…³å¿ƒå½“å‰è´Ÿè´£çš„å•å…ƒåŠŸèƒ½çš„æ­£ç¡®ä¸å¦ã€‚ç¹æ‚çš„å¼€å‘ä»»åŠ¡å½“ä¸­ï¼Œè¿˜è¦å…¼é¡¾æ‰€æœ‰æµç¨‹çš„åŠŸèƒ½è¿è½¬å¯èƒ½å°±æ²¡é‚£ä¸ªç²¾åŠ›äº†ï¼Œæˆ–è€…è¯´è¿™æœ¬èº«å°±æ˜¯æµ‹è¯•çš„å·¥ä½œã€‚åœ¨è¿œå¤æ—¶ä»£äº’è”ç½‘é¢†åŸŸå·¥ä½œè¿˜æ²¡ç»†åˆ†åˆ°å‰ç«¯ã€åç«¯ã€æµ‹è¯•ã€UIçš„æ—¶å€™ï¼Œæ‰€æœ‰ä¸€æ½å­æ´»éƒ½åªæœ‰ä¸€ä¸ªäººåšï¼Œé‚£å°±æ˜¯ç¨‹åºå‘˜ã€‚</p><p><strong>ä½†æ˜¯å¦‚ä½•å°½é‡ä¿è¯ç¨‹åºè¿”å›ç»“æœæ˜¯é¢„æœŸçš„ï¼Ÿ</strong> èƒ½å¦åšåˆ°æ¯æ¬¡å‘å¸ƒä¹‹å‰è‡ªåŠ¨å¯¹ç¨‹åºæµ‹è¯•çœ‹æ˜¯å¦è¾¾åˆ°é¢„æœŸï¼Ÿ<br>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥å¼•å…¥<strong>è‡ªåŠ¨åŒ–æµ‹è¯•</strong>ã€‚</p><h2 id="è‡ªåŠ¨åŒ–æµ‹è¯•èŒƒå›´"><a href="#è‡ªåŠ¨åŒ–æµ‹è¯•èŒƒå›´" class="headerlink" title="è‡ªåŠ¨åŒ–æµ‹è¯•èŒƒå›´"></a>è‡ªåŠ¨åŒ–æµ‹è¯•èŒƒå›´</h2><ul><li>UIæµ‹è¯•</li><li>æ¥å£æµ‹è¯•</li><li>å•å…ƒæµ‹è¯•</li><li>æ•°æ®æµ‹è¯•</li></ul><p>å…¶ä¸­UIæµ‹è¯•å’Œæ•°æ®æµ‹è¯•çš„è‡ªåŠ¨åŒ–å¯èƒ½æ˜¯æœ€ä¸å®¹æ˜“åšä¸”æ•ˆç›Šæœ€å°çš„ã€‚è¿™éƒ¨åˆ†å¯èƒ½æœ€å¥½æ˜¯äººä¸ºçš„è¿›è¡Œæµ‹è¯•æ•ˆæœæœ€å¥½ã€‚</p><p>åœ¨ä½“éªŒäº†java çš„junitä¹‹åç‰¹åˆ«è§‰å¾—junitçš„å¼ºå¤§,å…¶å®PHPä¹Ÿå¯ä»¥åšã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ¥äº†è§£ä¸‹PHPçš„æµ‹è¯•æ¡†æ¶<code>codeception</code></p><h2 id="å®‰è£…ä½¿ç”¨"><a href="#å®‰è£…ä½¿ç”¨" class="headerlink" title="å®‰è£…ä½¿ç”¨"></a>å®‰è£…ä½¿ç”¨</h2><h3 id="install"><a href="#install" class="headerlink" title="install"></a>install</h3><pre><code>composer require &quot;codeception/codeception&quot; --dev</code></pre><h3 id="setup"><a href="#setup" class="headerlink" title="setup"></a>setup</h3><pre><code>php vendor/bin/codecept bootstrap</code></pre><p>è¯¥å‘½ä»¤ä¼šåˆå§‹åŒ–é…ç½®æ–‡ä»¶å’Œç›®å½•</p><h3 id="è½»é‡å®‰è£…"><a href="#è½»é‡å®‰è£…" class="headerlink" title="è½»é‡å®‰è£…"></a>è½»é‡å®‰è£…</h3><p>Use predefined installation templates for common use cases. Run them instead of bootstrap command.</p><p><code>bootstrap</code>ä¼šé»˜è®¤åˆå§‹åŒ–æ‰€æœ‰æµ‹è¯•ç±»å‹æ‰€éœ€è¦çš„ç»„ä»¶ï¼Œæœ‰äº›ä½ ä¸ä¼šç”¨åˆ°çš„ç±»åº“ä¹Ÿä¼šå®‰è£…ã€‚æ¨èä½¿ç”¨è½»é‡å®‰è£…æ‰€ç”¨èƒ½åˆ°çš„æµ‹è¯•ç±»å‹ã€‚</p><p>ä¾‹å¦‚ä½ åªéœ€è¦å•å…ƒæµ‹è¯•ï¼Œåˆ™å¯ä»¥</p><pre><code>php vendor/bin/codecept init unit</code></pre><p><strong>suiteé…ç½®</strong></p><p>åˆå§‹åŒ–ä¹‹åè¿˜è¦å¯¹æµ‹è¯•ç±»å‹è¿›è¡Œç›¸åº”çš„é…ç½®,åœ¨testsç›®å½•ä¸‹æ–°å»ºunitçš„é…ç½®</p><pre><code class="yml"># unit.suite.yml# Codeception Test Suite Configuration## Suite for unit or integration tests.actor: UnitTestermodules:    enabled:        - Asserts        - \Helper\Unit    step_decorators: ~        </code></pre><p><img src="http://img.rc5j.cn/blog20200702152857.png" alt=""></p><h2 id="codeceptionå•å…ƒæµ‹è¯•"><a href="#codeceptionå•å…ƒæµ‹è¯•" class="headerlink" title="codeceptionå•å…ƒæµ‹è¯•"></a>codeceptionå•å…ƒæµ‹è¯•</h2><p><img src="http://img.rc5j.cn/blog20200702143824.png" alt=""></p><p>codeceptionçš„å•å…ƒæµ‹è¯•å…¶å®ä¹Ÿæ˜¯åŸºäºphpunitä¹‹ä¸Šæ„å»ºçš„ã€‚phpunitçš„å•å…ƒæµ‹è¯•ç”¨ä¾‹å¯ä»¥ä¹‹å‰åœ¨codeceptionä¸Šæ‰§è¡Œã€‚</p><h3 id="åˆ›å»ºå•å…ƒæµ‹è¯•"><a href="#åˆ›å»ºå•å…ƒæµ‹è¯•" class="headerlink" title="åˆ›å»ºå•å…ƒæµ‹è¯•"></a>åˆ›å»ºå•å…ƒæµ‹è¯•</h3><pre><code>php vendor/bin/codecept generate:test unit Example</code></pre><p>æ‰§è¡Œå®Œä¼šåœ¨tests/unitç›®å½•é‡Œåˆ›å»ºæµ‹è¯•ç”¨ä¾‹æ–‡ä»¶ </p><pre><code class="php">class ExampleTest extends \Codeception\Test\Unit&#123;    /**     * @var \UnitTester     */    protected $tester;    protected function _before()    &#123;    &#125;    protected function _after()    &#123;    &#125;    // tests    public function testMe()    &#123;    &#125;&#125;</code></pre><ul><li>all public methods with test prefix are tests</li><li>_before method is executed before each test (like setUp in PHPUnit)</li><li>_after method is executed after each test (like tearDown in PHPUnit)</li></ul><h3 id="è¿è¡Œç”¨ä¾‹"><a href="#è¿è¡Œç”¨ä¾‹" class="headerlink" title="è¿è¡Œç”¨ä¾‹"></a>è¿è¡Œç”¨ä¾‹</h3><pre><code>php vendor/bin/codecept run unit ExampleTest</code></pre><p>å¦‚æœæœ‰ç›®å½•å¯ä»¥æ‰§è¡Œåˆ°æ–‡ä»¶</p><pre><code>php bin/codecept run unit tests/unit/src/Service/InvoiceServiceTest.php       </code></pre><p>è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•ç”¨ä¾‹</p><pre><code>php vendor/bin/codecept run unit</code></pre><pre><code class="php">class UserTest extends \Codeception\Test\Unit&#123;    public function testValidation()    &#123;        $user = new User();        $user-&gt;setName(null);        $this-&gt;assertFalse($user-&gt;validate([&#39;username&#39;]));        $user-&gt;setName(&#39;toolooooongnaaaaaaameeee&#39;);        $this-&gt;assertFalse($user-&gt;validate([&#39;username&#39;]));        $user-&gt;setName(&#39;davert&#39;);        $this-&gt;assertTrue($user-&gt;validate([&#39;username&#39;]));    &#125;&#125;</code></pre><h3 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h3><p><img src="http://img.rc5j.cn/blog20200723093255.png" alt=""></p><p><img src="http://img.rc5j.cn/blog20200723093429.png" alt=""></p><p>å¯ä»¥ç»Ÿè®¡åˆ°æ‰€æœ‰æ–‡ä»¶çš„è¦†ç›–ç‡å’Œç”¨ä¾‹æµ‹è¯•ç»“æœã€‚</p><p>ç»“åˆgité’©å­æˆ‘ä»¬å¯ä»¥åœ¨æ¯æ¬¡åˆ†æ”¯æäº¤æ—¶è¿›è¡Œè‡ªåŠ¨çš„ç”¨ä¾‹æµ‹è¯•ï¼Œèƒ½ä¸€å®šç¨‹åº¦ä¸Šé˜²æ­¢ä»£ç æ›´æ”¹äº†è€Œæ²¡æµ‹è¯•äº§ç”Ÿéé¢„æœŸçš„é—®é¢˜ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>intlå®‰è£…çš„é‚£äº›äº‹å„¿</title>
      <link href="2020/06/19/intl%E5%AE%89%E8%A3%85%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/"/>
      <url>2020/06/19/intl%E5%AE%89%E8%A3%85%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/</url>
      
        <content type="html"><![CDATA[<p>è¢«intlæŠ˜ç£¨çš„è¿˜ä¸å¤Ÿä¹ˆ</p><span id="more"></span><p>To build the extension you need to install the Â» ICU library, version 4.0.0 or newer is required. As of PHP 7.4.0 ICU 50.1 or newer is required.</p><p>This extension is bundled with PHP as of PHP version 5.3.0. Alternatively, the PECL version of this extension may be used with all PHP versions greater than 5.2.0 (5.2.4+ recommended).</p><h2 id="ICUå®‰è£…"><a href="#ICUå®‰è£…" class="headerlink" title="ICUå®‰è£…"></a>ICUå®‰è£…</h2><p>ç°åœ¨icuå·²è¢«æ”¾åˆ°githubï¼Œä¸‹è½½å»ºè®®ç›´æ¥ä»githubä¸‹è½½æºç åˆ°æœ¬åœ°ã€‚</p><p><a href="https://github.com/unicode-org/icu/releases/tag/release-60-3">https://github.com/unicode-org/icu/releases/tag/release-60-3</a></p><p>ä¸‹è½½åç¼–è¯‘å®‰è£…</p><h2 id="æ‹“å±•å®‰è£…"><a href="#æ‹“å±•å®‰è£…" class="headerlink" title="æ‹“å±•å®‰è£…"></a>æ‹“å±•å®‰è£…</h2><pre><code class="shell">pecl install intl</code></pre><p>æ€»ä¼šé‡åˆ°é—®é¢˜,å»ºè®®ç”¨phpize æºç å®‰è£…ã€‚è¿›å…¥æºç extä¸‹çš„intlç›®å½•</p><pre><code>./configure  --enable-intl   --with-php-config=/usr/local/php7/bin/php-configmakemake install</code></pre><p>é‡å¯php-fpm</p>]]></content>
      
      
      
        <tags>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MyBatis Dynamic SQLä½¿ç”¨å°è¯•</title>
      <link href="2020/06/01/MyBatis-Dynamic-SQL%E4%BD%BF%E7%94%A8%E5%B0%9D%E8%AF%95/"/>
      <url>2020/06/01/MyBatis-Dynamic-SQL%E4%BD%BF%E7%94%A8%E5%B0%9D%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<p>é¦–å…ˆè¯´æ˜ä¸‹ï¼Œæˆ‘å¯èƒ½æ˜¯è¢«è¿™ä¸ªæ’ä»¶çš„åå­—ç»™è¯¯å¯¼äº†ã€‚æˆ‘åŸæœ¬ä»¥ä¸ºDynamic SQLæ˜¯ä¸ºäº†è§£å†³åŠ¨æ€æŸ¥è¯¢åœºæ™¯çš„ã€‚ä½†å¯èƒ½<code>MyBatis Dynamic SQL</code> å¹¶ä¸æ˜¯æ¥è§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚</p><p>20.06.04æ›´æ–°</p><p><strong>æ‰“è„¸äº†</strong>ï¼ŒåŸæ¥å®ƒæ˜¯æ”¯æŒçš„ï¼Œæœç„¶æ˜¯åŠ¨æ€sql.å¹¶ä¸”è¿˜çœŸé¦™ï¼</p><span id="more"></span><h2 id="MyBatis-Dynamic-SQL"><a href="#MyBatis-Dynamic-SQL" class="headerlink" title="MyBatis Dynamic SQL"></a>MyBatis Dynamic SQL</h2><h3 id="å®˜æ–¹å®šä¹‰"><a href="#å®˜æ–¹å®šä¹‰" class="headerlink" title="å®˜æ–¹å®šä¹‰"></a>å®˜æ–¹å®šä¹‰</h3><p>This library is a framework for generating dynamic SQL statements. Think of it as a typesafe SQL templating library, with additional support for MyBatis3 and Spring JDBC Templates.</p><p>The primary goals of the library are:</p><ul><li>Typesafe - to the extent possible, the library will ensure that parameter types match the database column types</li><li>Expressive - statements are built in a way that clearly communicates their meaning (thanks to Hamcrest for some inspiration)</li><li>Flexible - where clauses can be built using any combination of and, or, and nested conditions</li><li>Extensible - the library will render statements for MyBatis3, Spring JDBC templates or plain JDBC. It can be extended to generate clauses for other frameworks as well. Custom where conditions can be added easily if none of the built in conditions are sufficient for your needs.</li><li>Small - the library is a small dependency to add. It has no transitive dependencies.</li></ul><p>å®˜æ–¹ä¼¼ä¹è¯´åˆ°è¿™ä¸ªç±»åº“çš„ä¸»è¦ç›®æ ‡æ˜¯è§£å†³ç±»å‹å®‰å…¨é—®é¢˜ã€‚</p><p>This library grew out of a desire to create a utility that could be used to improve the code generated by MyBatis Generator, but the library can be used on itâ€™s own with very little setup required.</p><p>å®˜æ–¹è¯´å¯ä»¥ä½¿ç”¨<code>MyBatis Generator</code>ç”Ÿæˆä»£ç æ–‡ä»¶ã€‚</p><pre><code class="xml">&lt;dependency&gt;    &lt;groupId&gt;org.mybatis.dynamic-sql&lt;/groupId&gt;    &lt;artifactId&gt;mybatis-dynamic-sql&lt;/artifactId&gt;    &lt;version&gt;1.1.4&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;    &lt;groupId&gt;mysql&lt;/groupId&gt;    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;&lt;/dependency&gt;</code></pre><h2 id="MyBatis-Generator"><a href="#MyBatis-Generator" class="headerlink" title="MyBatis Generator"></a>MyBatis Generator</h2><p>MyBatis Generator may generate:</p><p>Java or Kotlin classes that match the table structure. This may include:</p><ul><li>a class to match the primary key of the table (if there is a primary key)</li><li>a class to match the non-primary key fields of the table (except BLOB fields)</li><li>a class to include the BLOB fields of a table (if the table has BLOB fields)</li><li>a class to enable dynamic selects, updates, and deletes</li></ul><p><code>MyBatis Generator</code>å°†ä¼šç”Ÿæˆä¸‹è¿°ä¸‰ä¸ªæ–‡ä»¶ï¼š</p><ul><li>ä¸è¡¨å¯¹åº”çš„ model ç±» Employee.java</li><li>å®šä¹‰äº†è¡¨ä¿¡æ¯å’Œåˆ—ä¿¡æ¯çš„ support ç±» EmployeeDynamicSqlSupport.java</li><li>ä»¥æ³¨è§£å½¢å¼å®ç°çš„ mapper æ¥å£ EmployeeMapper.java</li></ul><h3 id="Running-MyBatis-Generator-With-Maven"><a href="#Running-MyBatis-Generator-With-Maven" class="headerlink" title="Running MyBatis Generator With Maven"></a>Running MyBatis Generator With Maven</h3><ol><li>é…ç½®pom.xml</li></ol><pre><code class="xml">           &lt;plugin&gt;                &lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt;                &lt;artifactId&gt;mybatis-generator-maven-plugin&lt;/artifactId&gt;                &lt;version&gt;1.4.0&lt;/version&gt;                &lt;executions&gt;                    &lt;execution&gt;                        &lt;id&gt;Generate MyBatis Artifacts&lt;/id&gt;                        &lt;goals&gt;                            &lt;goal&gt;generate&lt;/goal&gt;                        &lt;/goals&gt;                    &lt;/execution&gt;                &lt;/executions&gt;                &lt;dependencies&gt;                    &lt;dependency&gt;                        &lt;groupId&gt;mysql&lt;/groupId&gt;                        &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;                        &lt;version&gt;8.0.20&lt;/version&gt;                    &lt;/dependency&gt;                &lt;/dependencies&gt;            &lt;/plugin&gt;</code></pre><p>æ³¨æ„<code>mysql-connector-java</code>ä¾èµ–é…ç½®</p><ol start="2"><li>é…ç½® generatorConfig.xml</li></ol><p>åœ¨resourceä¸­é…ç½®ç”Ÿæˆé…ç½®æ–‡ä»¶generatorConfig.xml</p><pre><code class="xml">&lt;!DOCTYPE generatorConfiguration PUBLIC &quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;&gt;&lt;generatorConfiguration&gt;  &lt;context id=&quot;dsql&quot; targetRuntime=&quot;MyBatis3DynamicSql&quot;&gt;    &lt;jdbcConnection driverClass=&quot;com.mysql.jdbc.Driver&quot;        connectionURL=&quot;jdbc:mysql://localhost:3306/db_itdoc&quot; userId=&quot;username&quot; password=&quot;password&quot; /&gt;    &lt;javaModelGenerator targetPackage=&quot;com.vison.itdoc.entity&quot; targetProject=&quot;src/main/java&quot;/&gt;    &lt;javaClientGenerator targetPackage=&quot;com.vison.itdoc.dao&quot; targetProject=&quot;src/main/java&quot;/&gt;    &lt;table tableName=&quot;task&quot; /&gt;  &lt;/context&gt;&lt;/generatorConfiguration&gt;</code></pre><p><code>userId</code>å’Œ<code>password</code>åˆ†åˆ«æ˜¯æ•°æ®åº“ç”¨æˆ·åå’Œå¯†ç </p><ol start="3"><li>æ‰§è¡Œç”Ÿæˆ</li></ol><pre><code class="shell">$ mvn mybatis-generator:generate</code></pre><h2 id="ä½¿ç”¨MyBatis-Dynamic-SQL"><a href="#ä½¿ç”¨MyBatis-Dynamic-SQL" class="headerlink" title="ä½¿ç”¨MyBatis Dynamic SQL"></a>ä½¿ç”¨MyBatis Dynamic SQL</h2><p>å½“ç›¸åº”çš„æ–‡ä»¶ç”Ÿæˆä¹‹åï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ç›´æ¥ä½¿ç”¨äº†ã€‚</p><pre><code class="java">   SelectStatementProvider queryCount = select(count())                .from(task)                .build()                .render(RenderingStrategies.MYBATIS3);        Long taskCount = taskMapper.count(queryCount);        double total = Math.ceil(taskCount / iPageSize);        SelectStatementProvider tasksQuerypProvider = select(createTime).from(task)                .orderBy(createTime)                .limit(iPageSize).offset(iOffset).build()                .render(RenderingStrategy.MYBATIS3);    List&lt;Task&gt; tasks = taskMapper.selectMany(tasksQuerypProvider);</code></pre><p><code>MyBatis Dynamic SQL</code>éå¸¸ä¼˜é›…å¾—sqlbuilderæ–¹å¼,ä¼šæç¤ºè¡¨å­—æ®µåã€‚</p><h3 id="åŠ¨æ€sql"><a href="#åŠ¨æ€sql" class="headerlink" title="åŠ¨æ€sql"></a>åŠ¨æ€sql</h3><p>åœ¨è¿™ä¹‹å‰<code>mybatis</code>å¯ä»¥ä½¿ç”¨xmlæˆ–æ³¨è§£æ–¹å¼è¿›è¡ŒåŠ¨æ€ç»„ç»‡sql</p><pre><code class="java">public class TaskService &#123;    public String queryCount(String type, String remark) &#123;        return new SQL() &#123;            &#123;                SELECT(&quot;T.ID&quot;);                FROM(&quot;TASK T&quot;);                if (type != null) &#123;                    WHERE(&quot;T.type = #&#123;type&#125;&quot;);                &#125;                if (remark != null) &#123;                    WHERE(&quot;T.remark = #&#123;remark&#125;&quot;);                &#125;                ORDER_BY(&quot;T.create_time&quot;);            &#125;        &#125;.toString();    &#125;</code></pre><p>åœ¨mapperä¸Š</p><pre><code class="java">  @SelectProvider(type = TaskService.class, method = &quot;queryCount&quot;)    public Object queryCount(String type, String remark);</code></pre><p>ç°åœ¨å¯ä»¥æ¢å¦ä¸€ç§æ–¹å¼</p><pre><code class="java">    public SelectStatementProvider countTask(Integer typeInteger, String remarkString) &#123;        QueryExpressionDSL&lt;SelectModel&gt;.QueryExpressionWhereBuilder builder = select(count())                .from(task).where();        if (typeInteger != null) &#123;            builder.and(type, isEqualTo(typeInteger));        &#125;        if (remarkString != null) &#123;            builder.and(remark, isEqualTo(remarkString));        &#125;        return builder.build().render(RenderingStrategy.MYBATIS3);    &#125;    public SelectStatementProvider search(Object searchObj, Integer iPageSize, Integer iOffset) &#123;        QueryExpressionDSL&lt;SelectModel&gt;.QueryExpressionWhereBuilder builder = select(remark, type, createTime, modifyTime)                .from(task).where();        builder                .orderBy(createTime)                .limit(iPageSize).offset(iOffset);        return builder.build().render(RenderingStrategy.MYBATIS3);    &#125;</code></pre><p>ä»ç¼–ç æ„Ÿå—ä¸Šï¼Œç”±äºæ ¹æ®è¡¨ç»“æ„ç”Ÿæˆäº†<code>SqlSupport</code>.ä»»ä½•å¯¹è¡¨çš„ä¿¡æ¯å¼•ç”¨éƒ½èƒ½æœ‰æç¤ºï¼ŒåŒ…æ‹¬è¡¨åã€å­—æ®µåã€‚</p><pre><code class="java">List&lt;Task&gt; tasks = taskMapper.selectMany(taskService.search(null, iPageSize, iOffset));</code></pre><p>è°ƒç”¨ä¸Šé¢ï¼Œä¹Ÿæ— éœ€åœ¨mapperä¸Šå†ç¼–å†™æ–¹æ³•ï¼Œå› ä¸ºå·²ç»å…¨éƒ¨ç”Ÿæˆäº†ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://blog.olowolo.com/post/new-mybatis-dynamic-sql/">Mybatis Dynamic SQL - é‡æ–°å®šä¹‰ Mybatis åŠ¨æ€ SQL</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ©ç”¨ä¿¡å·æ§åˆ¶phpå¸¸é©»è¿›ç¨‹å¹³æ»‘ä¸­æ–­æ€è€ƒ</title>
      <link href="2020/05/30/php%E5%B8%B8%E9%A9%BB%E8%BF%9B%E7%A8%8B%E5%B9%B3%E6%BB%91%E4%B8%AD%E6%96%AD/"/>
      <url>2020/05/30/php%E5%B8%B8%E9%A9%BB%E8%BF%9B%E7%A8%8B%E5%B9%B3%E6%BB%91%E4%B8%AD%E6%96%AD/</url>
      
        <content type="html"><![CDATA[<p>å¾ˆå¤šåœºæ™¯ä¸‹æˆ‘ä»¬éƒ½éœ€è¦è¿›ç¨‹ç¨‹åºåœ¨åå°ä¸€ç›´å¤„ç†ä»»åŠ¡ï¼Œæ¯”å¦‚é˜Ÿåˆ—æ¶ˆè´¹ã€‚å¯é‡‡ç”¨while trueçš„æ–¹å¼è®©è¿›ç¨‹å¸¸é©»æŒ‰ä¸€å®šçš„é¢‘æ¬¡æ‰§è¡Œä»»åŠ¡ã€‚ä½†æ˜¯ä½†æˆ‘ä»¬è¦é‡å¯è¿›ç¨‹æˆ–ä¸­æ­¢è¿›ç¨‹æ—¶ï¼Œå¦‚ä½•ä¿è¯è¿›ç¨‹å†…æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•å†ä¸­æ­¢å‘¢ï¼Ÿ</p><span id="more"></span><p>æ€è€ƒä¸€ä¸‹ï¼Œå¯ä¸å¯ä»¥æˆ‘ä»¬é€šè¿‡ä¸€ç§æŒ‡ä»¤å‘Šè¯‰è¿›ç¨‹ï¼Œâ€è¯¶ï¼Œæˆ‘ç°åœ¨è¦é‡å¯ä¸€ä¸‹ï¼Œä½ èƒ½æŠŠæ­£åœ¨åšçš„äº‹æƒ…åšå®Œäº†å…ˆé€€å‡ºæ­‡ä¼šä¹ˆï¼Ÿâ€</p><p><code>kill</code>å‘½ä»¤å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h2 id="å†çœ‹kill"><a href="#å†çœ‹kill" class="headerlink" title="å†çœ‹kill"></a>å†çœ‹kill</h2><p>è®¸äººè‚¯å®šä¼šè§‰å¾— kill ä¸å°±æ˜¯æ€æ‰è¿›ç¨‹ä¹ˆï¼Ÿ æˆ‘ç»å¸¸ç”¨<code>kill -9</code>æ€è¿›ç¨‹ã€‚ è¿™ä¹ˆè¯´ä¹Ÿæ²¡é”™ï¼Œä¸è¿‡æˆ‘ä»¬ç°åœ¨å¯ä»¥ç³»ç»Ÿåœ°æ¥çœ‹çœ‹<code>kill</code>å‘½ä»¤.</p><p>æˆ‘ä»¬å…ˆçœ‹ä¸‹å®˜æ–¹çš„å®šä¹‰,è®©é‚£ä¸ªç”·äººæ¥è·Ÿæˆ‘ä»¬è®²è®²ã€‚</p><pre><code class="shell">man shell</code></pre><pre><code>KILL(1)                                                                         User Commands                                                                         KILL(1)NAME       kill - terminate a processSYNOPSIS       kill [-s signal|-p] [-q sigval] [-a] [--] pid...       kill -l [signal]DESCRIPTION       The command kill sends the specified signal to the specified process or process group.  If no signal is specified, the TERM signal is sent.  The TERM signal will kill       processes which do not catch this signal.  For other processes, it may be necessary to use the KILL (9) signal, since this signal cannot be caught.       Most modern shells have a builtin kill function, with a usage rather similar to that of the command described here.  The &#39;-a&#39; and &#39;-p&#39; options, and the possibility to       specify processes by command name are a local extension.       If sig is 0, then no signal is sent, but error checking is still performed.</code></pre><ul><li>å®˜æ–¹è§£é‡Š<code>kill</code>æ˜¯ç”¨æ¥ç»ˆæ­¢è¿›ç¨‹çš„ã€‚</li><li><code>kill</code> å‘é€æŒ‡å®šçš„ä¿¡å·ç»™åˆ°è¿›ç¨‹æˆ–è¿›ç¨‹ç»„ã€‚</li><li>å¦‚æœæ²¡æœ‰æŒ‡å®šä¿¡å·ï¼Œé»˜è®¤å‘é€<code>TERM</code>ä¿¡å·ã€‚</li><li><code>TERM</code>ä¿¡å·å°†ä¼šæ€æ‰è¿›ç¨‹ï¼Œå½“<code>TERM</code>æœªè¢«æ•è·çš„æ—¶å€™ã€‚</li><li><code>9</code>ä¿¡å·ä¸èƒ½è¢«æ•è·</li></ul><p><strong>è°ˆè°ˆæˆ‘çš„ç†è§£</strong></p><ol><li>killå‘½ä»¤å°±æ˜¯ç”¨æ¥æ€æ‰è¿›ç¨‹çš„</li><li>å®ƒå¯ä»¥ç»™è¿›ç¨‹å‘é€ä¸€äº›æŒ‡ä»¤ï¼Œè®©ç¨‹åºå»æ•è·åšç‰¹æ®Šå¤„ç†ã€‚æ¯”å¦‚ä¸Šé¢è¯´åˆ°çš„åœºæ™¯ï¼Œè®©ç¨‹åºæ‰§è¡Œå®Œæ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå†é€€å‡ºã€‚</li></ol><h2 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬ç”¨PHPè„šæœ¬æ¥éªŒè¯ä¸‹ä¸Šé¢çš„ç†è§£ã€‚æˆ‘ä»¬ç”¨<code>pcntl_signal</code>æ¥å¯¹ä¿¡å·è¿›è¡Œæ•è·ã€‚</p><pre><code class="php">class SignalShell extends Shell&#123;    private $taskFinish = false;    public function __construct()    &#123;//        pcntl_signal(SIGTERM, [$this, &#39;sig_handler&#39;]);//        pcntl_signal(SIGHUP, [$this, &#39;sig_handler&#39;]);        pcntl_signal(SIGINT, [$this, &#39;sig_handler&#39;]);//        pcntl_signal(SIGQUIT, [$this, &#39;sig_handler&#39;]);        pcntl_signal(SIGILL, [$this, &#39;sig_handler&#39;]);        pcntl_signal(SIGPIPE, [$this, &#39;sig_handler&#39;]);        pcntl_signal(SIGALRM, [$this, &#39;sig_handler&#39;]);        pcntl_signal(SIGUSR1, [$this, &#39;sig_handler&#39;]);        $this-&gt;info(&quot;æ³¨å†Œä¿¡å·&quot;);    &#125;    public function task()    &#123;        while (true &amp;&amp; !$this-&gt;taskFinish) &#123;            sleep(10);            $this-&gt;info(uniqid());        &#125;    &#125;    public function sig_handler($signo)    &#123;        $time = date(&#39;Y-m-d H:i:s&#39;);        if ($signo == 14) &#123;            //å¿½ç•¥alarmä¿¡å·            echo $time . &quot; ignore alarm signo[&#123;$signo&#125;]\r\n&quot;;        &#125; else &#123;            echo $time . &quot; exit  signo[&#123;$signo&#125;]\r\n&quot;;            if ($signo == SIGUSR1) &#123;                $this-&gt;info(&quot;æ•è·è‡ªå®šä¹‰&quot;);                $this-&gt;taskFinish = true;            &#125;        &#125;    &#125;&#125;</code></pre><p>ä»£ç å¾ˆç®€å•ï¼Œå°±æ˜¯è®©è„šæœ¬æ¯éš”10ç§’è¾“å‡ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä»»åŠ¡ä¹‹å‰å¯¹ä¸€äº›ä¿¡å·è¿›è¡Œæ•è·ã€‚</p><p><img src="http://img.rc5j.cn/blog20200530114817.png" alt=""></p><p>åˆ†åˆ«å¯¹è¿›ç¨‹æ‰§è¡Œäº†ï¼Œkillã€kill QUITã€kill HUP å‘ç°è¿›ç¨‹éƒ½ä¼šè¢«ç›´æ¥ç»ˆæ­¢ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬å¼€å§‹,å¯¹<code>TERM</code>è¿›è¡Œæ•è·ã€‚</p><pre><code class="php">pcntl_signal(SIGTERM, [$this, &#39;sig_handler&#39;]);</code></pre><p>æ‰“å¼€æ³¨é‡Šã€‚</p><p><img src="http://img.rc5j.cn/blog20200530115128.png" alt=""></p><p>15ä¿¡å·(TERM)è¢«æ•è·åˆ°äº†ï¼Œä½†æ˜¯è¿›ç¨‹å¹¶æ²¡æœ‰é€€å‡º,è¿˜å†ç»§ç»­æ‰§è¡Œã€‚</p><p>æˆ‘ä»¬å†è¯•ä¸‹USR1ä¿¡å·ã€‚</p><p><img src="http://img.rc5j.cn/blog20200530115632.png" alt=""></p><p>USR1è¢«æ•è·åˆ°äº†ï¼Œå¹¶ä¸”ç¨‹åºç«‹å³æ‰§è¡Œå®Œä¸€æ¬¡è¾“å‡ºé€€å‡ºäº†ã€‚æ³¨æ„æˆ‘æ˜¯ç¨‹åºè‡ªå·±æ§åˆ¶äº†,æ•è·åˆ°USR1ä¹‹åä¸ç»§ç»­æ‰§è¡Œå¾ªç¯ã€‚</p><p>ç»†å¿ƒçš„æœ‹å‹ä»¬å¯èƒ½ä¼šå‘ç°ï¼Œç¨‹åºä¸­çš„sleepè¢«è·³è¿‡äº†ã€‚</p><p><strong>è¿™æ˜¯ä»€ä¹ˆåŸå› å‘¢?</strong></p><h2 id="sleep"><a href="#sleep" class="headerlink" title="sleep"></a>sleep</h2><p>äº‹å®ä¸Šsleepæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å‡½æ•°ã€‚å…¶å®å®˜æ–¹æ–‡æ¡£æœ‰è§£é‡Š:</p><p><img src="http://img.rc5j.cn/blog20200530120859.png" alt=""></p><p><code>sleep</code>åœ¨è¢«ä¿¡å·ä¸­æ­¢æ—¶ï¼Œä¼šè¿”å›é0å€¼,éwindowsä¸‹ä¼šè¿”å›å‰©ä½™ç§’æ•°ã€‚</p><p>è®©æˆ‘ä»¬æ¥éªŒè¯ä¸‹ã€‚</p><pre><code class="php"> while (true &amp;&amp; !$this-&gt;taskFinish) &#123;            $res = sleep(10);            $this-&gt;info(&quot;sleepè¿”å›:&quot;.$res);            $this-&gt;info(uniqid()); &#125;</code></pre><p>æˆ‘ä»¬è®°å½•äº†sleepæ‰§è¡Œå®Œçš„è¿”å›å€¼ã€‚</p><p><img src="http://img.rc5j.cn/blog20200530121207.png" alt=""></p><p>å‘ç°ä¿¡å·ç»™åˆ°æ—¶ï¼Œsleepç¡®å®ä¼šè¿”å›å‰©ä½™ç§’æ•°ã€‚è¿™å°±è§£é‡Šäº†ä¸ºä»€ä¹ˆä¸Šé¢çœ‹åˆ°çš„sleepè¢«è·³è¿‡äº†ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><blockquote><p>A process can define how to handle incoming POSIX signals. If a process does not define a behaviour for a signal, then the default handler for that signal is being used. The table below lists some default actions for POSIX-compliant UNIX systems, such as FreeBSD, OpenBSD and Linux.</p></blockquote><ol><li>killèƒ½ç»™è¿›ç¨‹å‘é€ä¿¡å·é‡ï¼Œå‘Šè¯‰è¿›ç¨‹æŒ‰ä»€ä¹ˆæ–¹å¼ç»“æŸã€‚</li><li>killå®šä¹‰çš„ä¸åŒä¿¡å·é‡ï¼Œç”¨æ³•ä¸åŒï¼Œä½†æ˜¯éœ€è¦ç¨‹åºè‡ªå·±å»å¤„ç†ã€‚å®ƒåªæ˜¯å®šä¹‰äº†ç›®çš„ï¼Œä½†æœªå®šä¹‰è¿‡ç¨‹å’Œå®é™…ç»“æœã€‚</li></ol><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://en.wikipedia.org/wiki/Signal_(IPC)">https://en.wikipedia.org/wiki/Signal_(IPC)</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> php linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>spring bootåˆ†ç¯å¢ƒè‡ªå®šä¹‰é…ç½®</title>
      <link href="2020/05/26/spring-boot%E5%88%86%E7%8E%AF%E5%A2%83%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE/"/>
      <url>2020/05/26/spring-boot%E5%88%86%E7%8E%AF%E5%A2%83%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ä¸€èˆ¬è§„æ¨¡ä¼ä¸šï¼Œåº”å½“éƒ½æœ‰æµ‹è¯•ç¯å¢ƒå’Œæ­£å¼ç¯å¢ƒåŒºåˆ«ï¼Œæˆ–è€…è‡³å°‘ä¹Ÿæœ‰å¼€å‘ç¯å¢ƒå’Œæ­£å¼ç¯å¢ƒã€‚é‚£ä¸åŒç¯å¢ƒå¿…ç„¶å°±ä¼šæœ‰ä¸€äº›ç¯å¢ƒä¾èµ–çš„ä¸åŒï¼Œä¸ç®¡æ˜¯å‡ºäºå®‰å…¨æ€§è€ƒè™‘è¿˜æ˜¯å…¶ä»–åŸå› å¯¼è‡´çš„ã€‚æ¯”å¦‚æ•°æ®åº“é…ç½®ã€OSSè´¦å·ä¿¡æ¯ç­‰ã€‚é‚£ç¨‹åºå½“ä¸­å°±éœ€è¦é…ç½®å¤šä»½é…ç½®ä¿¡æ¯å’Œæ ¹æ®ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒé…ç½®ã€‚</p><span id="more"></span><h2 id="åˆ†ç¯å¢ƒé…ç½®"><a href="#åˆ†ç¯å¢ƒé…ç½®" class="headerlink" title="åˆ†ç¯å¢ƒé…ç½®"></a>åˆ†ç¯å¢ƒé…ç½®</h2><p><img src="http://img.rc5j.cn/blog20200526133442.png" alt=""></p><pre><code># æ¿€æ´»æ—¥å¿—ç¯å¢ƒspring.profiles.active=prd</code></pre><p>å…¬å…±é…ç½®è¿˜æ˜¯å†™åœ¨applicationã€‚<br>ç›¸åº”é…ç½®å†™åœ¨-{env} æ–‡ä»¶é‡Œã€‚</p><h2 id="è‡ªå®šä¹‰é…ç½®è·å–"><a href="#è‡ªå®šä¹‰é…ç½®è·å–" class="headerlink" title="è‡ªå®šä¹‰é…ç½®è·å–"></a>è‡ªå®šä¹‰é…ç½®è·å–</h2><p>ä¸Šé¢æ˜¯springæ¡†æ¶æ‰€éœ€çš„é»˜è®¤é…ç½®æ–¹æ³•ï¼Œæˆ‘ä»¬é€šå¸¸è¿˜éœ€è¦éå¸¸å¤šçš„è‡ªå®šä¹‰é…ç½®ã€‚æ¯”å¦‚å¯†ç çš„åŠ ç›saltç­‰ç­‰ï¼Œè¿™æ˜¯é¡¹ç›®çš„è‡ªå®šä¹‰é…ç½®ã€‚</p><p>é‚£å¦‚æœå¯¹è¿™äº›è‡ªå®šä¹‰å†…å®¹è¿›è¡Œé…ç½®å’Œè·å–å‘¢ã€‚</p><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>æˆ‘ä»¬ä¾ç„¶å¯ä»¥åœ¨application.propertiesè¿›è¡Œé…ç½®ã€‚</p><p>ä¾‹å¦‚ï¼š</p><pre><code class="properties">app.security.salt=zM2Y&amp;*21.rkJr=11app.oss.host=http://oss-cn-beijing.aliyuncs.comapp.oss.bucket=bucketNanmeapp.oss.accessKey=accessKeyapp.oss.accessSecret=accessSecret</code></pre><h2 id="è·å–é…ç½®"><a href="#è·å–é…ç½®" class="headerlink" title="è·å–é…ç½®"></a>è·å–é…ç½®</h2><pre><code class="java">@Servicepublic class OssService &#123;    @Value(&quot;$&#123;app.oss.host&#125;&quot;)    private String host;    @Value(&quot;$&#123;app.oss.accessKey&#125;&quot;)    private String accessKeyId;    @Value(&quot;$&#123;app.oss.accessSecret&#125;&quot;)    private String accessKeySecret;    @Value(&quot;$&#123;app.oss.bucket&#125;&quot;)    private String bucketName;&#125;</code></pre><p><strong>ä¸€å®šè¦æ˜¯åœ¨spring beané‡Œè¿›è¡Œè·å–ï¼Œå¦åˆ™æ— æ³•è·å–åˆ°ã€‚</strong></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol><li><a href="https://docs.spring.io/spring-boot/docs/1.5.22.RELEASE/reference/html/boot-features-external-config.html">https://docs.spring.io/spring-boot/docs/1.5.22.RELEASE/reference/html/boot-features-external-config.html</a></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> java spring-boot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysqlå•ä¸ªè¡¨çš„æƒé™æ§åˆ¶</title>
      <link href="2020/05/08/mysql%E5%8D%95%E4%B8%AA%E8%A1%A8%E7%9A%84%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/"/>
      <url>2020/05/08/mysql%E5%8D%95%E4%B8%AA%E8%A1%A8%E7%9A%84%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<blockquote><p>åœ¨ç³»ç»Ÿå¼€å‘å½“ä¸­æœ‰è¿™æ ·çš„éœ€æ±‚ï¼ŒAç³»ç»Ÿéœ€è¦è¯»å†™Bç³»ç»Ÿçš„æ•°æ®åº“æ•°æ®,ä½†æ˜¯æŸäº›ç‰¹æ®Šçš„è¡¨æ•°æ®åªå…è®¸è¯»æ“ä½œã€‚è¿™æ—¶å€™å°±éœ€è¦åšåˆ°è¡¨çº§çš„æƒé™æ§åˆ¶ã€‚</p></blockquote><span id="more"></span><h2 id="revoke"><a href="#revoke" class="headerlink" title="revoke"></a>revoke</h2><p>Mysqlæœ¬èº«æ˜¯æ”¯æŒç”¨revokeè¿›è¡Œæƒé™å›æ”¶æ“ä½œçš„ã€‚</p><p><a href="https://dev.mysql.com/doc/refman/5.6/en/revoke.html">https://dev.mysql.com/doc/refman/5.6/en/revoke.html</a></p><pre><code>REVOKE    priv_type [(column_list)]      [, priv_type [(column_list)]] ...    ON [object_type] priv_level    FROM user [, user] ...REVOKE ALL [PRIVILEGES], GRANT OPTION    FROM user [, user] ...REVOKE PROXY ON user    FROM user [, user] ...</code></pre><p>ä»è¯­æ³•å½“ä¸­å¯ä»¥çœ‹åˆ°è¿˜å¯ä»¥åšåˆ°åˆ—çº§åˆ«çš„æ§åˆ¶ã€‚</p><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><pre><code>mysql&gt; revoke insert,delete,update on db_oms.t_order from &#39;oms_order_ro&#39;@&#39;localhost&#39;;ERROR 1147 (42000): There is no such grant defined for user &#39;oms_order_ro&#39; on host &#39;localhost&#39; on table &#39;t_order&#39;</code></pre><p>ä½†æ˜¯äº‹å®ä¸Šï¼Œæ‰§è¡Œçš„æ—¶å€™ä¼šé‡åˆ°é—®é¢˜ã€‚</p><p><strong>ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ</strong></p><pre><code>mysql&gt; show grants for oms_order_ro@localhost    -&gt; ;+----------------------------------------------------------------------------------+| Grants for oms_order_ro@localhost                                                |+----------------------------------------------------------------------------------+| GRANT USAGE ON *.* TO &#39;oms_order_ro&#39;@&#39;localhost&#39;                                 || GRANT SELECT, INSERT, UPDATE, DELETE ON `db_oms`.* TO &#39;oms_order_ro&#39;@&#39;localhost&#39; |+----------------------------------------------------------------------------------+</code></pre><p>ä»”ç»†çœ‹ä¸‹ï¼Œæˆ‘ä»¬æ˜¯ä½¿ç”¨çš„é€šé…ç¬¦å»è¿›è¡Œèµ‹æƒé™ã€‚çœ‹èµ·æ¥è¿™é‡Œmysqlè¿˜æ˜¯è¡¨ç°çš„æ¯”è¾ƒæœ¬ã€‚è®¤ä¸ºæ²¡æœ‰è¯¥æƒé™è¿›è¡Œå›æ”¶ã€‚</p><p>é‚£ä¹ˆæ­£ç¡®çš„åšæ³•åº”è¯¥æ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</p><blockquote><p>Managing access in mysql can be quite dificult !!</p></blockquote><p>Once you gave him database.* you cannot revoke access for an object that is in that class. MySQL doesnâ€™t expand the Hotels.* wildcard to the individual tables The permissions tables store the granted permissions. Therefore, since you didnâ€™t actually grant anything on Hotels.AllHotels , thereâ€™s nothing for MySQL to revoke. In this case you need to do it granular form the start !</p><p>Remove all privileges on database, table, column levels, etccc.</p><p>Grant privileges to EACH table, except â€˜you chooseâ€™.<br>Grant privilege to specified fields in table â€˜you chooseâ€™.</p><p><strong>æˆ‘ä»¬å¿…é¡»è¦é€ä¸ªé€ä¸ªè¡¨è¿›è¡Œèµ‹æƒé™ï¼Œç„¶åè¿›è¡Œå›æ”¶ã€‚</strong></p><p>å®é™…ä¸Šè¿™ä¹ˆæ“ä½œè™½ç„¶èƒ½è§£å†³é—®é¢˜ï¼Œä½†æ˜¯ä¼šå¸¦æ¥è·Ÿå¤šé—®é¢˜ï¼Œå¦‚æœè¡¨å¢åŠ äº†ã€‚ä½ å¿…é¡»å†å¯¹è¿™ä¸ªè¡¨è¿›è¡Œèµ‹æƒé™å’Œå›æ”¶æƒé™ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Seleniumè‡ªåŠ¨åŒ–æµ‹è¯•åœ¨é¡µé¢webæ€§èƒ½æµ‹è¯•åº”ç”¨çš„å°è¯•</title>
      <link href="2020/05/07/Selenium%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E5%9C%A8%E9%A1%B5%E9%9D%A2web%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%BA%94%E6%9C%89%E7%9A%84%E5%B0%9D%E8%AF%95/"/>
      <url>2020/05/07/Selenium%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E5%9C%A8%E9%A1%B5%E9%9D%A2web%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%BA%94%E6%9C%89%E7%9A%84%E5%B0%9D%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<p>å¯¹äºwebæµ‹è¯•ï¼Œæˆ‘ä»¬é€šå¸¸åœ¨åšçš„æµ‹è¯•éƒ½æ˜¯äººå·¥çš„åŠŸèƒ½æµ‹è¯•ã€‚é‚£ä¹ˆå°‘è§çš„è‡ªåŠ¨åŒ–æµ‹è¯•åˆ°åº•é€‚ç”¨å“ªäº›åœºæ™¯å‘¢ï¼Ÿ</p><span id="more"></span><h1 id="ç”¨pythonè¿›è¡Œwebè‡ªåŠ¨åŒ–æµ‹è¯•"><a href="#ç”¨pythonè¿›è¡Œwebè‡ªåŠ¨åŒ–æµ‹è¯•" class="headerlink" title="ç”¨pythonè¿›è¡Œwebè‡ªåŠ¨åŒ–æµ‹è¯•"></a>ç”¨pythonè¿›è¡Œwebè‡ªåŠ¨åŒ–æµ‹è¯•</h1><blockquote><p>å‰æ®µæ—¶é—´ï¼Œåœ¨å®¢æœä¿¡æ¯ç³»ç»Ÿè¿›å…¥ç”¨æˆ·ä½“éªŒé˜¶æ®µæ—¶å‘ç°å†…å­˜å­˜åœ¨æ³„éœ²é—®é¢˜ã€‚æˆ‘ä»¬èŠ±äº†å¾ˆå¤šæ—¶é—´å»æ’æŸ¥åŸå› ã€‚ç»è¿‡å„ç§å¯èƒ½çš„ä¼˜åŒ–æ–¹æ¡ˆï¼Œç»“æœå‘ç°æ²¡æœ‰å®è´¨æ€§çš„æ•ˆæœï¼Œäºæ˜¯æˆ‘ä»¬å†³å®šé‡æ„ã€‚ä½†æ˜¯å¦‚ä½•ä¿è¯é‡æ„æ–¹æ¡ˆçš„å¯è¡Œå‘¢ï¼Ÿäºæ˜¯æˆ‘ä»¬ç”¨åˆ°äº†python+Selenium</p></blockquote><h2 id="ä¸ºä»€ä¹ˆä¼šç”¨åˆ°webè‡ªåŠ¨åŒ–æµ‹è¯•"><a href="#ä¸ºä»€ä¹ˆä¼šç”¨åˆ°webè‡ªåŠ¨åŒ–æµ‹è¯•" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šç”¨åˆ°webè‡ªåŠ¨åŒ–æµ‹è¯•"></a>ä¸ºä»€ä¹ˆä¼šç”¨åˆ°webè‡ªåŠ¨åŒ–æµ‹è¯•</h2><h3 id="webè‡ªåŠ¨åŒ–æµ‹è¯•é€‚ç”¨åœºæ™¯"><a href="#webè‡ªåŠ¨åŒ–æµ‹è¯•é€‚ç”¨åœºæ™¯" class="headerlink" title="webè‡ªåŠ¨åŒ–æµ‹è¯•é€‚ç”¨åœºæ™¯"></a>webè‡ªåŠ¨åŒ–æµ‹è¯•é€‚ç”¨åœºæ™¯</h3><p>å¯¹äºwebæµ‹è¯•ï¼Œæˆ‘ä»¬é€šå¸¸åœ¨åšçš„æµ‹è¯•éƒ½æ˜¯äººå·¥çš„åŠŸèƒ½æµ‹è¯•ã€‚é‚£ä¹ˆå°‘è§çš„è‡ªåŠ¨åŒ–æµ‹è¯•åˆ°åº•é€‚ç”¨å“ªäº›åœºæ™¯å‘¢ï¼Ÿ</p><ul><li>å›å½’æµ‹è¯•ã€‚æ¯ä¸€æ¬¡åº”ç”¨å‘å¸ƒï¼Œéƒ½ä¼´éšç€ä¸€æ¬¡å›å½’æµ‹è¯•ã€‚å¯¹äºé‡å¤æ€§çš„å·¥ä½œï¼Œæœºå™¨æ˜¾ç„¶æ›´é€‚åˆã€‚</li><li>å…¼å®¹æ€§æµ‹è¯•ã€‚ä¸ç®¡æ˜¯Webæµ‹è¯•ï¼Œè¿˜æ˜¯Appæµ‹è¯•ï¼Œå…¼å®¹æ€§æµ‹è¯•éƒ½æ˜¯å¿…ä¸å¯å°‘çš„ä¸€ç¯ã€‚ä»¥Webæµ‹è¯•ä¸ºä¾‹ï¼ŒåŒæ ·çš„æµ‹è¯•ç”¨ä¾‹ï¼Œéœ€è¦åœ¨ä¸åŒçš„æµè§ˆå™¨ä¸Šåˆ†åˆ«è¿è¡Œä¸€éï¼Œè¿™å¯¹æµ‹è¯•äººå‘˜è€Œè¨€ä¸å¯è°“ä¸æ˜¯ä¸€ç§æŠ˜ç£¨ã€‚</li><li>å¤§è§„æ¨¡æµ‹è¯•ã€‚å¦‚æœä¸€æ¬¡æµ‹è¯•æ¶‰åŠçš„æµ‹è¯•ç”¨ä¾‹è¿‡å¤šï¼ˆæ¯”å¦‚100+ï¼‰ï¼ŒåŠŸèƒ½æµ‹è¯•éš¾å…ä¼šæœ‰é—æ¼æˆ–è€…é‡å¤ï¼Œè€Œè‡ªåŠ¨åŒ–æµ‹è¯•å¯ä»¥è½»æ¾ç¡®ä¿ä¸€ä¸ªä¸å°‘ï¼Œä¸€ä¸ªä¹Ÿä¸å¤šã€‚</li><li>æ€§èƒ½æµ‹è¯•</li></ul><h3 id="å¼Šç«¯"><a href="#å¼Šç«¯" class="headerlink" title="å¼Šç«¯"></a>å¼Šç«¯</h3><p>ä¸‡äº‹çš†æœ‰åˆ©å¼Šï¼Œæœºå™¨çš„è‡ªåŠ¨åŒ–æµ‹è¯•æ²¡æœ‰å¹¿æ³›åº”ç”¨è‚¯å®šæ˜¯æœ‰åŸå› çš„ã€‚</p><ul><li>ä¸ä½çš„æŠ€æœ¯é—¨æ§›ã€‚ä¸è®ºæ˜¯ä½¿ç”¨å“ªç§è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ï¼Œå¯¹äºæµ‹è¯•äººå‘˜è€Œè¨€ï¼Œéƒ½å­˜åœ¨ä¸€å®šçš„æŠ€æœ¯é—¨æ§›ï¼Œä¸€èˆ¬è‡³å°‘éœ€è¦å­¦ä¹ å¹¶æŒæ¡ä¸€é—¨ç¼–ç¨‹è¯­è¨€ã€‚<br>å¯è§‚çš„å¼€å‘æˆæœ¬å’Œç»´æŠ¤æˆæœ¬ã€‚è·Ÿä»»ä½•ç¨‹åºä¸€æ ·ï¼Œæ— è®ºæ˜¯ç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ï¼Œè¿˜æ˜¯åœ¨éœ€æ±‚å˜åŒ–æ—¶ä¿®æ”¹è„šæœ¬ï¼Œéƒ½éœ€è¦èŠ±è´¹å¤§é‡çš„æ—¶é—´ã€‚</li><li>éœ€æ±‚è¦ç¨³å®šã€‚è‡ªåŠ¨åŒ–æµ‹è¯•çš„å‰ææ˜¯æµ‹è¯•ç”¨ä¾‹è¦ç¨³å®šï¼Œè€Œæµ‹è¯•ç”¨ä¾‹ç¨³å®šçš„å‰ææ˜¯éœ€æ±‚è¦ç¨³å®šã€‚å¯¹äºä¸´æ—¶çš„æˆ–è€…è¯´ä¸€æ¬¡æ€§çš„éœ€æ±‚ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•å¾€å¾€æ˜¯å¾—ä¸å¿å¤±çš„ã€‚</li><li>åº”ç”¨å‘¨æœŸé•¿ã€‚åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸè¶Šé•¿ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•èŠ‚çœçš„æ—¶é—´è¶Šå¤šï¼Œå¸¦æ¥çš„ä»·å€¼ä¹Ÿè¶Šå¤§ã€‚</li></ul><h3 id="æ€§èƒ½æµ‹è¯•"><a href="#æ€§èƒ½æµ‹è¯•" class="headerlink" title="æ€§èƒ½æµ‹è¯•"></a>æ€§èƒ½æµ‹è¯•</h3><p>éšç€webå‰ç«¯æŠ€æœ¯å‘å±•æ›´æ–°è¶Šæ¥è¶Šè¿…çŒ›çš„æ€åŠ¿ï¼Œå‰ç«¯æŠ€æœ¯å’Œæ¡†æ¶å±‚å‡ºä¸ç©·ã€‚ä½†å¾€å¾€æˆ‘ä»¬ä¼šåœ¨çŸ­æœŸå†…é«˜ä¼°æŠ€æœ¯å¸¦æ¥çš„å½±å“ã€‚</p><p><img src="http://img.rc5j.cn/blog20190524140107.png" alt=""></p><p>æ‰€ä»¥å¯¹äºä»»ä½•ä¸€ä¸ªæ–°çš„äº‹ç‰©ï¼Œæˆ‘ä»¬é‡‡å–ä¿å®ˆçš„æ€åº¦å¯¹å¾…å¯èƒ½ä¼šå°‘è·Œå…¥ä¸€äº›<strong>å¹»ç­çš„ä½è°·æœŸ</strong>ã€‚å¯¹äºæ–°æŠ€æœ¯åšå……åˆ†çš„è¯„ä¼°æµ‹è¯•ï¼Œå¯èƒ½ä¼šè®©æˆ‘ä»¬å°‘è¸©ä¸€äº›å‘ã€‚å½“ç„¶å¾€å¾€è¿™è¯ï¼Œéƒ½æ˜¯åœ¨äº‹åæ‰ä¼šæå‡ºæ¥ã€‚</p><p>ä¸ºä»€ä¹ˆå¯ä»¥ç”¨è‡ªåŠ¨åŒ–æµ‹è¯•åšæ€§èƒ½æµ‹è¯•ï¼Ÿ<br>ç½‘ä¸Šä¼¼ä¹éƒ½æ²¡æœ‰è¿™ç§å…ˆä¾‹ã€‚æˆ‘æ€»ç»“ä»¥ä¸‹å‡ ä¸ªåŸå› ï¼š</p><ol><li>è„šæœ¬èƒ½å¼ºæœ‰è§„å¾‹åœ°é‡å¤æ‰§è¡Œæ“ä½œï¼Œè€Œå¼€å‘æˆ–æµ‹è¯•è‡ªå·±åšè¿™ä¸ªå·¥ä½œä¼šå¾ˆç¹çè€Œä¸”å‡ºäº†ä¸€æ­¥å·®é”™å°±å¾—é‡æ¥</li><li>è„šæœ¬èƒ½å°†æ‰§è¡Œæ“ä½œå’Œæ•°æ®è®°å½•ç»“åˆèµ·æ¥ã€‚è€Œäººç±»æ‰§è¡Œä¸€æ¬¡æ•°æ®è®°å½•å’ŒåŠ¨ä½œæ‰§è¡Œä¹Ÿè®¸æ²¡é—®é¢˜ï¼Œä½†é‡å¤500æ¬¡æˆ–æ›´å¤šè€Œæ— å·®é”™é‚£å°±å›°éš¾äº†ã€‚</li></ol><h2 id="webè‡ªåŠ¨åŒ–æµ‹è¯•æ–¹æ³•"><a href="#webè‡ªåŠ¨åŒ–æµ‹è¯•æ–¹æ³•" class="headerlink" title="webè‡ªåŠ¨åŒ–æµ‹è¯•æ–¹æ³•"></a>webè‡ªåŠ¨åŒ–æµ‹è¯•æ–¹æ³•</h2><ul><li>python+Selenium è·¨æµè§ˆå™¨æ”¯æŒ</li><li>puppeteer ä¸“æ³¨äºchrome</li><li>airtest è·¨å¹³å°ï¼Œå®‰å“ã€iosã€webï¼Œwebè¿˜æ˜¯ç”¨çš„Selenium</li></ul><h2 id="æµ‹è¯•ç»“æœ"><a href="#æµ‹è¯•ç»“æœ" class="headerlink" title="æµ‹è¯•ç»“æœ"></a>æµ‹è¯•ç»“æœ</h2><p><img src="http://img.rc5j.cn/blog20190514101858.png" alt=""></p><p>æ‰§è¡Œè„šæœ¬</p><p><img src="http://img.rc5j.cn/blog20190524162047.gif" alt=""></p><p>è„šæœ¬è¿è¡Œæƒ…å†µï¼Œæµè§ˆå™¨åœ¨è‡ªåŠ¨è¿›è¡Œæ“ä½œ</p><p><img src="http://img.rc5j.cn/blog20190524162725.png" alt=""></p><p>å¾—å‡ºç»Ÿè®¡ç»“æœã€‚æˆ‘ä»¬æ¨¡æ‹Ÿç”¨æˆ·çš„æŸä¸ªæœ€é¢‘ç¹çš„æ“ä½œï¼Œå‘ç°é‡‡ç”¨æ–°çš„æ–¹æ¡ˆåå†…å­˜ä¼šåœ¨çŸ­æ—¶é—´å†…æœ‰æ•ˆå›æ”¶ã€‚æ•´ä½“ä¸Šï¼Œé¡µé¢å†…å­˜ä¼šè¶‹äºç¨³å®šçš„æ€åŠ¿ã€‚</p><h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><h3 id="åŠ¨æ€çš„ggcode"><a href="#åŠ¨æ€çš„ggcode" class="headerlink" title="åŠ¨æ€çš„ggcode"></a>åŠ¨æ€çš„ggcode</h3><pre><code class="python"> ggcode = prompt(&quot;è¾“å…¥è°·æ­Œç : &quot;)</code></pre><p>ç”±äºç™»å½•ç”¨çš„è°·æ­Œç æ˜¯åŠ¨æ€çš„ï¼Œæ‰€ä»¥è¿™é‡Œåªèƒ½æ¯æ¬¡è¾“å…¥è¿›è¡Œå¡«å……ã€‚è¿™é‡Œæˆ‘ä»¬å¼•å…¥prompt_toolkitè¿›è¡Œç»ˆç«¯çš„äº¤äº’</p><h3 id="è·å–å…ƒç´ "><a href="#è·å–å…ƒç´ " class="headerlink" title="è·å–å…ƒç´ "></a>è·å–å…ƒç´ </h3><p>å¦‚ä»Šçš„å‰ç«¯é¡¹ç›®ï¼Œç”±äºä½¿ç”¨çš„æ˜¯æ•°æ®é©±åŠ¨domï¼Œä¸æ˜¯ä¼ ç»Ÿçš„jqueryæ“ä½œï¼Œç°åœ¨åŸºæœ¬çœ‹ä¸åˆ°id classç­‰è¿›è¡Œå…ƒç´ å®šä½ã€‚ç°åœ¨æœ€æ–¹ä¾¿çš„åšæ³•åªèƒ½æ˜¯é€šè¿‡xpathå¯»æ‰¾å…ƒç´ ã€‚</p><p><img src="http://img.rc5j.cn/blog20190524180042.png" alt=""></p><pre><code>xpath = &#39;//*[@id=&quot;app&quot;]/div/div[2]/div[1]&#39;element = self.browser.find_element_by_xpath(                    xpath)</code></pre><p><strong>ç”±äºä¸æ˜¯å›ºå®šidï¼Œé¡µé¢ä¸€æ—¦æ”¹å˜xpathå¾ˆæœ‰å¯èƒ½æ”¹å˜ï¼Œä¼šå¯¼è‡´å…ƒç´ æ‰¾ä¸åˆ°ã€‚</strong></p><h3 id="webdriverè¿›ç¨‹ä¸é€€å‡º"><a href="#webdriverè¿›ç¨‹ä¸é€€å‡º" class="headerlink" title="webdriverè¿›ç¨‹ä¸é€€å‡º"></a>webdriverè¿›ç¨‹ä¸é€€å‡º</h3><p>åœ¨ä½¿ç”¨è¿‡ç¨‹å½“ä¸­å‘ç°æä¾›çš„<code>quit()</code> æ–¹æ³•å¹¶ä¸èƒ½è®©è¿›ç¨‹é€€å‡ºï¼Œæ‰€ä»¥åªèƒ½è‡ªå·±å°†è¿›ç¨‹killæ‰ã€‚</p><pre><code class="python">def close_browser(self):</code></pre><h3 id="ç‚¹å‡»"><a href="#ç‚¹å‡»" class="headerlink" title="ç‚¹å‡»"></a>ç‚¹å‡»</h3><p>åœ¨è¿›è¡ŒæŒ‰é’®ç‚¹å‡»çš„æ—¶å€™ï¼Œç»å¸¸ä¼šå› ä¸ºé¡µé¢æœªåŠ è½½å®Œç­‰åŸå› å¯¼è‡´æ— æ³•ç‚¹å‡»ã€‚ç»“æœå°±æ˜¯å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚å¯¹äºè¿™ç§æƒ…å†µwebdriveræœ¬èº«æœ‰æä¾›waitç­‰å¾…ã€‚</p><pre><code class="python">wait = WebDriverWait(self.browser, 30)            element = wait.until(EC.element_to_be_clickable((By.XPATH, xpath)))</code></pre><p><code>WebDriverWait</code> éœ€è¦è®¾ç½®ä¸€ä¸ªç­‰å¾…æ—¶é•¿ï¼Œä¸å¯èƒ½æ— é™ç­‰å¾…</p><p>è¿˜æœ‰äº›æƒ…å†µä¸‹ï¼Œæ˜¯ç”±äºéœ€è¦ä¸‹æ‹‰æ»šåŠ¨æ¡æ‰èƒ½è¿›è¡Œç‚¹å‡»ã€‚è¿™ç§æƒ…å†µå¯ä»¥è€ƒè™‘æ‰§è¡Œjsè¿›è¡Œç‚¹å‡»ã€‚</p><pre><code class="python">js_click_next_page = &#39;document.querySelector(&quot;body &gt; div.worker-order-search-list &gt; div.content-wrapper &gt; section &gt; ul &gt; li.ivu-page-next&quot;).click()&#39;                browser.execute_script(js_click_next_page)</code></pre><p><strong>ä½¿ç”¨webdriver.clickè¿˜æ˜¯ç”¨jsç‚¹å‡»ï¼Ÿ</strong></p><blockquote><p>When Should You Use JavaScript for Clicking?<br>If you are using Selenium for testing an application, my answer to this question is â€œalmost neverâ€. By and large, your Selenium test should reproduce what a user would do with the browser. Taking the example of the drop down menu: a test should click on the button that brings up the drop down first, and then click on the menu item. If there is a problem with the GUI because the button is invisible, or the button fails to show the menu items, or something similar, then your test will fail and youâ€™ll have detected the bug. If you use JavaScript to click around, you wonâ€™t be able to detect these bugs through automated testing.</p></blockquote><p><strong>æ€»ä¹‹è¿˜æ˜¯çœ‹ä½ çš„ä½¿ç”¨ç›®çš„ï¼Œå¦‚æœè‡ªåŠ¨åŒ–æµ‹è¯•çš„ç›®çš„å€¾å‘äºæµ‹è¯•é¡µé¢åŠŸèƒ½ã€‚é‚£ä¹ˆå»ºè®®ä½¿ç”¨webdriver.clickã€‚å¦‚æœæ˜¯ä¸ºäº†æµ‹è¯•æ€§èƒ½ï¼Œé‚£å¯ä»¥è¿›è¡Œjsç‚¹å‡»äº†ã€‚</strong></p><h2 id="è·å–é¡µé¢å†…å­˜"><a href="#è·å–é¡µé¢å†…å­˜" class="headerlink" title="è·å–é¡µé¢å†…å­˜"></a>è·å–é¡µé¢å†…å­˜</h2><p>æµè§ˆå™¨çš„ä»»åŠ¡ç®¡ç†å™¨å¯ä»¥å¾ˆå®¹æ˜“çš„çœ‹åˆ°é¡µé¢çš„å†…å­˜ã€cpuã€ç½‘ç»œæƒ…å†µï¼Œä½†æ˜¯å¦‚ä½•è·å–åˆ°è®°å½•å¹¶ç»Ÿè®¡å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ï¼Œå¾ˆå¯æƒœç°åœ¨è¿˜æ²¡æ‰¾åˆ°ã€‚å¦‚æœæœ‰å®˜æ–¹åŠæ³•ï¼Œè¯·å‘Šè¯‰æˆ‘ã€‚</p><p>æˆ‘èµ°äº†ä¸€ä¸ªå…¶ä»–é€”å¾„è·å–ï¼Œä»æ“ä½œç³»ç»Ÿå±‚é¢è·å–è¿›ç¨‹ã€‚è·å–ä¸€ä¸ªè¿›ç¨‹å¾—å†…å­˜å ç”¨æ˜¯ä¸€ä¸ªç®€å•çš„äº‹ï¼Œä½†æ˜¯å¦‚ä½•çŸ¥é“æŸä¸ªé¡µé¢çš„è¿›ç¨‹idå‘¢ã€‚å¾ˆé—æ†¾çš„æ˜¯ï¼ŒwebdriveråŒæ ·æ²¡æœ‰æ¥å£æ–¹æ³•æä¾›ã€‚äºæ˜¯æˆ‘åªèƒ½ä»webdriverå­è¿›ç¨‹å…¥æ‰‹ï¼Œçœ‹æœ‰æ²¡æœ‰ä¿¡æ¯èƒ½ä¸pageå…³è”ä¸Šã€‚å¾ˆé—æ†¾çš„äº‹ï¼Œå•å•ä»å­è¿›ç¨‹åçœ‹ä¸é¡µé¢æ¯«æ— å…³è”ã€‚æ‰€ä»¥ã€‚ã€‚æœ€åï¼Œæˆ‘åªèƒ½åšä¸€ä¸ªå‡è®¾ï¼Œå‡è®¾æµè§ˆå™¨å¯åŠ¨ç±»ä¼¼linuxå¯åŠ¨ã€‚å¯åŠ¨çš„ç¨‹åºæ˜¯æœ‰å…ˆåå…³ç³»çš„ã€‚</p><pre><code class="python">def get_page_pid(self, page_num=1):        &quot;&quot;&quot;[è·å–å¯åŠ¨é¡µé¢çš„è¿›ç¨‹id,éå®˜æ–¹æ–¹æ³•,ä¸ä¸€å®šæ­£ç¡®ã€‚            åŸç†:å‡è®¾chromeä¸»è¿›ç¨‹å¯åŠ¨å­è¿›ç¨‹æ˜¯æœ‰é¡ºåºçš„,é‚£ä¹ˆæ‰“å¼€çš„é¡µé¢è¿›ç¨‹åœ¨ç¬¬4ä¸ªå¼€å§‹å¯åŠ¨]        Returns:            [type] -- [description]        &quot;&quot;&quot;        webdriver_pid = self.browser.service.process.pid        ps = psutil.Process(webdriver_pid)        ps_children = ps.children(True)        return ps_children[3+page_num-1].pid</code></pre><p>è¿™æ˜¯ä¸€ç§å¯¹é¡¹ç›®æ— ä¾µå…¥çš„åšæ³•ï¼Œä½ ä¸éœ€è¦æ”¹åŠ¨é¡¹ç›®ä»£ç ï¼Œå°±å¯ä»¥å¯¹æµè§ˆå™¨é¡µé¢å†…å­˜è¿›è¡Œç»Ÿè®¡ã€‚è¿˜æœ‰å…¶ä»–åšæ³•ï¼Œå¯ä»¥å¯¹é¡¹ç›®è¿›è¡Œå¢åŠ å†…å­˜ä¸ŠæŠ¥è¿›è¡Œç»Ÿè®¡ã€‚ä½†è¿™æ ·çš„åšæ³•åŒæ ·æœ‰å¼Šç«¯ï¼š</p><ol><li>éœ€è¦åŠ¨è¢«æµ‹é¡¹ç›®ï¼Œå¯¹é¡¹ç›®å¹²æ‰°</li><li>å¢åŠ å·¥ä½œé‡ï¼Œä¸å…‰æ˜¯ä¸ŠæŠ¥è¿˜åŒ…æ‹¬æ¥æ”¶ä¸ŠæŠ¥æ¥å£</li><li>å¦‚æœæ˜¯å¤šiframeé¡µç­¾æ–¹å¼ï¼Œç»Ÿè®¡èšåˆä¸ŠæŠ¥å°†éå¸¸ç¹ç</li></ol><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç»Ÿè®¡é¡µé¢è¿›ç¨‹æ–¹æ³•ã€‚<strong>å¾—åˆ°çš„æ•°æ®æ˜¯æ•´ä¸ªé¡µé¢è¿›ç¨‹æ‰€å ç”¨çš„å†…å­˜ï¼Œå¹¶éé¡µé¢jså ç”¨å†…å­˜ã€‚</strong></p><h2 id="ç»Ÿè®¡"><a href="#ç»Ÿè®¡" class="headerlink" title="ç»Ÿè®¡"></a>ç»Ÿè®¡</h2><p>åœ¨ç»Ÿè®¡ä¸Šï¼Œæˆ‘ä½¿ç”¨äº†chartify+pandas,åªè¦ä¼ å…¥æ•°æ®å°±èƒ½å¿«æ·åœ°ç”Ÿæˆå›¾è¡¨</p><pre><code class="python">def chartArea(self, data, x_column, y_column):        &quot;&quot;&quot;[ç»˜åˆ¶åŒºåŸŸå›¾]        Arguments:            data &#123;[dict]&#125; -- [æ•°æ®çŸ©é˜µ,æ‹¿å»æ„å»ºpandas dataFrame]            x_column &#123;[type]&#125; -- [xè½´å­—æ®µ]            y_column &#123;[type]&#125; -- [yè½´å­—æ®µ]        &quot;&quot;&quot;        data_frame = pd.DataFrame(data)        print(data_frame)        self.ch.plot.area(data_frame=data_frame,                          x_column=x_column, y_column=y_column, stacked=True)    def show(self, show_type=&#39;html&#39;):        self.ch.save(&#39;./output/%s-%s.png&#39; %                     (self.subtitle, time.strftime(&quot;%Y%m%d%H%M%S&quot;)), &#39;png&#39;)</code></pre><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ­£å¦‚å‰é¢æ‰€è¯´ï¼Œwebè‡ªåŠ¨åŒ–æµ‹è¯•æ²¡æœ‰å¹¿æ³›åº”ç”¨è‚¯å®šæ˜¯æœ‰åŸå› çš„ã€‚ä½†æ˜¯åšä¸ºå‰ç«¯é—®é¢˜çš„è®ºè¯è¿˜æ˜¯æœ‰å¾ˆå¤§æ„ä¹‰ã€‚</p><p>æ¯”å¦‚ï¼Œé¡µé¢å ç”¨å†…å­˜é™åˆ¶æ˜¯å¤šå°‘ï¼Ÿæˆ‘æ‰¾äº†å¾ˆå¤šèµ„æ–™æ²¡æœ‰æ‰¾åˆ°(å®˜æ–¹çš„æ‰å¯ä¿¡)ã€‚</p><p>é€šè¿‡æµ‹è¯•ï¼Œæˆ‘å¾—åˆ°çš„ç»“æœæ˜¯ï¼Œchrome å¯¹å•é¡µé¢js å†…å­˜æœ‰é™åˆ¶2G,å¯¹é¡µé¢è¿›ç¨‹å†…å­˜æ— é™åˆ¶ã€‚ä½ ä¸€ä¸ªé¡µé¢è¿›ç¨‹ç”šè‡³å¯ä»¥è·‘åˆ°20Gã€‚</p><p>python+Selenium ä½¿ç”¨èµ·æ¥å¾ˆç®€å•ï¼Œæ„Ÿå…´è¶£åˆæœ‰éœ€è¦çš„è¯ï¼Œä¸å¦¨ä¸€è¯•ã€‚</p><h2 id="é™„åŠ "><a href="#é™„åŠ " class="headerlink" title="é™„åŠ "></a>é™„åŠ </h2>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello world</title>
      <link href="2020/05/07/Hello-world/"/>
      <url>2020/05/07/Hello-world/</url>
      
        <content type="html"><![CDATA[<pre><code>hello,world </code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> éšç¬” </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å·¥æ¬²å–„å…¶äº‹å¿…å…ˆåˆ©å…¶å™¨-ç¨‹åºå‘˜å·¥å…·</title>
      <link href="2019/04/04/%E5%B7%A5%E6%AC%B2%E5%96%84%E5%85%B6%E4%BA%8B%E5%BF%85%E5%85%88%E5%88%A9%E5%85%B6%E5%99%A8/"/>
      <url>2019/04/04/%E5%B7%A5%E6%AC%B2%E5%96%84%E5%85%B6%E4%BA%8B%E5%BF%85%E5%85%88%E5%88%A9%E5%85%B6%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æé«˜å·¥ä½œæ•ˆç‡ï¼Œé¦–å…ˆä½ å¾—æœ‰ä¸€å¥—ç”¨çš„é¡ºæ‰‹çš„å·¥å…·</p></blockquote><p><img src="http://img.rc5j.cn/blog20190404140301.png" alt=""></p><h2 id="å›¾åºŠ"><a href="#å›¾åºŠ" class="headerlink" title="å›¾åºŠ"></a>å›¾åºŠ</h2><span id="more"></span><p><strong>PicGo</strong></p><p><img src="http://img.rc5j.cn/blog20190404140404.png" alt=""></p><p>æ”¯æŒç²˜è´´æ¿ï¼Œç›´æ¥ä¸Šä¼ åˆ°äº‘å­˜å‚¨ã€‚</p><p>æˆ‘ç”¨ä¸ƒç‰›äº‘ï¼Œä¸Šä¼ ä¹‹ååˆ¶åŠ¨æŠŠmarkdownçš„æ ¼å¼åœ°å€ï¼Œæ”¾åˆ°ç²˜è´´æ¿ç›´æ¥å¯ä»¥ç²˜è´´åˆ°markdown.</p><p>å¯¹å–œæ¬¢ç”¨markdownå†™ä½œçš„åŒå­¦éå¸¸æ–¹ä¾¿</p><h2 id="è®°äº‹æœ¬"><a href="#è®°äº‹æœ¬" class="headerlink" title="è®°äº‹æœ¬"></a>è®°äº‹æœ¬</h2><p><strong>avenote</strong></p><p>ä¹‹å‰avenoteæ— æ³•å†™markdownï¼Œæˆ‘æ˜¯æ€ä¹ˆä¹Ÿå–œæ¬¢ä¸ä¸Šã€‚æœ€è¿‘å‘ç°ç‰ˆæœ¬æ›´æ–°ä¹‹åå¯ä»¥æ–°å»ºmarkdownæ ¼å¼ã€‚æˆ‘ç”¨é‡æ–°ä½¿ç”¨ä¸Šäº†ã€‚</p><p><img src="http://img.rc5j.cn/blog20190404175017.png" alt=""></p><p><strong>boostnote</strong></p><p>è¿™æ˜¯ä¸€æ¬¾ä¸“ä¸ºç¨‹åºå‘˜è®¾è®¡çš„è®°äº‹æœ¬ï¼Œæ”¯æŒä»£ç ç‰‡æ®µæ ¼å¼å’Œmarkdownæ ¼å¼ã€‚</p><p><img src="http://img.rc5j.cn/blog20190404175220.png" alt=""></p><p>æˆ‘æœ€å–œæ¬¢çš„ä¸€ç‚¹æ˜¯å®ƒçš„å¾…åŠè¿›åº¦å±•ç¤ºï¼Œå¾ˆç›´è§‚ã€‚</p><p>ç¼ºç‚¹å°±æ˜¯æ²¡æœ‰äº‘ç«¯åŠŸèƒ½å’Œæ²¡æœ‰æ‰‹æœºç‰ˆã€‚</p><h2 id="restå®¢æˆ·ç«¯"><a href="#restå®¢æˆ·ç«¯" class="headerlink" title="restå®¢æˆ·ç«¯"></a>restå®¢æˆ·ç«¯</h2><p><strong>Insomnia</strong></p><p>å®ƒæœ€å¤§çš„äº®ç‚¹æ˜¯èƒ½æ”¯æŒä»curlå‘½ä»¤é‡Œæ–°å»ºrequestå®ä¾‹ï¼Œèƒ½ä»chromeåˆ©çš„copy as curl å¤åˆ¶è¿‡æ¥æ— ç¼å¯¹æ¥ã€‚åœ¨è°ƒè¯•æ¥å£çš„æ—¶å€™ç®€ç›´æ˜¯å®Œç¾ï¼</p><p><img src="http://img.rc5j.cn/blog20190404180843.png" alt=""></p><h2 id="gitå®¢æˆ·ç«¯"><a href="#gitå®¢æˆ·ç«¯" class="headerlink" title="gitå®¢æˆ·ç«¯"></a>gitå®¢æˆ·ç«¯</h2><p><strong>gitKarken</strong></p><p>ç« é±¼ğŸ™å“¥æ˜¯æˆ‘åˆ°ç›®å‰ä¸ºæ­¢æœ€å–œæ¬¢çš„gitå®¢æˆ·ç«¯ï¼Œç•Œé¢ç¾è§‚ï¼Œæ“ä½œè®¾è®¡èˆ’æœï¼Œå¯¹gitflowä¼˜é›…æ”¯æŒã€‚</p><p><img src="http://img.rc5j.cn/blog20190404181218.png" alt=""></p><p>git flow æ“ä½œå¾ˆæ–¹ä¾¿ã€‚</p><p><img src="http://img.rc5j.cn/blog20190404181623.png" alt=""></p><p>æŒç»­æ›´æ–°ä¸­ã€‚ã€‚ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> ç¨‹åºäººç”Ÿ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker+compose+nginx+php</title>
      <link href="2018/07/22/docker-compose-nginx-php/"/>
      <url>2018/07/22/docker-compose-nginx-php/</url>
      
        <content type="html"><![CDATA[<p><img src="http://img.rc5j.cn/blog20200722165520.png" alt=""></p><span id="more"></span><blockquote><p>Docker å¯ä»¥è®©å¼€å‘è€…æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªè½»é‡çº§ã€å¯ç§»æ¤çš„å®¹å™¨ä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„ Linux æœºå™¨ä¸Šï¼Œä¹Ÿå¯ä»¥å®ç°è™šæ‹ŸåŒ–ã€‚</p></blockquote><h2 id="æˆ‘ç”¨dockeråšä»€ä¹ˆï¼Ÿ"><a href="#æˆ‘ç”¨dockeråšä»€ä¹ˆï¼Ÿ" class="headerlink" title="æˆ‘ç”¨dockeråšä»€ä¹ˆï¼Ÿ"></a>æˆ‘ç”¨dockeråšä»€ä¹ˆï¼Ÿ</h2><p>å¿«é€Ÿæ­å»ºå¼€å‘æ‰€éœ€ç¯å¢ƒï¼Œæµ‹è¯•å®éªŒæ–°ç»„ä»¶(å¦‚rabbitmq,kafka).é¿å…å› å®‰è£…è€Œæµªè´¹å¤ªå¤šæ—¶é—´ï¼Œæˆ‘çš„ç›®çš„æ˜¯å¿«é€Ÿå°è¯•ä½¿ç”¨ã€‚</p><h2 id="å®‰è£…docker"><a href="#å®‰è£…docker" class="headerlink" title="å®‰è£…docker"></a>å®‰è£…docker</h2><pre><code class="shell">brew cask install docker</code></pre><h2 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h2><p>Compose æ˜¯ä¸€ä¸ªç”¨æˆ·å®šä¹‰å’Œè¿è¡Œå¤šä¸ªå®¹å™¨çš„ Docker åº”ç”¨ç¨‹åºã€‚åœ¨ Compose ä¸­ä½ å¯ä»¥ä½¿ç”¨ YAML æ–‡ä»¶æ¥é…ç½®ä½ çš„åº”ç”¨æœåŠ¡ã€‚ç„¶åï¼Œåªéœ€è¦ä¸€ä¸ªç®€å•çš„å‘½ä»¤ï¼Œå°±å¯ä»¥åˆ›å»ºå¹¶å¯åŠ¨ä½ é…ç½®çš„æ‰€æœ‰æœåŠ¡ã€‚</p><h2 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h2><p><img src="http://upload-images.jianshu.io/upload_images/4033700-1a2d2c681ac9df9c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2018-08-07-14-17-25"></p><p>ä¸€ç»„æœåŠ¡å»ºç«‹ä¸€ä¸ªç›®å½•</p><h2 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h2><pre><code class="yaml">version: &#39;2&#39;services:  php7.2:    image: php:7.2-fpm    ports:      - &quot;9000:9000&quot;    volumes:       - ./php:/usr/local/etc/php      - /Users/caowenpeng/www:/www  nginx:    image: nginx    ports:       - &quot;80:80&quot;    volumes:      - /Users/caowenpeng/www:/www      - ./nginx:/etc/nginx</code></pre><h2 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h2><pre><code class="shell">docker-compose up -d</code></pre><h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>up</td><td>åˆ›å»ºå’Œå¯åŠ¨å®¹å™¨</td></tr><tr><td>ps</td><td>åˆ—å‡ºæ‰€æœ‰å®¹å™¨</td></tr><tr><td>down</td><td>åœæ­¢å¹¶åˆ é™¤å®¹å™¨ï¼Œé•œåƒï¼ŒæŒ‚è½½</td></tr><tr><td>start</td><td>å¯åŠ¨æœåŠ¡</td></tr><tr><td>stop</td><td>åœæ­¢æœåŠ¡</td></tr><tr><td>restart</td><td>é‡å¯æœåŠ¡</td></tr></tbody></table><p><strong>ç¬¬ä¸€æ¬¡ä½¿ç”¨up,ä¹‹åä½¿ç”¨start,å¦‚æœå†æ¬¡ä½¿ç”¨upå°†ä¼šé‡æ–°åˆ›å»ºå®¹å™¨ï¼Œä¸€äº›å¯¹å®¹å™¨çš„ä¿®æ”¹å°†ä¼šä¸¢å¤±</strong></p><h2 id="å…¶ä»–é—®é¢˜"><a href="#å…¶ä»–é—®é¢˜" class="headerlink" title="å…¶ä»–é—®é¢˜"></a>å…¶ä»–é—®é¢˜</h2><p>è¿›å…¥å®¹å™¨ </p><pre><code class="bash"> docker-compose exec php7.2 bash</code></pre><p>è¿›å…¥å®¹å™¨åä¼šå‘ç°åªèƒ½ç”¨å°‘é‡å‘½ä»¤ï¼Œè¿psç­‰éƒ½æ²¡æœ‰ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦å®‰è£…ä¸€äº›ç¨‹åº</p><pre><code class="bash">apt-get update  ##æ›´æ–°å…ƒapt-get install procps  ## å®‰è£… ps</code></pre><p>å®‰è£…php-rdkafkaæ‹“å±•</p><pre><code class="bash">apt-get install wgetwget https://github.com/edenhill/librdkafka/archive/master.zipapt-get install unzipunzip master.zipcd librdkafka./configure makemake install pecl install http://pecl.php.net/get/rdkafka-3.0.4.tgz#åœ¨php.ini é…ç½®å¯ç”¨ rdkafkaæ‹“å±•</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ°ç†ä½ç½®geoå¤„ç†ä¹‹mysqlå‡½æ•°</title>
      <link href="2017/12/01/%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AEgeo%E5%A4%84%E7%90%86%E4%B9%8Bmysql%E5%87%BD%E6%95%B0/"/>
      <url>2017/12/01/%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AEgeo%E5%A4%84%E7%90%86%E4%B9%8Bmysql%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ç›®å‰è¶Šæ¥è¶Šå¤šçš„ä¸šåŠ¡éƒ½ä¼šåŸºäºLBSï¼Œé™„è¿‘çš„äººï¼Œå¤–å–ä½ç½®ï¼Œé™„è¿‘å•†å®¶ç­‰ç­‰ï¼Œç°å°±è®¨è®ºç¦»æˆ‘æœ€è¿‘è¿™ä¸€ä¸šåŠ¡åœºæ™¯çš„è§£å†³æ–¹æ¡ˆã€‚</p></blockquote><p>ç›®å‰å·²çŸ¥è§£å†³æ–¹æ¡ˆæœ‰:</p><ul><li>mysql è‡ªå®šä¹‰å‡½æ•°è®¡ç®—</li><li>mysql geoç´¢å¼•</li><li>mongodb geoç´¢å¼•</li><li>postgresql PostGisç´¢å¼•</li><li>redis geo</li><li>ElasticSearch</li></ul><p>æœ¬æ–‡æµ‹è¯•ä¸‹mysql å‡½æ•°è¿ç®—çš„æ€§èƒ½</p><span id="more"></span><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><h3 id="åˆ›å»ºæ•°æ®è¡¨"><a href="#åˆ›å»ºæ•°æ®è¡¨" class="headerlink" title="åˆ›å»ºæ•°æ®è¡¨"></a>åˆ›å»ºæ•°æ®è¡¨</h3><pre><code class="sql">CREATE TABLE `driver` (  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,  `lng` float DEFAULT NULL,  `lat` float DEFAULT NULL,  PRIMARY KEY (`id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8;</code></pre><h3 id="åˆ›å»ºæµ‹è¯•æ•°æ®"><a href="#åˆ›å»ºæµ‹è¯•æ•°æ®" class="headerlink" title="åˆ›å»ºæµ‹è¯•æ•°æ®"></a>åˆ›å»ºæµ‹è¯•æ•°æ®</h3><p>åœ¨åˆ›å»ºæ•°æ®ä¹‹å‰å…ˆäº†è§£ä¸‹åŸºæœ¬çš„åœ°ç†çŸ¥è¯†:</p><ul><li><p><strong>å…¨çƒç»çº¬åº¦çš„å–å€¼èŒƒå›´ä¸º:</strong> çº¬åº¦-90<del>90ï¼Œç»åº¦-180</del>180</p></li><li><p><strong>ä¸­å›½çš„ç»çº¬åº¦èŒƒå›´å¤§çº¦ä¸ºï¼š</strong> çº¬åº¦3.86<del>53.55ï¼Œç»åº¦73.66</del>135.05</p></li><li><p>åŒ—äº¬è¡Œæ”¿ä¸­å¿ƒçš„çº¬åº¦ä¸º39.92ï¼Œç»åº¦ä¸º116.46</p></li><li><p>è¶ŠåŒ—é¢çš„åœ°æ–¹çº¬åº¦æ•°å€¼è¶Šå¤§ï¼Œè¶Šä¸œé¢çš„åœ°æ–¹ç»åº¦æ•°å€¼è¶Šå¤§</p></li><li><p>åº¦åˆ†è½¬æ¢ï¼š å°†åº¦åˆ†å•ä½æ•°æ®è½¬æ¢ä¸ºåº¦å•ä½æ•°æ®ï¼Œå…¬å¼ï¼šåº¦=åº¦+åˆ†/60</p></li><li><p>åˆ†ç§’è½¬æ¢ï¼š å°†åº¦åˆ†ç§’å•ä½æ•°æ®è½¬æ¢ä¸ºåº¦å•ä½æ•°æ®ï¼Œå…¬å¼ï¼šåº¦ = åº¦ + åˆ† / 60 + ç§’ / 60 / 60</p></li></ul><p>åœ¨çº¬åº¦ç›¸ç­‰çš„æƒ…å†µä¸‹ï¼š</p><ul><li>ç»åº¦æ¯éš”0.00001åº¦ï¼Œè·ç¦»ç›¸å·®çº¦1ç±³</li></ul><p>åœ¨ç»åº¦ç›¸ç­‰çš„æƒ…å†µä¸‹ï¼š</p><ul><li>çº¬åº¦æ¯éš”0.00001åº¦ï¼Œè·ç¦»ç›¸å·®çº¦1.1ç±³</li></ul><h2 id="mysqlå‡½æ•°è®¡ç®—"><a href="#mysqlå‡½æ•°è®¡ç®—" class="headerlink" title="mysqlå‡½æ•°è®¡ç®—"></a>mysqlå‡½æ•°è®¡ç®—</h2><pre><code class="sql">DELIMITER //CREATE DEFINER=`root`@`localhost` FUNCTION `getDistance`(    `lng1` float(10,7)     ,    `lat1` float(10,7)    ,    `lng2` float(10,7)     ,    `lat2` float(10,7)) RETURNS double    COMMENT &#39;è®¡ç®—2åæ ‡ç‚¹è·ç¦»&#39;BEGIN    declare d double;    declare radius int;    set radius = 6371000; #å‡è®¾åœ°çƒä¸ºæ­£çƒå½¢ï¼Œç›´å¾„ä¸º6371000ç±³    set d = (2*ATAN2(SQRT(SIN((lat1-lat2)*PI()/180/2)           *SIN((lat1-lat2)*PI()/180/2)+           COS(lat2*PI()/180)*COS(lat1*PI()/180)           *SIN((lng1-lng2)*PI()/180/2)           *SIN((lng1-lng2)*PI()/180/2)),           SQRT(1-SIN((lat1-lat2)*PI()/180/2)           *SIN((lat1-lat2)*PI()/180/2)           +COS(lat2*PI()/180)*COS(lat1*PI()/180)           *SIN((lng1-lng2)*PI()/180/2)           *SIN((lng1-lng2)*PI()/180/2))))*radius;    return d;END//DELIMITER ;</code></pre><h2 id="åˆ›å»ºæ•°æ®pythonè„šæœ¬"><a href="#åˆ›å»ºæ•°æ®pythonè„šæœ¬" class="headerlink" title="åˆ›å»ºæ•°æ®pythonè„šæœ¬"></a>åˆ›å»ºæ•°æ®pythonè„šæœ¬</h2><pre><code class="python"># coding=utf-8from orator import DatabaseManager, Modelimport loggingimport randomimport threading&quot;&quot;&quot; ä¸­å›½çš„ç»çº¬åº¦èŒƒå›´ çº¬åº¦3.86~53.55ï¼Œç»åº¦73.66~135.05ã€‚å¤§æ¦‚0.00001åº¦å·®è·1ç±³ &quot;&quot;&quot;# åˆ›å»º æ—¥å¿— å¯¹è±¡logger = logging.getLogger()handler = logging.StreamHandler()formatter = logging.Formatter(    &#39;%(asctime)s %(name)-12s %(levelname)-8s %(message)s&#39;)handler.setFormatter(formatter)logger.addHandler(handler)logger.setLevel(logging.DEBUG)# Connect to the databaseconfig = &#123;    &#39;mysql&#39;: &#123;        &#39;driver&#39;: &#39;mysql&#39;,        &#39;host&#39;: &#39;localhost&#39;,        &#39;database&#39;: &#39;dbtest&#39;,        &#39;user&#39;: &#39;root&#39;,        &#39;password&#39;: &#39;&#39;,        &#39;prefix&#39;: &#39;&#39;    &#125;&#125;db = DatabaseManager(config)Model.set_connection_resolver(db)class Driver(Model):    __table__ = &#39;driver&#39;    __timestamps__ = False    passdef ins_driver(thread_name,nums):    logger.info(&#39;å¼€å¯çº¿ç¨‹%s&#39; % thread_name)    for _ in range(nums):        lng = &#39;%.5f&#39; % random.uniform(73.66, 135.05)        lat = &#39;%.5f&#39; % random.uniform(3.86, 53.55)        driver = Driver()        driver.lng = lng        driver.lat = lat        driver.save()thread_nums = 10for i in range(thread_nums):    t = threading.Thread(target=ins_driver, args=(i, 400000))    t.start()</code></pre><p><img src="http://upload-images.jianshu.io/upload_images/4033700-dda526bdfcc5c759.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p>ä»¥ä¸Šè„šæœ¬åˆ›å»º10ä¸ªçº¿ç¨‹ï¼Œ10ä¸ªçº¿ç¨‹æ’å…¥4ä¸‡æ¡æ•°æ®ã€‚è€—è´¹150.18sæ‰§è¡Œå®Œ,æ€»å…±æ’å…¥40ä¸‡æ¡æ•°æ®</p><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><ul><li>æµ‹è¯•ç¯å¢ƒ</li></ul><p>ç³»ç»Ÿï¼šmac os</p><p>å†…å­˜ï¼š16G</p><p>cpu: intel core i5</p><p>ç¡¬ç›˜: 500g å›ºæ€ç¡¬ç›˜</p><p>æµ‹è¯•ä¸‹æŸ¥æ‰¾è·ç¦»(134.38753,18.56734)è¿™ä¸ªåæ ‡ç‚¹æœ€è¿‘çš„10ä¸ªå¸æœº</p><pre><code class="sql">select *,`getDistance`(134.38753,18.56734,`lng`,`lat`) as dis from driver ORDER BY dis limit 10</code></pre><ul><li>è€—æ—¶ï¼š18.0s</li><li>explain:å…¨è¡¨æ‰«æ</li></ul><p>æˆ‘æµ‹è¯•äº†ä»1ä¸‡åˆ°10ä¸‡é—´éš”1ä¸‡å’Œä»10ä¸‡åˆ°90ä¸‡æ¯é—´éš”10ä¸‡æµ‹è¯•çš„ç»“æœå˜åŒ–</p><p><img src="http://upload-images.jianshu.io/upload_images/4033700-c40f60c1ef7b3f18.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><ul><li>æ­¤æ–¹æ¡ˆåœ¨æ•°æ®é‡è¾¾åˆ°3ä¸‡æ¡æŸ¥è¯¢è€—æ—¶å°±ä¼šè¶…è¿‡1ç§’</li><li>å¤§çº¦æ¯å¢åŠ 1ä¸‡æ¡å°±ä¼šå¢åŠ 0.4ç§’çš„è€—æ—¶</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ°ç†ä½ç½®geoå¤„ç†ä¹‹mongodb geo ç´¢å¼•</title>
      <link href="2017/12/01/%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AE%E5%A4%84%E7%90%86%E4%B9%8Bmongodb/"/>
      <url>2017/12/01/%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AE%E5%A4%84%E7%90%86%E4%B9%8Bmongodb/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ç›®å‰è¶Šæ¥è¶Šå¤šçš„ä¸šåŠ¡éƒ½ä¼šåŸºäºLBSï¼Œé™„è¿‘çš„äººï¼Œå¤–å–ä½ç½®ï¼Œé™„è¿‘å•†å®¶ç­‰ç­‰ï¼Œç°å°±è®¨è®ºç¦»æˆ‘æœ€è¿‘è¿™ä¸€ä¸šåŠ¡åœºæ™¯çš„è§£å†³æ–¹æ¡ˆã€‚</p></blockquote><p>ç›®å‰å·²çŸ¥è§£å†³æ–¹æ¡ˆæœ‰:</p><ul><li>mysql è‡ªå®šä¹‰å‡½æ•°è®¡ç®—</li><li>mysql geoç´¢å¼•</li><li>mongodb geoç´¢å¼•</li><li>postgresql PostGisç´¢å¼•</li><li>redis geo</li><li>ElasticSearch</li></ul><p>æœ¬æ–‡æµ‹è¯•ä¸‹mongodb geoç´¢å¼• å‡½æ•°è¿ç®—çš„æ€§èƒ½</p><span id="more"></span><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><h3 id="åˆ›å»ºæ•°æ®è¡¨"><a href="#åˆ›å»ºæ•°æ®è¡¨" class="headerlink" title="åˆ›å»ºæ•°æ®è¡¨"></a>åˆ›å»ºæ•°æ®è¡¨</h3><pre><code class="sql">db.driver.createIndex(&#123;loc: &quot;2dsphere&quot;&#125;)</code></pre><h2 id="åˆ›å»ºæ•°æ®pythonè„šæœ¬"><a href="#åˆ›å»ºæ•°æ®pythonè„šæœ¬" class="headerlink" title="åˆ›å»ºæ•°æ®pythonè„šæœ¬"></a>åˆ›å»ºæ•°æ®pythonè„šæœ¬</h2><pre><code class="python"># coding=utf-8from pymongo import MongoClientimport loggingimport randomimport threading&quot;&quot;&quot; ä¸­å›½çš„ç»çº¬åº¦èŒƒå›´ çº¬åº¦3.86~53.55ï¼Œç»åº¦73.66~135.05ã€‚å¤§æ¦‚0.00001åº¦å·®è·1ç±³ &quot;&quot;&quot;# åˆ›å»º æ—¥å¿— å¯¹è±¡logger = logging.getLogger()handler = logging.StreamHandler()formatter = logging.Formatter(    &#39;%(asctime)s %(name)-12s %(levelname)-8s %(message)s&#39;)handler.setFormatter(formatter)logger.addHandler(handler)logger.setLevel(logging.DEBUG)# Connect to the mongodb databasemongoconn = MongoClient(&#39;127.0.0.1&#39;, 27017)mdb = mongoconn.geo_analysisdriver_collection = mdb.driverdef ins_driver(thread_name, nums):    logger.info(&#39;å¼€å¯çº¿ç¨‹%s&#39; % thread_name)    for i in range(nums):        lng = &#39;%.5f&#39; % random.uniform(73.66, 135.05)        lat = &#39;%.5f&#39; % random.uniform(3.86, 53.55)        logging.debug(&#39;æ’å…¥è®°å½•:%s&#39; % i)        driver_collection.insert_one(&#123;            &quot;loc&quot;:[                float(lng),                float(lat)            ]        &#125;)thread_nums = 10for i in range(thread_nums):    t = threading.Thread(target=ins_driver, args=(i, 40000))    t.start()</code></pre><p><img src="http://upload-images.jianshu.io/upload_images/4033700-dda526bdfcc5c759.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p>ä»¥ä¸Šè„šæœ¬åˆ›å»º10ä¸ªçº¿ç¨‹ï¼Œ10ä¸ªçº¿ç¨‹æ’å…¥4ä¸‡æ¡æ•°æ®ã€‚è€—è´¹52.43sæ‰§è¡Œå®Œ,æ€»å…±æ’å…¥40ä¸‡æ¡æ•°æ®</p><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><ul><li>æµ‹è¯•ç¯å¢ƒ</li></ul><p>ç³»ç»Ÿï¼šmac os</p><p>å†…å­˜ï¼š16G</p><p>cpu: intel core i5</p><p>ç¡¬ç›˜: 500g å›ºæ€ç¡¬ç›˜</p><p>æµ‹è¯•ä¸‹æŸ¥æ‰¾è·ç¦»(134.38753,18.56734)é™„è¿‘20å…¬é‡Œçš„å¸æœº</p><pre><code class="js">db.runCommand(&#123;geoNear:&#39;driver&#39;, near:[134.38753,18.56734], spherical:true, maxDistance:20000/6378000, distanceMultiplier:6378000&#125;);</code></pre><ul><li>è€—æ—¶ï¼š0.001s</li><li>explain:ä½¿ç”¨ç´¢å¼•</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> æ–¹æ¡ˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¨‹åºå‘˜ä»£ç ä¸‹çš„è®¸è±ªæ°(æŠ€æœ¯ç¯‡)</title>
      <link href="2017/08/05/python/%E7%A8%8B%E5%BA%8F%E5%91%98%E4%BB%A3%E7%A0%81%E4%B8%8B%E7%9A%84%E8%AE%B8%E8%B1%AA%E6%9D%B0-%E6%8A%80%E6%9C%AF%E7%AF%87/"/>
      <url>2017/08/05/python/%E7%A8%8B%E5%BA%8F%E5%91%98%E4%BB%A3%E7%A0%81%E4%B8%8B%E7%9A%84%E8%AE%B8%E8%B1%AA%E6%9D%B0-%E6%8A%80%E6%9C%AF%E7%AF%87/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æ¥ä¸Šç¯‡ï¼Œè¿™ä¸€ç¯‡å°†ä»æŠ€æœ¯å±‚é¢è®²è®²æ˜¯å¦‚ä½•å®ç°çš„ã€‚é˜…è¯»æœ¬æ–‡æ‚¨å°†ä¼šäº†è§£å¦‚ä½•ç”¨pythonçˆ¬å–å¾®åšçš„è¯„è®ºä»¥åŠå¦‚ä½•ç”¨python word_cloudåº“è¿›è¡Œæ•°æ®å¯è§†åŒ–ã€‚</p></blockquote><p>ä¸Šä¸€ç¯‡:<a href="http://www.jianshu.com/p/ab49113c1fda">ç¨‹åºå‘˜ä»£ç ä¸‹çš„è®¸è±ªæ°</a></p><span id="more"></span><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><p>æ‰“å¼€å¾®åšpc mç«™å¹¶æ‰¾åˆ°è®¸è±ªæ°è¯¥æ¡å¾®åšåœ°å€:<a href="https://m.weibo.cn/status/4132385564040383">https://m.weibo.cn/status/4132385564040383</a></p><p><strong>ä¸ºä»€ä¹ˆè¦ç”¨mç«™åœ°å€ï¼Ÿå› ä¸ºmç«™å¯ä»¥ç›´æ¥æŠ“å–åˆ°api jsonæ•°æ®,è€Œpcç«™è™½ç„¶ä¹Ÿæœ‰apiè¿”å›çš„æ˜¯html,ç›¸æ¯”è€Œè¨€é€‰å–mç«™ä¼šçœå»å¾ˆå¤šéº»çƒ¦</strong></p><p>æ‰“å¼€è¯¥é¡µé¢ï¼Œå¹¶ä¸”ç”¨chrome çš„æ£€æŸ¥å·¥å…· æŸ¥çœ‹networkï¼Œå¯ä»¥è·å–åˆ°è¯„è®ºçš„apiåœ°å€ã€‚</p><p><img src="http://upload-images.jianshu.io/upload_images/4033700-382e5a613595bc1c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="chromeæŸ¥çœ‹"></p><h2 id="æ•°æ®æŠ“å–"><a href="#æ•°æ®æŠ“å–" class="headerlink" title="æ•°æ®æŠ“å–"></a>æ•°æ®æŠ“å–</h2><p>é¦–å…ˆè§‚å¯Ÿapiè¿”å›</p><p><img src="http://upload-images.jianshu.io/upload_images/4033700-f2aa3ddad169fe31.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p>ä»è¿”å›åœ°å€ä¸Šå¯ä»¥çœ‹åˆ°å¯ä»¥é€šè¿‡å‚æ•°page æ”¹å˜è¯·æ±‚çš„é¡µç ,å¹¶ä¸”æ¯é¡µéƒ½å›è¿”å›æ€»æ¡æ•°å’Œæ€»é¡µç æ•°ã€‚è¿™é‡Œæˆ‘å†³å®šé‡‡ç”¨<strong>å¤šçº¿ç¨‹æ¥æŠ“å»</strong>(å…¶å®æ•°æ®é‡ä¸å¤§,ä¹Ÿå¯ä»¥å•çº¿ç¨‹è·‘)ã€‚</p><h3 id="å…¶ä¸­åœ¨çˆ¬å–æ•°æ®çš„æ—¶å€™ä¼šé¢ä¸´å‡ ä¸ªé—®é¢˜ï¼š"><a href="#å…¶ä¸­åœ¨çˆ¬å–æ•°æ®çš„æ—¶å€™ä¼šé¢ä¸´å‡ ä¸ªé—®é¢˜ï¼š" class="headerlink" title="å…¶ä¸­åœ¨çˆ¬å–æ•°æ®çš„æ—¶å€™ä¼šé¢ä¸´å‡ ä¸ªé—®é¢˜ï¼š"></a>å…¶ä¸­åœ¨çˆ¬å–æ•°æ®çš„æ—¶å€™ä¼šé¢ä¸´å‡ ä¸ªé—®é¢˜ï¼š</h3><p><strong>1.å­˜å‚¨é€‰æ‹©</strong></p><p>æˆ‘è¿™é‡Œé€‰ç”¨äº†MongoDBä½œä¸ºæ•°æ®å­˜å‚¨ï¼Œå› ä¸ºapié€šå¸¸è¿”å›çš„æ˜¯jsonæ•°æ®è€Œjsonç»“æ„å’ŒMongoDBçš„å­˜å‚¨æ–¹å¼å¯ä»¥ç»“åˆçš„å¾ˆé»˜å¥‘ï¼Œä¸éœ€è¦ç»è¿‡ä»»ä½•å¤„ç†å¯ä»¥ç›´æ¥çš„è¿›è¡Œæ’å…¥ã€‚</p><p><strong>2.é˜²çˆ¬è™«</strong></p><p>å¾ˆå¤šç½‘ç«™å¯èƒ½ä¼šåšä¸€äº›é˜²çˆ¬è™«çš„å¤„ç†ï¼Œé¢å¯¹åŒä¸€ä¸ªè¯·æ±‚ipçš„çŸ­æ—¶é—´çš„é«˜é¢‘ç‡è¯·æ±‚ä¼šè¿›è¡ŒæœåŠ¡éš”æ–­(ç›´æ¥å‘Šè¯‰ä½ æœåŠ¡ä¸å¯ç”¨)ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥å»ç½‘ä¸Šæ‰¾ä¸€äº›ä»£ç†è¿›è¡Œè¯·æ±‚ã€‚</p><p><strong>3.å¤šçº¿ç¨‹çš„ä»»åŠ¡åˆ†é…</strong></p><p>é‡‡ç”¨å¤šçº¿ç¨‹çˆ¬å–ä½ å½“ç„¶ä¸èƒ½è®©å¤šä¸ªçº¿ç¨‹å»çˆ¬å–åŒæ ·çš„é“¾æ¥åšåˆ«äººå·²ç»åšè¿‡çš„äº‹æƒ…ï¼Œé‚£æ ·å¤šçº¿ç¨‹æ¯«æ— æ„ä¹‰ã€‚æ‰€ä»¥ä½ éœ€è¦åˆ¶å®šä¸€å¥—è§„åˆ™ï¼Œè®©ä¸åŒçº¿ç¨‹çˆ¬å–ä¸åŒçš„é“¾æ¥ã€‚</p><pre><code class="python"># coding=utf-8from __future__ import divisionfrom pymongo import MongoClientimport requestsimport sysimport reimport randomimport timeimport loggingimport threadingimport jsonfrom os import pathimport math# çˆ¬å–å¾®åšè¯„è®º# mç«™å¾®åšåœ°å€weibo_url = &#39;https://m.weibo.cn/status/4132385564040383&#39; thread_nums = 5  #çº¿ç¨‹æ•°#ä»£ç†åœ°å€proxies = &#123;  &quot;http&quot;: &quot;http://171.92.4.67:9000&quot;,  &quot;http&quot;: &quot;http://163.125.222.240:8118&quot;,  &quot;http&quot;: &quot;http://121.232.145.251:9000&quot;,  &quot;http&quot;: &quot;http://121.232.147.247:9000&quot;,&#125;# åˆ›å»º æ—¥å¿— å¯¹è±¡logger = logging.getLogger()handler = logging.StreamHandler()formatter = logging.Formatter(    &#39;%(asctime)s %(name)-12s %(levelname)-8s %(message)s&#39;)handler.setFormatter(formatter)logger.addHandler(handler)logger.setLevel(logging.DEBUG)mongoconn = MongoClient(&#39;127.0.0.1&#39;, 27017)mdb = mongoconn.data_analysisdas_collection = mdb.weiboweiboid_reobj = re.match(r&#39;.*status/(\d+)&#39;, weibo_url)weibo_id = weiboid_reobj.group(1)def scrapy_comments(weibo_id, page):    weibo_comment_url = &#39;https://m.weibo.cn/api/comments/show?id=%s&amp;page=%d&#39; % (        weibo_id, page)    res = requests.get(weibo_comment_url)    res_obj = json.loads(res.content)    return res_objdef import_comments(threadName, weibo_id, page_start, page_end):    logger.info(&#39;å¼€å§‹çº¿ç¨‹:%s&#39; % threadName)    for page in range(page_start, page_end + 1):        logging.info(&#39;è¯»å–ç¬¬%sé¡µ&#39; % page)        time.sleep(1)        # continue        try:            res_obj = scrapy_comments(weibo_id, page)            logging.info(&#39;è¯¥é¡µæœ‰%sæ¡è®°å½•&#39; % len(res_obj[&#39;data&#39;]))        except:            logging.error(&#39;è¯»å–%sé¡µæ—¶å‘ç”Ÿé”™è¯¯&#39; % page)            continue        if res_obj[&#39;ok&#39;] == 1:            comments = res_obj[&#39;data&#39;]            for comment in comments:                comment_text = re.sub(                    r&#39;&lt;/?\w+[^&gt;]*&gt;&#39;, &#39;&#39;, comment[&#39;text&#39;]).encode(&#39;utf-8&#39;)                if re.search(r&#39;å›å¤@.*:&#39;, comment_text):                    # è¿‡æ»¤æ‰å›å¤åˆ«äººçš„è¯„è®º                    continue                comment[&#39;text&#39;] = comment_text                comment[&#39;weibo_id&#39;] = weibo_id                logging.info(&#39;è¯»å–è¯„è®º:%s&#39; % comment[&#39;id&#39;])                try:                    if das_collection.find_one(&#123;&#39;id&#39;: comment[&#39;id&#39;]&#125;):                        logging.info(&#39;åœ¨mongodbä¸­å­˜åœ¨&#39;)                    else:                        logging.info(&#39;æ’å…¥è®°å½•:%s&#39; % comment[&#39;id&#39;])                        das_collection.insert_one(comment)                except:                    logging.error(&#39;mongodbå‘ç”Ÿé”™è¯¯&#39;)        else:            logging.error(&#39;è¯»å–ç¬¬%sé¡µæ—¶å‘ç”Ÿé”™è¯¯&#39; % page)    logging.info(&#39;çº¿ç¨‹%sç»“æŸ&#39; % threadName)    # res_obj = scrapy_comments(weibo_id, page)if __name__ == &#39;__main__&#39;:    # åˆ†é…ä¸åŒé“¾æ¥åˆ°ä¸åŒçš„çº¿ç¨‹ä¸Šå»    res_obj = scrapy_comments(weibo_id, 1)    if res_obj[&#39;ok&#39;] == 1:        total_number = res_obj[&#39;total_number&#39;]        logging.info(&#39;è¯¥æ¡å¾®åšæœ‰:%sæ¡è¯„è®º&#39; % total_number)        max_page = res_obj[&#39;max&#39;]        page_nums = math.ceil(max_page / thread_nums)    else:        raise    # print max_page    # print page_nums    for i in range(1, thread_nums + 1):        if i &lt; thread_nums:            page_end = page_nums * i        else:            page_end = max_page        page_start = (i - 1) * page_nums + 1        t = threading.Thread(target=import_comments, args=(            i, weibo_id, int(page_start), int(page_end)))        t.start()</code></pre><h2 id="æ•°æ®æ•´ç†å¯è§†åŒ–-data-visualization"><a href="#æ•°æ®æ•´ç†å¯è§†åŒ–-data-visualization" class="headerlink" title="æ•°æ®æ•´ç†å¯è§†åŒ–(data visualization)"></a>æ•°æ®æ•´ç†å¯è§†åŒ–(data visualization)</h2><p>è¿è¡Œè„šæœ¬å®Œæ¯•ï¼Œæˆ‘çš„MongoDBå¾—åˆ°äº†2ä¸‡å¤šæ¡è¯„è®ºæ•°æ®ï¼Œæ¥ä¸‹æ¥è¦åšçš„äº‹æ˜¯å¯¹è¿™éƒ¨åˆ†æ•°æ®è¿›è¡Œæå–ã€æ¸…æ´—ã€ç»“æ„åŒ–ç­‰æ“ä½œã€‚è¿™é‡Œé¡ºä¾¿è¯´æ˜ä¸€ä¸‹python æ•°æ®åˆ†æçš„ å¤§è‡´åŸºæœ¬æµç¨‹ã€‚</p><p><strong>1.ä¸å¤–ç•Œè¿›è¡Œäº¤äº’</strong><br>è¿™ä¸ªè¿‡ç¨‹åŒ…æ‹¬æ•°æ®çš„è·å–ã€è¯»å–ã€‚ä¸ç®¡æ˜¯ä»ç½‘ç»œèµ„æºä¸Šçˆ¬å–ã€è¿˜æ˜¯ä»ç°æœ‰èµ„æº(å„æ ·çš„æ–‡ä»¶å¦‚æ–‡æœ¬ã€excelã€æ•°æ®åº“å­˜å‚¨å¯¹è±¡)</p><p><strong>2.å‡†å¤‡å·¥ä½œ</strong><br>å¯¹æ•°æ®è¿›è¡Œæ¸…æ´—(cleaning)ã€ä¿®æ•´(munging)ã€æ•´åˆ(combining)ã€è§„èŒƒåŒ–(normalizing)ã€é‡å¡‘(reshaping)ã€åˆ‡ç‰‡(slicing)å’Œåˆ‡å—(dicing)</p><p><strong>3.è½¬æ¢</strong><br>å¯¹æ•°æ®é›†åšä¸€äº›æ•°å­¦å’Œç»Ÿè®¡è¿ç®—äº§ç”Ÿæ–°çš„æ•°æ®é›†</p><p><strong>4.å»ºæ¨¡å’Œè®¡ç®—</strong><br>å°†æ•°æ®è·Ÿç»Ÿè®¡æ¨¡å‹ã€æœºå™¨å­¦ä¹ ç®—æ³•æˆ–å…¶ä»–è®¡ç®—å·¥å…·è”ç³»èµ·æ¥</p><p><strong>5.å±•ç¤º</strong><br>åˆ›å»ºäº¤äº’å¼çš„æˆ–é™æ€çš„å›¾ç‰‡æˆ–æ–‡å­—æ‘˜è¦</p><p>ä¸‹é¢æˆ‘ä»¬æ¥è¿›è¡Œ2ã€3åŠ5çš„å·¥ä½œ:</p><pre><code class="python"># coding=utf-8import sysfrom pymongo import MongoClientimport random# åˆ†è¯åº“# from snownlp import SnowNLPimport jiebaimport unioutfrom collections import Counter, OrderedDict# è¯è¯­äº‘ æ–‡æœ¬ç»Ÿè®¡å¯è§†åŒ–åº“from wordcloud import WordCloudmongoconn = MongoClient(&#39;127.0.0.1&#39;, 27017)mdb = mongoconn.data_analysisdas_collection = mdb.weibototal_counts = das_collection.find().count()# random_int = random.randint(0, total_counts - 1)docs = das_collection.find()print docs.count()words_counts = &#123;&#125;for doc in docs:    print doc    comment_text = doc[&#39;text&#39;].encode(&#39;utf-8&#39;)    if len(comment_text) == 0:        continue    words = jieba.cut(comment_text)    for word in words:        if word not in words_counts:            words_counts[word] = 1        else:            words_counts[word] += 1for word in words_counts.keys():    if words_counts[word] &lt; 2 or len(word) &lt; 2:        del words_counts[word]# print words_counts.items()#æ³¨æ„è¦è®©ä¸­æ–‡ä¸ä¹±ç è¦æŒ‡å®šä¸­æ–‡å­—ä½“#fit_words æ¥æ”¶å‚æ•°æ˜¯dict  eg:&#123;&#39;ä½ &#39;:333,&#39;å¥½&#39;:23&#125;  æ–‡å­—:å‡ºç°æ¬¡æ•°wordcloud = WordCloud(    font_path=&#39;/Users/cwp/font/msyh.ttf&#39;,    background_color=&#39;white&#39;,    width=1200,    height=1000).fit_words(words_counts)import matplotlib.pyplot as pltplt.imshow(wordcloud, interpolation=&#39;bilinear&#39;)plt.axis(&quot;off&quot;)plt.show()</code></pre><p>ä»‹ç»ä¸‹ä»¥ä¸Šä»£ç ï¼š<br>æˆ‘ä»¬ä¸»è¦ç”¨åˆ°äº†2ä¸ªå·¥å…·ï¼Œjiebaå’Œword_cloudã€‚å‰è€…å¯¹ä¸­æ–‡è¿›è¡Œåˆ†è¯åè€…å›¾å½¢åŒ–å±•ç¤ºè¯è¯­çš„å‡ºç°é¢‘ç‡ã€‚<br>ä¼—æ‰€å‘¨çŸ¥ï¼Œä¸­æ–‡ç³»çš„è¯­è¨€å¤„ç†ææ€•æ˜¯æœ€éš¾çš„è‡ªç„¶è¯­è¨€å¤„ç†(NLP)çš„è¯­ç§ã€‚å°±åŸºæœ¬çš„åˆ†è¯è€Œè¨€éƒ½æ˜¯ä¸€é¡¹æ¯”è¾ƒå›°éš¾çš„å·¥ä½œ,(è‹±è¯­å¥å­ä¸­æ¯ä¸ªå•è¯éƒ½æ˜¯æœ‰ç©ºæ ¼åˆ†å¼€çš„ï¼Œè€Œä¸­æ–‡æ˜¯ç”±å•ä¸ªå­—ç»„æˆè¯è¿æ¥æˆä¸²ç»„æˆå¥).<br>ä¸¾ä¸ªä¾‹å­,è¯·ç”¨â€œå­©æâ€é€ å¥,â€é‚£ä¸ªç”·å­©æäº¤å®Œä»£ç å°±ä¸‹ç­äº†â€ã€‚å¦‚æœäººå·¥åˆ†è¯ï¼Œå¯ä»¥çŸ¥é“â€ç”·å­©â€å’Œâ€æäº¤â€åº”è¯¥æ˜¯åˆ†å¼€çš„2ä¸ªè¯ï¼Œ<strong>ä½†æ˜¯å¯¹äºæœºå™¨è€Œè¨€ï¼Œè¦è¾¨åˆ«â€æâ€åº”è¯¥ä¸â€ç”·â€è¿˜æ˜¯â€äº¤â€è¿›è¡Œç»„è¯å°±å¾ˆéš¾åŠäº†</strong>ã€‚è¦æƒ³æœºå™¨èƒ½å¤Ÿæ›´ç²¾ç¡®çš„è¾¨åˆ«è¿™ç±»é—®é¢˜ï¼Œå°±éœ€è¦è®©æœºå™¨ä¸åœå­¦ä¹ ï¼Œè®©å®ƒçŸ¥é“è¿™ç§æƒ…å†µè¯¥è¿™ä¹ˆåˆ†è€Œä¸æ˜¯é‚£ä¹ˆåˆ†ã€‚ç ”ç©¶ä¸­æ–‡è‡ªç„¶è¯­è¨€å¤„ç†å°†æ˜¯ä¸€ä¸ªé•¿ä¹…è€Œå¤§çš„å·¥ç¨‹ï¼Œå¯¹äºåˆ†ææ•°æ®(æˆ‘ä»¬ä¸æ˜¯è¦ç ”ç©¶è‡ªç„¶è¯­è¨€å¤„ç†ğŸ˜)ï¼Œè¿™é‡Œå°±å€ŸåŠ©jiebaè¿™ä¸ªåº“è¿›è¡Œå·¥ä½œäº†.</p><p>å¯¹äºword_cloud,å›¾å½¢åŒ–æ–‡æœ¬ç»Ÿè®¡ï¼Œç½‘ä¸Šæœ‰ä¸å°‘çš„åšæ–‡éƒ½è´´äº†ä»£ç ï¼Œä½†æˆ‘æƒ³è¯´çš„æ˜¯æˆ‘ä¸äº†è§£å®ƒä»¬æ˜¯ä¸æ˜¯çœŸçš„è¿è¡Œå‡ºäº†ç»“æœã€‚å› ä¸ºfit_words è¿™ä¸ªå‡½æ•°æ¥æ”¶çš„æ˜¯dictè€Œä¸æ˜¯listï¼Œå®˜æ–¹æ–‡æ¡£å’Œå‡½æ•°docå…¶å®å†™é”™äº†,åœ¨githubä¸Šæœ‰æŠ«éœ²ã€‚</p><p>æœ€åå¾—åˆ°ç»“æœ:</p><p><img src="http://upload-images.jianshu.io/upload_images/4033700-dfbee241840ea23e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç»“æœ"></p><h2 id="ä¸€äº›ç”¨åˆ°çš„å·¥å…·"><a href="#ä¸€äº›ç”¨åˆ°çš„å·¥å…·" class="headerlink" title="ä¸€äº›ç”¨åˆ°çš„å·¥å…·"></a>ä¸€äº›ç”¨åˆ°çš„å·¥å…·</h2><p>1.<a href="https://github.com/amueller/word_cloud">word_cloud A little word cloud generator in Python</a></p><p>2.<a href="https://github.com/fxsjy/jieba">jieba ç»“å·´ä¸­æ–‡åˆ†è¯</a></p><p>3.<a href="http://docs.python-requests.org/en/master/">Requests is the only Non-GMO HTTP library for Python, safe for human consumption.</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
