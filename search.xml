<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>spring-bootè®°å½•å¹¶ç»Ÿè®¡sqlæ¢ç´¢,çº¿ç¨‹å®‰å…¨æ–¹å¼</title>
      <link href="2021/12/04/java/spring-boot%E8%AE%B0%E5%BD%95sql%E6%8E%A2%E7%B4%A2/"/>
      <url>2021/12/04/java/spring-boot%E8%AE%B0%E5%BD%95sql%E6%8E%A2%E7%B4%A2/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ç›®æ ‡è®°å½•æ¯æ¬¡è¯·æ±‚å†…çš„httpã€esã€mysqlè€—æ—¶ï¼Œæœ¬ç¯‡è®¨è®ºmysqléƒ¨åˆ†</p></blockquote><p>ä¸ºä»€ä¹ˆè¯´è¦æ¢ç´¢ï¼Œè¿™ä¸æ˜¯å¾ˆç®€å•çš„äº‹ä¹ˆï¼Ÿä½†æ˜¯èƒ½æ»¡è¶³ä»¥ä¸‹å‡ ç‚¹ä¹ˆï¼Ÿ</p><ul><li>èƒ½è®°å½•limitç­‰å‚æ•°</li><li>èƒ½å°†å‚æ•°å’Œsqlå†™ä¸€èµ·ï¼Œèƒ½ç›´æ¥ä½¿ç”¨</li><li>èƒ½è®°å½•è€—æ—¶</li><li>èƒ½è®¡æ•°ç´¯åŠ ,ç»Ÿè®¡ä¸€æ¬¡è¯·æ±‚ä¸­sqlæ‰§è¡Œçš„æ€»æ•°å’Œæ€»è€—æ—¶</li></ul><span id="more"></span><h2 id="springåŸç”Ÿèƒ½åŠ›"><a href="#springåŸç”Ÿèƒ½åŠ›" class="headerlink" title="springåŸç”Ÿèƒ½åŠ›"></a>springåŸç”Ÿèƒ½åŠ›</h2><pre class="language-ini" data-language="ini"><code class="language-ini"><span class="token key attr-name">logging.level.org.hibernate.SQL</span><span class="token punctuation">=</span><span class="token value attr-value">debug</span><span class="token key attr-name">logging.level.org.hibernate.type.descriptor.sql.BasicBinder</span><span class="token punctuation">=</span><span class="token value attr-value">trace</span></code></pre><p>é€šè¿‡ä¸Šé¢ä¸¤æ¡é…ç½®ã€‚</p><ul><li>âœ”ï¸å¯ä»¥æ˜¾ç¤ºsql.</li><li>âŒä¸èƒ½å’Œå‚æ•°ä¸€è¡Œæ˜¾ç¤º</li><li>âŒä¸èƒ½æ˜¾ç¤ºlimitå‚æ•°</li><li>âŒä¸èƒ½è®¡æ•°å’Œè®°å½•è€—æ—¶</li></ul><pre class="language-none"><code class="language-none">2021-02-23 19:35:42.932 DEBUG 97586 --- [  restartedMain] org.hibernate.SQL                        : select admin0_.id as id1_0_, admin0_.create_time as create_t2_0_, admin0_.modify_time as modify_t3_0_, admin0_.email as email4_0_, admin0_.password as password5_0_, admin0_.status as status6_0_, admin0_.username as username7_0_ from admin admin0_ where admin0_.username&#x3D;?2021-02-23 19:35:42.949 TRACE 97586 --- [  restartedMain] o.h.type.descriptor.sql.BasicBinder      : binding parameter [1] as [VARCHAR] - [root]</code></pre><h2 id="åŸç”Ÿlog-org-hibernate-EmptyInterceptor"><a href="#åŸç”Ÿlog-org-hibernate-EmptyInterceptor" class="headerlink" title="åŸç”Ÿlog+org.hibernate.EmptyInterceptor"></a>åŸç”Ÿlog+org.hibernate.EmptyInterceptor</h2><p><code>org.hibernate.EmptyInterceptor</code>æä¾›é’©å­ï¼Œhibernateæœ¬èº«æä¾›entityçš„curdé’©å­ã€‚é‡å†™<code>EmptyInterceptor</code>æ–¹æ³•ï¼Œå¯ä»¥å®ç°è®¡æ•°ã€‚ä½†æ˜¯<code>onPrepareStatement</code>æ–¹æ³•åªæ˜¯è£…é…sqlå‰çš„äº‹ä»¶ï¼Œè€Œä¸”ä¸æ˜¯å®Œæ•´çš„sqlã€‚</p><ul><li>âœ”ï¸ å¯ä»¥æ˜¾ç¤ºsql</li><li>âŒ ä¸èƒ½å’Œå‚æ•°ä¸€è¡Œæ˜¾ç¤º</li><li>âŒ ä¸èƒ½æ˜¾ç¤ºlimitå‚æ•°</li><li>âœ”ï¸ èƒ½è®¡æ•°</li><li>âŒ ä¸èƒ½è®°å½•è€—æ—¶</li></ul><pre class="language-ini" data-language="ini"><code class="language-ini"><span class="token key attr-name">spring.jpa.properties.hibernate.ejb.interceptor</span><span class="token punctuation">=</span><span class="token value attr-value">com.vison.itdoc.config.HibernateInterceptor</span></code></pre><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HibernateInterceptor</span> <span class="token keyword">extends</span> <span class="token class-name">EmptyInterceptor</span> <span class="token punctuation">&#123;</span>        <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token class-name">Object</span> entity<span class="token punctuation">,</span> <span class="token class-name">Serializable</span> id<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> state<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> propertyNames<span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">[</span><span class="token punctuation">]</span> types<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//        Log.info("onload...", entity)</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">onPrepareStatement</span><span class="token punctuation">(</span><span class="token class-name">String</span> string<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// count++</span>        <span class="token keyword">return</span> INSTANCE<span class="token punctuation">.</span><span class="token function">onPrepareStatement</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterTransactionCompletion</span><span class="token punctuation">(</span><span class="token class-name">Transaction</span> t<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        INSTANCE<span class="token punctuation">.</span><span class="token function">afterTransactionCompletion</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"after trans complete"</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span></code></pre><h2 id="log4jdbc"><a href="#log4jdbc" class="headerlink" title="log4jdbc"></a>log4jdbc</h2><p>log4jdbcèƒ½å¾ˆå¥½çš„è§£å†³sqlå®Œæ•´æ˜¾ç¤ºå’Œè®°å½•è€—æ—¶çš„é—®é¢˜</p><pre class="language-none"><code class="language-none">2021-02-23 19:59:13.709  INFO 97586 --- [nio-8081-exec-1] jdbc.sqltiming                           : select posts0_.id as id1_2_, posts0_.create_time as create_t2_2_, posts0_.modify_time as modify_t3_2_, posts0_.content as content4_2_, posts0_.title as title5_2_ from posts posts0_ where 1&#x3D;1 order by posts0_.id asc limit 10 ; &#123;executed in 1 msec&#125;</code></pre><p>è¿˜èƒ½å¤Ÿå®šä¹‰è¶…è¿‡1å®šæ—¶é—´çš„æ‰§è¡Œsqlè®°å½•ä¸ºerrorç±»å‹ã€‚</p><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.googlecode.log4jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>log4jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><pre class="language-ini" data-language="ini"><code class="language-ini">spring.datasource.driver-class-name: net.sf.log4jdbc.DriverSpy<span class="token comment">#ä½¿ç”¨log4jdbcåmysqlçš„url</span><span class="token key attr-name">spring.datasource.url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:log4jdbc:mysql://localhost:3306/xxxx?useUnicode=true&amp;characterEncoding=UTF-8</span><span class="token comment">#ä½¿ç”¨log4jdbcåoracleçš„url</span><span class="token comment">#spring.datasource.url: jdbc:log4jdbc:oracle:thin:@127.0.0.1:1521:orcl</span></code></pre><p>æ³¨æ„éœ€è¦æ·»åŠ <code>spring.datasource.driver-class-name</code> å’Œæ›´æ”¹ <code>spring.datasource.url</code> å°†jdbcæ”¹ä¸º jdbc:log4jdbc</p><p><em>log4jdbc.properties</em>å¯ä»¥å®šä¹‰æ›´å¤šé…ç½®</p><pre class="language-ini" data-language="ini"><code class="language-ini"><span class="token comment">#é…ç½®ä¸ºéœ€è¦è®°å½•çš„åŒ…æˆ–ç±»åŒ¹é…è·¯å¾„</span><span class="token comment">#log4jdbc.debug.stack.prefix=com.drp</span><span class="token comment">#log4jdbcåŠ è½½çš„drivers (é©±åŠ¨å)</span><span class="token comment">#log4jdbc.drivers=oracle.jdbc.OracleDriver</span><span class="token key attr-name">log4jdbc.auto.load.popular.drivers</span><span class="token punctuation">=</span><span class="token value attr-value">true</span><span class="token comment">#åœ¨æ—¥å¿—ä¸­æ˜¾ç¤ºwarnè­¦å‘Š</span><span class="token key attr-name">log4jdbc.statement.warn</span><span class="token punctuation">=</span><span class="token value attr-value">true</span><span class="token comment">#æ¯«ç§’å€¼.æ‰§è¡Œæ—¶é—´è¶…è¿‡è¯¥å€¼çš„SQLè¯­å¥å°†è¢«è®°å½•ä¸ºwarnçº§åˆ«.</span><span class="token key attr-name">log4jdbc.sqltiming.warn.threshold</span><span class="token punctuation">=</span><span class="token value attr-value">2000</span><span class="token comment">#æ¯«ç§’å€¼.æ‰§è¡Œæ—¶é—´è¶…è¿‡è¯¥å€¼çš„SQLè¯­å¥å°†è¢«è®°å½•ä¸ºerrorçº§åˆ«.</span><span class="token key attr-name">log4jdbc.sqltiming.error.threshold</span><span class="token punctuation">=</span><span class="token value attr-value">3000</span><span class="token comment">#æ˜¯æŠŠbooleanè®°å½•ä¸º 'true'/'false' è¿˜æ˜¯ 1/0. é»˜è®¤è®¾ç½®ä¸ºfalse,ä¸å¯ç”¨,ä¸ºäº†ç§»æ¤æ€§.</span><span class="token comment">#log4jdbc.dump.booleanastruefalse=true</span><span class="token comment">#è¾“å‡ºçš„sql,ä¸€è¡Œæœ€å¤§çš„å­—ç¬¦æ•°ï¼Œé»˜è®¤90. ä»¥åæ–°ç‰ˆå¯èƒ½ä¸º0</span><span class="token comment">#log4jdbc.dump.sql.maxlinelength=90</span><span class="token comment">#å¦‚æœåœ¨è°ƒè¯•æ¨¡å¼ä¸‹è½¬å‚¨ï¼Œåˆ™è½¬å‚¨æ•´ä¸ªå †æ ˆè·Ÿè¸ª  é»˜è®¤false</span><span class="token key attr-name">log4jdbc.dump.fulldebugstacktrace</span><span class="token punctuation">=</span><span class="token value attr-value">false</span><span class="token comment">#æ˜¯å¦è®°å½•æŸäº›ç±»å‹çš„è¯­å¥ï¼Œé»˜è®¤true</span><span class="token key attr-name">log4jdbc.dump.sql.select</span><span class="token punctuation">=</span><span class="token value attr-value">true</span><span class="token key attr-name">log4jdbc.dump.sql.insert</span><span class="token punctuation">=</span><span class="token value attr-value">true</span><span class="token key attr-name">log4jdbc.dump.sql.delete</span><span class="token punctuation">=</span><span class="token value attr-value">true</span><span class="token key attr-name">log4jdbc.dump.sql.update</span><span class="token punctuation">=</span><span class="token value attr-value">true</span><span class="token key attr-name">log4jdbc.dump.sql.create</span><span class="token punctuation">=</span><span class="token value attr-value">true</span><span class="token comment">#è¾“å‡ºsqlæœ«å°¾å¤„åŠ å…¥åˆ†å·ï¼Œé»˜è®¤false</span><span class="token key attr-name">log4jdbc.dump.sql.addsemicolon</span><span class="token punctuation">=</span><span class="token value attr-value">true</span><span class="token comment">#å°†æ­¤è®¾ç½®ä¸ºfalseä»¥ä¸ä¿®å‰ªå·²è®°å½•çš„SQL</span><span class="token key attr-name">log4jdbc.trim.sql</span><span class="token punctuation">=</span><span class="token value attr-value">true</span><span class="token comment">#å°†æ­¤è®¾ç½®ä¸ºfalseä¸åˆ é™¤é¢å¤–çš„ç©ºè¡Œ</span><span class="token key attr-name">log4jdbc.trim.sql.extrablanklines</span><span class="token punctuation">=</span><span class="token value attr-value">true</span><span class="token comment">#log4jdbc.suppress.generated.keys.exception=false</span></code></pre><ul><li>âœ”ï¸ å¯ä»¥æ˜¾ç¤ºsql</li><li>âœ”ï¸ ä¸èƒ½å’Œå‚æ•°ä¸€èµ·æ˜¾ç¤º</li><li>âœ”ï¸ ä¸èƒ½æ˜¾ç¤ºlimitå‚æ•°</li><li>âŒ èƒ½è®¡æ•°</li><li>âœ”ï¸  èƒ½è®°å½•å•ä¸ªsqlè€—æ—¶</li><li>âŒ ä¸èƒ½ç»Ÿè®¡æ€»è€—æ—¶</li></ul><p>ä¸è¶³çš„æ˜¯ï¼Œå•çº¯log4jdbcå¹¶ä¸èƒ½æ»¡è¶³æ‰€æœ‰ã€‚ç†è®ºä¸Šlog4jdbc+org.hibernate.EmptyInterceptorå¯ä»¥æ»¡è¶³éœ€æ±‚äº†</p><h2 id="P6Spy"><a href="#P6Spy" class="headerlink" title="P6Spy"></a>P6Spy</h2><p>æµ‹è¯•å®Œæ¯•ï¼Œå‘ç°P6Spyç›®å‰æœ€èƒ½æ»¡è¶³éœ€æ±‚ï¼š</p><ul><li>âœ”ï¸ å¯ä»¥æ˜¾ç¤ºsql</li><li>âœ”ï¸ ä¸èƒ½å’Œå‚æ•°ä¸€èµ·æ˜¾ç¤º</li><li>âœ”ï¸ ä¸èƒ½æ˜¾ç¤ºlimitå‚æ•°</li><li>âœ”ï¸ èƒ½è®¡æ•°</li><li>âœ”ï¸ ä¸èƒ½è®°å½•è€—æ—¶</li><li>âœ”ï¸ æ”¯æŒcurdäº‹ä»¶å‰åé’©å­ï¼Œé’©å­å‚æ•°è¿”å›sqlå’Œæ‰§è¡Œè€—æ—¶åŠå¼‚å¸¸ä¿¡æ¯ğŸš€</li></ul><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>p6spy<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>p6spy<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.9.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>åŒ<code>log4jdbc</code>éœ€è¦æ”¹driverå’Œurl</p><pre class="language-ini" data-language="ini"><code class="language-ini"><span class="token key attr-name">spring.datasource.driver-class-name</span><span class="token punctuation">=</span><span class="token value attr-value">com.p6spy.engine.spy.P6SpyDriver</span><span class="token key attr-name">spring.datasource.url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:p6spy:mysql://localhost:3306/test?useLegacyDatetimeCode=false&amp;serverTimezone=UTC</span></code></pre><p><em>psy.properties</em>å¯ä»¥å®šä¹‰æ›´å¤šé…ç½®</p><pre class="language-ini" data-language="ini"><code class="language-ini"><span class="token comment">#modulelist=com.p6spy.engine.spy.P6SpyFactory,com.p6spy.engine.logging.P6LogFactory,com.p6spy.engine.outage.P6OutageFactory</span><span class="token key attr-name">modulelist</span><span class="token punctuation">=</span><span class="token value attr-value">com.vison.itdoc.config.CustomeP6Factory,com.p6spy.engine.logging.P6LogFactory,com.p6spy.engine.outage.P6OutageFactory</span><span class="token comment">#moduelistå¾ˆå…³é”®ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨äº†è‡ªå®šä¹‰çš„Factoryï¼Œå› ä¸ºæˆ‘éœ€è¦è‡ªå®šä¹‰event</span><span class="token key attr-name">appender</span><span class="token punctuation">=</span><span class="token value attr-value">com.p6spy.engine.spy.appender.Slf4JLogger</span><span class="token key attr-name">logMessageFormat</span><span class="token punctuation">=</span><span class="token value attr-value">com.p6spy.engine.spy.appender.CustomLineFormat</span><span class="token key attr-name">customLogMessageFormat</span><span class="token punctuation">=</span><span class="token value attr-value">%(executionTime) ms|%(category)|%(sql)</span><span class="token key attr-name">excludecategories</span><span class="token punctuation">=</span><span class="token value attr-value">result,resultset,info,debug</span></code></pre><p>æ­£å¸¸ä½¿ç”¨é»˜è®¤é…ç½®å°±å¯ä»¥æ˜¾ç¤ºå‡ºsqlå’Œè€—æ—¶ä¿¡æ¯</p><pre class="language-none"><code class="language-none">4 ms|statement|select admin0_.id as id1_0_, admin0_.create_time as create_t2_0_, admin0_.modify_time as modify_t3_0_, admin0_.email as email4_0_, admin0_.password as password5_0_, admin0_.status as status6_0_, admin0_.username as username7_0_ from admin admin0_ where admin0_.username&#x3D;&#39;root&#39;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œè€—æ—¶ä¿¡æ¯å’Œå®é™…å‚æ•°</p><h3 id="è‡ªå®šä¹‰äº‹ä»¶"><a href="#è‡ªå®šä¹‰äº‹ä»¶" class="headerlink" title="è‡ªå®šä¹‰äº‹ä»¶"></a>è‡ªå®šä¹‰äº‹ä»¶</h3><p><code>modulelist=com.p6spy.engine.spy.P6SpyFactory</code>æ”¹æˆ<code>è‡ªå®šä¹‰Factory</code></p><p>è‡ªå®šä¹‰Factory</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomeP6Factory</span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>p6spy<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>spy<span class="token punctuation">.</span></span>P6Factory</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">P6LoadableOptions</span> <span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token class-name">P6OptionsRepository</span> optionsRepository<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">P6SpyOptions</span><span class="token punctuation">(</span>optionsRepository<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">JdbcEventListener</span> <span class="token function">getJdbcEventListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">P6spyListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ä½¿ç”¨è‡ªå®šä¹‰Listener</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>è‡ªå®šä¹‰äº‹ä»¶</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">P6spyListener</span> <span class="token keyword">extends</span> <span class="token class-name">JdbcEventListener</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAfterExecuteQuery</span><span class="token punctuation">(</span><span class="token class-name">PreparedStatementInformation</span> statementInformation<span class="token punctuation">,</span> <span class="token keyword">long</span> timeElapsedNanos<span class="token punctuation">,</span> <span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">App</span><span class="token punctuation">.</span>sqlCount<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"execute query..."</span><span class="token punctuation">,</span> statementInformation<span class="token punctuation">.</span><span class="token function">getSqlWithValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAfterExecuteUpdate</span><span class="token punctuation">(</span><span class="token class-name">PreparedStatementInformation</span> statementInformation<span class="token punctuation">,</span> <span class="token keyword">long</span> timeElapsedNanos<span class="token punctuation">,</span> <span class="token keyword">int</span> rowCount<span class="token punctuation">,</span> <span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">App</span><span class="token punctuation">.</span>sqlCount<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"execute update.."</span><span class="token punctuation">,</span> statementInformation<span class="token punctuation">.</span><span class="token function">getSqlWithValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAfterExecute</span><span class="token punctuation">(</span><span class="token class-name">StatementInformation</span> statementInformation<span class="token punctuation">,</span> <span class="token keyword">long</span> timeElapsedNanos<span class="token punctuation">,</span> <span class="token class-name">String</span> sql<span class="token punctuation">,</span> <span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"execute.."</span><span class="token punctuation">,</span> statementInformation<span class="token punctuation">.</span><span class="token function">getSqlWithValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘åœ¨è‡ªå®šä¹‰äº‹ä»¶ä¸­è¿›è¡Œäº†sqlè®¡æ•°.äºæ˜¯æˆ‘å¯ä»¥åœ¨è¯·æ±‚ç»“æŸæ—¶æ‰“å°æ¯æ¬¡è¯·æ±‚çš„æ€»sqlæ‰§è¡Œæ¬¡æ•°ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RequestInitInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">HandlerInterceptor</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">RequestInitInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">)</span>            <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">App</span><span class="token punctuation">.</span>_uniq_req_no <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">App</span><span class="token punctuation">.</span>sqlCount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">setMsgTraceNo</span><span class="token punctuation">(</span><span class="token class-name">App</span><span class="token punctuation">.</span>_uniq_req_no<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"request start..."</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterCompletion</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">,</span> <span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>            <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"finish request sqlæ‰§è¡Œæ¬¡æ•°:%s"</span><span class="token punctuation">,</span> <span class="token class-name">App</span><span class="token punctuation">.</span>sqlCount<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>ç”±äºäº‹ä»¶å‚æ•°è¿˜ç»™å‡ºäº†<code>timeElapsedNanos</code>,æœ€ç»ˆæˆ‘ä»¬è¿˜èƒ½ç»Ÿè®¡å‡ºæ‰€æœ‰sqlæ‰§è¡Œçš„è€—æ—¶ã€‚è¿™æ ·ä¸€æ¥æˆ‘ä»¬å°±èƒ½çœ‹å‡ºä¸€æ¬¡è¯·æ±‚å†…ï¼Œæœ€è€—æ—¶çš„æ“ä½œå…·ä½“æ˜¯ä»€ä¹ˆã€‚è¾¾åˆ°ç±»ä¼¼ä»¥ä¸‹æ•ˆæœï¼š</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210224141855.png" alt=""></p><h3 id="çº¿ç¨‹å®‰å…¨é—®é¢˜"><a href="#çº¿ç¨‹å®‰å…¨é—®é¢˜" class="headerlink" title="çº¿ç¨‹å®‰å…¨é—®é¢˜"></a>çº¿ç¨‹å®‰å…¨é—®é¢˜</h3><p>ä»¥ä¸Šåšæ³•å…¶å®è¿˜æœ‰ä¸ªé—®é¢˜,å¹¶æ²¡æœ‰è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ç”¨abæµ‹è¯•åä¼šå‘ç°,sqlç»Ÿè®¡ä»ç„¶æœ‰é—®é¢˜ã€‚æ­¤æ—¶æˆ‘ä»¬éœ€è¦ç”¨åˆ°<code>Threadlocal</code><br>åœ¨å®šä¹‰çš„å…¨å±€é™æ€å±æ€§å½“ä¸­å®é™…ä¸Šå·²ç»æœ‰çŠ¶æ€äº†ï¼Œè€Œå¤šçº¿ç¨‹å½“ä¸­çš„å…±äº«çŠ¶æ€å¿…ç„¶ä¼šå‘ç”Ÿæ„æƒ³ä¸åˆ°çš„é—®é¢˜ã€‚æ‰€ä»¥è¿™é‡Œè¦ä½¿ç”¨å¹¶å‘ç¼–ç¨‹çš„ç›¸å…³å¤„ç†åŠæ³•ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//ä½¿ç”¨ThreadLocal å®šä¹‰ç»Ÿè®¡å±æ€§</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> count <span class="token operator">=</span> <span class="token class-name">ThreadLocal</span><span class="token punctuation">.</span><span class="token function">withInitial</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>å…¶æ¬¡,<strong>å½“Threadlocalä¸çº¿ç¨‹æ± ä¸€èµ·ä½¿ç”¨çš„æ—¶å€™è¿˜éœ€è¦é¢å¤–çš„æ³¨æ„</strong>ã€‚ç®€å•çš„æè¿°ä¸‹ä¼šå‘ç”Ÿçš„é—®é¢˜ï¼š</p><ol><li>åº”ç”¨ç¨‹åºä»çº¿ç¨‹æ± å–å‡º1ä¸ªçº¿ç¨‹</li><li>ç„¶åå­˜å‚¨äº†ä¸€äº›çº¿ç¨‹å†…çš„å˜é‡åˆ°è¯¥çº¿ç¨‹</li><li>ä¸€æ—¦è¯¥çº¿ç¨‹å¤„ç†å®Œæ¯•ï¼Œåº”ç”¨ç¨‹åºä¾¿ä¼šå°†è¿™ä¸ªçº¿ç¨‹æ”¾å›åˆ°çº¿ç¨‹æ± </li><li>å½“è¿™ä¸ªçº¿ç¨‹åˆè¢«å†æ¬¡æ‹¿å‡ºæ¥å¤„ç†å¦å¤–ä¸€ä¸ªè¯·æ±‚</li><li>å› ä¸ºåº”ç”¨ç¨‹åºä¸Šæ¬¡æ²¡æœ‰è¿›è¡Œä¸“é—¨çš„æ¸…ç†åŠ¨ä½œï¼Œæ‰€ä»¥åœ¨å¤„ç†æ–°çš„è¯·æ±‚æ—¶ä½¿ç”¨çš„å¯èƒ½å°±æ˜¯ç›¸åŒçš„<code>ThreadLocal</code>æ•°æ®</li></ol><p>å› æ­¤æˆ‘ä»¬éœ€è¦è¿›è¡Œä¸€äº›å¿…è¦çš„æ¸…ç†åŠ¨ä½œ</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//æ‹¦æˆªå™¨å½“ä¸­ åœ¨ç»Ÿè®¡å®Œæ¯•æ—¶ç§»é™¤å½“å‰çº¿ç¨‹çš„Threadlocalå˜é‡</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RequestInitInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">HandlerInterceptor</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterCompletion</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">,</span> <span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"finish request... æ‰§è¡Œsql %d æ¬¡"</span><span class="token punctuation">,</span> <span class="token class-name">App</span><span class="token punctuation">.</span>count<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">App</span><span class="token punctuation">.</span>count<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>è¿™æ ·æœ€ç»ˆï¼Œæˆ‘ä»¬å¯ä»¥å®‰å…¨åœ°ç»Ÿè®¡ä¸€ä¸ªè¯·æ±‚å½“ä¸­çš„sqlæ‰§è¡Œæ€»æ¬¡æ•°äº†</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="http://knes1.github.io/blog/2015/2015-07-08-counting-queries-per-request-with-hibernate-and-spring.html">Counting Queries per Request with Hibernate and Spring</a></li><li><a href="https://github.com/p6spy/p6spy/issues/362">register an event handler</a></li><li><a href="https://www.baeldung.com/java-threadlocal">Threadlocal å¤„ç†çº¿ç¨‹å®‰å…¨é—®é¢˜</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHP-FPMå“åº”ç”¨æˆ·è¯·æ±‚è¿‡ç¨‹</title>
      <link href="2021/12/03/php/PHP-FPM%E5%93%8D%E5%BA%94%E7%94%A8%E6%88%B7%E8%AF%B7%E6%B1%82%E8%BF%87%E7%A8%8B/"/>
      <url>2021/12/03/php/PHP-FPM%E5%93%8D%E5%BA%94%E7%94%A8%E6%88%B7%E8%AF%B7%E6%B1%82%E8%BF%87%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æˆ‘ä»¬å‘å¸ƒäº†éå¸¸å¤šçš„é¡¹ç›®ï¼Œè®©å®ƒåœ¨æœºå™¨ä¸Šè¿è¡Œã€‚ä½†æ˜¯ä½ çŸ¥é“PHP-FPMç©¶ç«Ÿæ˜¯å¦‚ä½•è®©ä½ çš„æºä»£ç è¿è¡Œå¹¶å¤„ç†å¤§é‡çš„ç”¨æˆ·è¯·æ±‚ä¹ˆã€‚</p></blockquote><h2 id="å“åº”è¿‡ç¨‹"><a href="#å“åº”è¿‡ç¨‹" class="headerlink" title="å“åº”è¿‡ç¨‹"></a>å“åº”è¿‡ç¨‹</h2><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20211203094817.png" alt=""></p><span id="more"></span><p>Nginxå’ŒPHP-FPMé€šè¿‡ <a href="http://www.mit.edu/~yandros/doc/specs/fcgi-spec.html">Fastcgi åè®®</a> è¿›è¡Œäº¤æµ</p><pre class="language-none"><code class="language-none">Web browser www.example.com|        |   Transport over HTTP protocol  |        |    http server (server nginx &#x2F; APACHE)            |        |     Configuration analysis    Route to www.example.com&#x2F;index.php|        |Fast CGI module loaded with nginx|        |Fast CGI monitors 127.0.0.1:9000 addressesThrough the fast CGI protocol, the request is forwarded to PHP FPM for processing|        |Request reached 127.0.0.1:9000|        |PHP FPM monitoring 127.0.0.1:9000This can be done through PHP- fpm.conf  Make changes</code></pre><h2 id="å¹¶è¡Œæ¨¡å¼"><a href="#å¹¶è¡Œæ¨¡å¼" class="headerlink" title="å¹¶è¡Œæ¨¡å¼"></a>å¹¶è¡Œæ¨¡å¼</h2><p>PHPå…¶å®æœ‰2ç§æ¨¡å¼æ¥å¤„ç†å¹¶å‘è¯·æ±‚ï¼š</p><ul><li>åŸºäºè¿›ç¨‹</li><li>åŸºäºçº¿ç¨‹</li></ul><h3 id="è¿›ç¨‹æ¨¡å¼æµç¨‹"><a href="#è¿›ç¨‹æ¨¡å¼æµç¨‹" class="headerlink" title="è¿›ç¨‹æ¨¡å¼æµç¨‹"></a>è¿›ç¨‹æ¨¡å¼æµç¨‹</h3><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20211203101157.png" alt=""></p><ol><li>æ¨¡å—åˆå§‹åŒ–: MINIT()</li></ol><p>è¿™ä¸ªç¯èŠ‚ä¼šåˆå§‹åŒ–ä¸€äº›å¯¹è±¡å’Œä¸€äº›æ¯ä¸ªè¯·æ±‚ä¼šç”¨åˆ°çš„ä¿¡æ¯ï¼Œè¿™ä¸ªæ—¶å€™å¹¶æ²¡æœ‰å¼€å§‹æ¥æ”¶è¯·æ±‚ã€‚è¿™æ®µæ—¶é—´å¯ä»¥è®¿é—®å…¨å±€å˜é‡ã€‚</p><ol start="2"><li>è¯·æ±‚åˆå§‹åŒ–: RINIT()</li></ol><p>PHPåœ¨è¿™ä¸ªé˜¶æ®µå¼€å§‹å¤„ç†requestï¼ŒPHPæ˜¯ä¸€ç§æ— å…±äº«æ¶æ„ï¼Œæä¾›äº†çµæ´»çš„å†…å­˜ç®¡ç†æ–¹å¼ã€‚<code>share-nothing architecture</code>æ„å‘³ç€ä¸ç”¨æ‹…å¿ƒå¹¶å‘å¼•å‘çš„é”™ä¹±é—®é¢˜ã€‚</p><p>åœ¨æ­¤ä¸­ï¼Œå¦‚æœéœ€è¦åˆ†é…åŠ¨æ€å†…å­˜ï¼Œå°†ä½¿ç”¨<code>Zendå†…å­˜ç®¡ç†å™¨</code>ã€‚Zend å†…å­˜ç®¡ç†å™¨ä¼šè·Ÿè¸ªä½ é€šè¿‡å®ƒåˆ†é…çš„å†…å­˜ï¼Œå½“è¯·æ±‚å…³é—­æ—¶ï¼Œå¦‚æœæ‚¨å¿˜è®°è¿™æ ·åšï¼Œå®ƒå°†å°è¯•é‡Šæ”¾å—è¯·æ±‚çº¦æŸçš„å†…å­˜ã€‚</p><ol start="3"><li>è¯·æ±‚ç»ˆæ­¢ï¼šPRSHUTDOWN()</li></ol><p>PHPå¤„ç†è¯·æ±‚ç»“æŸï¼Œæ­¤é˜¶æ®µæ¸…ç†è¯·æ±‚å†…å­˜ã€‚æœªæ¥çš„è¯·æ±‚å½“ä¸­ä¸ä¼šæœ‰å½“å‰è¯·æ±‚çš„æ•°æ®ã€‚</p><p>æ­¤é˜¶æ®µï¼ŒRSHUTDOWN()çš„è°ƒç”¨æ—¶æœºï¼š</p><ul><li>æ¥è‡ª<code>register_shutdown_function</code>æ³¨å†Œçš„æ–¹æ³•ï¼Œç”¨æˆ·æ€çš„shutdownè°ƒç”¨æ‰§è¡Œå®Œ</li><li>æ‰€æœ‰çš„å¯¹è±¡ææ„å‡½æ•°æ‰§è¡Œå®Œ</li><li>PHPè¾“å‡ºç¼“å†²flushå®Œæ¯•</li><li><code>max_execution_time</code>è§¦è¾¾</li></ul><ol start="4"><li>è¯·æ±‚ç»ˆæ­¢å: PRSHUTDOWN()</li></ol><p>æ­¤é˜¶æ®µå¾ˆå°‘è¢«ä½¿ç”¨ã€‚</p><ol start="5"><li>å…¨å±€åˆå§‹åŒ–: GINIT()</li></ol><p>æ­¤é’©å­åœ¨çº¿ç¨‹æ¨¡å‹ä¸‹ä¼šä¸ºæ¯ä¸ªè¯·æ±‚éƒ½è§¦å‘ä¸€æ¬¡ï¼Œä½†åœ¨å¤šè¿›ç¨‹æ¨¡å‹ä¸‹åªè§¦å‘ä¸€æ¬¡ã€‚</p><p>å…¨å±€å˜é‡ä¸ä¼šè¢«æ¸…é™¤åœ¨æ¯ä¸ªè¯·æ±‚ä¹‹åï¼Œéœ€è¦æ¯æ¬¡è¿›è¡Œ<code>RINIT</code>æ“ä½œã€‚</p><ol start="6"><li>å…¨å±€ç»ˆæ­¢ï¼šGSHUTDOWN()</li></ol><p>ä¸GINITä¸€æ ·ï¼Œå¤šçº¿ç¨‹æ¨¡å¼ä¸‹æ¯æ¬¡è¯·æ±‚ä¹‹åéƒ½ä¼šè§¦å‘ï¼Œå¤šè¿›ç¨‹æ¨¡å¼åªä¼šæ‰§è¡Œä¸€æ¬¡ã€‚</p><p>æ‰€ä»¥æ€»ä½“ä¸Šçš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20211203175045.png" alt=""></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol><li><a href="https://www.phpinternalsbook.com/php7/extensions_design/php_lifecycle.html">https://www.phpinternalsbook.com/php7/extensions_design/php_lifecycle.html</a></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Servlet Filiter å’Œ Spring Intercetors,è®°å½•è¯·æ±‚æ—¥å¿—</title>
      <link href="2021/12/02/java/Intercetors-%E8%AE%B0%E5%BD%95%E8%AF%B7%E6%B1%82%E6%97%A5%E5%BF%97/"/>
      <url>2021/12/02/java/Intercetors-%E8%AE%B0%E5%BD%95%E8%AF%B7%E6%B1%82%E6%97%A5%E5%BF%97/</url>
      
        <content type="html"><![CDATA[<blockquote><p>åœ¨å‰é¢çš„æ–‡ç« æˆ‘ä»¬æœ‰çœ‹åˆ°Servlet Filiterçš„ä½œç”¨ã€‚ä¸ä¹‹ç±»ä¼¼çš„Springä¸­æˆ‘ä»¬çŸ¥é“æœ‰æ‹¦æˆªå™¨Intercetorsã€‚</p></blockquote><p>ç°åœ¨æœ‰1ä¸ªéœ€æ±‚ï¼Œè®°å½•requestçš„æ‰€æœ‰è¯·æ±‚ä¿¡æ¯ï¼ŒURLã€è¯·æ±‚æ–¹æ³•ã€è¯·æ±‚ä½“ã€‚æˆ‘ä»¬è‡ªç„¶è€Œç„¶ä¼šæƒ³åˆ°ä½¿ç”¨<code>Filiter</code>æˆ–<code>Intercetors</code></p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20211201133516.png" alt=""></p><p><code>Filiter</code>å’Œ<code>Intercetors</code>çš„åŒºåˆ«åœ¨äºæ‰€æ‰§è¡Œçš„æ—¶é—´ç‚¹ä¸åŒï¼Œä½†éƒ½åœ¨åˆ°è¾¾controllerä¹‹å‰ã€‚çœ‹èµ·æ¥äºŒè€…éƒ½å¯ä»¥å®Œæˆè¿™ä¸ªéœ€æ±‚ã€‚</p><span id="more"></span><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹Filiterã€‚Springå½“ä¸­æœ¬èº«æ”¯æŒservletçš„å‡ ä¸ªæ³¨è§£ã€‚</p><blockquote><p>When using an embedded container, automatic registration of classes annotated with @WebServlet, @WebFilter, and @WebListener can be enabled by using @ServletComponentScan.</p></blockquote><p>ä½†æ˜¯ä»–ä¹Ÿè¯´äº†ï¼Œå¦‚æœè¦ä¿è¯é¡ºåºï¼Œéœ€è¦é€šè¿‡å®šä¹‰<code>FilterRegistrationBean</code>çš„æ–¹å¼ã€‚</p><blockquote><p>you must define a FilterRegistrationBean for the Filter and set the registration beanâ€™s order using the setOrder(int) method.</p></blockquote><p><strong>ä¸ç®¡æ˜¯Filiterè¿˜æ˜¯Intercetorséƒ½æ˜¯éœ€è¦æ‹¿åˆ°request,ä»requestè·å–è¦è®°å½•çš„ä¿¡æ¯ã€‚å½“è¦è®°å½•è¯·æ±‚ä½“çš„æ—¶å€™ï¼Œåœ¨Java IOå½“ä¸­æœ‰ä¸ªæœ€å¤§çš„é—®é¢˜æ˜¯å¦‚æœä¸€æ—¦<code>request.getInputStream()</code> åé¢å°±ä¼šè¯»å–ä¸åˆ°è¯·æ±‚ä½“</strong>ï¼Œå¹¶æŠ›å‡º<code>HttpMessageNotReadableException: Required request body is missing</code> å¼‚å¸¸ã€‚</p><p>Springæœ¬èº«æä¾›è®°å½•è¯·æ±‚ä½“çš„Filiter <code>AbstractRequestLoggingFilter</code>,æˆ‘ä»¬å¯ä»¥ç»§æ‰¿å¹¶è‡ªå®šä¹‰ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomizedRequestLoggingFilter</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractRequestLoggingFilter</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">beforeRequest</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">afterRequest</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>å¯ç”¨è¯¥<code>bean</code></p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FilterConfigure</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">FilterRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LogFilter</span><span class="token punctuation">></span></span> <span class="token function">logFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// åˆ©ç”¨ slf4j.MDC è®°å½• å”¯ä¸€è¯·æ±‚ç </span>        <span class="token class-name">FilterRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LogFilter</span><span class="token punctuation">></span></span> bean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FilterRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LogFilter</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        bean<span class="token punctuation">.</span><span class="token function">setFilter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LogFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        bean<span class="token punctuation">.</span><span class="token function">addUrlPatterns</span><span class="token punctuation">(</span><span class="token string">"/*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¿‡æ»¤æ‰€æœ‰è·¯å¾„</span>        bean<span class="token punctuation">.</span><span class="token function">setOrder</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> bean<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">CustomizedRequestLoggingFilter</span> <span class="token function">logInitFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//åŸç”Ÿbeanè®°å½•è¯·æ±‚ä¿¡æ¯ è¯·æ±‚ä½“</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"logInitFilter..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">CustomizedRequestLoggingFilter</span> filter                <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CustomizedRequestLoggingFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        filter<span class="token punctuation">.</span><span class="token function">setIncludeClientInfo</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        filter<span class="token punctuation">.</span><span class="token function">setIncludeQueryString</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        filter<span class="token punctuation">.</span><span class="token function">setIncludePayload</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        filter<span class="token punctuation">.</span><span class="token function">setMaxPayloadLength</span><span class="token punctuation">(</span><span class="token number">2048</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        filter<span class="token punctuation">.</span><span class="token function">setIncludeHeaders</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        filter<span class="token punctuation">.</span><span class="token function">setAfterMessagePrefix</span><span class="token punctuation">(</span><span class="token string">"REQUEST DATA : "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> filter<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>ä½†æ˜¯åŸç”Ÿçš„<code>AbstractRequestLoggingFilter</code>æä¾›çš„Messageæ ¼å¼å·²ç»å›ºå®šï¼Œå¹¶ä¸èƒ½æ ¹æ®è‡ªå·±çš„å–œå¥½æ¥ã€‚</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20211202103252.png" alt=""></p><p>è€Œä¸”æ¢è¡Œç¬¦æ²¡è¢«è½¬ä¹‰ï¼Œè™½ç„¶ä¾¿äºè°ƒè¯•è§‚å¯Ÿä½†å¹¶ä¸åˆ©äºELKè¿™æ ·çš„æ—¥å¿—ä½“ç³»è®°å½•æ—¥å¿—ã€‚</p><p>è¦è§£å†³è¿™ä¸ªé—®é¢˜å°±éœ€è¦è‡ªå·±è¯»å–requestå¹¶è®°å½•ï¼Œå°±å¿…é¡»è§£å†³ä¸Šæ–‡æåˆ°çš„<code>request.getInputStream()</code> streamè¯»å–é—®é¢˜ã€‚</p><p>è§£å†³åŠæ³•ç½‘ä¸Šä¹Ÿæœ‰ï¼Œå°±æ˜¯é€šè¿‡æ‹·è´ä¸€ä»½streamï¼Œå°†æ‹·è´çš„streamç»§ç»­æ‰”å›<code>FilterChain</code>ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Bean</span><span class="token keyword">public</span> <span class="token class-name">FilterRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LogClientFilter</span><span class="token punctuation">></span></span> <span class="token function">logClientFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//è‡ªå®šä¹‰çš„ request log filter</span>    <span class="token class-name">FilterRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LogClientFilter</span><span class="token punctuation">></span></span> bean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FilterRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LogClientFilter</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    bean<span class="token punctuation">.</span><span class="token function">setFilter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LogClientFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    bean<span class="token punctuation">.</span><span class="token function">addUrlPatterns</span><span class="token punctuation">(</span><span class="token string">"/*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    bean<span class="token punctuation">.</span><span class="token function">setOrder</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> bean<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>å…³é”®çš„MultiReadå¯¹è±¡</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MultiReadHttpServletRequest</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServletRequestWrapper</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">ByteArrayOutputStream</span> cachedBytes<span class="token punctuation">;</span>    <span class="token comment">/**     * Construct a new multi-read wrapper.     *     * @param request to wrap around     */</span>    <span class="token keyword">public</span> <span class="token class-name">MultiReadHttpServletRequest</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">ServletInputStream</span> <span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>cachedBytes <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token function">cacheInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CachedServletInputStream</span><span class="token punctuation">(</span>cachedBytes<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">BufferedReader</span> <span class="token function">getReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">cacheInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">/* Cache the inputstream in order to read it multiple times. For         * convenience, I use apache.commons IOUtils         */</span>        cachedBytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cachedBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/* An inputstream which reads the cached request body */</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">CachedServletInputStream</span> <span class="token keyword">extends</span> <span class="token class-name">ServletInputStream</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ByteArrayInputStream</span> buffer<span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token class-name">CachedServletInputStream</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> contents<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>contents<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> buffer<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isFinished</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> buffer<span class="token punctuation">.</span><span class="token function">available</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setReadListener</span><span class="token punctuation">(</span><span class="token class-name">ReadListener</span> listener<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"Not implemented"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>æ—¥å¿—è®°å½•Filiter</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogClientFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">FilterConfig</span> config<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"log client..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ObjectMapper</span> mapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ObjectNode</span> rootNode <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">createObjectNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">HttpServletRequest</span> httpServletRequest <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span> request<span class="token punctuation">;</span>        <span class="token class-name">MultiReadHttpServletRequest</span> wrappedRequest <span class="token operator">=</span>                <span class="token keyword">new</span> <span class="token class-name">MultiReadHttpServletRequest</span><span class="token punctuation">(</span>httpServletRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>        request<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        rootNode<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"uri"</span><span class="token punctuation">,</span> httpServletRequest<span class="token punctuation">.</span><span class="token function">getRequestURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        rootNode<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"clientIp"</span><span class="token punctuation">,</span> httpServletRequest<span class="token punctuation">.</span><span class="token function">getRemoteAddr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> method <span class="token operator">=</span> httpServletRequest<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        rootNode<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"method"</span><span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> content <span class="token operator">=</span> <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>wrappedRequest<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">)</span> <span class="token operator">||</span> method<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"DELETE"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            rootNode<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"request"</span><span class="token punctuation">,</span> httpServletRequest<span class="token punctuation">.</span><span class="token function">getQueryString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            rootNode<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"request"</span><span class="token punctuation">,</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>rootNode<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol><li><a href="https://www.jvt.me/posts/2020/05/25/read-servlet-request-body-multiple/">https://www.jvt.me/posts/2020/05/25/read-servlet-request-body-multiple/ å¤šæ¬¡è¯»å–servletè¯·æ±‚ä½“</a></li><li><a href="https://www.javadevjournal.com/spring/log-incoming-requests-spring/">https://www.javadevjournal.com/spring/log-incoming-requests-spring/ è®°å½•springçš„è¯·æ±‚</a></li><li><a href="https://levelup.gitconnected.com/how-to-log-the-request-body-in-a-spring-boot-application-10083b70c66">https://levelup.gitconnected.com/how-to-log-the-request-body-in-a-spring-boot-application-10083b70c66</a></li><li><a href="https://stackoverflow.com/questions/54035778/commonsrequestloggingfilter-not-working-in-spring-boot-application/54545890#">https://stackoverflow.com/questions/54035778/commonsrequestloggingfilter-not-working-in-spring-boot-application/54545890#</a></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>servlet | servletå­¦ä¹ ç¬”è®°</title>
      <link href="2021/11/28/java/servlet%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>2021/11/28/java/servlet%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20211128120653.png" alt=""></p><p>ç®€å•è€Œè¨€ï¼ŒServletæ˜¯ä¸€ä¸ªAPIï¼Œæœ¬è´¨ä¸Šçš„å®ç°æ˜¯ç”±æ‰¿è½½çš„Servletå®¹å™¨å»å¤„ç†ã€‚é€šè¿‡Javaå¤šçº¿ç¨‹å¤„ç†å¹¶å“åº”å®¢æˆ·ç«¯çš„Http Requestã€‚</p><span id="more"></span><h2 id="å†å²"><a href="#å†å²" class="headerlink" title="å†å²"></a>å†å²</h2><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20211128105759.png" alt=""></p><p>æˆªæ­¢ç›®å‰ï¼Œæœ€æ–°ç‰ˆæœ¬è§„èŒƒä¸º6.0ã€‚</p><h2 id="è¿‡æ»¤å™¨-Filter"><a href="#è¿‡æ»¤å™¨-Filter" class="headerlink" title="è¿‡æ»¤å™¨ Filter"></a>è¿‡æ»¤å™¨ Filter</h2><p>åœ¨HTTPè¯·æ±‚åˆ°è¾¾Servletä¹‹å‰ï¼Œå¯ä»¥è¢«ä¸€ä¸ªæˆ–å¤šä¸ªFilteré¢„å¤„ç†ï¼Œç±»ä¼¼æ‰“å°æ—¥å¿—ã€ç™»å½•æ£€æŸ¥ç­‰é€»è¾‘ï¼Œå®Œå…¨å¯ä»¥æ”¾åˆ°Filterä¸­ã€‚</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20211128110826.png" alt=""></p><p>Filterä¸å…‰èƒ½æ‹¦æˆªè¯·æ±‚ï¼Œå¯¹è¯·æ±‚è¿›è¡Œé¢„å¤„ç†ï¼Œè¿˜èƒ½å¤Ÿä¿®æ”¹è¿”å›ã€‚</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20211128111038.png" alt=""></p><h2 id="äº‹ä»¶ç›‘å¬å™¨-Listener"><a href="#äº‹ä»¶ç›‘å¬å™¨-Listener" class="headerlink" title="äº‹ä»¶ç›‘å¬å™¨ Listener"></a>äº‹ä»¶ç›‘å¬å™¨ Listener</h2><p>Servlet ä¾¦å¬å™¨ç”¨äºä¾¦å¬ Web å®¹å™¨ä¸­çš„äº‹ä»¶ï¼Œä¾‹å¦‚ï¼Œå½“æ‚¨åˆ›å»ºä¼šè¯æ—¶ï¼Œæˆ–åœ¨ä¼šè¯ä¸­æ”¾ç½®å±æ€§æ—¶ï¼Œæˆ–è€…å¦‚æœæ‚¨åœ¨å¦ä¸€ä¸ªå®¹å™¨ä¸­è¢«åŠ¨åŒ–å¹¶æ¿€æ´»æ—¶ï¼Œè¦è®¢é˜…è¿™äº›äº‹ä»¶ï¼Œ</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20211128111619.png" alt=""></p><h3 id="äº‹ä»¶ç±»å‹"><a href="#äº‹ä»¶ç±»å‹" class="headerlink" title="äº‹ä»¶ç±»å‹"></a>äº‹ä»¶ç±»å‹</h3><ol><li><p><strong>javax.servlet.AsyncEvent</strong> â€“ åœ¨ ServletRequest ä¸Šå¯åŠ¨çš„å¼‚æ­¥æ“ä½œï¼ˆé€šè¿‡è°ƒç”¨ ServletRequest#startAsync æˆ–ServletRequest#startAsyncï¼ˆServletRequestï¼Œ ServletResponseï¼‰ï¼‰å®Œæˆã€è¶…æ—¶æˆ–äº§ç”Ÿé”™è¯¯æ—¶è§¦å‘çš„äº‹ä»¶ã€‚</p></li><li><p><strong>javax.servlet.http.HttpSessionBindingEvent</strong> â€“ å½“ä¼šè¯ç»‘å®šæˆ–å–æ¶ˆç»‘å®š HttpSessionListener æ—¶ï¼Œè¿™ç§ç±»å‹çš„äº‹ä»¶è¦ä¹ˆå‘é€åˆ°å®ç° HttpSessionBindingListener çš„å¯¹è±¡ï¼Œè¦ä¹ˆå‘é€åˆ°åœ¨ Web ä¸­é…ç½®çš„ </p></li><li><p><strong>HttpSessionAttributeListener</strong>å½“ä»»ä½•å±æ€§åœ¨ä¼šè¯ä¸­è¢«ç»‘å®šã€å–æ¶ˆç»‘å®šæˆ–æ›¿æ¢æ—¶ã€‚ä¼šè¯é€šè¿‡è°ƒç”¨ HttpSession.setAttribute ç»‘å®šå¯¹è±¡ï¼Œå¹¶é€šè¿‡è°ƒç”¨ HttpSession.removeAttribute è§£é™¤ç»‘å®šå¯¹è±¡ã€‚<br>å½“å¯¹è±¡ä»ä¼šè¯ä¸­åˆ é™¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ­¤äº‹ä»¶ç”¨äºæ¸…ç†æ´»åŠ¨ã€‚</p></li><li><p><strong>javax.servlet.http.HttpSessionEvent</strong> â€“ è¿™æ˜¯ä¸€ä¸ªç±»ï¼Œè¡¨ç¤º Web åº”ç”¨ç¨‹åºä¸­ä¼šè¯æ›´æ”¹çš„äº‹ä»¶é€šçŸ¥ã€‚</p></li><li><p><strong>javax.servlet.ServletContextAttributeEvent</strong> â€“ äº‹ä»¶ç±»ï¼Œç”¨äºé€šçŸ¥æœ‰å…³ Web åº”ç”¨ç¨‹åº ServletContext å±æ€§çš„æ›´æ”¹ã€‚</p></li><li><p><strong>javax.servlet.ServletContextEvent</strong>â€“ è¿™æ˜¯æœ‰å…³ Web åº”ç”¨ç¨‹åº servlet ä¸Šä¸‹æ–‡æ›´æ”¹çš„é€šçŸ¥çš„äº‹ä»¶ç±»ã€‚</p></li><li><p><strong>javax.servlet.ServletRequestEvent</strong> â€“ æ­¤ç±»äº‹ä»¶è¡¨ç¤º ServletRequest çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ã€‚è¯¥äº‹ä»¶çš„æºæ˜¯æ­¤ Web åº”ç”¨ç¨‹åºçš„ ServletContextã€‚</p></li><li><p><strong>javax.servlet.ServletRequestAttributeEvent</strong>â€“ è¿™æ˜¯ä¸€ä¸ªäº‹ä»¶ç±»ï¼Œç”¨äºé€šçŸ¥åº”ç”¨ç¨‹åºä¸­ servlet è¯·æ±‚çš„å±æ€§çš„æ›´æ”¹ã€‚</p></li></ol><h2 id="æ³¨è§£"><a href="#æ³¨è§£" class="headerlink" title="æ³¨è§£"></a>æ³¨è§£</h2><p>åœ¨2005å¹´çš„servlet 2.5ä¸­å¼•å…¥äº†æ³¨è§£èƒ½åŠ›ï¼Œå¯ä»¥ä¸å†é…ç½®å¤ªå¤šxmlã€‚</p><p><code>@WebServlet</code> </p><p>å£°æ˜javaç±»ä¸ºservlet</p><p><code>@WebInitParam</code> </p><p>ä½œä¸º<code>WebServlet</code>å‚æ•°æ³¨è§£ã€‚åˆå§‹åŒ–serverlå‚æ•°ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span>  name <span class="token operator">=</span> <span class="token string">"BankAccountServlet"</span><span class="token punctuation">,</span>   description <span class="token operator">=</span> <span class="token string">"Represents a Bank Account and it's transactions"</span><span class="token punctuation">,</span>   urlPatterns <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"/account"</span><span class="token punctuation">,</span> <span class="token string">"/bankAccount"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>   initParams <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token annotation punctuation">@WebInitParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"type"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"savings"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountServlet</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> accountType <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">ServletConfig</span> config<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>        accountType <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">getInitParameter</span><span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span>       <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// ...</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p><code>@WebFilter</code></p><p>å£°æ˜è¿‡æ»¤å™¨ï¼Œå¦‚æœè¦å¯¹è¯·æ±‚è¿›è¡Œæ‹¦æˆªã€ä¿®æ”¹è€Œä¸å½±å“é€»è¾‘ä»£ç ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@WebFilter</span><span class="token punctuation">(</span>  urlPatterns <span class="token operator">=</span> <span class="token string">"/account/*"</span><span class="token punctuation">,</span>  filterName <span class="token operator">=</span> <span class="token string">"LoggingFilter"</span><span class="token punctuation">,</span>  description <span class="token operator">=</span> <span class="token string">"Filter all account transaction URLs"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogInFilter</span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span>Filter</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">FilterConfig</span> filterConfig<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span>        <span class="token class-name">ServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span>           <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">HttpServletRequest</span> req <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span> request<span class="token punctuation">;</span>        <span class="token class-name">HttpServletResponse</span> res <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">)</span> response<span class="token punctuation">;</span>        res<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">getContextPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"/login.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p><code>@WebListener</code></p><p>å£°æ˜äº‹ä»¶ç›‘å¬å™¨ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@WebListener</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BankAppServletContextListener</span>   <span class="token keyword">implements</span> <span class="token class-name">ServletContextListener</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contextInitialized</span><span class="token punctuation">(</span><span class="token class-name">ServletContextEvent</span> sce<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         sce<span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"ATTR_DEFAULT_LANGUAGE"</span><span class="token punctuation">,</span> <span class="token string">"english"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span>         <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contextDestroyed</span><span class="token punctuation">(</span><span class="token class-name">ServletContextEvent</span> sce<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         <span class="token comment">// ... </span>    <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span></code></pre><p><code>@ServletSecurity</code>ã€<code>@HttpConstraint</code>ã€<code>@HttpMethodConstraint</code></p><p>ç±»ä¼¼nginxè®¤è¯åŠŸèƒ½</p><p><code>@MultipartConfig</code></p><p>å¤„ç†æ–‡ä»¶ä¸Šä¼ é…ç½®</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span>urlPatterns <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token string">"/uploadCustDocs"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token annotation punctuation">@MultipartConfig</span><span class="token punctuation">(</span>  fileSizeThreshold <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">,</span>  maxFileSize <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">,</span>  maxRequestSize <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">25</span><span class="token punctuation">,</span>  location <span class="token operator">=</span> <span class="token string">"./custDocs"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UploadCustomerDocumentsServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span>       <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Part</span> part <span class="token operator">:</span> request<span class="token punctuation">.</span><span class="token function">getParts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            part<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"myFile"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h2 id="Api"><a href="#Api" class="headerlink" title="Api"></a>Api</h2><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20211201093231.png" alt=""></p><p>â€Java servlet API ç”±ä¸¤ä¸ªåŒ…ç»„æˆã€‚ä¸€ä¸ªæ˜¯javax.servletï¼Œå¦ä¸€ä¸ªæ˜¯javax.servlet.httpã€‚javax.servlet åŒ…åŒ…å«å¯ç”¨äºç¼–å†™ç‹¬ç«‹äºåè®®çš„ servlet çš„æ‰€æœ‰ç±»å’Œæ¥å£ï¼Œjavax.servlet.http åŒ…å«ç¼–å†™ HTTP ç‰¹å®š servlet æ‰€éœ€çš„æ‰€æœ‰ç±»å’Œæ¥å£ã€‚è®©æˆ‘ä»¬è¯¦ç»†æ¢è®¨ä¸€ä¸‹ Java Servlet APIã€‚â€</p><h2 id="å‚è€ƒé˜…è¯»"><a href="#å‚è€ƒé˜…è¯»" class="headerlink" title="å‚è€ƒé˜…è¯»"></a>å‚è€ƒé˜…è¯»</h2><ol><li><a href="https://o7planning.org/10395/java-servlet-filter">https://o7planning.org/10395/java-servlet-filter</a></li><li><a href="https://www.codejava.net/java-ee/servlet/how-to-modify-http-response-using-java-filter">https://www.codejava.net/java-ee/servlet/how-to-modify-http-response-using-java-filter å¦‚ä½•ä½¿ç”¨filterä¿®æ”¹response</a></li><li><a href="https://en.wikipedia.org/wiki/Jakarta_Servlet">https://en.wikipedia.org/wiki/Jakarta_Servlet ç»´åŸºservlet</a></li><li><a href="https://www.baeldung.com/javaee-web-annotations">Java-web-æ³¨è§£ www.baeldung.com</a></li><li><a href="https://www.simplilearn.com/tutorials/java-tutorial/java-servlets">Java-servlets</a></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTTPæœ¬è´¨</title>
      <link href="2021/10/30/java/%E6%98%A5%E5%A4%A9%E4%B9%8B%E5%89%8D-http/"/>
      <url>2021/10/30/java/%E6%98%A5%E5%A4%A9%E4%B9%8B%E5%89%8D-http/</url>
      
        <content type="html"><![CDATA[<blockquote><p>è¯•å›¾è·³è¿‡spring,è€Œå­¦ä¹ spring bootæ˜¯ä¸å¯èƒ½çš„ã€‚å­¦ä¹ java webå¼€å‘ï¼Œä»åŸºç¡€å¼€å§‹å­¦ä¹ ã€‚å°±åº”å½“äº†è§£httpã€servletã€tomcat</p></blockquote><span id="more"></span><ul><li>èµ·æº</li><li>å®ƒè§£å†³ä»€ä¹ˆé—®é¢˜</li><li>å®ç°åŸç†</li></ul><h1 id="èµ·æº"><a href="#èµ·æº" class="headerlink" title="èµ·æº"></a>èµ·æº</h1><p>1980å¹´6æœˆè‡³12æœˆé—´ï¼Œä¼¯çº³æ–¯-æåœ¨çš„CERNï¼ˆæ¬§æ´²æ ¸å­ç ”ç©¶ç»„ç»‡ï¼‰æ‹…ä»»å·¥ä½œã€‚å®éªŒå®¤çš„ç ”ç©¶äººå‘˜éœ€è¦å¤§é‡çš„ä¿¡æ¯æŸ¥é˜…æˆ–æ²Ÿé€šã€‚åœ¨é‚£æ®µæ—¶é—´é‡Œï¼Œä»–æå‡ºäº†ä¸ªæ„æƒ³ï¼šåˆ›å»ºä¸€ä¸ªä»¥è¶…æ–‡æœ¬ç³»ç»Ÿä¸ºåŸºç¡€çš„é¡¹ç›®ï¼Œæ–¹ä¾¿ç ”ç©¶äººå‘˜åˆ†äº«åŠæ›´æ–°è®¯æ¯ã€‚</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20201222144257.png" alt=""></p><p>1989å¹´3æœˆï¼Œä»–å†™ä¸‹äº†ä»–çš„åˆæ­¥æ„æƒ³ï¼Œå¹¶åœ¨1990å¹´é‡æ–°é…ç½®ã€‚ç„¶åè¢«ä»–çš„ç»ç†éº¦å…‹Â·æ£®å¾·å°”ï¼ˆMike Sendallï¼‰æ‰€æ¥å—ã€‚ä»–ä½¿ç”¨ä¸ENQUIREç³»ç»Ÿç›¸ä¼¼çš„æ¦‚å¿µæ¥åˆ›å»ºä¸‡ç»´ç½‘ï¼Œä¸ºæ­¤ä»–è®¾è®¡å¹¶æ„å»ºäº†ç¬¬ä¸€ä¸ªç½‘é¡µæµè§ˆå™¨ã€‚</p><p>ä¸–ç•Œä¸Šç¬¬ä¸€ä¸ªç½‘ç«™åœ¨CERNæ­å»ºï¼Œè€ŒCERNåˆ™ä½äºæ³•å›½è¾¹å¢ƒã€‚ç½‘ç«™åœ¨1991å¹´8æœˆ6æ—¥ä¸Šçº¿ã€‚</p><p>ä¸Šçº¿ çš„ç¬¬ä¸€ä¸ªç½‘å€ï¼Œ<a href="http://info.cern.ch/hypertext/WWW/TheProject.html">http://info.cern.ch/hypertext/WWW/TheProject.html</a> å‘Šè¯‰äººä»¬ä¸‡ç»´ç½‘æ˜¯ä»€ä¹ˆï¼Œç”¨æˆ·å¦‚ä½•ä½¿ç”¨æµè§ˆå™¨ï¼Œå¦‚ä½•åˆ›å»ºç½‘é¡µæœåŠ¡å™¨ã€‚</p><h1 id="ç›®çš„"><a href="#ç›®çš„" class="headerlink" title="ç›®çš„"></a>ç›®çš„</h1><p>è®¾è®¡HTTPæœ€åˆçš„ç›®çš„æ˜¯ä¸ºäº†æä¾›ä¸€ç§å‘å¸ƒå’Œæ¥æ”¶HTMLé¡µé¢çš„æ–¹æ³•ã€‚</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20201218163846.png" alt=""></p><h1 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h1><p>ä¸€ä¸ªè¿æ¥æ˜¯ç”±ä¼ è¾“å±‚æ¥æ§åˆ¶çš„ï¼Œè¿™ä»æ ¹æœ¬ä¸Šä¸å±äºHTTPçš„èŒƒå›´ã€‚HTTPå¹¶ä¸éœ€è¦å…¶åº•å±‚çš„ä¼ è¾“å±‚åè®®æ˜¯é¢å‘è¿æ¥çš„ï¼Œåªéœ€è¦å®ƒæ˜¯å¯é çš„ï¼Œæˆ–ä¸ä¸¢å¤±æ¶ˆæ¯çš„ï¼ˆè‡³å°‘è¿”å›é”™è¯¯ï¼‰ã€‚åœ¨äº’è”ç½‘ä¸­ï¼Œæœ‰ä¸¤ä¸ªæœ€å¸¸ç”¨çš„ä¼ è¾“å±‚åè®®ï¼šTCPæ˜¯å¯é çš„ï¼Œè€ŒUDPä¸æ˜¯ã€‚å› æ­¤ï¼ŒHTTPä¾èµ–äºé¢å‘è¿æ¥çš„TCPè¿›è¡Œæ¶ˆæ¯ä¼ é€’ï¼Œä½†è¿æ¥å¹¶ä¸æ˜¯å¿…é¡»çš„ã€‚å› æ­¤é€šè¿‡socketç¼–ç¨‹å°±èƒ½å®ç°httpåè®®ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Server</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> port <span class="token operator">=</span> <span class="token number">8081</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ServerSocket</span> ss <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç›‘å¬æŒ‡å®šç«¯å£</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"server is running..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Socket</span> sock <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"connected from "</span> <span class="token operator">+</span> sock<span class="token punctuation">.</span><span class="token function">getRemoteSocketAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Handler</span><span class="token punctuation">(</span>sock<span class="token punctuation">)</span><span class="token punctuation">;</span>            t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Handler</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Socket</span> sock<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Handler</span><span class="token punctuation">(</span><span class="token class-name">Socket</span> sock<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>sock <span class="token operator">=</span> sock<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span> <span class="token class-name">InputStream</span> input <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sock<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">(</span> <span class="token class-name">OutputStream</span> output <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sock<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token function">handle</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> output<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">this</span><span class="token punctuation">.</span>sock<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ioe<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token punctuation">&#125;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"client disconnected."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> input<span class="token punctuation">,</span> <span class="token class-name">OutputStream</span> output<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Process new http request..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> writer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedWriter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">OutputStreamWriter</span><span class="token punctuation">(</span>output<span class="token punctuation">,</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è¯»å–HTTPè¯·æ±‚:</span>        <span class="token keyword">boolean</span> requestOk <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> first <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>first<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"GET / HTTP/1."</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            requestOk <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> header <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>header<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// è¯»å–åˆ°ç©ºè¡Œæ—¶, HTTP Headerè¯»å–å®Œæ¯•</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>requestOk <span class="token operator">?</span> <span class="token string">"Response OK"</span> <span class="token operator">:</span> <span class="token string">"Response Error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>requestOk<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// å‘é€é”™è¯¯å“åº”:</span>            writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"HTTP/1.0 404 Not Found\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"Content-Length: 0\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            writer<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// å‘é€æˆåŠŸå“åº”:</span>            <span class="token class-name">String</span> data <span class="token operator">=</span> <span class="token string">"&lt;html>&lt;body>&lt;h1>Hello, world!&lt;/h1>&lt;/body>&lt;/html>"</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> length <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>            writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"HTTP/1.0 200 OK\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"Connection: close\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"Content-Type: text/html\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"Content-Length: "</span> <span class="token operator">+</span> length <span class="token operator">+</span> <span class="token string">"\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç©ºè¡Œæ ‡è¯†Headerå’ŒBodyçš„åˆ†éš”</span>            writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>            writer<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// TODO: å¤„ç†HTTPè¯·æ±‚</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ul><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP">https://developer.mozilla.org/zh-CN/docs/Web/HTTP</a></p></li><li><p><a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1304265903570978">å»–é›ªå³°-webåŸºç¡€</a></p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>log4jä½¿ç”¨æŒ‡å—</title>
      <link href="2021/10/30/java/log4j%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/"/>
      <url>2021/10/30/java/log4j%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<p>å¯¹äºåˆšå¼€å§‹æ¥è§¦javaçš„äººæ¥è¯´ï¼Œç”¨ä»€ä¹ˆæ¥æ‰“æ—¥å¿—ä¼¼ä¹å¿«è¢«javaçš„è¿™ä¹ˆå¤šæ¦‚å¿µææ‡µäº†ã€‚log4jã€log4j2ã€slf4jã€logback?!!</p><span id="more"></span><h2 id="ç›˜ç‚¹"><a href="#ç›˜ç‚¹" class="headerlink" title="ç›˜ç‚¹"></a>ç›˜ç‚¹</h2><p>ç›˜ç‚¹ä¸‹æˆ‘ä»¬é‡åˆ°è¿‡å“ªäº›æ—¥å¿—</p><ul><li><code>java.util.logging</code></li><li><code>org.apache.commons.logging.Log</code></li><li><code>Log4j</code>å’Œ<code>Log4j2</code></li><li><code>SLF4J</code> å’Œ <code>Logback</code></li></ul><p>ç®€å•æ¦‚æ‹¬ <code>Log4j</code>å’Œ<code>Log4j2</code>æ˜¯<code>commons.logging</code></p><h2 id="log4j"><a href="#log4j" class="headerlink" title="log4j"></a>log4j</h2><p>Apache Log4j æ˜¯ä¸€ä¸ªéå¸¸å¤è€çš„æ—¥å¿—æ¡†æ¶ï¼Œå¹¶ä¸”æ˜¯å¤šå¹´æ¥æœ€å—æ¬¢è¿çš„æ—¥å¿—æ¡†æ¶ã€‚ å®ƒå¼•å…¥äº†ç°ä»£æ—¥å¿—æ¡†æ¶ä»åœ¨ä½¿ç”¨çš„åŸºæœ¬æ¦‚å¿µï¼Œå¦‚åˆ†å±‚æ—¥å¿—çº§åˆ«å’Œè®°å½•å™¨ã€‚</p><p>2015 å¹´ 8 æœˆ 5 æ—¥ï¼Œè¯¥é¡¹ç›®ç®¡ç†å§”å‘˜ä¼šå®£å¸ƒ Log4j 1.x å·²è¾¾åˆ°ä½¿ç”¨å¯¿å‘½ã€‚ å»ºè®®ç”¨æˆ·ä½¿ç”¨ Log4j 1 å‡çº§åˆ° Apache<br>Log4j 2ã€‚</p><h2 id="log4j2"><a href="#log4j2" class="headerlink" title="log4j2"></a>log4j2</h2><p>Apache Log4j 2æ˜¯å¯¹ Log4j çš„å‡çº§ï¼Œå®ƒæ¯”å…¶å‰èº« Log4j 1.x æä¾›äº†é‡å¤§æ”¹è¿›ï¼Œå¹¶æä¾›äº† Logback ä¸­å¯ç”¨çš„è®¸å¤šæ”¹è¿›ï¼ŒåŒæ—¶ä¿®å¤äº† Logback æ¶æ„ä¸­çš„ä¸€äº›å›ºæœ‰é—®é¢˜ã€‚</p><p>ä¸ Logback ä¸€æ ·ï¼ŒLog4j2 æä¾›å¯¹ SLF4J çš„æ”¯æŒï¼Œè‡ªåŠ¨é‡æ–°åŠ è½½æ—¥å¿—é…ç½®ï¼Œå¹¶æ”¯æŒé«˜çº§è¿‡æ»¤é€‰é¡¹ã€‚ é™¤äº†è¿™äº›åŠŸèƒ½å¤–ï¼Œå®ƒè¿˜å…è®¸åŸºäº lambda è¡¨è¾¾å¼å¯¹æ—¥å¿—è¯­å¥è¿›è¡Œå»¶è¿Ÿè¯„ä¼°ï¼Œä¸ºä½å»¶è¿Ÿç³»ç»Ÿæä¾›å¼‚æ­¥è®°å½•å™¨ï¼Œå¹¶æä¾›æ— åƒåœ¾æ¨¡å¼ä»¥é¿å…ç”±åƒåœ¾æ”¶é›†å™¨æ“ä½œå¼•èµ·çš„ä»»ä½•å»¶è¿Ÿã€‚</p><p>æ‰€æœ‰è¿™äº›åŠŸèƒ½ä½¿ Log4j2 æˆä¸ºè¿™ä¸‰ä¸ªæ—¥å¿—æ¡†æ¶ä¸­æœ€å…ˆè¿›å’Œæœ€å¿«çš„ã€‚</p><h2 id="Logback"><a href="#Logback" class="headerlink" title="Logback"></a>Logback</h2><p>logback æ˜¯ç”± log4j åˆ›å§‹äººè®¾è®¡çš„åˆä¸€ä¸ªå¼€æºæ—¥å¿—ç»„ä»¶ï¼Œä½œä¸ºæµè¡Œçš„ log4j é¡¹ç›®çš„åç»­ç‰ˆæœ¬ï¼Œä»è€Œæ›¿ä»£ log4jã€‚</p><p>Logback çš„ä½“ç³»ç»“æ„è¶³å¤Ÿé€šç”¨ï¼Œä»¥ä¾¿åœ¨ä¸åŒæƒ…å†µä¸‹åº”ç”¨ã€‚ ç›®å‰ï¼Œlogback åˆ†ä¸ºä¸‰ä¸ªæ¨¡å—ï¼šlogback-coreï¼Œlogback-classicå’Œlogback-accessã€‚</p><p>logback-coreï¼šæ¨¡å—ä¸ºå…¶ä»–ä¸¤ä¸ªæ¨¡å—çš„åŸºç¡€ã€‚<br>logback-classicï¼šæ¨¡å—å¯ä»¥è¢«çœ‹åšæ˜¯log4jçš„æ”¹è¿›ç‰ˆæœ¬ã€‚æ­¤å¤–ï¼Œlogback-classic æœ¬èº«å®ç°äº† SLF4J APIï¼Œå› æ­¤å¯ä»¥åœ¨ logback å’Œå…¶ä»–æ—¥å¿—æ¡†æ¶ï¼ˆå¦‚ log4j æˆ– java.util.loggingï¼ˆJULï¼‰ï¼‰ä¹‹é—´æ¥å›åˆ‡æ¢ã€‚<br>logback-accessï¼šæ¨¡å—ä¸ Servlet å®¹å™¨ï¼ˆå¦‚ Tomcat å’Œ Jettyï¼‰é›†æˆï¼Œä»¥æä¾› HTTP è®¿é—®æ—¥å¿—åŠŸèƒ½ã€‚</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20201221143239.png" alt=""></p>]]></content>
      
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHPStormä½¿ç”¨é…ç½®</title>
      <link href="2021/09/24/PHPStorm%E4%BD%BF%E7%94%A8%E9%85%8D%E7%BD%AE/"/>
      <url>2021/09/24/PHPStorm%E4%BD%BF%E7%94%A8%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘åˆå¼€å§‹ä½¿ç”¨PHPStormäº†ï¼Œä¸ºä»€ä¹ˆæ˜¯â€åˆâ€ï¼Ÿå› ä¸ºæ–­æ–­ç»­ç»­ä½¿ç”¨è¿‡å‡ æ¬¡ï¼Œéƒ½ä¸­æ–­è¿‡ã€‚è¦ç ´è§£æ„Ÿè§‰è¿˜æ˜¯éº»çƒ¦ï¼Œä¸€ç›´ä½¿ç”¨netbeansä¹Ÿæ„Ÿè§‰æ²¡ä»€ä¹ˆé—®é¢˜ã€‚</p><p>ç”±äºæœ€è¿‘åœ¨è€ƒè™‘<code>doctrine\annotation</code>,netbeansçš„æ”¯æŒèƒ½åŠ›è¿˜æ˜¯ä¸è¶³ï¼Œæ‰€ä»¥åˆå¼€å§‹ä½“éªŒ<code>phpstorm</code>.<br>å‡ ä¸ªåœ¨netbeansé‡Œå–œæ¬¢çš„åŠŸèƒ½ï¼Œåƒæ–¹ç™¾è®¡å¼€å§‹åœ¨phpstormæ‰¾å›æ¥ã€‚ä»¥ä¸‹æ˜¯è®°å½•ã€‚</p><span id="more"></span><h2 id="é¡¹ç›®åæ˜¾ç¤ºgitåˆ†æ”¯"><a href="#é¡¹ç›®åæ˜¾ç¤ºgitåˆ†æ”¯" class="headerlink" title="é¡¹ç›®åæ˜¾ç¤ºgitåˆ†æ”¯"></a>é¡¹ç›®åæ˜¾ç¤ºgitåˆ†æ”¯</h2><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210924174001.png" alt=""></p><p>å¦‚å›¾ï¼Œç”±äºç»å¸¸åˆ‡æ¢åˆ†æ”¯ã€‚æœ‰æ—¶å€™å¯èƒ½ä¼šåœ¨é”™è¯¯çš„åˆ†æ”¯ä¸Šè¿›è¡Œå¼€å‘ï¼Œé¡¹ç›®ååé¢æ ‡ä¸Šåˆ†æ”¯åè¿™ä¸ªåŠŸèƒ½æˆ‘å¾ˆå–œæ¬¢ã€‚</p><p>å‘ç°phpstormä½¿ç”¨<code>GitToolBox</code>å¯ä»¥è§£å†³ã€‚</p><h2 id="å…³é—­æ˜¾ç¤ºé¡¹ç›®è·¯å¾„"><a href="#å…³é—­æ˜¾ç¤ºé¡¹ç›®è·¯å¾„" class="headerlink" title="å…³é—­æ˜¾ç¤ºé¡¹ç›®è·¯å¾„"></a>å…³é—­æ˜¾ç¤ºé¡¹ç›®è·¯å¾„</h2><p>ä½†æ˜¯è¿˜æœ‰ä¸ªé—®é¢˜æ˜¯ï¼Œé¡¹ç›®åä¼šæ˜¾ç¤ºé¡¹ç›®åœ°å€ï¼Œè¿™ç‚¹å¾ˆçƒ¦ã€‚å¯ä»¥é€šè¿‡è‡ªå®šä¹‰phpstormå±æ€§åŠåˆ°ã€‚</p><p>æ‰“å¼€ Help/Edit Custom Propertiesâ€¦</p><p>æ–°å»º idea.properties file</p><pre class="language-ini" data-language="ini"><code class="language-ini"><span class="token key attr-name">project.tree.structure.show.url</span><span class="token punctuation">=</span><span class="token value attr-value">false</span><span class="token key attr-name">ide.tree.horizontal.default.autoscrolling</span><span class="token punctuation">=</span><span class="token value attr-value">false</span></code></pre><h2 id="éšè—nbproject"><a href="#éšè—nbproject" class="headerlink" title="éšè—nbproject"></a>éšè—nbproject</h2><p>nbprojectæ˜¯netbeansçš„é…ç½®æ–‡ä»¶å¤¹,åœ¨phpstormé¡¹ç›®ä¸­æ˜¾ç¤ºéå¸¸éš¾å—ã€‚</p><p>Preferences-&gt;File Types -&gt; Files and Folders to Ignore.</p>]]></content>
      
      
      
        <tags>
            
            <tag> è½¯ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å†™å¥½ä»£ç çš„ä¸ƒç§æ­¦å™¨ä¹‹ä¾èµ–æ³¨å…¥</title>
      <link href="2021/09/09/%E5%86%99%E5%A5%BD%E4%BB%A3%E7%A0%81%E7%9A%84%E4%B8%83%E7%A7%8D%E6%AD%A6%E5%99%A8%E4%B9%8B%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/"/>
      <url>2021/09/09/%E5%86%99%E5%A5%BD%E4%BB%A3%E7%A0%81%E7%9A%84%E4%B8%83%E7%A7%8D%E6%AD%A6%E5%99%A8%E4%B9%8B%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210909111628.png" alt=""></p><p>åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­æœ‰è¯´åˆ°ï¼Œå†™å¥½ä»£ç çš„åŸåˆ™ã€‚å…¶ä¸­æåˆ°äº†<code>SOLID</code></p><p>é‚£ä¹ˆä»€ä¹ˆæ˜¯<code>SOLID</code></p><span id="more"></span><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>SOLID åŸåˆ™é¦–å…ˆç”±è‘—åçš„è®¡ç®—æœºç§‘å­¦å®¶ Robert CÂ·Martin ï¼ˆè‘—åçš„Bobå¤§å”ï¼‰ç”± 2000 å¹´åœ¨ä»–çš„è®ºæ–‡ä¸­æå‡ºã€‚ä½†æ˜¯ SOLID ç¼©ç•¥è¯æ˜¯ç¨æ™šç”± Michael Feathers å…ˆä½¿ç”¨çš„ã€‚</p><p>Bobå¤§å”ä¹Ÿæ˜¯ç•…é”€ä¹¦ã€Šä»£ç æ•´æ´ä¹‹é“ã€‹å’Œã€Šæ¶æ„æ•´æ´ä¹‹é“ã€‹çš„ä½œè€…ï¼Œä¹Ÿæ˜¯ â€œAgile Allianceâ€ çš„æˆå‘˜ã€‚</p><p>ä»–ä»¬è¾¾æˆçš„ç›®æ ‡æ˜¯ä¸€è‡´çš„ï¼š</p><blockquote><p>â€œåˆ›å»ºå¯å¤šäººåä½œçš„ã€æ˜“äºç†è§£çš„ã€æ˜“è¯»çš„ä»¥åŠå¯æµ‹è¯•çš„ä»£ç ã€‚â€</p></blockquote><p>ç°åœ¨ä¾æ¬¡çœ‹ä¸€ä¸‹å„ä¸ªåŸåˆ™ï¼ŒSOLID æ˜¯ä»¥ä¸‹æ˜¯åŸåˆ™çš„ç¼©å†™ï¼š</p><ul><li>S å•ä¸€èŒè´£åŸåˆ™</li><li>O å¼€é—­åŸåˆ™</li><li>L é‡Œæ°æ›¿æ¢åŸåˆ™</li><li>I æ¥å£éš”ç¦»åŸåˆ™</li><li>D ä¾èµ–åè½¬åŸåˆ™</li></ul><p>æœ¬æ–‡ä¸»è¦è®²D ä¾èµ–åè½¬åŸåˆ™</p><h2 id="whatå’Œwhy"><a href="#whatå’Œwhy" class="headerlink" title="whatå’Œwhy"></a>whatå’Œwhy</h2><ol><li>ä»€ä¹ˆæ˜¯ä¾èµ–åè½¬</li><li>ä¸ºä»€ä¹ˆéœ€è¦ä¾èµ–åè½¬</li></ol><p>ä¾èµ–æ³¨å…¥DIæ˜¯ä¾èµ–åè½¬çš„ä¸€ç§å®ç°æ–¹å¼ï¼Œ<br>æˆ‘çœ‹äº†å¾ˆå¤šå®šä¹‰æè¿°æˆ‘è§‰å¾—éƒ½ä¸å¦‚æ¥ä¸€ä¸ªå®ä¾‹å¯¹æ¯”æ›´èƒ½è§£é‡Šæ¸…æ¥šã€‚</p><p><em>å…ˆæ¥çœ‹çœ‹ä¸ä½¿ç”¨DIçš„æ¡ˆä¾‹</em></p><pre class="language-none"><code class="language-none">Application needs Foo (e.g. a controller), so:Application creates FooApplication calls Foo    Foo needs Bar (e.g. a service), so:    Foo creates Bar    Foo calls Bar        Bar needs Bim (a service, a repository, â€¦), so:        Bar creates Bim        Bar does something</code></pre><p>å¯ä»¥çœ‹åˆ°çš„é—®é¢˜æ˜¯:<code>ä¾èµ–è¢«åˆ†æ•£å±‚å±‚åˆ›å»º</code></p><p><em>å†æ¥çœ‹çœ‹ä½¿ç”¨DIçš„æƒ…å†µ</em></p><pre class="language-none"><code class="language-none">Application needs Foo so:Application gets Foo from the Container, so:    Container creates Bim    Container creates Bar and gives it Bim    Container creates Foo and gives it BarApplication calls Foo    Foo calls Bar    Bar does something</code></pre><p>ä¾èµ–è¢«é›†ä¸­åˆ›å»ºå’Œæ³¨å…¥</p><p><em>è¿™æ ·çš„å¥½å¤„æ˜¯ä»€ä¹ˆï¼Ÿä¸¾ä¸ªä¾‹å­å§</em></p><p>å¦‚ä½•ä½ çš„ä¸€ä¸ªLibrary X ä½¿ç”¨äº† Logger Yï¼Œ ä½ æƒ³ä½¿ç”¨ä½ è‡ªå·±å®šä¹‰çš„logger Z? ä½¿ç”¨DIçš„è¯, å°±ä¸éœ€è¦æ”¹å˜ Library Xçš„ä»£ç äº†.</p><h2 id="ä»£ç å®ä¾‹"><a href="#ä»£ç å®ä¾‹" class="headerlink" title="ä»£ç å®ä¾‹"></a>ä»£ç å®ä¾‹</h2><p>å†æ¥çœ‹çœ‹å®ä¾‹ä»£ç ç‰ˆæœ¬</p><h3 id="éDI"><a href="#éDI" class="headerlink" title="éDI"></a>éDI</h3><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">GoogleMaps</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getCoordinatesFromAddress</span><span class="token punctuation">(</span><span class="token variable">$address</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// calls Google Maps webservice</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">OpenStreetMap</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getCoordinatesFromAddress</span><span class="token punctuation">(</span><span class="token variable">$address</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// calls OpenStreetMap webservice</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">StoreService</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getStoreCoordinates</span><span class="token punctuation">(</span><span class="token variable">$store</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$geolocationService</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GoogleMaps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// or $geolocationService = GoogleMaps::getInstance() if you use singletons</span>        <span class="token keyword">return</span> <span class="token variable">$geolocationService</span><span class="token operator">-></span><span class="token function">getCoordinatesFromAddress</span><span class="token punctuation">(</span><span class="token variable">$store</span><span class="token operator">-></span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>ä¸šåŠ¡åœºæ™¯å¾ˆç®€å•ï¼Œå°±æ˜¯è·å–åº—é“ºçš„åæ ‡ï¼Œæƒ…å†µæ˜¯å¯ä»¥æœ‰2ä¸ªæˆ–å¤šä¸ªåœ°å›¾æœåŠ¡ã€‚</p><h3 id="DI"><a href="#DI" class="headerlink" title="DI"></a>DI</h3><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">StoreService</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$geolocationService</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token class-name type-declaration">GeolocationService</span> <span class="token variable">$geolocationService</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">geolocationService</span> <span class="token operator">=</span> <span class="token variable">$geolocationService</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getStoreCoordinates</span><span class="token punctuation">(</span><span class="token variable">$store</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">geolocationService</span><span class="token operator">-></span><span class="token function">getCoordinatesFromAddress</span><span class="token punctuation">(</span><span class="token variable">$store</span><span class="token operator">-></span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">interface</span> <span class="token class-name-definition class-name">GeolocationService</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getCoordinatesFromAddress</span><span class="token punctuation">(</span><span class="token variable">$address</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">GoogleMaps</span> <span class="token keyword">implements</span> <span class="token class-name">GeolocationService</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">OpenStreetMap</span> <span class="token keyword">implements</span> <span class="token class-name">GeolocationService</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span></code></pre><p>é€šè¿‡æ„é€ å‡½æ•°ä¼ å…¥åœ°å›¾æœåŠ¡å®ä¾‹ï¼Œä¸ç”¨å¯¹<code>StoreService</code>è¿›è¡Œæ›´æ”¹ã€‚<code>StoreService</code>ä¸ç”¨å…³å¿ƒæ˜¯å“ªä¸ªåœ°å›¾æœåŠ¡ï¼Œä¸ä¾èµ–è§£è€¦å¼€ã€‚</p><h3 id="PHP-DI"><a href="#PHP-DI" class="headerlink" title="PHP-DI"></a>PHP-DI</h3><p>ç”¨PHP-DIè¿›è¡Œå®ç°ï¼Œä¸ç”¨é€šè¿‡æ„é€ å‡½æ•°çš„æ–¹å¼è¿›è¡Œä¼ é€’åœ°å›¾æœåŠ¡ã€‚</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$storeService</span> <span class="token operator">=</span> <span class="token variable">$container</span><span class="token operator">-></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'StoreService'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æ³¨å…¥æ”¹ä¸ºå®¹å™¨ç»Ÿä¸€æ³¨å…¥ã€‚</p><pre class="language-php7" data-language="php7"><code class="language-php7">$container-&gt;set(&#39;GeolocationService&#39;, \DI\create(&#39;GoogleMaps&#39;));</code></pre><p>å¼•å…¥äº†å®¹å™¨çš„æ¦‚å¿µçš„å¥½å¤„æ˜¯ï¼Œå¦‚æœè®©å®¹å™¨åœ¨æ•´ä¸ªworkflowé‡Œï¼Œåˆ™å¯ä»¥è½»æ˜“çš„å…¨å±€æ›´æ”¹ä»»ä½•çš„ä¾èµ–ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºOKRçš„æ€è€ƒ</title>
      <link href="2021/09/06/%E5%85%B3%E4%BA%8EOKR%E7%9A%84%E6%80%9D%E8%80%83/"/>
      <url>2021/09/06/%E5%85%B3%E4%BA%8EOKR%E7%9A%84%E6%80%9D%E8%80%83/</url>
      
        <content type="html"><![CDATA[<p>èµ·å› æ˜¯ç”±äºæˆ‘çš„è€æ¿åœ¨æœˆåˆçš„æ—¶å€™åˆå¸ƒç½®ä»»åŠ¡è¦æ±‚å†™ä¸‹æœ¬æœˆçš„å…³é”®ç›®æ ‡Top3ã€‚ä¹Ÿå°±æ˜¯OKR Top3,å¹¶ä¸”è¦æ±‚ç”¨SMARTåŸåˆ™ã€‚</p><p>åœ¨æ­¤ä¹‹å‰é¢†å¯¼ä¸€ç›´å‘Šè¯‰æˆ‘ä»¬KPIå’ŒOKRæ˜¯åˆ†åˆ«ç”¨æ¥ç®¡ç†é”€å”®å›¢é˜Ÿå’ŒèŒèƒ½å›¢é˜Ÿçš„ã€‚å› ä¸ºé”€å”®å›¢é˜Ÿå¾ˆå®¹æ˜“ç”¨æ•°æ®æŒ‡æ ‡æ¥è¡¡é‡å·¥ä½œç»“æœï¼Œä½†èŒèƒ½å›¢é˜Ÿçš„å·¥ä½œå¹¶ä¸å¥½ç”¨æ•°æ®æŒ‡æ ‡æ¥è¡¡é‡ã€‚</p><p>ä½†æ˜¯SMARTåŸåˆ™äº”æ¡åˆæœ‰Measurable(å¯è¡¡é‡çš„),äºæ˜¯æˆ‘æœ‰ç‚¹æƒŠè®¶ã€‚å¦‚æœOKR+SMARTé‚£è·ŸKPIæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p><span id="more"></span><p>äºæ˜¯æˆ‘è®¤ä¸ºOKR+SMART = KPI. ä½†ç©¶ç«Ÿæ˜¯ä¸æ˜¯è¿™æ ·å‘¢ï¼Ÿ</p><h2 id="OKRå’ŒKPI"><a href="#OKRå’ŒKPI" class="headerlink" title="OKRå’ŒKPI"></a>OKRå’ŒKPI</h2><p>å…ˆæ¥çœ‹çœ‹KPIï¼Œå› ä¸ºæœ¬èº«OKRæ˜¯åæ¥æ‰æå‡ºæ¥çš„æ¦‚å¿µã€‚ç›¸è¾ƒäºOKRï¼ŒKPIæ›´å¹¿å’Œæ›´æ—©è¢«äººæ‰€çŸ¥ã€‚</p><p>KPI æ˜¯ Key Performance Indicator çš„ç¼©å†™ï¼Œä¸­æ–‡åç§°æ˜¯ã€Œå…³é”®ç»©æ•ˆæŒ‡æ ‡ã€ï¼Œå³ä¸€ç³»åˆ—è¡¡é‡å·¥ä½œæˆæ•ˆçš„é‡è¦æŒ‡æ ‡ã€‚</p><p>å…³é”®ç‚¹æœ‰äº†ï¼Œ<code>æŒ‡æ ‡</code></p><p><em>KPI å¿…é¡»æ˜¯å®¢è§‚çš„ã€å¯è¡¡é‡çš„ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ KPIï¼š</em></p><p>åŒ»ç–—ä¿å¥è¡Œä¸šï¼šæ‚£è€…ç­‰å¾…æ—¶é—´ã€å¹³å‡æ²»ç–—è´¹ç”¨</p><p>é›¶å”®è¡Œä¸šï¼šåªæ•ˆã€æ¯åå‘˜å·¥é”€å”®é¢</p><p>äººåŠ›èµ„æºéƒ¨é—¨ï¼šç¦»èŒç‡ã€å¹³å‡æ‹›è˜æ—¶é—´</p><p>é”€å”®éƒ¨é—¨ï¼šé”€å”®æ”¶å…¥ã€æ‹¨æ‰“ç”µè¯çš„æ¬¡æ•°</p><p>å®¢æœéƒ¨é—¨ï¼š å®¢æˆ·æ»¡æ„åº¦NPS</p><p>å†æ¥çœ‹ä¸‹OKR</p><p>OKR æ˜¯ Objective and Key Results çš„ç¼©å†™ï¼Œä¸­æ–‡åç§°æ˜¯ã€Œç›®æ ‡ä¸å…³é”®ç»“æœæ³•ã€ï¼Œæ˜¯ä¸€å¥—å¸®åŠ©ç»„ç»‡å®ç°ç›®æ ‡ç®¡ç†ã€æ¨åŠ¨æ‰§è¡Œä¸åä½œçš„å·¥å…·å’Œæ–¹æ³•ï¼Œå…³é”®ç‚¹<code>å·¥å…·å’Œæ–¹æ³•</code>ã€‚</p><p>å½“ç„¶KPIä¹Ÿå¯ä»¥ç†è§£ä¸ºæ–¹æ³•ï¼Œä½†æ˜¯OKRçš„å·¥å…·æ€§å’Œæ–¹æ³•æŒ‡å¯¼æ„ä¹‰ä¼šæ›´å¼ºã€‚</p><h2 id="OKR"><a href="#OKR" class="headerlink" title="OKR"></a>OKR</h2><p>oKRå¼ºè°ƒåœ¨â€ç¬¬ä¸€æ€§åŸç†â€æ€è€ƒæ–¹å¼çš„åŸºç¡€ä¸Š,èšç„¦æˆ˜ç•¥<br>é‡ç‚¹,æå²€é¼“èˆäººå¿ƒçš„ç›®æ ‡,é€‰æ‹©ROæ›´ä¼˜çš„ç­–ç•¥,ä»è€Œ<br><code>æ¿€å‘ç»„ç»‡æ´»åŠ›,é™ä½å…±è¯†æˆæœ¬</code>,ä¿ƒè¿›å›¢é˜Ÿå’Œä¸ªäººå›´ç»•ç»„ç»‡<br>ç›®æ ‡é«˜æ•ˆåä½œ.</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210906205210.png" alt=""></p><p>ä¸€ä¸ªå…¬å¸éƒ½ä¼šæŒ‡å®šå…¬å¸ç»ˆç”Ÿå¥‹æ–—çš„<code>ä½¿å‘½</code>ï¼Œ<code>æ„¿æ™¯</code>ã€‚</p><p>å…³äº<code>ä½¿å‘½</code>å’Œ<code>æ„¿æ™¯</code> æˆ‘ä¹Ÿå¬åˆ°è¿‡æˆ‘é¢†å¯¼è·Ÿæˆ‘è®²çš„æ¯”è¾ƒæœ‰æ„æ€çš„è§£é‡Šç‰ˆæœ¬ã€‚</p><p><code>ä½¿å‘½</code> å¯èƒ½æ˜¯å½“ä¸‹å°±å¯ä»¥å®ç°çš„ã€‚<br><code>æ„¿æ™¯</code> å¯èƒ½ä¸èƒ½å®ç°ï¼Œä½†æ˜¯å…¬å¸è¦ä¸ºä¹‹å¥‹æ–—çš„ç›®æ ‡ã€‚</p><p>ä¾‹å¦‚ apple æ„¿æ™¯ï¼šè®©æ¯äººæ‹¥æœ‰ä¸€å°è®¡ç®—æœºï¼›ä½¿å‘½ï¼šæ¨å¹¿å…¬å¹³çš„èµ„æ–™ä½¿ç”¨æƒ¯ä¾‹ï¼Œå»ºç«‹ç”¨æˆ·å¯¹äº’è”ç½‘ä¹‹ä¿¡ä»»å’Œä¿¡å¿ƒ</p><p>è¨€å½’æ­£ä¼ ã€‚ä¸ºäº†å®Œæˆ<code>ä½¿å‘½</code>æˆ–è€…æ¥è¿‘<code>æ„¿æ™¯</code>ã€‚å…¬å¸é«˜å±‚å¿…ç„¶ä¼šåˆ¶å®šé•¿æœŸçš„æˆ˜ç•¥è®¡åˆ’ã€‚</p><p>é‚£ä¹ˆä¸ºäº†è¿™äº›æˆ˜ç•¥è®¡åˆ’ï¼Œæ¯ä¸ªå±‚çº§æ¯ä¸ªäººéƒ½å› ä¸ºæƒ³åˆ°<code>æˆ‘å¯ä»¥å®Œæˆä»€ä¹ˆ</code>å’Œ<code>å¦‚ä½•è¾¾åˆ°ç›®æ ‡</code>ã€‚</p><p>ä»¥åŠæ›´ç»†åŒ–çš„ä¸ºäº†è½åœ°è¿™äº›<code>ç›®æ ‡</code>å’Œ<code>å…³é”®ç»“æœ</code> éœ€è¦å»ºç«‹å“ªäº›<code>é¡¹ç›®</code>æˆ–<code>é¡¹ç›®ä»»åŠ¡</code></p><p>ä»å®è§‚çš„ä¼ä¸šæˆ˜ç•¥åˆ°å¾®è§‚ä¸ªäººä»»åŠ¡ï¼ŒOKRèƒ½å¾ˆå¥½çš„æˆä¸ºä¼ä¸šç›®æ ‡ç®¡ç†ä½“ç³»å’Œä¸ªäººçš„å·¥ä½œæ–¹æ³•ã€‚</p><p><em>OKRæ˜¯æ›´ç¬¦åˆæ—¶ä»£éœ€è¦çš„ç®¡ç†æ–¹æ³•</em></p><ul><li><p>ä¼ä¸šç«¯:VUCAæ—¶ä»£,è®©ç»„ç»‡æŒç»­è¿›åŒ–æ˜¯åº”å¯¹ä¸ç¡®å®šæ€§çš„æ ¹æœ¬</p></li><li><p>äººæ‰ç«¯:ä¸ªä½“å´›èµ·,ç®¡ç†ä»å¼ºè°ƒ<code>ç®¡æ§èµ°å†‹è‡ªé©±ä¸åä½œ</code></p></li><li><p>æ™®é€‚æ€§:å›´ç»•ç›®æ ‡å¼€å±•å·¥ä½œæ˜¯å¾ˆè‡ªç„¶çš„äº‹</p></li><li><p>ä¾›ç»™ç«¯: OKR SaaSæŠŠé¢†å…ˆå®è·µäº§å“åŒ–,è®©æ›´å¤šä¼ä¸šä»¥ä½æˆæœ¬å—ç›Š</p></li><li><p>è®¤çŸ¥:OKRä¸æ˜¯ä¸‡èƒ½è¯,æ­£ç¡®è®¤è¯†OKRæ‰èƒ½ç”¨å¥½OKR</p></li></ul><p><em>æˆ˜ç•¥å±‚é¢:ä»é•¿è¿œè§„åˆ’è½¬å‘æ•æ·è¿­ä»£</em></p><p>è¿‡å»ä¼ä¸šåšæˆ˜ç•¥é€šå¸¸è¦çœ‹3-5å¹´,å‰ææ˜¯å¸‚åœºå…è®¸ä½ ä¿æŒçº¿æ€§å¢é•¿çš„åˆç†é¢„æœŸã€‚ä»Šå¤©,éçº¿æ€§å¢é•¿æˆä¸ºæ™®éæƒ…å†µ,ä¼ä¸šæ›´åŠ èšç„¦åœ¨çœ¼å‰çš„åŠå¹´æˆ–ä¸€å¹´,ä»¥æ›´å¿«çš„é€Ÿåº¦åº”å¯¹å¸‚åœºå’Œéœ€æ±‚å˜åŒ–ã€‚</p><p><em>ç»„ç»‡å±‚é¢:ä»ç§‘å±‚åˆ¶ã€æ¡çº¿å¼è¿ä½œ,å‘åˆ†å¸ƒå¼å†³ç­–ã€ç½‘ç»œåŒ–åä½œçš„æ–¹å‘å‘å±•</em></p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210907095116.png" alt=""></p><p>ç§‘å±‚åˆ¶æœ€å¤§çš„ç‰¹ç‚¹,æ˜¯æŒ‡ä»¤å¼çš„ä¸Šä¼ ä¸‹è¾¾,æ¯ä¸€å±‚éƒ½ä¾èµ–ä¸Šä¸€å±‚çš„å†³ç­–,è¾ƒä¸ºè¢«åŠ¨ä½æ•ˆ,ä¹Ÿéš¾ä»¥äº§ç”Ÿåˆ›æ–°ã€‚åˆ†å¸ƒå¼ã€ç½‘ç»œåŒ–çš„ç»„ç»‡é‡Œ,æ¯ä¸ªèŠ‚ç‚¹(å›¢é˜Ÿæˆ–ä¸ªäºº)éƒ½æ›´åŠ è‡ªä¸»çš„å†³ç­–å’Œè¡ŒåŠ¨,ä¸»åŠ¨å‘èµ·åä½œ,æ›´åŠæ—¶çš„å“åº”å˜åŒ–,æ¶Œç°æ›´å¤šåˆ›æ–°ã€‚</p><p><em>æ–‡åŒ–å±‚é¢:ä»å¼ºè°ƒç®¡æ§ã€ä¸€è‡´åˆ°æ›´åŠ å¤šå…ƒåŒ–ã€å…¼å®¹å¹¶è“„</em></p><p>å¼ºè°ƒç®¡æ§ä¹Ÿæ˜¯ç§‘å±‚åˆ¶ç»„ç»‡ç‰¹å¾çš„å»¶ç»­,ä»Šå¤©çš„ç»„ç»‡éœ€è¦æ›´å¤šæ ·åŒ–çš„æ€æƒ³å’Œå®è·µ,äº§ç”Ÿæ–°çš„å˜åŒ–,åœ¨å…§å¤–éƒ¨å½¢æˆæ›´åŠ å¥åº·çš„ç”Ÿæ€,æ‰èƒ½äº§ç”Ÿæ›´å¤šå¯èƒ½æ€§ã€‚</p><p>OKRè®©æ¯ä¸€ä½å‘˜å·¥äº†è§£ç»„ç»‡çš„æ•´ä½“ç›®æ ‡,æ‰¾åˆ°è‡ªå·±å·¥ä½œä¸ç»„ç»‡ç›®æ ‡çš„è”ç³»,è·å¾—æ„ä¹‰ä¸æˆå°±æ„Ÿ</p><h2 id="OKRè®¤çŸ¥"><a href="#OKRè®¤çŸ¥" class="headerlink" title="OKRè®¤çŸ¥"></a>OKRè®¤çŸ¥</h2><p><em>ç¬¬ä¸€,OKRå¹¶ä¸è§£å†³æˆ˜ç•¥è§„åˆ’çš„é—®é¢˜</em></p><p>â—‹KRèƒ½å¤Ÿå¸®åŠ©ä¼ä¸šæ›´å¥½åœ°æ€è€ƒå’Œè½åœ°æˆ˜ç•¥,ä½†ä¸æ˜¯ç”¨äº†OKRå°±æœ‰æ›´å¥½çš„æˆ˜ç•¥OKRæœ¬è´¨æ˜¯ä¸€ç§äººäººçš†å›´ç»•æˆ˜ç•¥åœ¨ä¸»åŠ¨æ€è€ƒå¹¶åº¦é‡ç»“æœçš„æ–¹æ³•å’Œå·¥å…·</p><p><em>ç¬¬äºŒ,OKRä¸èƒ½ä»£æ›¿é¢†å¯¼åŠ›</em></p><p>ä»…ä»…è®¾å®šä¸€ä¸ªç›®æ ‡å¹¶ä¸èƒ½å¸¦æ¥æˆåŠŸ,é¢†å¯¼è€…ã€ç®¡ç†è€…å¸¦é¢†å›¢é˜Ÿå…±åŒåŠªåŠ›,æ‰èƒ½æ›´å¥½è¾¾æˆç›®æ ‡å„çº§ç®¡ç†è€…éƒ½å¿…é¡»ä¸»åŠ¨æ€è€ƒä¸šåŠ¡æœ¬è´¨å’Œæœ€ä½³è·¯å¾„é€šè¿‡OKRåˆ†æ´¾ä»»åŠ¡,æ˜¯å¯¹OKRçš„è¯¯ç”¨,æ›´æ˜¯ç®¡ç†ä¸Šçš„æ‡’æ”¿</p><p><em>ç¬¬ä¸‰,OKRä¸æ˜¯ç»©æ•ˆè€ƒæ ¸</em></p><p>ç›®æ ‡ç®¡ç†è®©å‘˜å·¥ä¸“æ³¨æ€è€ƒå¦‚ä½•å®ç°ç›®æ ‡,ç»©æ•ˆè€ƒæ ¸ä¸“æ³¨äºå¯¹å‘˜å·¥æ‰€åšè´¡çŒ®ç»™äºˆå…¬å¹³å›æŠ¥,å‰è€…æ˜¯ä»·å€¼åˆ›é€ ,åè€…æ˜¯ä»·å€¼åˆ†é…,äºŒè€…æœ‰æœ¬è´¨åŒºåˆ«é¢†å…ˆå®è·µä¸»å¼ å°†ç›®æ ‡ç®¡ç†å’Œç»©æ•ˆè¯„ä»·è§£ç»‘ã€‚ä¾‹å¦‚è°·æ­Œã€å­—èŠ‚è·³åŠ¨,â—‹KRä½œä¸ºç›®æ ‡ç®¡ç†å·¥å…·,ç»©æ•ˆè€ƒæ ¸é€šè¿‡360Â°è¯„ä»·å®ç°ã€‚å¦‚æœç›´æ¥è€ƒæ ¸OKRè¾¾æˆç‡,ç»„ç»‡åŠ¿å¿…åˆå°†é™·å…¥KP|å¼çš„è®¨ä»·è¿˜ä»·,ä¹Ÿæ›´å®¹æ˜“æ»‹ç”ŸçŸ­æœŸè¡Œä¸º</p><h2 id="OKRè½åœ°"><a href="#OKRè½åœ°" class="headerlink" title="OKRè½åœ°"></a>OKRè½åœ°</h2><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210907100005.png" alt=""></p><p>OKRçš„å®æ–½æ­¥éª¤éµå¾ªç»å…¸çš„â€œPDCAâ€ç›®æ ‡ç®¡ç†æµç¨‹ã€‚ä»¥å¹´åº¦ä¸ºä¾‹,â—‹KRçš„è¿è¡Œä¸€èˆ¬éµå¾ª</p><p>ç›®æ ‡åˆ¶å®š-è¿‡ç¨‹è·Ÿè¿›-æ€»ç»“å¤ç›˜-è€ƒæ ¸åº”ç”¨å››æ­¥å®æ–½æµç¨‹,å¹¶å½¢æˆé—­ç¯ç®¡ç†ã€‚</p><p>åœ¨ä¸€ä¸ªå¹´åº¦å†…,ä¼šæœ‰å¤šä¸ªåŒæœˆæˆ–å­£åº¦OKRå‘¨æœŸ,æ­¤å‘¨æœŸå†…ä¸»è¦ä»¥ç›®æ ‡åˆ¶å®š-è¿‡ç¨‹è·Ÿè¿›-æ€»ç»“å¤ç›˜ç¯èŠ‚å½¢æˆçš„å°é—­ç¯è¿›è¡Œè¿ä½œã€‚</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210907100800.png" alt=""></p><p><em>äº”å¤§æˆåŠŸå› ç´ </em></p><ul><li>é«˜å±‚ç®¡ç†è€…çš„ç§¯æå‚ä¸</li><li>æŠŠOKRåº”ç”¨åˆ°æ—¥å¸¸ç®¡ç†</li><li>åˆ›é€ è‰¯å¥½çš„å®æ–½ç¯å¢ƒ</li><li>ä¾¿æ·é«˜æ•ˆçš„OKRç³»ç»Ÿ</li><li>ä¸“é—¨çš„OKRè¿è¥å›¢é˜Ÿ</li></ul><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210907101053.png" alt=""></p><p>è¿™é‡Œæˆ‘è®¤ä¸º ç¬¬ä¸€ ç¬¬äºŒç‚¹å°¤ä¸ºé‡è¦ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul><li>OKRä¸åŒäºKPIï¼ŒOKR+SMART ä¹Ÿä¸ç­‰äºKPI</li><li>OKRæ˜¯æ›´é€‚åº”å½“ä»£çš„ç®¡ç†å·¥å…·ï¼Œé¢å¯¹æ–°æ—¶ä»£çš„â€äººâ€å’Œç¬å³ä¸‡å˜çš„å¿«èŠ‚å¥</li><li>OKRæ›´æ³¨é‡ç›®æ ‡å¯¼å‘,æ²¡æœ‰ç²¾ç¡®è§„ç»“æœï¼Œæ›´èƒ½æ¿€å‘å›¢é˜Ÿè‡ªä¸»æ€§</li><li>å¹¶ä¸æ„å‘³ç€å¯ä»¥æ‘ˆå¼ƒKPIï¼Œè€Œåº”é‡‡å–OKRä¸ºä¸»KPIä¸ºè¾…çš„æ–¹å¼ã€‚</li><li>å¯¹KPIçš„è®¤çŸ¥å°¤ä¸ºé‡è¦ï¼Œä¸Šåˆ°æœ€é«˜å±‚ä¸‹åˆ°åŸºå±‚éƒ½åº”è¯¥ç†è§£OKRçš„ä½œç”¨å’Œå¦‚ä½•è¿ç”¨OKRã€‚</li><li>æ‰€æœ‰ç®¡ç†æ–¹æ³•éƒ½åº”ä»¥äººä¸ºæœ¬ï¼Œç¦»ä¸å¼€åŸºç¡€çš„æ²Ÿé€šã€æ¼”è®²æŠ€å·§ã€‚è¦è®©æ–¹æ³•å‘æŒ¥åŠŸæ•ˆï¼Œè¿˜éœ€è¦æœ‰å¼ºå¤§çš„æ„Ÿå¬åŠ›ã€‚</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> ç®¡ç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»£ç æ•´æ´ä¹‹é“</title>
      <link href="2021/07/30/%E4%BB%A3%E7%A0%81%E6%95%B4%E6%B4%81%E4%B9%8B%E9%81%93/"/>
      <url>2021/07/30/%E4%BB%A3%E7%A0%81%E6%95%B4%E6%B4%81%E4%B9%8B%E9%81%93/</url>
      
        <content type="html"><![CDATA[<p>è½¯ä»¶è´¨é‡ä¸ä½†ä¾èµ–äºæ¶æ„åŠé¡¹ç›®ç®¡ç†ï¼Œè¿˜ä¸ä»£ç è´¨é‡ç´§å¯†ç›¸å…³ã€‚</p><blockquote><p>ä»£ç è´¨é‡ä¸æ•´æ´åº¦æˆæ­£æ¯”ï¼Œå¹²å‡€çš„ä»£ç å³åœ¨è´¨é‡ä¸Šè¾ƒä¸ºå¯é ï¼Œä¹Ÿä¸ºåæœŸç»´æŠ¤ã€å‡çº§å¥ å®šè‰¯å¥½åŸºç¡€ã€‚</p></blockquote><p>å¦ä¸€ç§æ¦‚å¿µå«åš<code>æé™ç¼–ç¨‹</code></p><h2 id="åŸåˆ™"><a href="#åŸåˆ™" class="headerlink" title="åŸåˆ™"></a>åŸåˆ™</h2><ul><li>SOLID</li><li>DRY</li><li>KISS</li></ul><h3 id="ç«¥å­å†›å†›è§„"><a href="#ç«¥å­å†›å†›è§„" class="headerlink" title="ç«¥å­å†›å†›è§„"></a>ç«¥å­å†›å†›è§„</h3><p><strong>è®©è¥åœ°æ¯”ä½ æ¥æ—¶æ›´å¹²å‡€</strong></p><span id="more"></span><h2 id="æœ‰æ„ä¹‰çš„å‘½å"><a href="#æœ‰æ„ä¹‰çš„å‘½å" class="headerlink" title="æœ‰æ„ä¹‰çš„å‘½å"></a>æœ‰æ„ä¹‰çš„å‘½å</h2><ul><li>åå‰¯å…¶å®ï¼Œè¡¨è¾¾çœŸå®æ„ä¹‰</li><li>ä¸è¯¯å¯¼</li><li>åšæœ‰æ„ä¹‰çš„åŒºåˆ†ï¼Œé¿å… aã€bã€c</li><li>å¯è¯»ã€å¯æœç´¢ </li></ul><h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h2><ul><li>å•ä¸€èŒè´£</li><li>è¡Œæ•° 20-100</li></ul><h3 id="å‡½æ•°å‚æ•°"><a href="#å‡½æ•°å‚æ•°" class="headerlink" title="å‡½æ•°å‚æ•°"></a>å‡½æ•°å‚æ•°</h3><ul><li>0å‚æ•°æœ€ä½³ï¼Œ3ä¸ªå‚æ•°å·²ç»å‹‰ä¸ºå…¶éš¾</li><li>æ ‡è¯†å‚æ•°ä¸‘é™‹ä¸å ªï¼Œå‘å‚æ•°ä¼ å…¥å¸ƒå°”å€¼éª‡äººå¬é—»</li><li>å¦‚æœå‡½æ•°éœ€è¦ä¸‰ä¸ªä»¥ä¸Šçš„å‚æ•°ï¼Œè¯´æ˜è¿™äº›å‚æ•°åº”è¯¥å°è£…ä¸ºç±»äº†</li></ul><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Circle</span> <span class="token function">makeCircle</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">,</span><span class="token keyword">double</span> y<span class="token punctuation">,</span><span class="token keyword">double</span> radius<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Circle</span> <span class="token function">makeCircle</span><span class="token punctuation">(</span><span class="token class-name">Point</span> center<span class="token punctuation">,</span><span class="token keyword">double</span> radius<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Foo</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">bar</span><span class="token punctuation">(</span><span class="token variable">$flag</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span></code></pre><h3 id="æ— å‰¯ä½œç”¨"><a href="#æ— å‰¯ä½œç”¨" class="headerlink" title="æ— å‰¯ä½œç”¨"></a>æ— å‰¯ä½œç”¨</h3><p>å‡½æ•°æ‰¿è¯ºåªåšä¸€ä»¶äº‹ï¼Œå®é™…ä¸Šè¿˜åšäº†å…¶ä»–çš„ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserValidator</span> <span class="token punctuation">&#123;</span><span class="token keyword">private</span> <span class="token class-name">Cryptographer</span> cryptographer<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">checkPassword</span><span class="token punctuation">(</span><span class="token class-name">String</span> userName<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token class-name">UserGateway</span><span class="token punctuation">.</span><span class="token function">findByName</span><span class="token punctuation">(</span>userName<span class="token punctuation">)</span> <span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">!=</span> <span class="token class-name">User</span><span class="token punctuation">.</span>NULL<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> codedPhrase <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getPhraseEncodedByPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> phrase <span class="token operator">=</span> cryptographer<span class="token punctuation">.</span>decrypt <span class="token punctuation">(</span>codedPhrase<span class="token punctuation">,</span>password <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"Valid Password"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>phrase<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">Session</span><span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//å®é™…ä¸Šè¿˜åšäº†session åˆå§‹åŒ–çš„æ“ä½œ</span>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>è¦ä¹ˆæŠ½ç¦»<code>Session.initialize()</code>,è¦ä¹ˆé‡å‘½åä¸º<code>checkPasswordAndInitializeSession</code> ä¸è¦ç»™äººè¯¯å¯¼ã€‚</p><h3 id="ä½¿ç”¨å¼‚å¸¸ä»£æ›¿é”™è¯¯ç "><a href="#ä½¿ç”¨å¼‚å¸¸ä»£æ›¿é”™è¯¯ç " class="headerlink" title="ä½¿ç”¨å¼‚å¸¸ä»£æ›¿é”™è¯¯ç "></a>ä½¿ç”¨å¼‚å¸¸ä»£æ›¿é”™è¯¯ç </h3><p>ä½¿ç”¨é”™è¯¯ç å°±è¦å®šä¹‰é”™è¯¯ç æšä¸¾ï¼Œæšä¸¾ç±»è¢«å¤§é‡å¯¼å…¥è°ƒç”¨ã€‚ä¸€æ—¦å¢åŠ æˆ–ä¿®æ”¹é”™è¯¯æšä¸¾ï¼Œå°±è¦å¯¹æ‰€æœ‰å¼•å…¥çš„æ–‡ä»¶è¿›è¡Œç¼–è¯‘ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">deletePage</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token operator">==</span>E_OK<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>       <span class="token keyword">if</span> <span class="token punctuation">(</span>registry<span class="token punctuation">.</span><span class="token function">deleteReference</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token operator">==</span>E_OK<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>           <span class="token keyword">if</span> <span class="token punctuation">(</span>configKeys<span class="token punctuation">.</span><span class="token function">deleteKey</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">makeKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span>E_OK<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>           logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"page deleted"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>           logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"configKey not deleted"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>           logger<span class="token punctuation">.</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"deleteReference from registry failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>           logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"delete failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">&#125;</span>     <span class="token keyword">return</span> E_ERROR<span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span></code></pre><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token function">deletePage</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>    registry<span class="token punctuation">.</span><span class="token function">deleteReference</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    configKeys<span class="token punctuation">.</span><span class="token function">deleteKey</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">makeKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h2 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h2><p>æ³¨é‡Šå¹¶ä¸åƒè¾›å¾·å‹’çš„åå•ã€‚å®ƒä»¬å¹¶ä¸â€œçº¯ç„¶åœ°å¥½â€ã€‚å®é™…ä¸Šï¼Œæ³¨é‡Šæœ€å¤šä¹Ÿå°±æ˜¯ä¸€ç§å¿…é¡»çš„æ¶ã€‚è‹¥ç¼–ç¨‹è¯­è¨€è¶³å¤Ÿæœ‰è¡¨è¾¾åŠ›ï¼Œæˆ–è€…æˆ‘ä»¬é•¿äºç”¨è¿™äº›è¯­è¨€æ¥è¡¨è¾¾æ„å›¾ï¼Œå°±ä¸é‚£ä¹ˆéœ€è¦æ³¨é‡Šâ€”â€”ä¹Ÿè®¸æ ¹æœ¬ä¸éœ€è¦ã€‚</p><h3 id="æ³¨é‡Šæ‰çš„ä»£ç "><a href="#æ³¨é‡Šæ‰çš„ä»£ç " class="headerlink" title="æ³¨é‡Šæ‰çš„ä»£ç "></a>æ³¨é‡Šæ‰çš„ä»£ç </h3><p>20ä¸–çºª60å¹´ä»£ï¼Œæ›¾ç»æœ‰é‚£ä¹ˆä¸€æ®µæ—¶é—´ï¼Œæ³¨é‡Šæ‰çš„ä»£ç å¯èƒ½æœ‰ç”¨ã€‚ä½†æˆ‘ä»¬å·²ç»æ‹¥æœ‰ä¼˜è‰¯çš„æºä»£ç æ§åˆ¶ç³»ç»Ÿå¦‚æ­¤ä¹‹ä¹…ï¼Œè¿™äº›ç³»ç»Ÿå¯ä»¥ä¸ºæˆ‘ä»¬è®°ä½ä¸è¦çš„ä»£ç ã€‚æˆ‘ä»¬æ— éœ€å†ç”¨æ³¨é‡Šæ¥æ ‡è®°ï¼Œåˆ æ‰å³å¯ï¼Œå®ƒä»¬ä¸¢ä¸äº†ã€‚æˆ‘æ‹…ä¿ã€‚</p><h2 id="æ ¼å¼"><a href="#æ ¼å¼" class="headerlink" title="æ ¼å¼"></a>æ ¼å¼</h2><h3 id="æ–‡ä»¶é•¿åº¦"><a href="#æ–‡ä»¶é•¿åº¦" class="headerlink" title="æ–‡ä»¶é•¿åº¦"></a>æ–‡ä»¶é•¿åº¦</h3><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210722110617.png" alt=""></p><p>200-500</p><h3 id="è¡Œå­—ç¬¦æ•°"><a href="#è¡Œå­—ç¬¦æ•°" class="headerlink" title="è¡Œå­—ç¬¦æ•°"></a>è¡Œå­—ç¬¦æ•°</h3><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210722111053.png" alt=""></p><p>ä¸Šé™120</p><h2 id="å¯¹è±¡å’Œæ•°æ®ç»“æ„"><a href="#å¯¹è±¡å’Œæ•°æ®ç»“æ„" class="headerlink" title="å¯¹è±¡å’Œæ•°æ®ç»“æ„"></a>å¯¹è±¡å’Œæ•°æ®ç»“æ„</h2><h3 id="å¾·è«ç‰¹å®šå¾‹"><a href="#å¾·è«ç‰¹å®šå¾‹" class="headerlink" title="å¾·è«ç‰¹å®šå¾‹"></a>å¾·è«ç‰¹å®šå¾‹</h3><p>è‘—åçš„å¾—å¢¨å¼è€³å¾‹ï¼ˆThe Law of Demeter)è®¤ä¸ºï¼Œæ¨¡å—ä¸åº”äº†è§£å®ƒæ‰€æ“ä½œå¯¹è±¡çš„å†…éƒ¨å½¢ã€‚å¦‚ä¸ŠèŠ‚æ‰€è§ï¼Œå¯¹è±¡éšè—æ•°æ®ï¼Œæ›éœ²æ“ä½œã€‚è¿™æ„å‘³ç€å¯¹è±¡ä¸åº”é€šè¿‡å­˜å–å™¨æ›éœ²å…¶å†…éƒ¨ç»“æ„<br>å› ä¸ºè¿™æ ·æ›´åƒæ˜¯æ›éœ²è€Œééšè—å…¶å†…éƒ¨ç»“æ„ã€‚<br>æ›´å‡†ç¡®åœ°è¯´ï¼Œå¾—å¢¨å¼è€³å¾‹è®¤ä¸ºï¼Œç±»Cçš„æ–¹æ³•fåªåº”è¯¥è°ƒç”¨ä»¥ä¸‹å¯¹è±¡çš„æ–¹æ³•ï¼š</p><ul><li>C</li><li>ç”±fåˆ›å»ºçš„å¯¹è±¡ï¼›</li><li>ä½œä¸ºå‚æ•°ä¼ é€’ç»™fçš„å¯¹è±¡ï¼›</li><li>ç”±Cçš„å®ä½“å˜é‡æŒæœ‰çš„å¯¹è±¡ã€‚</li></ul><h2 id="null"><a href="#null" class="headerlink" title="null"></a>null</h2><ul><li>åˆ«ä¼ nullå€¼</li><li>åˆ«è¿”å›nullå€¼</li></ul><h2 id="ç³»ç»Ÿ"><a href="#ç³»ç»Ÿ" class="headerlink" title="ç³»ç»Ÿ"></a>ç³»ç»Ÿ</h2><p>â€œå¤æ‚è¦äººå‘½ã€‚å®ƒæ¶ˆç£¨å¼€å‘è€…çš„ç”Ÿå‘½ï¼Œè®©äº§å“éš¾ä»¥è§„åˆ’ã€æ„å»ºå’Œæµ‹è¯•ã€‚â€<br>â€”â€”Ray Ozzie,å¾®è½¯å…¬å¸é¦–å¸­æŠ€æœ¯å®˜</p><h3 id="ä¾èµ–æ³¨å…¥"><a href="#ä¾èµ–æ³¨å…¥" class="headerlink" title="ä¾èµ–æ³¨å…¥"></a>ä¾èµ–æ³¨å…¥</h3><p>åœ¨ä¾èµ–ç®¡ç†æƒ…æ™¯ä¸­ï¼Œå¯¹è±¡ä¸åº”è´Ÿè´£å®ä½“åŒ–å¯¹è‡ªèº«çš„ä¾èµ–ã€‚åä¹‹ï¼Œå®ƒåº”å½“å°†è¿™ä»½æƒè´£ç§»äº¤ç»™å…¶ä»–â€œæœ‰æƒåŠ›â€çš„æœºåˆ¶ï¼Œä»è€Œå®ç°æ§åˆ¶çš„åè½¬ã€‚å› ä¸ºåˆå§‹è®¾ç½®æ˜¯ä¸€ç§å…¨å±€é—®é¢˜ï¼Œè¿™ç§æˆæƒæœºåˆ¶é€šå¸¸è¦ä¹ˆæ˜¯mainä¾‹ç¨‹ï¼Œè¦ä¹ˆæ˜¯æœ‰ç‰¹å®šç›®çš„çš„å®¹å™¨ã€‚</p><h3 id="æ‰©å®¹"><a href="#æ‰©å®¹" class="headerlink" title="æ‰©å®¹"></a>æ‰©å®¹</h3><blockquote><p>â€œä¸€å¼€å§‹å°±åšå¯¹ç³»ç»Ÿâ€çº¯å±ç¥è¯ã€‚</p></blockquote><h3 id="ä»£ç†"><a href="#ä»£ç†" class="headerlink" title="ä»£ç†"></a>ä»£ç†</h3><p>AOPæœ‰æ—¶ä¼šä¸å®ç°å®ƒçš„æŠ€æœ¯ç›¸æ··æ·†ï¼Œä¾‹å¦‚æ–¹æ³•æ‹¦æˆªå’Œé€šè¿‡ä»£ç†åšçš„â€œå°åŒ…â€ã€‚AOPç³»ç»Ÿçš„çœŸæ­£ä»·å€¼åœ¨äºç”¨ç®€æ´å’Œæ¨¡å—åŒ–çš„æ–¹å¼æŒ‡å®šç³»ç»Ÿè¡Œä¸ºã€‚</p><h2 id="å¹¶å‘ç¼–ç¨‹"><a href="#å¹¶å‘ç¼–ç¨‹" class="headerlink" title="å¹¶å‘ç¼–ç¨‹"></a>å¹¶å‘ç¼–ç¨‹</h2><p>å¹¶å‘ç¼–ç¨‹å¾ˆéš¾ï¼Œéå¸¸éš¾ã€‚å¦‚æœä½ ä¸é‚£ä¹ˆç»†<br>å¿ƒï¼Œå°±ä¼šæå‡ºä¸å ªå…¥ç›®çš„ä¸œè¥¿æ¥ã€‚çœ‹çœ‹ä»¥ä¸‹å¸¸è§çš„è¿·æ€å’Œè¯¯è§£ï¼š</p><ul><li><p>å¹¶å‘æ€»èƒ½æ”¹è¿›æ€§èƒ½<br>å¹¶å‘æœ‰æ—¶èƒ½æ”¹è¿›æ€§èƒ½ï¼Œä½†åªåœ¨å¤šä¸ªçº¿ç¨‹æˆ–å¤„ç†å™¨ä¹‹é—´èƒ½åˆ†äº«å¤§é‡ç­‰å¾…æ—¶é—´çš„æ—¶å€™ç®¡ç”¨ã€‚<br>äº‹æƒ…æ²¡é‚£ä¹ˆç®€å•ã€‚</p></li><li><p>ç¼–å†™å¹¶å‘ç¨‹åºæ— éœ€ä¿®æ”¹è®¾è®¡<br>äº‹å®ä¸Šï¼Œå¹¶å‘ç®—æ³•çš„è®¾è®¡æœ‰å¯èƒ½ä¸å•çº¿ç¨‹ç³»ç»Ÿçš„è®¾è®¡æä¸ç›¸åŒã€‚ç›®çš„ä¸æ—¶æœºçš„è§£è—•å¾€å¾€å¯¹ç³»ç»Ÿç»“æ„äº§ç”Ÿå·¨å¤§å½±å“ã€‚</p></li><li><p>åœ¨é‡‡ç”¨Webæˆ–EJBå®¹å™¨çš„æ—¶å€™ï¼Œç†è§£å¹¶å‘é—®é¢˜å¹¶ä¸é‡è¦<br>å®é™…ä¸Šï¼Œä½ æœ€å¥½äº†è§£å®¹å™¨åœ¨åšä»€ä¹ˆï¼Œäº†è§£å¦‚ä½•å¯¹ä»˜æœ¬ç« åæ–‡å°†æåˆ°çš„å¹¶å‘æ›´æ–°ã€æ­»é”ç­‰é—®é¢˜ã€‚</p></li></ul><p>ä¸‹é¢æ˜¯ä¸€äº›æœ‰å…³ç¼–å†™å¹¶å‘è½¯ä»¶çš„ä¸­è‚¯è¯´æ³•ï¼š</p><ul><li>å¹¶å‘ä¼šåœ¨æ€§èƒ½å’Œç¼–å†™é¢å¤–ä»£ç ä¸Šå¢åŠ ä¸€äº›å¼€é”€ï¼›</li><li>æ­£ç¡®çš„å¹¶å‘æ˜¯å¤æ‚çš„ï¼Œå³ä¾¿å¯¹äºç®€å•çš„é—®é¢˜ä¹Ÿæ˜¯å¦‚æ­¤ï¼›<br>å¹¶å‘ç¼ºé™·å¹¶éæ€»èƒ½é‡ç°ï¼Œæ‰€ä»¥å¸¸è¢«çœ‹åšå¶å‘äº‹ä»¶è€Œå¿½ç•¥ï¼Œæœªè¢«å½“åšçœŸçš„ç¼ºé™·çœ‹å¾…ï¼›</li><li>å¹¶å‘å¸¸å¸¸éœ€è¦å¯¹è®¾è®¡ç­–ç•¥çš„æ ¹æœ¬æ€§ä¿®æ”¹ã€‚</li></ul><h2 id="å‘³é“å»ºè®®"><a href="#å‘³é“å»ºè®®" class="headerlink" title="å‘³é“å»ºè®®"></a>å‘³é“å»ºè®®</h2><h3 id="å‘½åå¸¸é‡ä»£æ›¿é­”æœ¯æ•°"><a href="#å‘½åå¸¸é‡ä»£æ›¿é­”æœ¯æ•°" class="headerlink" title="å‘½åå¸¸é‡ä»£æ›¿é­”æœ¯æ•°"></a>å‘½åå¸¸é‡ä»£æ›¿é­”æœ¯æ•°</h3><h3 id="å‡†ç¡®"><a href="#å‡†ç¡®" class="headerlink" title="å‡†ç¡®"></a>å‡†ç¡®</h3><ul><li>ç”¨æµ®ç‚¹æ•°è¡¨ç¤ºè´§å¸å‡ è¿‘äºçŠ¯ç½ªã€‚</li><li>å› ä¸ºä½ ä¸æƒ³åšå¹¶å‘æ›´æ–°å°±é¿å…ä½¿ç”¨é”å’Œ/æˆ–äº‹åŠ¡ç®¡ç†å¾€å¥½å¤„è¯´ä¹Ÿæ˜¯ä¸€ç§æ‡’æƒ°è¡Œä¸ºã€‚åœ¨ä»£ç ä¸­åšå†³å®šæ—¶ï¼Œç¡®è®¤è‡ªå·±è¶³å¤Ÿå‡†ç¡®ã€‚</li><li>æ˜ç¡®è‡ªå·±ä¸ºä½•è¦è¿™ä¹ˆåšï¼Œå¦‚æœé‡åˆ°å¼‚å¸¸æƒ…å†µå¦‚ä½•å¤„ç†ã€‚</li><li>åˆ«æ‡’å¾—ç†ä¼šå†³å®šçš„å‡†ç¡®æ€§ã€‚å¦‚æœä½ æ‰“ç®—è°ƒç”¨å¯èƒ½è¿”å›nullçš„å‡½æ•°ï¼Œç¡®è®¤è‡ªå·±æ£€æŸ¥äº†nullå€¼ã€‚</li><li>å¦‚æœæŸ¥è¯¢ä½ è®¤ä¸ºæ˜¯æ•°æ®åº“ä¸­å”¯ä¸€çš„è®°å½•ï¼Œç¡®ä¿ä»£ç æ£€æŸ¥ä¸å­˜åœ¨å…¶ä»–è®°å½•ã€‚</li><li>å¦‚æœè¦å¤„ç†è´§å¸æ•°æ®ï¼Œä½¿ç”¨æ•´æ•°ï¼å¹¶æ°å½“åœ°å¤„ç†å››èˆäº”å…¥ã€‚</li><li>å¦‚æœå¯èƒ½æœ‰å¹¶å‘æ›´æ–°ï¼Œç¡®è®¤ä½ å®ç°äº†æŸç§é”å®šæœºåˆ¶ã€‚</li><li>ä»£ç ä¸­çš„å«ç³Šå’Œä¸å‡†ç¡®è¦ä¹ˆæ˜¯æ„è§ä¸åŒçš„ç»“æœï¼Œè¦ä¹ˆæºäºæ‡’æƒ°ã€‚æ— è®ºåŸå› æ˜¯ä»€ä¹ˆï¼Œéƒ½è¦æ¶ˆé™¤ã€‚</li></ul><h3 id="è¿”å›å¼‚å¸¸"><a href="#è¿”å›å¼‚å¸¸" class="headerlink" title="è¿”å›å¼‚å¸¸"></a>è¿”å›å¼‚å¸¸</h3><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">/**  *   * @param array $awbnos  * @throws Exception|ConnectionTimeOutException  * @return array Description  */</span> <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">fetchTrace</span><span class="token punctuation">(</span><span class="token keyword type-hint">array</span> <span class="token variable">$awbnos</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword return-type">array</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span></code></pre><p>php åˆ©ç”¨ phpdoc å’Œ php7 ç‰¹æ€§èƒ½æ”¯æŒè®©è°ƒç”¨è€…æ³¨æ„å¼‚å¸¸å’Œè¿”å›å€¼çš„æ­£ç¡®å¤„ç†ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></code></pre><p>java å‡½æ•°å®šä¹‰è¯­æ³•å¤©ç”Ÿæ”¯æŒã€‚</p><h3 id="é¿å…è¿‡å¤šåµŒå¥—"><a href="#é¿å…è¿‡å¤šåµŒå¥—" class="headerlink" title="é¿å…è¿‡å¤šåµŒå¥—"></a>é¿å…è¿‡å¤šåµŒå¥—</h3><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210729173311.png" alt=""></p><h2 id="åŸºæœ¬æ³•"><a href="#åŸºæœ¬æ³•" class="headerlink" title="åŸºæœ¬æ³•"></a>åŸºæœ¬æ³•</h2><ul><li>å•ä¸€èŒè´£ï¼Œè´¯å½»è½å®</li><li>çŸ­ã€å°‘ï¼Œç±»1000è¡Œï¼Œæ–¹æ³•120è¡Œï¼Œå‚æ•°3ä¸ªï¼Œä¸¥æ ¼è¦æ±‚ã€‚</li><li>æ¶ˆç­mess,æœ‰1ä¸ªå°±ä¼šæœ‰æ— æ•°ä¸ª</li><li>Later equals never ç¨åç­‰äºæ°¸ä¸ï¼Œåˆ«ç­‰ç°åœ¨å°±å»åš</li><li>æ‰“ç£¨ï¼Œåˆ†è§£å‡½æ•°ã€ä¿®æ”¹åç§°ã€æ¶ˆé™¤é‡å¤ã€‚ç¼©çŸ­å’Œé‡æ–°å®‰ç½®æ–¹æ³•ã€‚æœ‰æ‹†æ•£ç±»ã€‚åŒæ—¶ä¿æŒæµ‹è¯•é€šè¿‡ã€‚<code>ä¿æŒé‡æ„ã€çƒ­çˆ±é‡æ„ã€æ³¨æ„å•å…ƒæµ‹è¯•å›å½’æµ‹è¯•</code></li></ul><h2 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h2><ol><li>ã€ŠClean Codeã€‹</li><li><a href="http://kaelzhang81.github.io/2020/04/10/%E8%AF%91-%E8%AE%BE%E8%AE%A1%E9%AB%98%E8%B4%A8%E9%87%8F%E8%BD%AF%E4%BB%B6/">http://kaelzhang81.github.io/2020/04/10/è¯‘-è®¾è®¡é«˜è´¨é‡è½¯ä»¶/</a></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> æŠ€æœ¯å·¥ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ©ç”¨PHPMDè®©ä½ çš„phpä»£ç æ›´å¹²å‡€æ›´æ˜“ç»´æŠ¤</title>
      <link href="2021/07/27/php/%E5%88%A9%E7%94%A8PHPMD%E8%AE%A9%E4%BD%A0%E7%9A%84php%E4%BB%A3%E7%A0%81%E6%9B%B4%E5%B9%B2%E5%87%80%E6%9B%B4%E6%98%93%E7%BB%B4%E6%8A%A4/"/>
      <url>2021/07/27/php/%E5%88%A9%E7%94%A8PHPMD%E8%AE%A9%E4%BD%A0%E7%9A%84php%E4%BB%A3%E7%A0%81%E6%9B%B4%E5%B9%B2%E5%87%80%E6%9B%B4%E6%98%93%E7%BB%B4%E6%8A%A4/</url>
      
        <content type="html"><![CDATA[<p>PHPMD - PHP Mess Detector</p><p>ç­‰ä»·äºjavaå·¥å…·PMDï¼Œèƒ½å¤Ÿå¯¹php æºä»£ç è¿›è¡Œå¦‚ä¸‹é—®é¢˜æ£€æµ‹ï¼š</p><ul><li>å¯èƒ½çš„bug</li><li>æ¬ ä½³çš„ä»£ç </li><li>è¿‡äºå¤æ‚çš„è¡¨è¾¾å¼</li><li>æœªä½¿ç”¨çš„æ–¹æ³•ã€å˜é‡ã€å‚æ•°ã€å±æ€§</li></ul><p>æœ€æ–°ç‰ˆæœ¬å‘å¸ƒäº 2021/05/11</p><span id="more"></span><p><a href="https://phpmd.org/about.html">https://phpmd.org/about.html</a></p><h2 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h2><pre class="language-shell" data-language="shell"><code class="language-shell">phpmd /path/to/source text codesize</code></pre><ul><li>ç¬¬ä¸€ä¸ªå‚æ•° è¦æ£€æµ‹çš„ä»£ç åœ°å€</li><li>ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šè¾“å‡ºæ£€æµ‹ç»“æœçš„æ ¼å¼</li><li>ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯æŒ‡å®šçš„è§„åˆ™é›†</li></ul><h2 id="è§„åˆ™é›†åˆ"><a href="#è§„åˆ™é›†åˆ" class="headerlink" title="è§„åˆ™é›†åˆ"></a>è§„åˆ™é›†åˆ</h2><ul><li><code>Clean Code</code>: ä¸€äº›åŒ…å«clean codeçš„è§„åˆ™é›†åˆï¼ŒåŒ…æ‹¬é¢å‘å¯¹è±¡è®¾è®¡çš„ SOLIDï¼ˆå•ä¸€åŠŸèƒ½ã€å¼€é—­åŸåˆ™ã€é‡Œæ°æ›¿æ¢ã€æ¥å£éš”ç¦»ä»¥åŠä¾èµ–åè½¬ï¼‰åŸåˆ™ã€‚</li><li><code>Code Size</code> : æœ‰å…³ä»£ç å¤§å°çš„ç›¸å…³é—®é¢˜ï¼Œä¾‹å¦‚è¡Œæ•°ç­‰</li><li><code>Controversial</code> : å…·æœ‰äº‰è®®çš„è§„åˆ™ï¼Œå¯ä»¥ä¸å‚è€ƒæ­¤è§„åˆ™</li><li><code>Design</code> ï¼š è®¾è®¡è§„åˆ™ï¼ŒåŒ…å«ç±»ä¾èµ–æ•°é‡ç­‰ç­‰</li><li><code>Naming</code>: å‘½åè§„åˆ™</li><li><code>Unused Code</code>: æœªä½¿ç”¨ä»£ç è§„åˆ™</li></ul><p>å…³äº<code>clean code</code> æœ‰ä¸€æœ¬ä¹¦åå°±å« &lt;&lt; Clean Code &gt;&gt;,ä¸ªäººè¯»ä¸‹æ¥æ„Ÿå—é¢‡æ·±ã€‚ </p><p>è¿™é‡Œä¸»è¦ä»‹ç»ä¸€äº›æˆ‘è®¤ä¸ºéå¸¸æœ‰å¿…è¦æ³¨æ„çš„è§„åˆ™</p><h2 id="Clean-Code"><a href="#Clean-Code" class="headerlink" title="Clean Code"></a>Clean Code</h2><h3 id="BooleanArgumentFlag"><a href="#BooleanArgumentFlag" class="headerlink" title="BooleanArgumentFlag"></a>BooleanArgumentFlag</h3><p>å¸ƒå°”æ ‡å¿—å‚æ•°è¿åå•ä¸€è´£ä»»åŸåˆ™ï¼ˆSRPï¼‰,å¯ä»¥å°†æ­¤ç±»æ–¹æ³•ä¸€æ‹†ä¸ºäºŒã€‚</p><pre class="language-PHP" data-language="PHP"><code class="language-PHP">class Foo &#123;    public function drink($thirsty &#x3D; true) &#123;        if($thirsty)&#123;            &#x2F;&#x2F; å–2æ¯        &#125;else&#123;            &#x2F;&#x2F; å–ä¸€æ¯        &#125;    &#125;&#125;</code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Foo</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">drinkThirsty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token comment">// å–2æ¯</span>            <span class="token punctuation">&#125;</span>          <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">drinkUnThirsty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                   <span class="token comment">// å–2æ¯</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h3 id="ElseExpression"><a href="#ElseExpression" class="headerlink" title="ElseExpression"></a>ElseExpression</h3><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Foo</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">bar</span><span class="token punctuation">(</span><span class="token variable">$flag</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$flag</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// one branch</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// another branch</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>åƒè¿™æ ·çš„if elseçš„è¡¨è¾¾å¼å…¶å®æ˜¯æ²¡å¿…è¦çš„ï¼Œå¯é€šè¿‡ä¸‰å…ƒè¡¨è¾¾å¼ã€æ‹†åˆ†æ–¹æ³•æˆ–è€…å¯èƒ½çš„æƒ…å†µä¸‹å…ˆreturnæ¥è§„é¿è¿™ç±»é—®é¢˜ï¼Œä»¥å°†ä»£ç ç®€å•æˆ–å¢åŠ å¯è¯»æ€§ã€‚</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Foo</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">bar</span><span class="token punctuation">(</span><span class="token variable">$flag</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$flag</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// one branch</span>            <span class="token keyword">return</span>        <span class="token punctuation">&#125;</span>         <span class="token comment">// another branch</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h2 id="Code-Size"><a href="#Code-Size" class="headerlink" title="Code Size"></a>Code Size</h2><h3 id="CyclomaticComplexity"><a href="#CyclomaticComplexity" class="headerlink" title="CyclomaticComplexity"></a>CyclomaticComplexity</h3><p>åœˆå¤æ‚åº¦ï¼Œç”¨æ¥è¡¡é‡ä»£ç å¤æ‚åº¦çš„ä¸€ä¸ªè®¡ç®—è§„åˆ™ã€‚å¤æ‚åº¦è¶Šé«˜ä»£è¡¨ä»£ç å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§è¶Šå·®ï¼Œæ˜“é”™æ€§æ›´é«˜ã€é›†æˆæµ‹è¯•æ›´éš¾ã€‚</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210727111045.png" alt=""></p><h4 id="ç‚¹è¾¹è®¡ç®—æ³•"><a href="#ç‚¹è¾¹è®¡ç®—æ³•" class="headerlink" title="ç‚¹è¾¹è®¡ç®—æ³•"></a>ç‚¹è¾¹è®¡ç®—æ³•</h4><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210727110713.png" alt=""></p><p>ä¸Šè¿°è¡¨è¾¾å¼çš„åœˆå¤æ‚åº¦ä¸º e = 10 n = 8 Cyclomatic Complexity = 10 - 8 + 2 = 4</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210727111603.png" alt=""></p><p>è®¡ç®—å…¬å¼ä¸ºï¼š</p><p>V(G) = E - N + 2</p><p>å…¶ä¸­ï¼Œeè¡¨ç¤ºæ§åˆ¶æµå›¾ä¸­è¾¹çš„æ•°é‡ï¼Œnè¡¨ç¤ºæ§åˆ¶æµå›¾ä¸­èŠ‚ç‚¹çš„æ•°é‡ã€‚</p><p>æ›´å¤šå¯å‚è€ƒ <a href="http://kaelzhang81.github.io/2017/06/18/%E8%AF%A6%E8%A7%A3%E5%9C%88%E5%A4%8D%E6%9D%82%E5%BA%A6/">http://kaelzhang81.github.io/2017/06/18/è¯¦è§£åœˆå¤æ‚åº¦/</a></p><h3 id="ExcessiveMethodLength"><a href="#ExcessiveMethodLength" class="headerlink" title="ExcessiveMethodLength"></a>ExcessiveMethodLength</h3><p>æ–¹æ³•é•¿åº¦ï¼Œè¯¥è§„åˆ™æœ‰2ä¸ªå±æ€§</p><p>minimum æœ€å°é™å®šå€¼ é»˜è®¤ 100</p><p>ignore-whitespace æ˜¯å¦å¿½ç•¥ç©ºç™½è¡Œ é»˜è®¤ false</p><h3 id="ExcessiveClassLength"><a href="#ExcessiveClassLength" class="headerlink" title="ExcessiveClassLength"></a>ExcessiveClassLength</h3><p>ç±»é•¿åº¦</p><p>minimum æœ€å°é™å®šå€¼ é»˜è®¤ 1000</p><p>ignore-whitespace æ˜¯å¦å¿½ç•¥ç©ºç™½è¡Œ é»˜è®¤ false</p><h3 id="ExcessiveParameterList"><a href="#ExcessiveParameterList" class="headerlink" title="ExcessiveParameterList"></a>ExcessiveParameterList</h3><p>å‚æ•°ä¸ªæ•°é™å®š</p><p>minimum 10ï¼Œæ ¹æ®ã€Šclean codeã€‹ä¸€ä¹¦çš„è¯´æ³•ï¼Œè¿™ä¸ªå€¼åº”è¯¥é™å®šä¸º3</p><h3 id="ExcessivePublicCount"><a href="#ExcessivePublicCount" class="headerlink" title="ExcessivePublicCount"></a>ExcessivePublicCount</h3><p>å…¬å…±æ–¹æ³•ã€å…¬å…±å±æ€§</p><p>minimum    45</p><h3 id="TooManyFields"><a href="#TooManyFields" class="headerlink" title="TooManyFields"></a>TooManyFields</h3><p>maxfields    15</p><h3 id="TooManyMethods"><a href="#TooManyMethods" class="headerlink" title="TooManyMethods"></a>TooManyMethods</h3><p>maxmethods    25<br>ignorepattern    (^(set|get))i</p><h3 id="TooManyPublicMethods"><a href="#TooManyPublicMethods" class="headerlink" title="TooManyPublicMethods"></a>TooManyPublicMethods</h3><p>maxmethods    10    The method count reporting threshold<br>ignorepattern    (^(set|get))i</p><h2 id="è‡ªå®šä¹‰è§„åˆ™"><a href="#è‡ªå®šä¹‰è§„åˆ™" class="headerlink" title="è‡ªå®šä¹‰è§„åˆ™"></a>è‡ªå®šä¹‰è§„åˆ™</h2><p>æœ‰çš„é»˜è®¤è§„åˆ™ä¹Ÿè®¸å¹¶ä¸èƒ½æ»¡è¶³è‡ªèº«éœ€æ±‚éœ€åšèˆå¼ƒæˆ–ä¿®æ”¹ã€‚ä¾‹å¦‚å‡½æ•°å‚æ•°æ•°ï¼Œåœ¨ã€Šclean codeã€‹ä¸€ä¹¦ä¸­å®šä¹‰çš„æ˜¯æœ€å¤šä¸º3ï¼Œè€Œphpmdé»˜è®¤æŒ‡å®šçš„æ˜¯10. 10ä¸ªç¡®å®å·²ç»éå¸¸éš¾çœ‹äº†ï¼Œæƒ³è±¡ä½ å»è°ƒç”¨ä¸€ä¸ªæœ‰10ä¸ªå‚æ•°çš„å‡½æ•°ï¼Œä½ ä¸€å®šä¼šåæ§½æ‡µé€¼çš„ã€‚</p><p>å¥½åœ¨phpmdè¿™äº›éƒ½å¯ä»¥ä¿®æ”¹ï¼Œå¦‚ä¸‹ï¼š</p><ul><li>å¼•å…¥unusedcodeè§„åˆ™é›†</li><li>å¼•å…¥codesize,å¹¶æš‚æ—¶æ’é™¤<code>NPathComplexity</code>å’Œ<code>CyclomaticComplexity</code>è¿™ä¸¤ä¸ªç†è§£èµ·æ¥æœ‰ä¸€å®šå›°éš¾çš„è§„åˆ™ã€‚è¯šç„¶<code>CyclomaticComplexity</code>åœ¨åº¦é‡å¤æ‚åº¦ååˆ†æœ‰æ•ˆï¼Œä½†è‹¥ä½ çš„æ‰€æœ‰å‡½æ•°å·²ç»æ»¡è¶³<code>ExcessiveMethodLength</code>å·²ç»è¿›æ­¥å¾ˆå¤§äº†ï¼Œæ‰€ä»¥ä¸€æ­¥æ­¥æ¥ã€‚</li><li>ä¿®æ”¹ExcessiveParameterList,è®©é™å®šå€¼ä¸º3.</li><li>ä¿®æ”¹ExcessiveMethodLengthå’ŒExcessiveClassLength,å¿½ç•¥ç©ºç™½è¡Œ</li><li>æ’é™¤StaticAccessè§„åˆ™</li></ul><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ruleset</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>My first PHPMD rule set<span class="token punctuation">"</span></span>         <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://pmd.sf.net/ruleset/1.0.0<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://pmd.sf.net/ruleset/1.0.0                     http://pmd.sf.net/ruleset_xml_schema.xsd<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xsi:</span>noNamespaceSchemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>                     http://pmd.sf.net/ruleset_xml_schema.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">></span></span>        My custom rule set that checks my code...    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>rulesets/unusedcode.xml<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>rulesets/codesize.xml<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclude</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ExcessiveParameterList<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclude</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>NPathComplexity<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclude</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CyclomaticComplexity<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>rulesets/codesize.xml/ExcessiveParameterList<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>minimum<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>                    3                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>rulesets/codesize.xml/ExcessiveClassLength<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ignore-whitespace<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>                    true                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>rulesets/codesize.xml/ExcessiveMethodLength<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ignore-whitespace<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>                    true                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>rulesets/cleancode.xml<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclude</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>StaticAccess<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ruleset</span><span class="token punctuation">></span></span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç”¨phpunitè¿›è¡Œå•å…ƒæµ‹è¯•</title>
      <link href="2021/07/23/php/%E7%94%A8phpunit%E8%BF%9B%E8%A1%8C%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/"/>
      <url>2021/07/23/php/%E7%94%A8phpunit%E8%BF%9B%E8%A1%8C%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘è¯»äº†ä¸€æœ¬ä¹¦ã€Šclean codeã€‹ã€‚æ·±æœ‰æ„Ÿæ‚Ÿï¼Œæ„Ÿè§‰éå¸¸æ¥åº•æ°”ï¼Œè®²åˆ°äº†æ—¥å¸¸ç¼–ç ä¸­çœŸæ­£é‡åˆ°çš„å›°æ‰°ã€‚å¤§è‡´æˆ‘æ€»ç»“ä¸‹å°±æ˜¯è¦åšå‡ ä»¶äº‹ï¼š</p><ul><li>é‡æ„ï¼Œå®šæœŸé‡æ„ï¼Œä¿æŒé‡æ„</li><li>clean code,ç¼–å†™æ•´æ´ã€æ˜“ç»´æŠ¤çš„ä»£ç </li><li>å•å…ƒæµ‹è¯•</li></ul><p>æœ¬ç¯‡æˆ‘ä»¬è®²ä¸‹å¦‚ä½•åˆ©ç”¨phpunitè¿›è¡Œå•å…ƒæµ‹è¯•</p><span id="more"></span><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>è¿™é‡Œä¸»è¦è¯´æ˜ä¸‹å®‰è£…çš„ç‰ˆæœ¬é—®é¢˜ï¼Œæœ€æ–°ç‰ˆphpunit-latestç›®å‰ä¾èµ–php7.4. ä½†æ˜¯æˆ‘ä»¬çº¿ä¸Šç‰ˆæœ¬ä»ç„¶æ˜¯php7.2,å› æ­¤æˆ‘ä»¬éœ€è¦å®‰è£…æ—§çš„ç‰ˆæœ¬.</p><p><a href="https://phpunit.de/announcements/phpunit-8.html">https://phpunit.de/announcements/phpunit-8.html</a>  ä»è¿™ä¸ªé“¾æ¥èƒ½æ‰¾åˆ°phpunit-8ã€‚</p><p>å®‰è£…çš„æ–¹å¼æœ‰2ç§ï¼Œ<code>PHAR</code> å’Œ <code>composer</code>ï¼Œä¸¤ç§æ–¹å¼éƒ½å¯ä»¥å…¨å±€å®‰è£…ã€‚</p><p><a href="https://phpunit.readthedocs.io/zh_CN/latest/installation.html#installation-requirements">https://phpunit.readthedocs.io/zh_CN/latest/installation.html#installation-requirements</a> å®˜æ–¹çš„æ•™ç¨‹æ–‡æ¡£é‡Œä¸æ¨èè¿›è¡Œå…¨å±€å®‰è£…ã€‚</p><blockquote><p>è¯·æ³¨æ„ï¼Œå¹¶ä¸æ¨èå…¨å±€å®‰è£… PHPUnitï¼Œæ¯”å¦‚è¯´æ”¾åœ¨ /usr/bin/phpunit æˆ– /usr/local/bin/phpunitã€‚<br>ç›¸åï¼ŒPHPUnit åº”è¯¥ä½œä¸ºé¡¹ç›®æœ¬åœ°ä¾èµ–é¡¹è¿›è¡Œç®¡ç†ã€‚</p></blockquote><p>ä½†æ˜¯æˆ‘è¿˜æ˜¯é€‰æ‹©å…¨å±€å®‰è£…ï¼Œå› ä¸ºä¸æƒ³å°†æœ¬åœ°å¤ªå¤šä¾èµ–ã€‚</p><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><h3 id="IDEæç¤º"><a href="#IDEæç¤º" class="headerlink" title="IDEæç¤º"></a>IDEæç¤º</h3><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">declare</span><span class="token punctuation">(</span>strict_types<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">PHPUnit<span class="token punctuation">\</span>Framework<span class="token punctuation">\</span>TestCase</span><span class="token punctuation">;</span><span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">RedisCacheTest</span> <span class="token keyword">extends</span> <span class="token class-name">TestCase</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">testSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span>    <span class="token punctuation">&#123;</span>       <span class="token variable">$res</span> <span class="token operator">=</span>  <span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>Hll<span class="token punctuation">\</span>Cache<span class="token punctuation">\</span>Cache</span><span class="token operator">::</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'foo'</span><span class="token punctuation">,</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Y-m-d H:i:s'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><p>è¿™æ˜¯æˆ‘çš„ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹è„šæœ¬ï¼Œæµ‹è¯•è„šæœ¬ç±»éœ€è¦ç»§æ‰¿<code>TestCase</code>.</p><p>ç”±äºæˆ‘çš„å®‰è£…æ–¹å¼å¹¶ä¸æ˜¯æœ¬åœ°é¡¹ç›®å®‰è£…ï¼Œæ‰€ä»¥åœ¨ideä¸ä¼šæç¤ºTestCaseçš„ç›¸å…³æ–¹æ³•ã€‚è¿™å¯¹äºæ¥è¯´æ˜¯ä¸èƒ½å®¹å¿çš„ï¼Œä¸è¿‡å¥½åœ¨IDEèƒ½é¢å¤–çš„é…ç½®å¼•å…¥é¡¹ç›®å¤–çš„æ–‡ä»¶è¿›è¡Œæç¤ºã€‚</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210723100857.png" alt=""></p><h3 id="å·¥ç¨‹ç›®å½•"><a href="#å·¥ç¨‹ç›®å½•" class="headerlink" title="å·¥ç¨‹ç›®å½•"></a>å·¥ç¨‹ç›®å½•</h3><p>å†æ¥çœ‹çœ‹å·¥ç¨‹ç›®å½•ç»“æ„</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210723101019.png" alt=""></p><p>åœ¨æˆ‘ç¼–å†™çš„ä¸€ä¸ª<code>cache</code>ç»„ä»¶åº“ä¸­</p><ul><li><code>src</code>ä½œä¸ºæºä»£ç ç›®å½•</li><li><code>tests</code>ä½œä¸ºæµ‹è¯•ç”¨ä¾‹ç›®å½•</li><li><code>bootstrap.php</code>æ˜¯phpunitçš„å¯åŠ¨åŠ è½½æ–‡ä»¶ï¼Œç”¨äºåšäº›å…¨å±€çš„åˆå§‹åŒ–åŠ¨ä½œï¼Œæ¯”å¦‚åŠ è½½autoload.</li></ul><h3 id="æ‰§è¡Œæµ‹è¯•"><a href="#æ‰§è¡Œæµ‹è¯•" class="headerlink" title="æ‰§è¡Œæµ‹è¯•"></a>æ‰§è¡Œæµ‹è¯•</h3><pre class="language-shell" data-language="shell"><code class="language-shell">phpunit --bootstrap tests/bootstrap.php --verbose tests/case </code></pre><p>è¯¥å‘½ä»¤æ˜¯æ‰§è¡Œæµ‹è¯• tests/caseä¸‹çš„æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹æ–‡ä»¶ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥å…·ä½“åˆ°åªæ‰§è¡Œå•ä¸ªæ–‡ä»¶ã€‚</p><p><code>--bootstrap</code></p><p>åŠ è½½å¯åŠ¨æ–‡ä»¶</p><p><code>--colors</code></p><p>å½©è‰²è¾“å‡º</p><p><code>--debug</code></p><p>è¾“å‡ºè°ƒè¯•ä¿¡æ¯ï¼Œä¾‹å¦‚å½“ä¸€ä¸ªæµ‹è¯•å¼€å§‹æ‰§è¡Œæ—¶è¾“å‡ºå…¶åç§°ã€‚</p><p><code>--testtox</code></p><p>ä»¥<code>testtox</code>æ ¼å¼æ˜¾ç¤ºæµ‹è¯•ç»“æœ</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210723102912.png" alt=""></p><p><code>--configuration</code>ã€<code>-c</code></p><p>ä» XML æ–‡ä»¶ä¸­è¯»å–é…ç½®ä¿¡æ¯ã€‚</p><p>å¦‚æœ<code>phpunit.xml</code> æˆ– <code>phpunit.xml.dist</code>ï¼ˆæŒ‰æ­¤é¡ºåºï¼‰å­˜åœ¨äºå½“å‰å·¥ä½œç›®å½•å¹¶ä¸”æœªä½¿ç”¨ <code>--configuration</code>ï¼Œå°†è‡ªåŠ¨ä»æ­¤æ–‡ä»¶ä¸­è¯»å–é…ç½®ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å­¦ä¹ ç¼–å†™phpæ‹“å±•</title>
      <link href="2021/07/07/php/%E5%AD%A6%E4%B9%A0%E7%BC%96%E5%86%99php%E6%8B%93%E5%B1%95/"/>
      <url>2021/07/07/php/%E5%AD%A6%E4%B9%A0%E7%BC%96%E5%86%99php%E6%8B%93%E5%B1%95/</url>
      
        <content type="html"><![CDATA[<h2 id="ç›®çš„"><a href="#ç›®çš„" class="headerlink" title="ç›®çš„"></a>ç›®çš„</h2><p><strong>ä¸ºä»€ä¹ˆè¦å­¦ä¹ ç¼–å†™phpæ‹“å±•ï¼Ÿ</strong></p><p>1.ç›®å‰å¸‚é¢ä¸Šæœ‰æ•°æ®åº“æˆ–ä¸­é—´ä»¶æ— phpé©±åŠ¨<br>2.æœ‰è‡ªå·±çš„å…¬å…±ç»„ä»¶æˆ–å‡½æ•°,è™½ç„¶å¯ä»¥ä½¿ç”¨composerï¼Œä¸ºäº†æå‡æ€§èƒ½æ›¿ä»£composeråŒ…<br>3.ä¸ºäº†å­¦ä¹ phpå†…æ ¸åŸç†æˆ–å…¶ä»–æ‹“å±•çš„å†…éƒ¨å®ç°åŸç†</p><h2 id="hello-world"><a href="#hello-world" class="headerlink" title="hello,world"></a>hello,world</h2><p><strong>1.æºç ä¸‹è½½</strong></p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">wget</span> https://www.php.net/distributions/php-7.2.19.tar.bz2<span class="token function">tar</span> -xvf php-7.2.19.tar.bz2</code></pre><p><strong>2.å¢åŠ å‡½æ•°å£°æ˜</strong></p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">vim</span> php_vison.h<span class="token comment"># åœ¨å…¶ä¸­å¢åŠ  PHP_FUNCTION(vison_print);</span><span class="token function">vim</span> vison.c<span class="token comment"># å°†å¦‚ä¸‹ä»£ç ä¸­çš„PHP_FEå’ŒPHP_FE_ENDä¸­åŠ å…¥ä¸‹é¢ä»£ç ï¼ˆè¿™çš„ä»£ç æ˜¯å°†å‡½æ•°æŒ‡é’ˆæ³¨å†Œåˆ°Zendå¼•æ“ï¼‰</span>PHP_FE<span class="token punctuation">(</span>vison_print,  NULL<span class="token punctuation">)</span></code></pre><p><strong>3.å‡½æ•°å®šä¹‰</strong></p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">vim</span> vison.cåœ¨æœ€ååŠ ä¸Šåˆ›å»ºæ‰§è¡Œæ–¹æ³•vison_print</code></pre><pre class="language-c" data-language="c"><code class="language-c"><span class="token function">PHP_FUNCTION</span><span class="token punctuation">(</span>vison_print<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token function">php_printf</span><span class="token punctuation">(</span><span class="token string">"Hello vison!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  RETURN_TRUE<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p><strong>4.ç¼–è¯‘</strong></p><pre class="language-none"><code class="language-none">phpize.&#x2F;configure &amp;&amp; make &amp;&amp; make install# ç„¶åå°†ç”Ÿæˆçš„vison.soæ”¾å…¥é…ç½®vim &#x2F;etc&#x2F;php.iniextension&#x3D;vison.so#ç„¶åè¾“å…¥php -mæŸ¥çœ‹é…ç½®</code></pre><p><strong>4.éªŒè¯</strong></p><pre class="language-shell" data-language="shell"><code class="language-shell">php -r <span class="token string">"vison_print();"</span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RabbitMQä»‹ç»å’Œåœºæ™¯ä½¿ç”¨</title>
      <link href="2021/06/25/RabbitMQ%E4%BB%8B%E7%BB%8D%E5%92%8C%E5%9C%BA%E6%99%AF%E4%BD%BF%E7%94%A8/"/>
      <url>2021/06/25/RabbitMQ%E4%BB%8B%E7%BB%8D%E5%92%8C%E5%9C%BA%E6%99%AF%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.1'</span><span class="token key atrule">services</span><span class="token punctuation">:</span>    <span class="token key atrule">rabbitmq-manger</span><span class="token punctuation">:</span>        <span class="token key atrule">image</span><span class="token punctuation">:</span> rabbitmq<span class="token punctuation">:</span>3<span class="token punctuation">-</span>management        <span class="token key atrule">restart</span><span class="token punctuation">:</span> always        <span class="token key atrule">ports</span><span class="token punctuation">:</span>          <span class="token punctuation">-</span> 5672<span class="token punctuation">:</span><span class="token number">5672</span>          <span class="token punctuation">-</span> 8091<span class="token punctuation">:</span><span class="token number">15672</span></code></pre><p>ä½¿ç”¨dockerè¿›è¡Œå¿«é€Ÿå®‰è£…</p><h2 id="å†å²"><a href="#å†å²" class="headerlink" title="å†å²"></a>å†å²</h2><ul><li>2007å¹´8æœˆï¼ŒRabbitå…¬å¸å‘è¡Œäº† RabbitMQ 1.1.0.</li><li>2009å¹´8æœˆï¼ŒVMwareå‡ºèµ„4.2äº¿ç¾å…ƒæ”¶è´­äº†SpringSource[9]ï¼Œå¹¶åœ¨ä¸€æ®µæ—¶é—´å†…ä½œä¸ºVMwareçš„ä¸€ä¸ªç‹¬ç«‹çš„éƒ¨é—¨ï¼›å…¬å¸åŸæœ‰çš„å•†ä¸šäº§å“ä»¥vFabricåº”ç”¨å¥—ä»¶åä¹‰å‘å”®ã€‚ä¹‹åSpringSourceåˆæ¥è¿æ”¶è´­äº†RabbitMQ[10]ã€Redis[11]å’ŒGemstone[12]ã€‚é™¤Rediså¤–ï¼Œå®ƒä»¬çš„äº§å“ä¹Ÿæˆä¸ºäº†vFabricåº”ç”¨å¥—ä»¶çš„ä¸€éƒ¨åˆ†ã€‚</li></ul><p>ä½ ä¼šå‘ç°ä¸€ä¸ªæœ‰è¶£è€Œè¯§å¼‚çš„äº‹å®ï¼ŒVMware å’Œ Spring ã€RabbitMQã€Redisè¿™äº›å¤§åé¼é¼çš„æŠ€æœ¯æ˜¯åŒå±ä¸€å®¶å…¬å¸ã€‚è€Œ è‘—åçš„ SpringèƒŒåçš„SpringSourceå…¬å¸ä¸»è¦ä»¥åŸ¹è®­å’Œå’¨è¯¢ç›ˆåˆ©ã€‚</p><span id="more"></span><h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210616101427.png" alt=""></p><blockquote><p>RabbitMQ is a message broker: it accepts and forwards messages. You can think about it as a post office: when you put the mail that you want posting in a post box, you can be sure that Mr. or Ms. Mailperson will eventually deliver the mail to your recipient. In this analogy, RabbitMQ is a post box, a post office and a postman.</p></blockquote><p>è¿™æ˜¯å®˜ç½‘æœ€å¼€å¤´çš„ä¸€æ®µä»‹ç»,è¿™é‡Œå°†RabbitMQç±»æ¯”ä¸ºé‚®å±€æ´¾ä¿¡åœºæ™¯ï¼ŒRabbitMQæ‰®æ¼”é‚®ç®±ã€é‚®å±€ã€é‚®å·®çš„è§’è‰²ã€‚è¿™é‡Œä¹Ÿçœ‹åˆ°äº† <code>broker</code> è¿™ä¸ªå•è¯ï¼ŒKafkaä¹Ÿæœ‰brokerè¿™ä¸ªæ¦‚å¿µï¼Œè¿™é‡Œæˆ‘ä»¬æš‚ä¸”å°†å®ƒç†è§£ä¸º<code>ä»£ç†</code>çš„æ„æ€ã€‚</p><h2 id="ç”Ÿäº§è€…-producer"><a href="#ç”Ÿäº§è€…-producer" class="headerlink" title="ç”Ÿäº§è€… producer"></a>ç”Ÿäº§è€… producer</h2><p>ç®€å•ç†è§£å°±æ˜¯å‘é€æ¶ˆæ¯çš„ç¨‹åº</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210618112249.png" alt=""></p><h2 id="æ¶ˆè´¹è€…-consumer"><a href="#æ¶ˆè´¹è€…-consumer" class="headerlink" title="æ¶ˆè´¹è€… consumer"></a>æ¶ˆè´¹è€… consumer</h2><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210618112407.png" alt=""></p><h2 id="é˜Ÿåˆ—-queue"><a href="#é˜Ÿåˆ—-queue" class="headerlink" title="é˜Ÿåˆ— queue"></a>é˜Ÿåˆ— queue</h2><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210618112446.png" alt=""></p><p>æ¶ˆæ¯å­˜å‚¨äºqueueå½“ä¸­ï¼Œå¤šä¸ªproducer å¯å¾€ä¸€ä¸ª queueå‘é€æ¶ˆæ¯</p><h2 id="äº¤æ¢æœº-Exchange"><a href="#äº¤æ¢æœº-Exchange" class="headerlink" title="äº¤æ¢æœº Exchange"></a>äº¤æ¢æœº Exchange</h2><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210618112856.png" alt=""></p><p>äº¤æ¢æœºæ˜¯ç”¨æ¥å‘é€æ¶ˆæ¯çš„AMQPå®ä½“ã€‚äº¤æ¢æœºæ‹¿åˆ°ä¸€ä¸ªæ¶ˆæ¯ä¹‹åå°†å®ƒè·¯ç”±ç»™ä¸€ä¸ªæˆ–é›¶ä¸ªé˜Ÿåˆ—ã€‚å®ƒä½¿ç”¨å“ªç§è·¯ç”±ç®—æ³•æ˜¯ç”±äº¤æ¢æœºç±»å‹å’Œè¢«ç§°ä½œç»‘å®šï¼ˆbindingsï¼‰çš„è§„åˆ™æ‰€å†³å®šçš„(è¿™ä¸ªåé¢ä¼šè®²åˆ°)ã€‚</p><p><strong>Exchange Type</strong></p><ul><li>direct  ç›´è¿ </li><li>fanout  æ‰‡å‡º</li><li>topic   ä¸»é¢˜</li><li>headers  å¤´</li></ul><p>é™¤äº¤æ¢æœºç±»å‹å¤–ï¼Œåœ¨å£°æ˜äº¤æ¢æœºæ—¶è¿˜å¯ä»¥é™„å¸¦è®¸å¤šå…¶ä»–çš„å±æ€§ï¼Œå…¶ä¸­æœ€é‡è¦çš„å‡ ä¸ªåˆ†åˆ«æ˜¯ï¼š</p><ul><li>Name</li><li>Durability ï¼ˆæ¶ˆæ¯ä»£ç†é‡å¯åï¼Œäº¤æ¢æœºæ˜¯å¦è¿˜å­˜åœ¨ï¼‰</li><li>Auto-delete ï¼ˆå½“æ‰€æœ‰ä¸ä¹‹ç»‘å®šçš„æ¶ˆæ¯é˜Ÿåˆ—éƒ½å®Œæˆäº†å¯¹æ­¤äº¤æ¢æœºçš„ä½¿ç”¨åï¼Œåˆ æ‰å®ƒï¼‰</li><li>Argumentsï¼ˆä¾èµ–ä»£ç†æœ¬èº«ï¼‰</li></ul><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">exchange_declare</span><span class="token punctuation">(</span>       <span class="token variable">$exchange</span><span class="token punctuation">,</span>       <span class="token variable">$type</span><span class="token punctuation">,</span>       <span class="token variable">$passive</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span>       <span class="token variable">$durable</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span>       <span class="token variable">$auto_delete</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>       <span class="token variable">$internal</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span>       <span class="token variable">$nowait</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span>       <span class="token variable">$arguments</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>       <span class="token variable">$ticket</span> <span class="token operator">=</span> <span class="token constant">null</span>   <span class="token punctuation">)</span></code></pre><p>æŒä¹…ï¼ˆdurableï¼‰ã€æš‚å­˜ï¼ˆtransientï¼‰ã€‚æŒä¹…åŒ–çš„äº¤æ¢æœºä¼šåœ¨æ¶ˆæ¯ä»£ç†ï¼ˆbrokerï¼‰é‡å¯åä¾æ—§å­˜åœ¨ï¼Œè€Œæš‚å­˜çš„äº¤æ¢æœºåˆ™ä¸ä¼šï¼ˆå®ƒä»¬éœ€è¦åœ¨ä»£ç†å†æ¬¡ä¸Šçº¿åé‡æ–°è¢«å£°æ˜ï¼‰ã€‚ç„¶è€Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„åº”ç”¨åœºæ™¯éƒ½éœ€è¦æŒä¹…åŒ–çš„äº¤æ¢æœºã€‚</p><p><strong>é»˜è®¤äº¤æ¢æœº</strong></p><p>é‚£å°±æ˜¯æ¯ä¸ªæ–°å»ºé˜Ÿåˆ—ï¼ˆqueueï¼‰éƒ½ä¼šè‡ªåŠ¨ç»‘å®šåˆ°é»˜è®¤äº¤æ¢æœºä¸Šï¼Œç»‘å®šçš„è·¯ç”±é”®ï¼ˆrouting keyï¼‰åç§°ä¸é˜Ÿåˆ—åç§°ç›¸åŒã€‚</p><p><strong>ç›´è¿äº¤æ¢æœº Direct</strong></p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210618113517.png" alt=""></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$channel</span><span class="token operator">-></span><span class="token function">queue_bind</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'hello_queue'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'hello_exchange'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'hello_key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š</p><ul><li>å°†ä¸€ä¸ªé˜Ÿåˆ—ç»‘å®šåˆ°æŸä¸ªäº¤æ¢æœºä¸Šï¼ŒåŒæ—¶èµ‹äºˆè¯¥ç»‘å®šä¸€ä¸ªè·¯ç”±é”®ï¼ˆrouting keyï¼‰</li><li>å½“ä¸€ä¸ªæºå¸¦ç€è·¯ç”±é”®ä¸ºhello_keyçš„æ¶ˆæ¯è¢«å‘é€ç»™ç›´è¿äº¤æ¢æœºhello_exchangeæ—¶ï¼Œäº¤æ¢æœºä¼šæŠŠå®ƒè·¯ç”±ç»™hello_queueçš„é˜Ÿåˆ—ã€‚</li></ul><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$channel</span><span class="token operator">-></span><span class="token function">basic_publish</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'hello_exchange'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'hello_key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210618113859.png" alt=""></p><p><strong>æ‰‡å½¢äº¤æ¢æœº  fanout</strong></p><p>æ‰‡å‹äº¤æ¢æœºï¼ˆfunout exchangeï¼‰å°†æ¶ˆæ¯è·¯ç”±ç»™ç»‘å®šåˆ°å®ƒèº«ä¸Šçš„æ‰€æœ‰é˜Ÿåˆ—ï¼Œè€Œä¸ç†ä¼šç»‘å®šçš„è·¯ç”±é”®ã€‚</p><p>å¦‚æœNä¸ªé˜Ÿåˆ—ç»‘å®šåˆ°æŸä¸ªæ‰‡å‹äº¤æ¢æœºä¸Šï¼Œå½“æœ‰æ¶ˆæ¯å‘é€ç»™æ­¤æ‰‡å‹äº¤æ¢æœºæ—¶ï¼Œäº¤æ¢æœºä¼šå°†æ¶ˆæ¯çš„æ‹·è´åˆ†åˆ«å‘é€ç»™è¿™æ‰€æœ‰çš„Nä¸ªé˜Ÿåˆ—ã€‚</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210618114009.png" alt=""></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">// RabbitFanoutProduce.php</span><span class="token variable">$faker</span> <span class="token operator">=</span> <span class="token class-name static-context">Factory</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'zh_CN'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$connection</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMQPStreamConnection</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'192.168.106.179'</span><span class="token punctuation">,</span> <span class="token number">5672</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'guest'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'guest'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// åˆ›å»ºé€šé“</span><span class="token variable">$channel</span> <span class="token operator">=</span> <span class="token variable">$connection</span><span class="token operator">-></span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$channel</span><span class="token operator">-></span><span class="token function">exchange_declare</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'test.fanout'</span><span class="token punctuation">,</span> <span class="token class-name static-context">AMQPExchangeType</span><span class="token operator">::</span><span class="token constant">FANOUT</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$body</span> <span class="token operator">=</span> <span class="token variable">$faker</span><span class="token operator">-></span><span class="token function">text</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMQPMessage</span><span class="token punctuation">(</span><span class="token variable">$body</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'delivery_mode'</span> <span class="token operator">=></span> <span class="token class-name static-context">AMQPMessage</span><span class="token operator">::</span><span class="token constant">DELIVERY_MODE_PERSISTENT</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$channel</span><span class="token operator">-></span><span class="token function">basic_publish</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'test.fanout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><code>RabbitFanoutProduce</code> ç”Ÿäº§è€…å®šä¹‰äº†ä¸€ä¸ª<code>test.fanout</code> äº¤æ¢æœºç±»å‹æ˜¯<code>AMQPExchangeType::FANOUT</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">// lmsConsoumer.php</span><span class="token variable">$connection</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMQPStreamConnection</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'192.168.106.179'</span><span class="token punctuation">,</span> <span class="token number">5672</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'guest'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'guest'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// åˆ›å»ºé€šé“</span><span class="token variable">$channel</span> <span class="token operator">=</span> <span class="token variable">$connection</span><span class="token operator">-></span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$channel</span><span class="token operator">-></span><span class="token function">queue_declare</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'test.lms'</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$channel</span><span class="token operator">-></span><span class="token function">queue_bind</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'test.lms'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'test.fanout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$callback</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">' [x] '</span><span class="token punctuation">,</span> <span class="token variable">$msg</span><span class="token operator">-></span><span class="token property">body</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token variable">$channel</span><span class="token operator">-></span><span class="token function">basic_consume</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'test.lms'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token variable">$callback</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token variable">$channel</span><span class="token operator">-></span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$channel</span><span class="token operator">-></span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p><code>lmsConsoumer</code> è®¢é˜…äº†ä¸€ä¸ª<code>test.lms</code>çš„é˜Ÿåˆ—å¹¶ç»‘å®šåˆ°<code>test.fanout</code>äº¤æ¢æœº</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">// omsConsoumer.php</span><span class="token variable">$connection</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMQPStreamConnection</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'192.168.106.179'</span><span class="token punctuation">,</span> <span class="token number">5672</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'guest'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'guest'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// åˆ›å»ºé€šé“</span><span class="token variable">$channel</span> <span class="token operator">=</span> <span class="token variable">$connection</span><span class="token operator">-></span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$channel</span><span class="token operator">-></span><span class="token function">queue_declare</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'test.oms'</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span><span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$channel</span><span class="token operator">-></span><span class="token function">queue_bind</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'test.oms'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'test.fanout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$callback</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">' [x] '</span><span class="token punctuation">,</span> <span class="token variable">$msg</span><span class="token operator">-></span><span class="token property">body</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token variable">$channel</span><span class="token operator">-></span><span class="token function">basic_consume</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'test.oms'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token variable">$callback</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token variable">$channel</span><span class="token operator">-></span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$channel</span><span class="token operator">-></span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p><code>omsConsoumer</code> è®¢é˜…äº†ä¸€ä¸ª<code>test.oms</code>çš„é˜Ÿåˆ—å¹¶ç»‘å®šåˆ°<code>test.fanout</code>äº¤æ¢æœº</p><p>ç¤ºä¾‹ä¸­æ¼”ç¤ºäº†ï¼Œä¸€ä¸ªç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯ç»™2ä¸ªç³»ç»Ÿè®¢é˜…æ¶ˆè´¹ã€‚</p><p>Fanout å…¸å‹çš„ä¸€ä¸ªåº”ç”¨åœºæ™¯æ˜¯å¤šä¸ªåº”ç”¨ç³»ç»Ÿè®¢é˜…ä¸€ä¸ªæ¶ˆæ¯äº‹ä»¶ã€‚</p><p>egï¼š å®¢æœç³»ç»Ÿã€è¿è¥ç³»ç»Ÿã€è´¢åŠ¡ç³»ç»ŸåŒæ—¶è®¢é˜…è®¢å•ç³»ç»Ÿçš„è®¢å•çŠ¶æ€å˜æ›´äº‹ä»¶ã€‚</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210618114806.png" alt=""></p><p>è¿™æ ·ä¸åŒç³»ç»Ÿéƒ½èƒ½å„è‡ªä½¿ç”¨å„è‡ªçš„é˜Ÿåˆ—å¤„ç†è®¢å•çš„å˜æ›´ä¸šåŠ¡é€»è¾‘ã€‚</p><p>ç»†åŒ–ä¸‹åœºæ™¯ä¸¾ä¸ªä¾‹å­ï¼š</p><p>å½“è®¢å•å®Œç»“ order close:</p><ul><li>å®¢æœç³»ç»Ÿéœ€è¦ç»™å®¢æˆ·å‘é€ä¸€ä¸ªå®¢æˆ·æ»¡æ„åº¦è°ƒæŸ¥</li><li>è¿è¥ç³»ç»Ÿéœ€è¦å‘é€ä¸€å¼ æŒ‰è®¢å•æ¶ˆè´¹é‡‘é¢é…æ¯”çš„ä¼˜æƒ åˆ¸</li><li>è´¢åŠ¡ç³»ç»Ÿéœ€è¦è®¡ç®—è¿™ç¬”è®¢å•çš„å…¥è´¦</li></ul><p><strong>ä¸»é¢˜äº¤æ¢æœº topic</strong></p><p>ä¸»é¢˜äº¤æ¢æœºï¼ˆtopic exchangesï¼‰é€šè¿‡å¯¹æ¶ˆæ¯çš„è·¯ç”±é”®å’Œé˜Ÿåˆ—åˆ°äº¤æ¢æœºçš„ç»‘å®šæ¨¡å¼ä¹‹é—´çš„åŒ¹é…ï¼Œå°†æ¶ˆæ¯è·¯ç”±ç»™ä¸€ä¸ªæˆ–å¤šä¸ªé˜Ÿåˆ—ã€‚</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210618114944.png" alt=""></p><p>topicæœ‰ç‚¹ç±»ä¼¼ directå’Œfanoutçš„ç»“åˆä½“ï¼Œå³å¯ä»¥å¹¿æ’­åˆå¯ä»¥æŒ‰ä¸€å®šè§„åˆ™æŒ‡å®š route.</p><p>ä¸Šé¢ç¤ºä¾‹å›¾æ¡ˆä¾‹ï¼š</p><ul><li>è¿™æ˜¯ä¸€ä¸ªå…³äºåŠ¨ç‰©çš„æ¶ˆæ¯æ¶ˆè´¹ç¨‹åº</li><li>æœ‰å…³orangeçš„åŠ¨ç‰©å°†è¿›å…¥Q1 ï¼Œä¾‹å¦‚ fast.orange.pig å¿«é€Ÿçš„æ©™è‰²çŒª</li><li>æœ‰å…³ rabbit å’Œ lazy çš„åŠ¨ç‰©å°†è¿›å…¥ Q2 ï¼Œä¾‹å¦‚ lazy.green.rabbit æˆ– lazy.yellow.monkey</li><li>å¦‚æœåŒ¹é…å¤šä¸ªæ¨¡å¼åˆ™è¿›å…¥å¤šä¸ªç›¸åº”çš„é˜Ÿåˆ—ï¼Œä¾‹å¦‚ lazy.orange.monkey åˆ™ä¼šè¿›å…¥Q1å’ŒQ2</li></ul><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$faker</span> <span class="token operator">=</span> <span class="token class-name static-context">Factory</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'zh_CN'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$connection</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMQPStreamConnection</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'192.168.106.179'</span><span class="token punctuation">,</span> <span class="token number">5672</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'guest'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'guest'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// åˆ›å»ºé€šé“</span><span class="token variable">$channel</span> <span class="token operator">=</span> <span class="token variable">$connection</span><span class="token operator">-></span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$channel</span><span class="token operator">-></span><span class="token function">exchange_declare</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'test.topic'</span><span class="token punctuation">,</span> <span class="token class-name static-context">AMQPExchangeType</span><span class="token operator">::</span><span class="token constant">TOPIC</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$channel</span><span class="token operator">-></span><span class="token function">queue_declare</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Q1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$channel</span><span class="token operator">-></span><span class="token function">queue_declare</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Q2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$channel</span><span class="token operator">-></span><span class="token function">queue_bind</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Q1'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'test.topic'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'*.orange.*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$channel</span><span class="token operator">-></span><span class="token function">queue_bind</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Q2'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'test.topic'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'*.*.rabbit'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$channel</span><span class="token operator">-></span><span class="token function">queue_bind</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Q2'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'test.topic'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'lazy.#'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$body</span> <span class="token operator">=</span> <span class="token variable">$faker</span><span class="token operator">-></span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMQPMessage</span><span class="token punctuation">(</span><span class="token variable">$body</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'delivery_mode'</span> <span class="token operator">=></span> <span class="token class-name static-context">AMQPMessage</span><span class="token operator">::</span><span class="token constant">DELIVERY_MODE_PERSISTENT</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$channel</span><span class="token operator">-></span><span class="token function">basic_publish</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'test.topic'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'fast.orange.pig'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$channel</span><span class="token operator">-></span><span class="token function">basic_publish</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'test.topic'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'lazy.green.rabbit'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$channel</span><span class="token operator">-></span><span class="token function">basic_publish</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'test.topic'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'lazy.orange.monkey'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210618115131.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°3ä¸ªæ¶ˆæ¯ï¼Œå‘é€åˆ°äº†2ä¸ªé˜Ÿåˆ—ã€‚Q1å’ŒQ2å„æœ‰2ä¸ªï¼Œå› ä¸ºlazy.orange.monkeyè¿›å…¥äº†2ä¸ªé˜Ÿåˆ—ã€‚</p><p><strong>å¤´äº¤æ¢æœº header</strong></p><p>æœ‰æ—¶æ¶ˆæ¯çš„è·¯ç”±æ“ä½œä¼šæ¶‰åŠåˆ°å¤šä¸ªå±æ€§ï¼Œæ­¤æ—¶ä½¿ç”¨æ¶ˆæ¯å¤´å°±æ¯”ç”¨è·¯ç”±é”®æ›´å®¹æ˜“è¡¨è¾¾ï¼Œå¤´äº¤æ¢æœºï¼ˆheaders exchangeï¼‰å°±æ˜¯ä¸ºæ­¤è€Œç”Ÿçš„ã€‚å¤´äº¤æ¢æœºä½¿ç”¨å¤šä¸ªæ¶ˆæ¯å±æ€§æ¥ä»£æ›¿è·¯ç”±é”®å»ºç«‹è·¯ç”±è§„åˆ™ã€‚é€šè¿‡åˆ¤æ–­æ¶ˆæ¯å¤´çš„å€¼èƒ½å¦ä¸æŒ‡å®šçš„ç»‘å®šç›¸åŒ¹é…æ¥ç¡®ç«‹è·¯ç”±è§„åˆ™ã€‚</p><p>å®ƒæä¾›æ›´å¤šçš„åŒ¹é…ï¼Œå¯è®¾ç½®x-match ä¸ºany æˆ–all æ¥æ§åˆ¶æ˜¯ä»»æ„åŒ¹é…è¿˜æ˜¯å…¨éƒ¨åŒ¹é…ã€‚</p><h3 id="é˜Ÿåˆ—-queue-1"><a href="#é˜Ÿåˆ—-queue-1" class="headerlink" title="é˜Ÿåˆ— queue"></a>é˜Ÿåˆ— queue</h3><p>AMQPä¸­çš„é˜Ÿåˆ—ï¼ˆqueueï¼‰è·Ÿå…¶ä»–æ¶ˆæ¯é˜Ÿåˆ—æˆ–ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„é˜Ÿåˆ—æ˜¯å¾ˆç›¸ä¼¼çš„ï¼šå®ƒä»¬å­˜å‚¨ç€å³å°†è¢«åº”ç”¨æ¶ˆè´¹æ‰çš„æ¶ˆæ¯ã€‚é˜Ÿåˆ—è·Ÿäº¤æ¢æœºå…±äº«æŸäº›å±æ€§ï¼Œä½†æ˜¯é˜Ÿåˆ—ä¹Ÿæœ‰ä¸€äº›å¦å¤–çš„å±æ€§ã€‚</p><ul><li>Name</li><li>Durableï¼ˆæ¶ˆæ¯ä»£ç†é‡å¯åï¼Œé˜Ÿåˆ—ä¾æ—§å­˜åœ¨ï¼‰</li><li>Exclusiveï¼ˆåªè¢«ä¸€ä¸ªè¿æ¥ï¼ˆconnectionï¼‰ä½¿ç”¨ï¼Œè€Œä¸”å½“è¿æ¥å…³é—­åé˜Ÿåˆ—å³è¢«åˆ é™¤ï¼‰</li><li>Auto-deleteï¼ˆå½“æœ€åä¸€ä¸ªæ¶ˆè´¹è€…é€€è®¢åå³è¢«åˆ é™¤ï¼‰</li><li>Argumentsï¼ˆä¸€äº›æ¶ˆæ¯ä»£ç†ç”¨ä»–æ¥å®Œæˆç±»ä¼¼ä¸TTLçš„æŸäº›é¢å¤–åŠŸèƒ½ï¼‰</li></ul><h3 id="æ¶ˆæ¯ç¡®è®¤"><a href="#æ¶ˆæ¯ç¡®è®¤" class="headerlink" title="æ¶ˆæ¯ç¡®è®¤"></a>æ¶ˆæ¯ç¡®è®¤</h3><p>æ¶ˆè´¹è€…åº”ç”¨ï¼ˆConsumer applicationsï¼‰ - ç”¨æ¥æ¥å—å’Œå¤„ç†æ¶ˆæ¯çš„åº”ç”¨ - åœ¨å¤„ç†æ¶ˆæ¯çš„æ—¶å€™å¶å°”ä¼šå¤±è´¥æˆ–è€…æœ‰æ—¶ä¼šç›´æ¥å´©æºƒæ‰ã€‚è€Œä¸”ç½‘ç»œåŸå› ä¹Ÿæœ‰å¯èƒ½å¼•èµ·å„ç§é—®é¢˜ã€‚è¿™å°±ç»™æˆ‘ä»¬å‡ºäº†ä¸ªéš¾é¢˜ï¼ŒAMQPä»£ç†åœ¨ä»€ä¹ˆæ—¶å€™åˆ é™¤æ¶ˆæ¯æ‰æ˜¯æ­£ç¡®çš„ï¼ŸAMQP 0-9-1 è§„èŒƒç»™æˆ‘ä»¬ä¸¤ç§å»ºè®®ï¼š</p><ul><li>å½“æ¶ˆæ¯ä»£ç†ï¼ˆbrokerï¼‰å°†æ¶ˆæ¯å‘é€ç»™åº”ç”¨åç«‹å³åˆ é™¤ã€‚ï¼ˆä½¿ç”¨AMQPæ–¹æ³•ï¼šbasic.deliveræˆ–basic.get-okï¼‰</li><li>å¾…åº”ç”¨ï¼ˆapplicationï¼‰å‘é€ä¸€ä¸ªç¡®è®¤å›æ‰§ï¼ˆacknowledgementï¼‰åå†åˆ é™¤æ¶ˆæ¯ã€‚ï¼ˆä½¿ç”¨AMQPæ–¹æ³•ï¼šbasic.ackï¼‰</li></ul><p>å‰è€…è¢«ç§°ä½œè‡ªåŠ¨ç¡®è®¤æ¨¡å¼ï¼ˆautomatic acknowledgement modelï¼‰ï¼Œåè€…è¢«ç§°ä½œæ˜¾å¼ç¡®è®¤æ¨¡å¼ï¼ˆexplicit acknowledgement model)ã€‚</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$callback</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">echo</span> <span class="token string single-quoted-string">' [x] Received '</span><span class="token punctuation">,</span> <span class="token variable">$msg</span><span class="token operator">-></span><span class="token property">body</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>  <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token function">substr_count</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token operator">-></span><span class="token property">body</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">echo</span> <span class="token string double-quoted-string">" [x] Done\n"</span><span class="token punctuation">;</span>  <span class="token variable">$msg</span><span class="token operator">-></span><span class="token function">ack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token variable">$channel</span><span class="token operator">-></span><span class="token function">basic_consume</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'task_queue'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token variable">$callback</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ä»¥ä¸Šä»£ç ç¤ºä¾‹å±•ç¤ºackä½¿ç”¨ï¼Œbasic_consumeçš„ç¬¬4ä¸ªå‚æ•°è¦ è®¾ç½®ä¸ºtrueã€‚</p><h3 id="æ‹’ç»æ¶ˆæ¯"><a href="#æ‹’ç»æ¶ˆæ¯" class="headerlink" title="æ‹’ç»æ¶ˆæ¯"></a>æ‹’ç»æ¶ˆæ¯</h3><p>å½“ä¸€ä¸ªæ¶ˆè´¹è€…æ¥æ”¶åˆ°æŸæ¡æ¶ˆæ¯åï¼Œå¤„ç†è¿‡ç¨‹æœ‰å¯èƒ½æˆåŠŸï¼Œæœ‰å¯èƒ½å¤±è´¥ã€‚åº”ç”¨å¯ä»¥å‘æ¶ˆæ¯ä»£ç†è¡¨æ˜ï¼Œæœ¬æ¡æ¶ˆæ¯ç”±äºâ€œæ‹’ç»æ¶ˆæ¯ï¼ˆRejecting Messagesï¼‰â€çš„åŸå› å¤„ç†å¤±è´¥äº†ï¼ˆæˆ–è€…æœªèƒ½åœ¨æ­¤æ—¶å®Œæˆï¼‰ã€‚å½“æ‹’ç»æŸæ¡æ¶ˆæ¯æ—¶ï¼Œåº”ç”¨å¯ä»¥å‘Šè¯‰æ¶ˆæ¯ä»£ç†å¦‚ä½•å¤„ç†è¿™æ¡æ¶ˆæ¯â€”â€”é”€æ¯å®ƒæˆ–è€…é‡æ–°æ”¾å…¥é˜Ÿåˆ—ã€‚å½“æ­¤é˜Ÿåˆ—åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…æ—¶ï¼Œè¯·ç¡®è®¤ä¸è¦ç”±äºæ‹’ç»æ¶ˆæ¯å¹¶ä¸”é€‰æ‹©äº†é‡æ–°æ”¾å…¥é˜Ÿåˆ—çš„è¡Œä¸ºè€Œå¼•èµ·æ¶ˆæ¯åœ¨åŒä¸€ä¸ªæ¶ˆè´¹è€…èº«ä¸Šæ— é™å¾ªç¯çš„æƒ…å†µå‘ç”Ÿã€‚</p><h3 id="è¿æ¥"><a href="#è¿æ¥" class="headerlink" title="è¿æ¥"></a>è¿æ¥</h3><p>AMQPè¿æ¥é€šå¸¸æ˜¯é•¿è¿æ¥ã€‚AMQPæ˜¯ä¸€ä¸ªä½¿ç”¨TCPæä¾›å¯é æŠ•é€’çš„åº”ç”¨å±‚åè®®ã€‚AMQPä½¿ç”¨è®¤è¯æœºåˆ¶å¹¶ä¸”æä¾›TLSï¼ˆSSLï¼‰ä¿æŠ¤ã€‚å½“ä¸€ä¸ªåº”ç”¨ä¸å†éœ€è¦è¿æ¥åˆ°AMQPä»£ç†çš„æ—¶å€™ï¼Œéœ€è¦ä¼˜é›…çš„é‡Šæ”¾æ‰AMQPè¿æ¥ï¼Œè€Œä¸æ˜¯ç›´æ¥å°†TCPè¿æ¥å…³é—­ã€‚</p><h3 id="è™šæ‹Ÿä¸»æœº-vhost"><a href="#è™šæ‹Ÿä¸»æœº-vhost" class="headerlink" title="è™šæ‹Ÿä¸»æœº vhost"></a>è™šæ‹Ÿä¸»æœº vhost</h3><p>ä¸ºäº†åœ¨ä¸€ä¸ªå•ç‹¬çš„ä»£ç†ä¸Šå®ç°å¤šä¸ªéš”ç¦»çš„ç¯å¢ƒï¼ˆç”¨æˆ·ã€ç”¨æˆ·ç»„ã€äº¤æ¢æœºã€é˜Ÿåˆ— ç­‰ï¼‰ï¼ŒAMQPæä¾›äº†ä¸€ä¸ªè™šæ‹Ÿä¸»æœºï¼ˆvirtual hosts - vhostsï¼‰çš„æ¦‚å¿µã€‚è¿™è·ŸWeb serversè™šæ‹Ÿä¸»æœºæ¦‚å¿µéå¸¸ç›¸ä¼¼ï¼Œè¿™ä¸ºAMQPå®ä½“æä¾›äº†å®Œå…¨éš”ç¦»çš„ç¯å¢ƒã€‚</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$connection</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMQPStreamConnection</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'192.168.106.179'</span><span class="token punctuation">,</span> <span class="token number">5672</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'guest'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'guest'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'test-vhost'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="åŠ¨æ€åŒ¹é…æ¨¡å‹"><a href="#åŠ¨æ€åŒ¹é…æ¨¡å‹" class="headerlink" title="åŠ¨æ€åŒ¹é…æ¨¡å‹"></a>åŠ¨æ€åŒ¹é…æ¨¡å‹</h2><p>ç”Ÿäº§è€…</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">execute</span><span class="token punctuation">(</span><span class="token class-name type-declaration">InputInterface</span> <span class="token variable">$input</span><span class="token punctuation">,</span> <span class="token class-name type-declaration">OutputInterface</span> <span class="token variable">$output</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">int</span>   <span class="token punctuation">&#123;</span>       <span class="token variable">$connection</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMQPStreamConnection</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'192.168.106.179'</span><span class="token punctuation">,</span> <span class="token number">5672</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'guest'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'guest'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// åˆ›å»ºé€šé“</span>       <span class="token variable">$channel</span> <span class="token operator">=</span> <span class="token variable">$connection</span><span class="token operator">-></span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token variable">$channel</span><span class="token operator">-></span><span class="token function">exchange_declare</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'order.lifecycle'</span><span class="token punctuation">,</span> <span class="token class-name static-context">AMQPExchangeType</span><span class="token operator">::</span><span class="token constant">TOPIC</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">//å®šä¹‰ä¸€ä¸ªé»˜è®¤ å…¨çŠ¶æ€é˜Ÿåˆ—</span>       <span class="token variable">$channel</span><span class="token operator">-></span><span class="token function">queue_declare</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'order.all'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">//åŒ¹é… å…¨çŠ¶æ€ è®¢å•æ¶ˆæ¯</span>       <span class="token variable">$channel</span><span class="token operator">-></span><span class="token function">queue_bind</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'order.all'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'order.lifecycle'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'order.*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token variable">$faker</span> <span class="token operator">=</span> <span class="token class-name static-context">Factory</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'zh_CN'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token variable">$orderStatus</span> <span class="token operator">=</span> <span class="token punctuation">[</span>           <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">ORDER_CREATE</span><span class="token punctuation">,</span> <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">ORDER_SENDED</span><span class="token punctuation">,</span> <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token constant">ORDER_WAIT_PAY</span>       <span class="token punctuation">]</span><span class="token punctuation">;</span>       <span class="token variable">$status</span> <span class="token operator">=</span> <span class="token variable">$orderStatus</span><span class="token punctuation">[</span><span class="token function">array_rand</span><span class="token punctuation">(</span><span class="token variable">$orderStatus</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>       <span class="token variable">$body</span> <span class="token operator">=</span> <span class="token punctuation">[</span>           <span class="token string single-quoted-string">'status'</span> <span class="token operator">=></span> <span class="token variable">$status</span><span class="token punctuation">,</span>           <span class="token string single-quoted-string">'name'</span> <span class="token operator">=></span> <span class="token variable">$faker</span><span class="token operator">-></span><span class="token property">name</span><span class="token punctuation">,</span>           <span class="token string single-quoted-string">'order_no'</span> <span class="token operator">=></span> <span class="token variable">$faker</span><span class="token operator">-></span><span class="token property">uuid</span>       <span class="token punctuation">]</span><span class="token punctuation">;</span>       <span class="token function">dump</span><span class="token punctuation">(</span><span class="token variable">$body</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMQPMessage</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$body</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'delivery_mode'</span> <span class="token operator">=></span> <span class="token class-name static-context">AMQPMessage</span><span class="token operator">::</span><span class="token constant">DELIVERY_MODE_PERSISTENT</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">//æ¶ˆæ¯ åŠ¨æ€ ç»‘å®š è·¯ç”±é”®</span>       <span class="token variable">$channel</span><span class="token operator">-></span><span class="token function">basic_publish</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'order.lifecycle'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'order.'</span><span class="token operator">.</span><span class="token variable">$status</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">return</span> <span class="token class-name static-context">Command</span><span class="token operator">::</span><span class="token constant">SUCCESS</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span></code></pre><pre class="language-php" data-language="php"><code class="language-php">æ¶ˆè´¹è€… <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">handPay</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$connection</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMQPStreamConnection</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'192.168.106.179'</span><span class="token punctuation">,</span> <span class="token number">5672</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'guest'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'guest'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// åˆ›å»ºé€šé“</span>        <span class="token variable">$channel</span> <span class="token operator">=</span> <span class="token variable">$connection</span><span class="token operator">-></span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//å®šä¹‰ h66 æ¶ˆè´¹ pay é˜Ÿåˆ—</span>        <span class="token variable">$channel</span><span class="token operator">-></span><span class="token function">queue_declare</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'h66.pay'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//å°† WAIY_PAY ç±»å‹æ¶ˆæ¯ ç»‘å®šåˆ°è¯¥é˜Ÿåˆ—</span>        <span class="token variable">$channel</span><span class="token operator">-></span><span class="token function">queue_bind</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'h66.pay'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'order.lifecycle'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'order.WAIT_PAY'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$callback</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$body</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token operator">-></span><span class="token property">body</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å¤„ç†æ•°æ®...<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$body</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'status'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span> <span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$body</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'order_no'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token comment">// æ¶ˆè´¹ é˜Ÿåˆ—</span>        <span class="token variable">$channel</span><span class="token operator">-></span><span class="token function">basic_consume</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'h66.pay'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token variable">$callback</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// é˜»å¡é˜Ÿåˆ—ç›‘å¬äº‹ä»¶</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token variable">$channel</span><span class="token operator">-></span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$channel</span><span class="token operator">-></span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span></code></pre><p>ä»£ç ç¤ºä¾‹ä¸­ ç”Ÿæˆè€…æ ¹æ®è®¢å•çŠ¶æ€åŠ¨æ€ç”Ÿäº§ç›¸åº”è·¯ç”±é”®æ¶ˆæ¯åˆ°äº¤æ¢æœºï¼Œæ¶ˆè´¹è€…è®¢é˜…è‡ªå·±æ‰€éœ€çš„çŠ¶æ€åˆ°è‡ªå·±çš„é˜Ÿåˆ—å½“ä¸­è¿›è¡Œæ¶ˆè´¹ã€‚</p><p>ä¾‹å¦‚ <code>handPay</code> æ¶ˆè´¹è€…åªè®¢é˜…å¾…æ”¯ä»˜ç±»å‹ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol><li><a href="https://rabbitmq.mr-ping.com/">https://rabbitmq.mr-ping.com/</a></li><li><a href="https://www.rabbitmq.com/getstarted.html">https://www.rabbitmq.com/getstarted.html</a></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> æ¶æ„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysqlçš„waitimeout</title>
      <link href="2021/06/02/mysql%E7%9A%84waitimeout/"/>
      <url>2021/06/02/mysql%E7%9A%84waitimeout/</url>
      
        <content type="html"><![CDATA[<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹</p><pre class="language-shell" data-language="shell"><code class="language-shell">show GLOBAL VARIABLES like <span class="token string">'%timeout%'</span><span class="token punctuation">;</span></code></pre><p>é»˜è®¤å€¼ä¸º28800så³8å°æ—¶,æˆ‘ä»¬æ”¹ä¸º100s</p><pre class="language-ini" data-language="ini"><code class="language-ini"><span class="token comment"># Default Homebrew MySQL server config</span><span class="token header"><span class="token punctuation">[</span><span class="token section-name selector">mysqld</span><span class="token punctuation">]</span></span><span class="token comment"># Only allow connections from localhost</span><span class="token key attr-name">bind-address</span> <span class="token punctuation">=</span> <span class="token value attr-value">0.0.0.0</span><span class="token key attr-name">wait_timeout</span><span class="token punctuation">=</span><span class="token value attr-value">100</span><span class="token key attr-name">interactive_timeout</span><span class="token punctuation">=</span><span class="token value attr-value">100</span></code></pre><p>é‡æ–°æŸ¥çœ‹ç»“æœ</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210603144255.png" alt=""></p><span id="more"></span><p>æŸ¥çœ‹å¯¹å®ˆæŠ¤è¿›ç¨‹è¿æ¥çš„å½±å“</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">longT</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token punctuation">&#123;</span>       <span class="token variable">$TicketModel</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TicketModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'å¼€å§‹å»ºç«‹è¿æ¥...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token constant boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>           <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token function">dump</span><span class="token punctuation">(</span><span class="token variable">$TicketModel</span><span class="token operator">-></span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'t_id'</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span></code></pre><p>å‘ç°åœ¨100såçš„è¿æ¥å·²è¢«ä¸»åŠ¨æ–­å¼€</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210603144315.png" alt=""></p><p>ä»£ç ä¸­çš„åœºæ™¯æ˜¯ï¼Œ<strong>åœ¨wait_timeoutä¹‹å†…æ— ä»»ä½•æ“ä½œä¼šè‡ªåŠ¨å…³é—­</strong></p><h2 id="å®˜æ–¹è§£é‡Š"><a href="#å®˜æ–¹è§£é‡Š" class="headerlink" title="å®˜æ–¹è§£é‡Š"></a>å®˜æ–¹è§£é‡Š</h2><p>interactive_timeout 28800</p><blockquote><p>The number of seconds the server waits for activity on an interactive connection before closing it. An interactive client is defined as a client that uses the <strong>CLIENT_INTERACTIVE</strong> option to mysql_real_connect(). See also wait_timeout.</p></blockquote><p>waitimeout 28800</p><p>The number of seconds the server waits for activity on a noninteractive connection before closing it.</p><p>On thread startup, the session wait_timeout value is initialized from the global wait_timeout value or from the global interactive_timeout value, depending on the type of client (as defined by the CLIENT_INTERACTIVE connect option to mysql_real_connect()). See also interactive_timeout.</p><p>é€šè¿‡MySQLå®¢æˆ·ç«¯è¿æ¥dbçš„æ˜¯äº¤äº’ä¼šè¯ï¼Œé€šè¿‡jdbcç­‰ç¨‹åºè¿æ¥dbçš„æ˜¯éäº¤äº’ä¼šè¯ã€‚ </p><p>æ€»ç»“ï¼š</p><p>å¦‚æœåº”ç”¨ç¨‹åºé•¿æ—¶é—´çš„ä½¿ç”¨ä¸€ä¸ªè¿æ¥ï¼Œè€Œæœ‰æœºä¼šé•¿æ—¶é—´ä¸è¿›è¡Œä»»ä½•æ“ä½œã€‚åˆ™ä¼šå¯¼è‡´è¿æ¥è¢«å…³é—­ã€‚</p><p>å‚è€ƒæ–‡çŒ®:</p><p>1.<a href="https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html">https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html</a><br>2.<a href="https://cloud.tencent.com/developer/article/1181515">https://cloud.tencent.com/developer/article/1181515</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue+quasar+electron+springboot+mysqlæ’¸ä¸€ä¸ªTODO LIST çœ‹æ¿</title>
      <link href="2021/04/09/vue-quasar-electron-springboot-mysql%E6%92%B8%E4%B8%80%E4%B8%AATODO-LIST-%E7%9C%8B%E6%9D%BF/"/>
      <url>2021/04/09/vue-quasar-electron-springboot-mysql%E6%92%B8%E4%B8%80%E4%B8%AATODO-LIST-%E7%9C%8B%E6%9D%BF/</url>
      
        <content type="html"><![CDATA[<p>å…ˆçœ‹æ•ˆæœ</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210330200044.png" alt=""></p><p>å†™æœ¬é¡¹ç›®çš„ç›®çš„æœ‰å‡ ç‚¹ï¼š</p><ol><li>å­¦ä¹ ä¸‹vue+electronæ¡Œé¢å¼€å‘</li><li>å­¦ä¹ ä¸‹javaå’Œspringå¼€å‘(æœ¬äººä¸€ç›´ä½¿ç”¨PHP)</li><li>ä¸€ç›´ç¼ºå°‘ä¸€æ¬¾èƒ½é€‚åˆè‡ªå·±çš„TODO LISTè½¯ä»¶ï¼Œèƒ½æœ‰æ¡Œé¢ç«¯çš„</li></ol><span id="more"></span><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210409114201.png" alt=""></p><p>å¯ç›´æ¥æ‰“åŒ…æˆdmgã€exe ç­‰äºŒè¿›åˆ¶æ–‡ä»¶ä½¿ç”¨ã€‚<br>è¿™æ˜¯æˆ‘æ‰“åŒ…åçš„æ•ˆæœã€‚</p><h2 id="æŠ€æœ¯æ ˆ"><a href="#æŠ€æœ¯æ ˆ" class="headerlink" title="æŠ€æœ¯æ ˆ"></a>æŠ€æœ¯æ ˆ</h2><ul><li>vue</li><li>quasar</li><li>electron</li><li>springboot</li><li>mysql</li></ul><h2 id="è‡ªå®šä¹‰æ³¨è§£"><a href="#è‡ªå®šä¹‰æ³¨è§£" class="headerlink" title="è‡ªå®šä¹‰æ³¨è§£"></a>è‡ªå®šä¹‰æ³¨è§£</h2><h2 id="æºç åœ°å€"><a href="#æºç åœ°å€" class="headerlink" title="æºç åœ°å€"></a>æºç åœ°å€</h2><ul><li>å‰ç«¯ <a href="https://github.com/visonforcoding/carambola-todo">https://github.com/visonforcoding/carambola-todo</a></li><li>åç«¯ <a href="https://github.com/visonforcoding/carambola-todo-service">https://github.com/visonforcoding/carambola-todo-service</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¹¶å‘ç¼–ç¨‹æ—¥è®°-çº¿ç¨‹ä¸å®‰å…¨çš„å±å®³</title>
      <link href="2021/03/03/%E7%BC%96%E5%8F%91%E7%BC%96%E7%A8%8B%E6%97%A5%E8%AE%B0-%E7%BA%BF%E7%A8%8B%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E5%8D%B1%E5%AE%B3/"/>
      <url>2021/03/03/%E7%BC%96%E5%8F%91%E7%BC%96%E7%A8%8B%E6%97%A5%E8%AE%B0-%E7%BA%BF%E7%A8%8B%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E5%8D%B1%E5%AE%B3/</url>
      
        <content type="html"><![CDATA[<p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210303192545.png" alt=""></p><span id="more"></span><h2 id="è®¡æ•°å™¨"><a href="#è®¡æ•°å™¨" class="headerlink" title="è®¡æ•°å™¨"></a>è®¡æ•°å™¨</h2><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"HelloServlet"</span><span class="token punctuation">,</span> urlPatterns <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"/hello"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> LOG <span class="token operator">=</span> <span class="token class-name">Logger</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">HelloServlet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span>            <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token operator">++</span>count<span class="token punctuation">;</span>        <span class="token function">processRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>        LOG<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"è®¡æ•° %d"</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>æŒ‰å¸¸ç†å¤šå°‘æ¬¡è¯·æ±‚åå°±ä¼šæ‰“å°å‡ºè®¡æ•°å¤šå°‘ã€‚</p><pre class="language-none"><code class="language-none">ab -n300 -c20 http:&#x2F;&#x2F;localhost:8080&#x2F;servlet-demo&#x2F;hello</code></pre><p>æ­£å¸¸ä¸‹ï¼Œæ‰§è¡Œç¬¬ä¸€æ¬¡ è®¡æ•°åº”ä¸º300</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210303194840.png" alt=""></p><p>äº‹å®ä¸Šå¾—åˆ°çš„å´ä¸æ˜¯</p><p>å†æ‰§è¡Œ..</p><p>2 ~ 590<br>3 ~ 879<br>4 ~ 1170</p><p>å‡ ä¹æ²¡æœ‰è§„å¾‹ï¼Œå¹¶ä¸æ˜¯é¢„æœŸçš„ 300çš„å€æ•°ã€‚</p><h2 id="è§£é‡Š"><a href="#è§£é‡Š" class="headerlink" title="è§£é‡Š"></a>è§£é‡Š</h2><p>å®é™…ä¸Š<code>++count</code>æ˜¯ä¸€ä¸ªè¯»å–-ä¿®æ”¹-å†™å…¥çš„æ“ä½œã€‚</p><p>å‡è®¾çº¿ç¨‹Aã€B åŒæ—¶è¯»å–åˆ°äº†å€¼æ˜¯m,åŒæ—¶å†™å…¥+1åçš„å€¼m+1ã€‚ç»“æœcount = m+1,åˆ™äº‹å®ä¸Šæ•´ä¸ªè®¡æ•°å°±å°‘äº†1,åº”è¯¥ä¸ºm+2ã€‚</p><h2 id="å¤„ç†"><a href="#å¤„ç†" class="headerlink" title="å¤„ç†"></a>å¤„ç†</h2><p>å°†<code>count</code>å£°æ˜ä¸º<code>AtomicInter</code></p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token class-name">Integer</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">private</span> <span class="token class-name">AtomicInteger</span> atomicCount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Override</span><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span>        <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>    <span class="token operator">++</span>count<span class="token punctuation">;</span>    <span class="token function">processRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>    LOG<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"è®¡æ•°count %d"</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    LOG<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"è®¡æ•°atomicCount %d"</span><span class="token punctuation">,</span> atomicCount<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210309095018.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>AtomicInteger</code>ç»Ÿè®¡çš„æ˜¯æ­£ç¡®çš„äº†ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>spring-boot+vue+supervisor+nginxçš„å‰åç«¯åˆ†ç¦»éƒ¨ç½²</title>
      <link href="2021/02/22/java/spring-boot-vue%E7%9A%84%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%83%A8%E7%BD%B2/"/>
      <url>2021/02/22/java/spring-boot-vue%E7%9A%84%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%83%A8%E7%BD%B2/</url>
      
        <content type="html"><![CDATA[<ul><li>è¦ä¿è¯åŒåŸŸéƒ¨ç½²,å› ä¸ºè·¨åŸŸä¼šæœ‰å¾ˆå¤šé—®é¢˜è¦é‡æ–°è§£å†³</li></ul><p>é¡ºä¾¿æ ‘ä¸‹ï¼Œä½†å…¶å®ç°åœ¨äº’è”ç½‘äº§å“ä¸€èˆ¬éƒ½æœ‰å¤šå®¢æˆ·ç«¯ï¼Œpc web ã€å°ç¨‹åºã€appã€‚ä¿å®ˆçš„åŒåŸŸsessionæ¨¡å¼ä¿æŒä¼šè¯å·²ç»æ»¡è¶³ä¸äº†ä¸€äº›éœ€æ±‚ã€‚æ¯”å¦‚ï¼Œå•ç«¯ç™»å½•ç­‰ã€‚</p><p>è¨€å½’æ­£ä¼ ï¼Œæˆ‘é‡‡å–çš„æ€è·¯æ˜¯ï¼Œå‰ç«¯è¯·æ±‚æ¥å£æ—¶ç»Ÿä¸€åŠ ä¸Šapiå‰ç¼€ï¼Œnginxå°†apiå‰ç¼€çš„è·¯ç”±è¯·æ±‚ä»£ç†è½¬å‘åˆ°spring-boot</p><span id="more"></span><h2 id="nginxé…ç½®"><a href="#nginxé…ç½®" class="headerlink" title="nginxé…ç½®"></a>nginxé…ç½®</h2><pre class="language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">&#123;</span>    <span class="token directive"><span class="token keyword">server_name</span> admin.domain.xyz</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">location</span>  /</span> <span class="token punctuation">&#123;</span>                <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span>                <span class="token directive"><span class="token keyword">root</span> /home/wwwuser/webroot/itdoc-admin-web/dist/spa</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token directive"><span class="token keyword">location</span> /api/</span> <span class="token punctuation">&#123;</span>              <span class="token directive"><span class="token keyword">proxy_pass</span>  http://127.0.0.1:8081/</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token comment"># optionally disable falling back to PHP script for the asset directories;</span>    <span class="token comment"># nginx will return a 404 error when files are not found instead of passing the</span>    <span class="token comment"># request to Symfony (improves performance but Symfony's 404 page is not displayed)</span>    <span class="token comment"># location /bundles &#123;</span>    <span class="token comment">#     try_files $uri =404;</span>    <span class="token comment"># &#125;</span>    <span class="token directive"><span class="token keyword">error_log</span> /var/log/nginx/admin_error.log</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">access_log</span> /var/log/nginx/admin_access.log</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h2 id="supervisorå®ˆæŠ¤java-jar"><a href="#supervisorå®ˆæŠ¤java-jar" class="headerlink" title="supervisorå®ˆæŠ¤java -jar"></a>supervisorå®ˆæŠ¤java -jar</h2><p>æˆ‘è¿™é‡Œé‡‡å–java -jaræ¨¡å¼éƒ¨ç½²ï¼Œä½†æ˜¯å•çº¯çš„è¿™ç§æ¨¡å¼å¹¶ä¸èƒ½ä¿è¯è‡ªå¯åŠ¨å’Œè¿›ç¨‹ç›‘æ§ç­‰ã€‚å› æ­¤éœ€è¦å€ŸåŠ©supervisorã€‚</p><pre class="language-ini" data-language="ini"><code class="language-ini"><span class="token header"><span class="token punctuation">[</span><span class="token section-name selector">program:itdoc</span><span class="token punctuation">]</span></span><span class="token key attr-name">command</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/local/jdk-11.0.2/bin/java -jar itdoc-0.0.2-SNAPSHOT.jar</span><span class="token key attr-name">process_name</span><span class="token punctuation">=</span><span class="token value attr-value">%(program_name)s</span><span class="token key attr-name">numprocs</span><span class="token punctuation">=</span><span class="token value attr-value">1</span><span class="token key attr-name">directory</span><span class="token punctuation">=</span><span class="token value attr-value">/home/wwwuser/webroot</span><span class="token key attr-name">umask</span><span class="token punctuation">=</span><span class="token value attr-value">022</span><span class="token key attr-name">priority</span><span class="token punctuation">=</span><span class="token value attr-value">999</span><span class="token key attr-name">autostart</span><span class="token punctuation">=</span><span class="token value attr-value">true</span><span class="token key attr-name">autorestart</span><span class="token punctuation">=</span><span class="token value attr-value">unexpected</span><span class="token key attr-name">startsecs</span><span class="token punctuation">=</span><span class="token value attr-value">10</span><span class="token key attr-name">startretries</span><span class="token punctuation">=</span><span class="token value attr-value">3</span><span class="token key attr-name">exitcodes</span><span class="token punctuation">=</span><span class="token value attr-value">0</span><span class="token key attr-name">stopsignal</span><span class="token punctuation">=</span><span class="token value attr-value">TERM</span><span class="token key attr-name">stopwaitsecs</span><span class="token punctuation">=</span><span class="token value attr-value">10</span><span class="token key attr-name">stopasgroup</span><span class="token punctuation">=</span><span class="token value attr-value">false</span><span class="token key attr-name">killasgroup</span><span class="token punctuation">=</span><span class="token value attr-value">false</span><span class="token key attr-name">user</span><span class="token punctuation">=</span><span class="token value attr-value">wwwuser</span><span class="token key attr-name">redirect_stderr</span><span class="token punctuation">=</span><span class="token value attr-value">false</span><span class="token key attr-name">stdout_logfile</span><span class="token punctuation">=</span><span class="token value attr-value">/var/log/webroot/itdoc-out.log</span><span class="token key attr-name">stdout_logfile_maxbytes</span><span class="token punctuation">=</span><span class="token value attr-value">1MB</span><span class="token key attr-name">stdout_logfile_backups</span><span class="token punctuation">=</span><span class="token value attr-value">10</span><span class="token key attr-name">stdout_capture_maxbytes</span><span class="token punctuation">=</span><span class="token value attr-value">1MB</span><span class="token key attr-name">stdout_events_enabled</span><span class="token punctuation">=</span><span class="token value attr-value">false</span><span class="token key attr-name">stderr_logfile</span><span class="token punctuation">=</span><span class="token value attr-value">/var/log/webroot/itdoc-err.log</span><span class="token key attr-name">stderr_logfile_maxbytes</span><span class="token punctuation">=</span><span class="token value attr-value">1MB</span><span class="token key attr-name">stderr_logfile_backups</span><span class="token punctuation">=</span><span class="token value attr-value">10</span><span class="token key attr-name">stderr_capture_maxbytes</span><span class="token punctuation">=</span><span class="token value attr-value">1MB</span></code></pre><p>è¿™é‡Œçš„<code>autostart</code> å’Œ <code>autorestart</code> èƒ½ä¿è¯è‡ªå¯åŠ¨å’Œå¯åŠ¨é‡å¯</p>]]></content>
      
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ©ç”¨Locustè¿›è¡Œæ€§èƒ½æµ‹è¯•</title>
      <link href="2021/01/23/%E5%88%A9%E7%94%A8Locust%E8%BF%9B%E8%A1%8C%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/"/>
      <url>2021/01/23/%E5%88%A9%E7%94%A8Locust%E8%BF%9B%E8%A1%8C%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<ul><li>è¦çœ‹ä¸€ä¸ªé¡¹ç›®çš„æœ€å¤§å¯ç”¨èƒ½åŠ›æ˜¯å¤šå°‘ï¼Œæ€§èƒ½æµ‹è¯•å·¥ä½œå°‘ä¸äº†.</li><li>æ¯ä¸€ä¸ªé¡¹ç›®éƒ½åº”è¯¥åšå‹æµ‹</li><li>å¤šçº¿ç¨‹å¹¶å‘æ¨¡å‹ä¸€å®šè¦åšå‹æµ‹</li></ul><span id="more"></span><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><pre class="language-none"><code class="language-none">$ pip3 install locust</code></pre><h2 id="ç¼–å†™è„šæœ¬"><a href="#ç¼–å†™è„šæœ¬" class="headerlink" title="ç¼–å†™è„šæœ¬"></a>ç¼–å†™è„šæœ¬</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> time<span class="token keyword">from</span> locust <span class="token keyword">import</span> HttpUser<span class="token punctuation">,</span> task<span class="token punctuation">,</span> between<span class="token keyword">class</span> <span class="token class-name">QuickstartUser</span><span class="token punctuation">(</span>HttpUser<span class="token punctuation">)</span><span class="token punctuation">:</span>    wait_time <span class="token operator">=</span> between<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">)</span>    <span class="token decorator annotation punctuation">@task</span>    <span class="token keyword">def</span> <span class="token function">hello_world</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"/hello"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"/world"</span><span class="token punctuation">)</span>    <span class="token decorator annotation punctuation">@task</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">view_items</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> item_id <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"/item?id=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>item_id<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"/item"</span><span class="token punctuation">)</span>            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">on_start</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">,</span> json<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"username"</span><span class="token punctuation">:</span><span class="token string">"foo"</span><span class="token punctuation">,</span> <span class="token string">"password"</span><span class="token punctuation">:</span><span class="token string">"bar"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre><p><code>wait_time = between(1, 2.5)</code></p><p>Our class defines a wait_time that will make the simulated users wait between 1 and 2.5 seconds after each task (see below) is executed. For more info see wait_time attribute.</p><p><code>def hello_world(self):</code></p><pre class="language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@task</span><span class="token keyword">def</span> <span class="token function">hello_world</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"/hello"</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"/world"</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@task</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">view_items</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre><p><code>task(3)</code> å†…çš„å‚æ•°è¡¨ç¤ºä»»åŠ¡æ‰§è¡Œçš„æƒé‡ï¼Œ<code>view_items</code>çš„æ¬¡æ•°å°†æ˜¯<code>hello_world</code>æ¬¡æ•°çš„3å€ã€‚</p><h2 id="æ‰§è¡Œ"><a href="#æ‰§è¡Œ" class="headerlink" title="æ‰§è¡Œ"></a>æ‰§è¡Œ</h2><pre class="language-none"><code class="language-none">$ locust -f locust_files&#x2F;my_locust_file.py</code></pre><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210330151409.png" alt=""></p><p>ä»»åŠ¡æ‰§è¡Œç•Œé¢å’Œç»“æœ</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210330151426.png" alt=""></p>]]></content>
      
      
      
        <tags>
            
            <tag> è½¯ä»¶å·¥ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é»‘å¯åŠ¨</title>
      <link href="2021/01/21/%E9%BB%91%E5%90%AF%E5%8A%A8/"/>
      <url>2021/01/21/%E9%BB%91%E5%90%AF%E5%8A%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="facebookæ¡ˆä¾‹"><a href="#facebookæ¡ˆä¾‹" class="headerlink" title="facebookæ¡ˆä¾‹"></a>facebookæ¡ˆä¾‹</h2><p>ä½œä¸ºé»‘å¯åŠ¨æµç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œæ¯ä¸ªFacebook ç”¨æˆ·ä¼šè¯ï¼ˆåœ¨ç”¨æˆ·ç«¯æµè§ˆå™¨ä¸­è¿è¡Œ<br>JavaScript ä»£ç ï¼‰éƒ½åŠ è½½äº†æµ‹è¯•å·¥å…·ã€‚è™½ç„¶èŠå¤©åŠŸèƒ½çš„ç”¨æˆ·ç•Œé¢å…ƒç´ è¢«éšè—èµ·æ¥ï¼Œä½†æµè§ˆå™¨<br>è¿˜æ˜¯ä¼šå‘å·²éƒ¨ç½²åœ¨ç”Ÿäº§ç¯å¢ƒä¸­çš„åå°èŠå¤©æœåŠ¡å™¨å‘é€ç”¨æˆ·ä¸å¯è§çš„èŠå¤©æµ‹è¯•ä¿¡æ¯ï¼Œè¿™ä½¿å¼€</p><p>å‘å›¢é˜Ÿèƒ½å¤Ÿåœ¨æ•´ä¸ªé¡¹ç›®è¿‡ç¨‹ä¸­æ¨¡æ‹Ÿå‡ºç±»ç”Ÿäº§è´Ÿè½½ï¼Œä»è€Œåœ¨å‘å¸ƒä¹‹å‰æ‰¾å‡ºå¹¶è§£å†³æ€§èƒ½é—®é¢˜ã€‚</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210121214126.jpeg" alt=""></p><p>è€å­æƒŠäº†,è¿™æœ‰ç‚¹ç‰›çš®</p>]]></content>
      
      
      
        <tags>
            
            <tag> æ–¹æ¡ˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>servlet | servleté›†æˆmybatis-æ— xml&amp;æ³¨è§£æ–¹å¼</title>
      <link href="2021/01/06/java/servlet%E9%9B%86%E6%88%90mybatis-%E6%97%A0xml-%E6%B3%A8%E8%A7%A3%E6%96%B9%E5%BC%8F/"/>
      <url>2021/01/06/java/servlet%E9%9B%86%E6%88%90mybatis-%E6%97%A0xml-%E6%B3%A8%E8%A7%A3%E6%96%B9%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ä¹ æƒ¯äº†phpé¡¹ç›®ä¹‹åï¼Œææ€•éå¸¸ä¸å–œæ¬¢æ“ä½œxmlå§.æœ¬ç« å°†ä»‹ç»servlet+mybatisæ— xmlé…ç½®æ¨¡å¼ã€‚</p></blockquote><span id="more"></span><h2 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h2><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>5.1.26<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>   <span class="token comment">&lt;!-- https://mvnrepository.com/artifact/org.mybatis/mybatis --></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.5.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><h2 id="å¼•å…¥"><a href="#å¼•å…¥" class="headerlink" title="å¼•å…¥"></a>å¼•å…¥</h2><p>é¦–å…ˆå®šä¹‰datasource</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DatabaseConfig</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">static</span> <span class="token class-name">String</span> driver <span class="token operator">=</span> <span class="token string">"com.mysql.jdbc.Driver"</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">"jdbc:mysql://localhost:3306/db_itdoc?useSSL=false"</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token string">"root"</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">"12345678"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">DataSource</span> <span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        properties<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"driver"</span><span class="token punctuation">,</span> driver<span class="token punctuation">)</span><span class="token punctuation">;</span>        properties<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>        properties<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>        properties<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">UnpooledDataSourceFactory</span> unpooledDataSourceFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UnpooledDataSourceFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        unpooledDataSourceFactory<span class="token punctuation">.</span><span class="token function">setProperties</span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">DataSource</span> dataSource <span class="token operator">=</span> unpooledDataSourceFactory<span class="token punctuation">.</span><span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> dataSource<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>è·å–sessionFactory</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MybatisLoader</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">static</span> <span class="token class-name">SqlSessionFactory</span> sqlSessionFactory <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">SqlSessionFactory</span> <span class="token function">getSqlSessionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>sqlSessionFactory <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">DataSource</span> dataSource <span class="token operator">=</span> <span class="token class-name">DatabaseConfig</span><span class="token punctuation">.</span><span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">TransactionFactory</span> transactionFactory                    <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JdbcTransactionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Environment</span> environment                    <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Environment</span><span class="token punctuation">(</span><span class="token string">"development"</span><span class="token punctuation">,</span> transactionFactory<span class="token punctuation">,</span> dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Configuration</span> configuration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">;</span>            configuration<span class="token punctuation">.</span><span class="token function">addMapper</span><span class="token punctuation">(</span><span class="token class-name">UserMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            sqlSessionFactory                    <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>configuration<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> sqlSessionFactory<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h2 id="å®šä¹‰mapper"><a href="#å®šä¹‰mapper" class="headerlink" title="å®šä¹‰mapper"></a>å®šä¹‰mapper</h2><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"SELECT * FROM user WHERE id = #&#123;id&#125;"</span><span class="token punctuation">)</span>    <span class="token class-name">User</span> <span class="token function">selectUser</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Insert</span><span class="token punctuation">(</span><span class="token string">"INSERT INTO user(name,email) VALUES(#&#123;name&#125;, #&#123;email&#125;)"</span><span class="token punctuation">)</span>    <span class="token keyword">int</span> <span class="token function">insertUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h2 id="æŸ¥è¯¢å’Œæ’å…¥"><a href="#æŸ¥è¯¢å’Œæ’å…¥" class="headerlink" title="æŸ¥è¯¢å’Œæ’å…¥"></a>æŸ¥è¯¢å’Œæ’å…¥</h2><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">UserController</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">"/user/profile"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">profile</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getCookies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"i am user profile"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">"/user"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">Response</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token class-name">SqlSession</span> session <span class="token operator">=</span> <span class="token class-name">MybatisLoader</span><span class="token punctuation">.</span><span class="token function">getSqlSessionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">UserMapper</span> mapper <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">UserMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        user <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">selectUser</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"è·å–æˆåŠŸ"</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">"/user/add"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">Response</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"request user"</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">SqlSession</span> session <span class="token operator">=</span> <span class="token class-name">MybatisLoader</span><span class="token punctuation">.</span><span class="token function">getSqlSessionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">UserMapper</span> mapper <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">UserMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> id <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">insertUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>            session<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"è¿”å›"</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"ä¿å­˜å¤±è´¥"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"ä¿å­˜"</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Introduction to Spring MVC HandlerInterceptoræ‹¦æˆªå™¨ä»‹ç»</title>
      <link href="2020/09/24/java/Introduction-to-Spring-MVC-HandlerInterceptor%E6%8B%A6%E6%88%AA%E5%99%A8%E4%BB%8B%E7%BB%8D/"/>
      <url>2020/09/24/java/Introduction-to-Spring-MVC-HandlerInterceptor%E6%8B%A6%E6%88%AA%E5%99%A8%E4%BB%8B%E7%BB%8D/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
        <tags>
            
            <tag> JAVA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java JPAæ€è€ƒ</title>
      <link href="2020/09/23/java/Java-JPA%E6%80%9D%E8%80%83/"/>
      <url>2020/09/23/java/Java-JPA%E6%80%9D%E8%80%83/</url>
      
        <content type="html"><![CDATA[<p><img src="http://img.rc5j.cn/blog20200923170827.png" alt=""></p><p>JPAå³Java Persistence API. 2006å¹´5æœˆ11å·ï¼ŒJPA 1.0 è§„èŒƒä½œä¸º JCP JSR 220 çš„ä¸€éƒ¨åˆ†æœ€ç»ˆè¢«å‘å¸ƒã€‚</p><p>åœ¨PHPä¸–ç•Œå½“ä¸­doctrineã€cake ORM éƒ½æœ‰JPAçš„å½±å­ã€‚</p><span id="more"></span><h2 id="Entity"><a href="#Entity" class="headerlink" title="Entity"></a>Entity</h2><p>æŒä¹…åŒ–å®ä½“æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ Java ç±»ï¼Œå…¶çŠ¶æ€é€šå¸¸æŒä¹…åœ°ä¿å­˜åˆ°å…³ç³»æ•°æ®åº“çš„è¡¨ä¸­ã€‚ è¿™ç§å®ä½“çš„å®ä¾‹å¯¹åº”äºè¡¨ä¸­çš„å„ä¸ªè¡Œã€‚ å®ä½“ä¹‹é—´é€šå¸¸æœ‰å…³ç³»ï¼Œè¿™äº›å…³ç³»é€šè¿‡å¯¹è±¡/å…³ç³»å…ƒæ•°æ®è¡¨ç¤ºã€‚ å¯ä»¥åœ¨å®ä½“ç±»æ–‡ä»¶ä¸­ç›´æ¥ä½¿ç”¨æ³¨é‡Šæ¥æŒ‡å®šè¿™ç§å…³ç³»ï¼Œä¹Ÿå¯ä»¥åœ¨éšåº”ç”¨ç¨‹åºåˆ†å‘çš„å•ç‹¬XMLæè¿°æ–‡ä»¶ä¸­æŒ‡å®šã€‚</p><h2 id="JPQL"><a href="#JPQL" class="headerlink" title="JPQL"></a>JPQL</h2><p>JavaæŒä¹…åŒ–æŸ¥è¯¢è¯­è¨€ ï¼ˆJPQLï¼‰å¯¹å­˜å‚¨åœ¨å…³ç³»æ•°æ®åº“ä¸­çš„å®ä½“è¿›è¡ŒæŸ¥è¯¢ã€‚æŸ¥è¯¢åœ¨è¯­æ³•ä¸Šç±»ä¼¼äºSQLæŸ¥è¯¢ï¼Œä½†æ˜¯æ“ä½œçš„æ˜¯å®ä½“å¯¹è±¡è€Œä¸æ˜¯ç›´æ¥å¯¹æ•°æ®åº“è¡¨è¿›è¡Œæ“ä½œã€‚</p><h2 id="åŠ¨æœº"><a href="#åŠ¨æœº" class="headerlink" title="åŠ¨æœº"></a>åŠ¨æœº</h2><p>åœ¨å¼•å…¥EJB 3.0è§„èŒƒä¹‹å‰ï¼Œè®¸å¤šä¼ä¸šçº§Javaå¼€å‘äººå‘˜ä½¿ç”¨ç”±æŒä¹…åŒ–æ¡†æ¶ï¼ˆä¾‹å¦‚Hibernateï¼‰æˆ–æ•°æ®è®¿é—®å¯¹è±¡ï¼ˆDAOï¼‰æä¾›çš„è½»é‡çº§æŒä¹…åŒ–å¯¹è±¡ï¼Œæ¥ä»£æ›¿å®ä½“beanï¼ˆEJBçš„ä¸€ç§ï¼‰ã€‚ è¿™æ˜¯å› ä¸ºåœ¨ä»¥å‰çš„EJBè§„èŒƒä¸­ï¼Œå®ä½“beanéœ€è¦å¤ªå¤šå¤æ‚çš„ä»£ç å’Œç¹é‡çš„èµ„æºå ç”¨ï¼Œå¹¶ä¸”ç”±äºbeanå’ŒDAOå¯¹è±¡æˆ–æŒä¹…åŒ–æ¡†æ¶ä¹‹é—´çš„æºä»£ç ä¸­çš„äº’è¿å’Œä¾èµ–æ€§ï¼Œå®ƒä»¬åªèƒ½åœ¨Java EEåº”ç”¨ç¨‹åºæœåŠ¡å™¨ä¸­ä½¿ç”¨ã€‚ å› æ­¤ï¼Œæœ€åˆåœ¨ç¬¬ä¸‰æ–¹æŒä¹…æ€§æ¡†æ¶ä¸­æä¾›çš„è®¸å¤šåŠŸèƒ½éƒ½è¢«åˆå¹¶åˆ°Java Persistence APIä¸­ï¼Œå¹¶ä¸”ä»2006å¹´å¼€å§‹ï¼Œ<code>åƒHibernateï¼ˆç‰ˆæœ¬3.2ï¼‰å’ŒTopLink Essentialsè¿™æ ·çš„é¡¹ç›®å·²ç»å®ç°Java Persistence APIè§„èŒƒã€‚</code></p><h2 id="JPAæä¾›å•†"><a href="#JPAæä¾›å•†" class="headerlink" title="JPAæä¾›å•†"></a>JPAæä¾›å•†</h2><p>JPAæ˜¯ä¸€ä¸ªå¼€æºAPIï¼Œå› æ­¤Oracleï¼ŒRedhatï¼ŒEclipseç­‰å„ç§ä¼ä¸šä¾›åº”å•†é€šè¿‡åœ¨å…¶ä¸­æ·»åŠ JPAæŒä¹…æ€§é£æ ¼æ¥æä¾›æ–°äº§å“ã€‚ å…¶ä¸­ä¸€äº›äº§å“åŒ…æ‹¬:</p><p>Hibernate, Eclipselink, Toplink, Spring Data JPA, etc.</p><p>JSRå®šä¹‰äº†æ ‡å‡†ï¼Œä¼—å¤šç»„ç»‡å¯¹è¿™ä¸ªæ ‡å‡†è¿›è¡Œäº†å®ç°ï¼Œè¿™ä½¿å¾—å¼€å‘è€…å‡ ä¹å¯ä»¥åœ¨ä¸åŒçš„å®ç°ç‰ˆæœ¬é‡Œæ— ç¼åˆ‡æ¢ã€‚</p><h2 id="æ³¨è§£-Annotations"><a href="#æ³¨è§£-Annotations" class="headerlink" title="æ³¨è§£ Annotations"></a>æ³¨è§£ Annotations</h2><p>é€šå¸¸ï¼ŒXmlæ–‡ä»¶ç”¨äºé…ç½®ç‰¹å®šç»„ä»¶ï¼Œæˆ–æ˜ å°„ä¸¤ç§ä¸åŒè§„æ ¼çš„ç»„ä»¶ã€‚ åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨æ¡†æ¶ä¸­å•ç‹¬ç»´æŠ¤xmlã€‚ è¿™æ„å‘³ç€åœ¨ç¼–å†™æ˜ å°„xmlæ–‡ä»¶æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°†POJOç±»å±æ€§ä¸mapping.xmlæ–‡ä»¶ä¸­çš„å®ä½“æ ‡è®°è¿›è¡Œæ¯”è¾ƒã€‚</p><p>è¿™æ˜¯è§£å†³æ–¹æ¡ˆ:åœ¨ç±»å®šä¹‰ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ³¨é‡Šç¼–å†™é…ç½®éƒ¨åˆ†ã€‚ æ³¨é‡Šç”¨äºç±»ï¼Œå±æ€§å’Œæ–¹æ³•ã€‚ æ³¨é‡Šä»¥â€œ@â€ç¬¦å·å¼€å¤´ã€‚ åœ¨å£°æ˜ç±»ï¼Œå±æ€§æˆ–æ–¹æ³•ä¹‹å‰å£°æ˜æ³¨é‡Šã€‚ JPAçš„æ‰€æœ‰æ³¨é‡Šéƒ½åœ¨javax.persistenceåŒ…ä¸­å®šä¹‰ã€‚</p><p>ä»¥ä¸‹æ˜¯æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ä½¿ç”¨çš„æ³¨é‡Šåˆ—è¡¨</p><p>æ³¨è§£    æè¿°</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>@Entity</td><td>æ­¤æ‰¹æ³¨æŒ‡å®šå°†ç±»å£°æ˜ä¸ºå®ä½“æˆ–è¡¨</td></tr><tr><td>@Table</td><td>æ­¤æ‰¹æ³¨æŒ‡å®šå£°æ˜è¡¨åã€‚</td></tr><tr><td>@Basic</td><td>æ­¤æ‰¹æ³¨æ˜ç¡®æŒ‡å®šéçº¦æŸå­—æ®µ</td></tr><tr><td>@Embedded</td><td>æ­¤æ‰¹æ³¨æŒ‡å®šç±»æˆ–å®ä½“çš„å±æ€§ï¼Œè¯¥å®ä½“çš„å¯åµŒå…¥ç±»çš„å€¼å®ä¾‹ã€‚</td></tr><tr><td>@Id</td><td>æ­¤æ‰¹æ³¨æŒ‡å®šå±æ€§ï¼Œç”¨äºç±»çš„æ ‡è¯†ï¼ˆè¡¨çš„ä¸»é”®ï¼‰ã€‚</td></tr><tr><td>@GeneratedValue</td><td>æ­¤æ‰¹æ³¨æŒ‡å®šäº†å¦‚ä½•åˆå§‹åŒ–æ ‡è¯†å±æ€§ï¼Œä¾‹å¦‚è‡ªåŠ¨ï¼Œæ‰‹åŠ¨æˆ–ä»åºåˆ—è¡¨ä¸­è·å–çš„å€¼ã€‚</td></tr><tr><td>@Transient</td><td>æ­¤æ‰¹æ³¨æŒ‡å®šäº†ä¸æŒä¹…çš„å±æ€§ï¼Œå³è¯¥å€¼æ°¸è¿œä¸ä¼šå­˜å‚¨åˆ°æ•°æ®åº“ä¸­ã€‚</td></tr><tr><td>@Column</td><td>æ­¤æ‰¹æ³¨ç”¨äºæŒ‡å®šæŒä¹…æ€§å±æ€§çš„åˆ—æˆ–å±æ€§ã€‚</td></tr><tr><td>@SequenceGenerator</td><td>æ­¤æ‰¹æ³¨ç”¨äºå®šä¹‰@GeneratedValueæ‰¹æ³¨ä¸­æŒ‡å®šçš„å±æ€§çš„å€¼ã€‚ å®ƒåˆ›å»ºäº†ä¸€ä¸ªåºåˆ—ã€‚</td></tr><tr><td>@TableGenerator</td><td>æ­¤æ‰¹æ³¨ç”¨äºæŒ‡å®š@GeneratedValueæ‰¹æ³¨ä¸­æŒ‡å®šçš„å±æ€§çš„å€¼ç”Ÿæˆå™¨ã€‚ å®ƒåˆ›å»ºäº†ä¸€ä¸ªä»·å€¼ç”Ÿæˆè¡¨ã€‚</td></tr><tr><td>@AccessType</td><td>æ­¤ç±»æ³¨é‡Šç”¨äºè®¾ç½®è®¿é—®ç±»å‹ã€‚ å¦‚æœè®¾ç½®@AccessTypeï¼ˆFIELDï¼‰ï¼Œåˆ™ä¼šå‘ç”Ÿå­—æ®µè®¿é—®ã€‚ å¦‚æœè®¾ç½®@AccessTypeï¼ˆPROPERTYï¼‰ï¼Œåˆ™å°†è¿›è¡ŒProperty wiseè¯„ä¼°ã€‚</td></tr><tr><td>@JoinColumn</td><td>æ­¤æ‰¹æ³¨ç”¨äºæŒ‡å®šå®ä½“å…³è”æˆ–å®ä½“é›†åˆã€‚ è¿™ç”¨äºå¤šå¯¹ä¸€å’Œä¸€å¯¹å¤šå…³è”ã€‚</td></tr><tr><td>@UniqueConstraint</td><td>æ­¤æ‰¹æ³¨ç”¨äºæŒ‡å®šä¸»è¦æˆ–è¾…åŠ©è¡¨çš„å­—æ®µï¼Œå”¯ä¸€çº¦æŸã€‚</td></tr><tr><td>@ColumnResult</td><td>æ­¤æ‰¹æ³¨ä½¿ç”¨selectå­å¥å¼•ç”¨SQLæŸ¥è¯¢ä¸­çš„åˆ—çš„åç§°ã€‚</td></tr><tr><td>@ManyToMany</td><td>æ­¤æ‰¹æ³¨ç”¨äºå®šä¹‰è¿æ¥è¡¨ä¹‹é—´çš„å¤šå¯¹å¤šå…³ç³»ã€‚</td></tr><tr><td>@ManyToOne</td><td>æ­¤æ‰¹æ³¨ç”¨äºå®šä¹‰è¿æ¥è¡¨ä¹‹é—´çš„å¤šå¯¹ä¸€å…³ç³»ã€‚</td></tr><tr><td>@OneToMany</td><td>æ­¤æ‰¹æ³¨ç”¨äºå®šä¹‰è¿æ¥è¡¨ä¹‹é—´çš„ä¸€å¯¹å¤šå…³ç³»ã€‚</td></tr><tr><td>@OneToOne</td><td>æ­¤æ‰¹æ³¨ç”¨äºå®šä¹‰è¿æ¥è¡¨ä¹‹é—´çš„ä¸€å¯¹ä¸€å…³ç³»ã€‚</td></tr><tr><td>@NamedQueries</td><td>æ­¤æ‰¹æ³¨ç”¨äºæŒ‡å®šå‘½åæŸ¥è¯¢çš„åˆ—è¡¨ã€‚</td></tr><tr><td>@NamedQuery</td><td>æ­¤æ‰¹æ³¨ç”¨äºä½¿ç”¨é™æ€åç§°æŒ‡å®šæŸ¥è¯¢ã€‚</td></tr></tbody></table>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHP QA</title>
      <link href="2020/09/17/php/PHP-QA%E4%B9%8BPHPStan/"/>
      <url>2020/09/17/php/PHP-QA%E4%B9%8BPHPStan/</url>
      
        <content type="html"><![CDATA[<p><img src="http://img.rc5j.cn/blog20200917210020.png" alt=""></p><p>å†™åœ¨å‰é¢ï¼Œå·¥ä½œ7å¹´ï¼ŒPHPä¹Ÿå†™äº†7å¹´äº†ã€‚æœŸé—´ä¹Ÿå†™ä¸€äº›javaå’Œpythonï¼Œä¹Ÿå¯¹å„è¯­è¨€çš„ç‰¹ç‚¹æœ‰ä¸€äº›è‡ªå·±çš„ä½“ä¼šã€‚<br>è¿™æ¬¡å’±ä»¬èŠèŠQAä¹‹ä½™ä¹Ÿæ¥èŠèŠPHPè¯­è¨€æœ¬èº«ã€‚</p><span id="more"></span><p>æ¥åˆ°<code>PHPStan</code>çš„å®˜ç½‘ï¼Œæˆ‘çœ‹åˆ°äº†ä¸€æ®µè¯ã€‚</p><blockquote><p>I really like how much productivity a web developer gains by switching from compiled languages like Java or C# to an interpreted one like PHP. Aside from the dead simple execution model (start, handle one request, and die) and a much shorter feedback loop (no need to wait for the compiler), thereâ€™s a healthy ecosystem of open-source frameworks and libraries to help developers with their everyday tasks. Because of these reasons, PHP is the most popular language for web development by far.</p></blockquote><p>å¤§æ„æ˜¯ä½œè€…å¾ˆä¹æ„çœ‹åˆ°webå¼€å‘è€…ä»¬ä»C#æˆ–Javaè¿™äº›ç¼–è¯‘æ€§è¯­è¨€é‡Œåˆ‡æ¢åˆ°è§£é‡Šè¯­è¨€ã€‚é™¤äº†ç®€å•çš„æ‰§è¡Œæ¨¡å‹ï¼ˆå¯åŠ¨ï¼Œå¤„ç†ä¸€ä¸ªè¯·æ±‚å’Œç»ˆæ­¢ï¼‰å’Œè¾ƒçŸ­çš„åé¦ˆå‘¨æœŸï¼ˆæ— éœ€ç­‰å¾…ç¼–è¯‘ï¼‰ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå¥åº·çš„å¼€æºæ¡†æ¶å’Œåº“ç”Ÿæ€ç³»ç»Ÿå¯å¸®åŠ©å¼€å‘äººå‘˜å®Œæˆæ—¥å¸¸å·¥ä½œä»»åŠ¡ã€‚ç”±äºè¿™äº›åŸå› ï¼ŒPHPæ˜¯è¿„ä»Šä¸ºæ­¢æœ€æµè¡Œçš„Webå¼€å‘è¯­è¨€ã€‚</p><p>è¿™ç¯‡æ–‡ç« æ˜¯ä½œè€…2016å¹´12æœˆ4æ—¥å†™çš„ï¼Œè¯´å®è¯å¯¹äº<code>PHPæ˜¯è¿„ä»Šä¸ºæ­¢æœ€æµè¡Œçš„Webå¼€å‘è¯­è¨€</code>è¿™å¥è¯æˆ‘å·²ç»å¼€å§‹æ€€ç–‘äº†ã€‚è‡³å°‘åœ¨æœ€è¿‘è¿™äº›å¹´ï¼Œåœ¨å›½å†…PHPçš„å¸‚åœºå·²ç»ä¸é‚£ä¹ˆå¥½äº†ã€‚å¹¶ä¸”æˆ‘ä¹Ÿåœ¨è¶‹å‘ä»è§£é‡Šæ€§è¯­è¨€å‘ç¼–è¯‘è¯­è¨€åˆ‡æ¢äº†ã€‚ä½†æ˜¯å…¶ä¸­å¯¹äºè§£é‡Šæ€§è¯­è¨€çš„ä¼˜åŠ¿æè¿°æˆ‘æ˜¯éå¸¸èµåŒçš„ï¼Œè¿™ä¹Ÿæ˜¯å®ƒå®è´µçš„ä¼˜åŠ¿ã€‚</p><ul><li>ç®€å•çš„æ‰§è¡Œæ¨¡å‹</li><li>è¾ƒçŸ­çš„åé¦ˆå‘¨æœŸ</li></ul><h2 id="QAä¹‹PHPStan"><a href="#QAä¹‹PHPStan" class="headerlink" title="QAä¹‹PHPStan"></a>QAä¹‹PHPStan</h2><p>è¨€å½’æ­£ä¼ ï¼Œç»§ç»­PHPStan</p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><pre class="language-none"><code class="language-none">composer require --dev phpstan&#x2F;phpstan</code></pre><h3 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h3><pre class="language-none"><code class="language-none">vendor&#x2F;bin&#x2F;phpstan analyse src tests</code></pre><h2 id="PHPmd"><a href="#PHPmd" class="headerlink" title="PHPmd"></a>PHPmd</h2><pre class="language-none"><code class="language-none">~&#x2F;vendor&#x2F;bin&#x2F;phpmd src&#x2F;Service&#x2F;OrderService.php text codesize,unusedcode,naming</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue+vuex+axios+vant+vue-routerç®€å•å•é¡µç™»å½•æ€demo</title>
      <link href="2020/09/15/web/vue-vuex-axios-vant-vue-router%E7%AE%80%E5%8D%95%E5%8D%95%E9%A1%B5%E7%99%BB%E5%BD%95%E6%80%81demo/"/>
      <url>2020/09/15/web/vue-vuex-axios-vant-vue-router%E7%AE%80%E5%8D%95%E5%8D%95%E9%A1%B5%E7%99%BB%E5%BD%95%E6%80%81demo/</url>
      
        <content type="html"><![CDATA[<p><img src="http://img.rc5j.cn/blog20200915182645.png" alt=""></p><span id="more"></span><h2 id="åˆ›å»ºvanté¡¹ç›®"><a href="#åˆ›å»ºvanté¡¹ç›®" class="headerlink" title="åˆ›å»ºvanté¡¹ç›®"></a>åˆ›å»ºvanté¡¹ç›®</h2><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># å®‰è£… Vue Cli</span><span class="token function">npm</span> <span class="token function">install</span> -g @vue/cli<span class="token comment"># åˆ›å»ºä¸€ä¸ªé¡¹ç›®</span>vue create hello-world<span class="token comment"># åˆ›å»ºå®Œæˆåï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤æ‰“å¼€å›¾å½¢åŒ–ç•Œé¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</span>vue ui<span class="token comment"># æˆ–è€… é€šè¿‡ yarn å®‰è£…</span><span class="token function">yarn</span> <span class="token function">add</span> vant</code></pre><p><img src="http://img.rc5j.cn/blog20200915181419.png" alt=""></p><p>åœ¨å›¾å½¢åŒ–ç•Œé¢ä¸­ï¼Œç‚¹å‡»<code>ä¾èµ–</code> -&gt; <code>å®‰è£…ä¾èµ–</code>ï¼Œç„¶åå°† <code>vant</code> æ·»åŠ åˆ°ä¾èµ–ä¸­å³å¯ã€‚</p><h2 id="vue-router"><a href="#vue-router" class="headerlink" title="vue-router"></a>vue-router</h2><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">yarn</span> <span class="token function">add</span> vue-router</code></pre><pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-nav-bar</span>    <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>æ ‡é¢˜<span class="token punctuation">"</span></span>    <span class="token attr-name">left-text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>è¿”å›<span class="token punctuation">"</span></span>    <span class="token attr-name">right-text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>æŒ‰é’®<span class="token punctuation">"</span></span>    <span class="token attr-name">left-arrow</span>    <span class="token attr-name">@click-left</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>onClickLeft<span class="token punctuation">"</span></span>    <span class="token attr-name">@click-right</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>onClickRight<span class="token punctuation">"</span></span>      <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-view</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-tabbar</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>active<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-tabbar-item</span> <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>home-o<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>ä¸»é¡µ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-tabbar-item</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-tabbar-item</span> <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>æ ‡ç­¾<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-tabbar-item</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-tabbar-item</span> <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>friends-o<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>æ ‡ç­¾<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-tabbar-item</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-tabbar-item</span> <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user-o<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/user/detail<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>æˆ‘çš„<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-tabbar-item</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-tabbar</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-nav-bar</span>    <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>æ ‡é¢˜<span class="token punctuation">"</span></span>    <span class="token attr-name">left-text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>è¿”å›<span class="token punctuation">"</span></span>    <span class="token attr-name">right-text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>æŒ‰é’®<span class="token punctuation">"</span></span>    <span class="token attr-name">left-arrow</span>    <span class="token attr-name">@click-left</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>onClickLeft<span class="token punctuation">"</span></span>    <span class="token attr-name">@click-right</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>onClickRight<span class="token punctuation">"</span></span>      <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-view</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-tabbar</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>active<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-tabbar-item</span> <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>home-o<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>ä¸»é¡µ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-tabbar-item</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-tabbar-item</span> <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>æ ‡ç­¾<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-tabbar-item</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-tabbar-item</span> <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>friends-o<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>æ ‡ç­¾<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-tabbar-item</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-tabbar-item</span> <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user-o<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/user/detail<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>æˆ‘çš„<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-tabbar-item</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-tabbar</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre><p>è·¯ç”±é…ç½®å’Œç™»å½•æ€æ§åˆ¶</p><pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token keyword">import</span> VueRouter <span class="token keyword">from</span> <span class="token string">'vue-router'</span><span class="token comment">// import store from '@/store'</span><span class="token comment">// import layout from '@/layout/layout'</span>Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueRouter<span class="token punctuation">)</span><span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>  <span class="token punctuation">&#123;</span>    path<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>    name<span class="token operator">:</span> <span class="token string">'home'</span><span class="token punctuation">,</span>    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">"@/views/Home"</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#123;</span>    path<span class="token operator">:</span> <span class="token string">'/user/detail'</span><span class="token punctuation">,</span>    name<span class="token operator">:</span> <span class="token string">'user_detail'</span><span class="token punctuation">,</span>    meta<span class="token operator">:</span><span class="token punctuation">&#123;</span>      requireLogin<span class="token operator">:</span><span class="token boolean">true</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">"@/views/User/detail.vue"</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#123;</span>    path<span class="token operator">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span>    name<span class="token operator">:</span> <span class="token string">'login'</span><span class="token punctuation">,</span>    meta<span class="token operator">:</span><span class="token punctuation">&#123;</span>      requireLogin<span class="token operator">:</span><span class="token boolean">false</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">"@/views/Login/login.vue"</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  mode<span class="token operator">:</span> <span class="token string">'history'</span><span class="token punctuation">,</span>  base<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">BASE_URL</span><span class="token punctuation">,</span>  routes<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> token <span class="token operator">=</span> sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// store.getters('isLogin')</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>requireLogin<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//éœ€è¦æ£€æµ‹ç™»å½•</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'å‰å¾€ç™»å½•...'</span><span class="token punctuation">)</span>      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>        path<span class="token operator">:</span> <span class="token string">'/login'</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>     <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">export</span> <span class="token keyword">default</span> router</code></pre><p><img src="http://img.rc5j.cn/blog20200915181827.png" alt=""></p><h2 id="ç™»å½•"><a href="#ç™»å½•" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h2><p>å¼•å…¥<code>axios</code></p><pre class="language-none"><code class="language-none">yarn add axios</code></pre><pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> login <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"@/api/loginReq"</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>      loading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>      loginInfo<span class="token operator">:</span><span class="token punctuation">&#123;</span>          username<span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span>          pwd<span class="token operator">:</span><span class="token string">""</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  methods<span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token function">onSubmit</span><span class="token punctuation">(</span><span class="token parameter">values</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>      <span class="token function">login</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>loginInfo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>code<span class="token operator">===</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">,</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>spring-boot validationæ•°æ®éªŒè¯</title>
      <link href="2020/09/14/java/spring-boot-validation%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81/"/>
      <url>2020/09/14/java/spring-boot-validation%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81/</url>
      
        <content type="html"><![CDATA[<p><img src="http://img.rc5j.cn/blog20200914225941.png" alt=""></p><p>åšä¸šåŠ¡å¤„ç†ï¼Œä¸å¯é¿å…çš„è¦å¯¹å‚æ•°è¿›è¡Œæ ¡éªŒï¼Œä¸€å¥—å®Œæ•´è§„èŒƒçš„æ ¡éªŒä½“ç³»å¯ä»¥æé«˜ä¸å°‘çš„æ•ˆç‡ã€‚</p><p>åœ¨å†™äº†PHPã€javaã€python ç­‰ç¼–ç¨‹è¯­è¨€ä¹‹åï¼Œæˆ‘å‘ç°javaçš„ä¼˜åŠ¿å°±æ˜¯å®ƒçš„è§„èŒƒã€å®ƒçš„ä¸¥è°¨ã€‚åœ¨<code>jsr</code>ä¹‹ä¸‹å»ºç«‹å„ç§åœºæ™¯çš„æ ‡å‡†ï¼Œæ‰€æœ‰äººéƒ½åœ¨è¿™å¥—è§„èŒƒä¸‹æ‹“å±•ã€è¿­ä»£ã€å‡çº§ã€‚æœ€ç»ˆè¿™å¥—ä½“ç³»å˜å¾—è¶Šæ¥è¶Šå®Œç¾ã€ç¬¦åˆä½“ç³»çš„ç”Ÿæ€äº§å“ä¹Ÿè¶Šæ¥è¶Šå¤šã€‚ è¿™å¤§æ¦‚å°±æ˜¯javaæœ€å¼ºä¹‹å¤„å§ã€‚</p><p>æœ¬èŠ‚ä»‹ç»ä¸‹spring-bootçš„éªŒè¯ï¼Œå®ƒä¹Ÿæ˜¯åŸºäº<code>jsr</code>çš„validationä¹‹ä¸‹ã€‚</p><span id="more"></span><h2 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h2><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-validation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>javax.validation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>validation-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.0.1.Final<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">></span></span>jar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>javax.validation æ­£æ˜¯ jsrçš„è§„èŒƒã€‚</p><h2 id="å®šä¹‰éªŒè¯è§„åˆ™"><a href="#å®šä¹‰éªŒè¯è§„åˆ™" class="headerlink" title="å®šä¹‰éªŒè¯è§„åˆ™"></a>å®šä¹‰éªŒè¯è§„åˆ™</h2><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"ç”¨æˆ·åä¸å¯ä¸ºç©º"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@NotNull</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"ä¸å¯ä¸ºç©º"</span><span class="token punctuation">)</span><span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span><span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"å¯†ç ä¸å¯ä¸ºç©º"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@NotNull</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"å¯†ç ä¸å¯ä¸ºç©º"</span><span class="token punctuation">)</span><span class="token keyword">private</span> <span class="token class-name">String</span> pwd<span class="token punctuation">;</span></code></pre><h2 id="controllerä½¿ç”¨"><a href="#controllerä½¿ç”¨" class="headerlink" title="controllerä½¿ç”¨"></a>controllerä½¿ç”¨</h2><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">Response</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Valid</span> <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">LoginInfo</span> loginInfo<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpSession</span> session<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></code></pre><p>è¿™é‡Œè¦å¯¹<code>@Valid</code> è¿›è¡Œä½¿ç”¨</p><h2 id="å…¨å±€å¤„ç†"><a href="#å…¨å±€å¤„ç†" class="headerlink" title="å…¨å±€å¤„ç†"></a>å…¨å±€å¤„ç†</h2><pre class="language-java" data-language="java"><code class="language-java"> <span class="token annotation punctuation">@RestControllerAdvice</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ControllerAdvice</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * ConstraintViolationException     */</span>    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">MethodArgumentNotValidException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">Response</span> <span class="token function">handleConstraintViolationException</span><span class="token punctuation">(</span><span class="token class-name">MethodArgumentNotValidException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> errors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ex<span class="token punctuation">.</span><span class="token function">getBindingResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAllErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> fieldName <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">FieldError</span><span class="token punctuation">)</span> error<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getField</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>fieldName<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> errorMessage <span class="token operator">=</span> error<span class="token punctuation">.</span><span class="token function">getDefaultMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            errors<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>fieldName<span class="token punctuation">,</span> errorMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>errorMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token class-name">ResponseCode</span><span class="token punctuation">.</span>parametrErrror<span class="token punctuation">,</span> <span class="token string">"å‚æ•°é”™è¯¯"</span><span class="token punctuation">,</span> errors<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>ç”±äºä½¿ç”¨<code>@Valid</code>å¯¹å‚æ•°è¿›è¡Œæ ¡éªŒä¹‹åï¼Œå¦‚æœæœ‰æ ¡éªŒä¸é€šè¿‡ä¼šæŠ›å‡ºä¸€ä¸ª<code>MethodArgumentNotValidException</code>å¼‚å¸¸ã€‚å…¨å±€è¿›è¡Œæ•è·ä¹‹åå¯ä»¥å…¨å±€å¤„ç†å‚æ•°ä¸æ­£ç¡®çš„æƒ…å†µã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://www.cnblogs.com/fqybzhangji/p/10384347.html">https://www.cnblogs.com/fqybzhangji/p/10384347.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> spring-boot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IOCå’Œspringå¯¹å®ƒçš„å®ç°</title>
      <link href="2020/09/09/java/IOC%E5%92%8Cspring%E5%AF%B9%E5%AE%83%E7%9A%84%E5%AE%9E%E7%8E%B0/"/>
      <url>2020/09/09/java/IOC%E5%92%8Cspring%E5%AF%B9%E5%AE%83%E7%9A%84%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p><img src="http://img.rc5j.cn/blog20200909211506.png" alt=""></p><span id="more"></span><h2 id="IOSæ¦‚è¿°"><a href="#IOSæ¦‚è¿°" class="headerlink" title="IOSæ¦‚è¿°"></a>IOSæ¦‚è¿°</h2><p><a href="https://www.cnblogs.com/DebugLZQ/archive/2013/06/05/3107957.html">https://www.cnblogs.com/DebugLZQ/archive/2013/06/05/3107957.html</a> è¿™ç¯‡æ–‡ç« å·²ç»è®²çš„å¾ˆå¥½ã€‚</p><p>æˆ‘åšä¸‹æ€»ç»“ã€‚</p><ul><li>é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¸–ç•Œï¼Œç¨‹åºä¹‹é—´çš„è€¦åˆä¸å¯é¿å…ï¼Œè€Œä¸”ä¼šä½¿å¾—ç³»ç»Ÿå˜å¾—éš¾ä»¥ç»´æŠ¤</li><li>IOCå°±æ˜¯ä¸ºäº†é™ä½è¿™ç§è€¦åˆ</li><li>IOSä¹Ÿä¸æ˜¯å®Œç¾çš„ï¼Œæ‰€æœ‰äº‹æƒ…éƒ½æœ‰ä¼˜ç¼ºç‚¹</li></ul><p><img src="http://img.rc5j.cn/blog20200909212010.png" alt=""></p><p>IOCå°±æ˜¯ä¸ºäº†æŠŠåŸæœ¬äº’ç›¸ä¹‹é—´æœ‰è€¦åˆåœ¨ä¸€èµ·ï¼Œä¼šé€ æˆç‰µä¸€å‘è€ŒåŠ¨å…¨èº«çš„ç°è±¡ã€‚é€šè¿‡å®¹å™¨è§£è€¦å¼€,å„è‡ªèƒ½ç‹¬ç«‹è¿ä½œã€‚</p><p><img src="http://img.rc5j.cn/blog20200909212051.png" alt=""></p><h2 id="springçš„å®ç°"><a href="#springçš„å®ç°" class="headerlink" title="springçš„å®ç°"></a>springçš„å®ç°</h2><p>org.springframework.beans å’Œorg.springframework.context åŒ…æ˜¯Spring Framework çš„IoC å®¹å™¨çš„åŸºç¡€ã€‚</p><p>BeanFactory æ¥å£æä¾›é«˜çº§çš„é…ç½®æœºåˆ¶ï¼Œå¯ä»¥ç®¡ç†ä»»æ„ç±»å‹çš„å¯¹è±¡ã€‚</p><ul><li>ApplicationContext æ˜¯BeanFactory çš„å­æ¥å£ã€‚</li><li>å®ƒæ·»åŠ äº†å’ŒSpring çš„AOP ç‰¹æ€§å¾ˆç®€ä¾¿çš„æ•´åˆï¼›</li><li>æ¶ˆæ¯èµ„æºå¤„ç†ï¼ˆç”¨äºå›½é™…åŒ–i18nï¼‰ï¼Œäº‹ä»¶å‘å¸ƒï¼›</li><li>åº”ç”¨å±‚ç‰¹å®šçš„ä¸Šä¸‹æ–‡ï¼Œ æ¯”å¦‚ç”¨äºWeb åº”ç”¨ç¨‹åºçš„WebApplicationContextã€‚</li></ul><p>æ€»ä¹‹ï¼ŒBeanFactory æä¾›äº†é…ç½®æ¡†æ¶å’ŒåŸºæœ¬åŠŸèƒ½ï¼Œè€ŒApplicationContext æ·»åŠ äº†æ›´å¤šä¼ä¸šçº§å¼€å‘ç‰¹å®šçš„åŠŸèƒ½ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>phpç¼–è¯‘å‚æ•°è¯¦è§£</title>
      <link href="2020/09/03/php/php%E7%BC%96%E8%AF%91%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3/"/>
      <url>2020/09/03/php/php%E7%BC%96%E8%AF%91%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<p>å°½ç®¡ç»å†äº†Næ¬¡çš„æ‰‹åŠ¨ç¼–è¯‘ï¼Œä½ å¯èƒ½è¿˜æ˜¯ä¸çŸ¥é“å“ªäº›ç¼–è¯‘å‚æ•°éœ€è¦å“ªäº›ä¸éœ€è¦</p><span id="more"></span><h2 id="help"><a href="#help" class="headerlink" title="help"></a>help</h2><p>æ‰§è¡Œå¸®åŠ©å‘½ä»¤æŸ¥çœ‹ç¼–è¯‘é…ç½®å¸®åŠ©</p><pre class="language-none"><code class="language-none">.&#x2F;configure --help&#x3D;short</code></pre><p>å¾—åˆ°ç»“æœ</p><pre class="language-none"><code class="language-none">Optional Features and Packages:  --disable-option-checking  ignore unrecognized --enable&#x2F;--with options  --disable-FEATURE       do not include FEATURE (same as --enable-FEATURE&#x3D;no)  --enable-FEATURE[&#x3D;ARG]  include FEATURE [ARG&#x3D;yes]  --with-PACKAGE[&#x3D;ARG]    use PACKAGE [ARG&#x3D;yes]  --without-PACKAGE       do not use PACKAGE (same as --with-PACKAGE&#x3D;no)  --with-libdir&#x3D;NAME      Look for libraries in ...&#x2F;NAME rather than ...&#x2F;lib  --disable-rpath         Disable passing additional runtime library                          search paths  --enable-re2c-cgoto     Enable -g flag to re2c to use computed goto gcc extension  --disable-gcc-global-regs                          whether to enable GCC global register variablesSAPI modules:  --with-apxs2&#x3D;FILE       Build shared Apache 2.0 Handler module. FILE is the optional                          pathname to the Apache apxs tool apxs  --disable-cli           Disable building CLI version of PHP                          (this forces --without-pear)  --enable-embed&#x3D;TYPE     EXPERIMENTAL: Enable building of embedded SAPI library                          TYPE is either &#39;shared&#39; or &#39;static&#39;. TYPE&#x3D;shared  --enable-fpm            Enable building of the fpm SAPI executable  fastcgiè¿›ç¨‹ç®¡ç†,è¿™ä¸ªåº”è¯¥å¿…ä¸å¯å°‘  --with-fpm-user&#x3D;USER    Set the user for php-fpm to run as. (default: nobody)  --with-fpm-group&#x3D;GRP    Set the group for php-fpm to run as. For a system user, this                          should usually be set to match the fpm username (default: nobody)  --with-fpm-systemd      Activate systemd integration  --with-fpm-acl          Use POSIX Access Control Lists  --with-litespeed        Build PHP as litespeed module  --enable-phpdbg            Build phpdbg  --enable-phpdbg-webhelper  Build phpdbg web SAPI support  --enable-phpdbg-debug      Build phpdbg in debug mode  --enable-phpdbg-readline   Enable readline support in phpdbg (depends on static ext&#x2F;readline)  --disable-cgi           Disable building CGI version of PHP   ç¦ç”¨cgi  --with-valgrind&#x3D;DIR     Enable valgrind supportGeneral settings:  --enable-gcov           Enable GCOV code coverage (requires LTP) - FOR DEVELOPERS ONLY!!  --enable-debug          Compile with debugging symbols  --with-layout&#x3D;TYPE      Set how installed files will be laid out.  Type can                          be either PHP or GNU [PHP]  --with-config-file-path&#x3D;PATH                          Set the path in which to look for php.ini [PREFIX&#x2F;lib]  --with-config-file-scan-dir&#x3D;PATH                          Set the path where to scan for configuration files  --enable-sigchild       Enable PHP&#39;s own SIGCHLD handler  --enable-libgcc         Enable explicitly linking against libgcc  --disable-short-tags    Disable the short-form &lt;? start tag by default  --enable-dmalloc        Enable dmalloc  --disable-ipv6          Disable IPv6 support  --enable-dtrace         Enable DTrace support  --enable-fd-setsize     Set size of descriptor setsExtensions:  --with-EXTENSION&#x3D;shared[,PATH]    NOTE: Not all extensions can be build as &#39;shared&#39;.    Example: --with-foobar&#x3D;shared,&#x2F;usr&#x2F;local&#x2F;foobar&#x2F;      o Builds the foobar extension as shared extension.      o foobar package install prefix is &#x2F;usr&#x2F;local&#x2F;foobar&#x2F;  --disable-all           Disable all extensions which are enabled by default  --disable-libxml        Disable LIBXML support  --with-libxml-dir&#x3D;DIR   LIBXML: libxml2 install prefix  --with-openssl&#x3D;DIR      Include OpenSSL support (requires OpenSSL &gt;&#x3D; 1.0.1)  --with-kerberos&#x3D;DIR     OPENSSL: Include Kerberos support  --with-system-ciphers   OPENSSL: Use system default cipher list instead of hardcoded value  --with-pcre-regex&#x3D;DIR   Include Perl Compatible Regular Expressions support.                          DIR is the PCRE install prefix BUNDLED  --with-pcre-jit         Enable PCRE JIT functionality (BUNDLED only)  --with-pcre-valgrind&#x3D;DIR                          Enable PCRE valgrind support. Developers only!  --without-sqlite3&#x3D;DIR   Do not include SQLite3 support. DIR is the prefix to                          SQLite3 installation directory.  --with-zlib&#x3D;DIR         Include ZLIB support (requires zlib &gt;&#x3D; 1.2.0.4)  --with-zlib-dir&#x3D;&lt;DIR&gt;   Define the location of zlib install directory  --enable-bcmath         Enable bc style precision math functions  --with-bz2&#x3D;DIR          Include BZip2 support  --enable-calendar       Enable support for calendar conversion  --disable-ctype         Disable ctype functions  --with-curl&#x3D;DIR         Include cURL support  --enable-dba            Build DBA with bundled modules. To build shared DBA                          extension use --enable-dba&#x3D;shared  --with-qdbm&#x3D;DIR         DBA: QDBM support  --with-gdbm&#x3D;DIR         DBA: GDBM support  --with-ndbm&#x3D;DIR         DBA: NDBM support  --with-db4&#x3D;DIR          DBA: Oracle Berkeley DB 4.x or 5.x support  --with-db3&#x3D;DIR          DBA: Oracle Berkeley DB 3.x support  --with-db2&#x3D;DIR          DBA: Oracle Berkeley DB 2.x support  --with-db1&#x3D;DIR          DBA: Oracle Berkeley DB 1.x support&#x2F;emulation  --with-dbm&#x3D;DIR          DBA: DBM support  --with-tcadb&#x3D;DIR        DBA: Tokyo Cabinet abstract DB support  --with-lmdb&#x3D;DIR        DBA: Lightning memory-mapped database support  --without-cdb&#x3D;DIR       DBA: CDB support (bundled)  --disable-inifile       DBA: INI support (bundled)  --disable-flatfile      DBA: FlatFile support (bundled)  --disable-dom           Disable DOM support  --with-libxml-dir&#x3D;DIR   DOM: libxml2 install prefix  --with-enchant&#x3D;DIR      Include enchant support.                          GNU Aspell version 1.1.3 or higher required.  --enable-exif           Enable EXIF (metadata from images) support  --disable-fileinfo      Disable fileinfo support  --disable-filter        Disable input filter support  --with-pcre-dir         FILTER: pcre install prefix  --enable-ftp            Enable FTP support  --with-openssl-dir&#x3D;DIR  FTP: openssl install prefix  --with-gd&#x3D;DIR           Include GD support.  DIR is the GD library base                          install directory BUNDLED  --with-webp-dir&#x3D;DIR      GD: Set the path to libwebp install prefix  --with-jpeg-dir&#x3D;DIR     GD: Set the path to libjpeg install prefix  --with-png-dir&#x3D;DIR      GD: Set the path to libpng install prefix  --with-zlib-dir&#x3D;DIR     GD: Set the path to libz install prefix  --with-xpm-dir&#x3D;DIR      GD: Set the path to libXpm install prefix  --with-freetype-dir&#x3D;DIR GD: Set the path to FreeType 2 install prefix  --enable-gd-jis-conv    GD: Enable JIS-mapped Japanese font support  --with-gettext&#x3D;DIR      Include GNU gettext support  --with-gmp&#x3D;DIR          Include GNU MP support  --with-mhash&#x3D;DIR        Include mhash support  --disable-hash          Disable hash support  --without-iconv&#x3D;DIR     Exclude iconv support  --with-imap&#x3D;DIR         Include IMAP support. DIR is the c-client install prefix  --with-kerberos&#x3D;DIR     IMAP: Include Kerberos support. DIR is the Kerberos install prefix  --with-imap-ssl&#x3D;DIR     IMAP: Include SSL support. DIR is the OpenSSL install prefix  --with-interbase&#x3D;DIR    Include Firebird support.  DIR is the Firebird base                          install directory &#x2F;opt&#x2F;firebird  --enable-intl           Enable internationalization support  --with-icu-dir&#x3D;DIR      Specify where ICU libraries and headers can be found  --disable-json          Disable JavaScript Object Serialization support  --with-ldap&#x3D;DIR         Include LDAP support  --with-ldap-sasl&#x3D;DIR    LDAP: Include Cyrus SASL support  --enable-mbstring       Enable multibyte string support  --disable-mbregex       MBSTRING: Disable multibyte regex support  --disable-mbregex-backtrack                          MBSTRING: Disable multibyte regex backtrack check  --with-libmbfl&#x3D;DIR      MBSTRING: Use external libmbfl.  DIR is the libmbfl base                          install directory BUNDLED  --with-onig&#x3D;DIR         MBSTRING: Use external oniguruma. DIR is the oniguruma install prefix.                          If DIR is not set, the bundled oniguruma will be used  --with-mysqli&#x3D;FILE      Include MySQLi support.  FILE is the path                          to mysql_config.  If no value or mysqlnd is passed                          as FILE, the MySQL native driver will be used  --enable-embedded-mysqli                          MYSQLi: Enable embedded support                          Note: Does not work with MySQL native driver!  --with-mysql-sock&#x3D;SOCKPATH                          MySQLi&#x2F;PDO_MYSQL: Location of the MySQL unix socket pointer.                          If unspecified, the default locations are searched  --with-oci8&#x3D;DIR         Include Oracle Database OCI8 support. DIR defaults to $ORACLE_HOME.                          Use --with-oci8&#x3D;instantclient,&#x2F;path&#x2F;to&#x2F;instant&#x2F;client&#x2F;lib                          to use an Oracle Instant Client installation  --with-odbcver&#x3D;HEX      Force support for the passed ODBC version. A hex number is expected, default 0x0350.                             Use the special value of 0 to prevent an explicit ODBCVER to be defined.  --with-adabas&#x3D;DIR       Include Adabas D support &#x2F;usr&#x2F;local  --with-sapdb&#x3D;DIR        Include SAP DB support &#x2F;usr&#x2F;local  --with-solid&#x3D;DIR        Include Solid support &#x2F;usr&#x2F;local&#x2F;solid  --with-ibm-db2&#x3D;DIR      Include IBM DB2 support &#x2F;home&#x2F;db2inst1&#x2F;sqllib  --with-ODBCRouter&#x3D;DIR   Include ODBCRouter.com support &#x2F;usr  --with-empress&#x3D;DIR      Include Empress support \$EMPRESSPATH                          (Empress Version &gt;&#x3D; 8.60 required)  --with-empress-bcs&#x3D;DIR                          Include Empress Local Access support \$EMPRESSPATH                          (Empress Version &gt;&#x3D; 8.60 required)  --with-birdstep&#x3D;DIR     Include Birdstep support &#x2F;usr&#x2F;local&#x2F;birdstep  --with-custom-odbc&#x3D;DIR  Include user defined ODBC support. DIR is ODBC install base                          directory &#x2F;usr&#x2F;local. Make sure to define CUSTOM_ODBC_LIBS and                          have some odbc.h in your include dirs. f.e. you should define                          following for Sybase SQL Anywhere 5.5.00 on QNX, prior to                          running this configure script:                            CPPFLAGS&#x3D;\&quot;-DODBC_QNX -DSQLANY_BUG\&quot;                            LDFLAGS&#x3D;-lunix                            CUSTOM_ODBC_LIBS&#x3D;\&quot;-ldblib -lodbc\&quot;  --with-iodbc&#x3D;DIR        Include iODBC support &#x2F;usr&#x2F;local  --with-esoob&#x3D;DIR        Include Easysoft OOB support &#x2F;usr&#x2F;local&#x2F;easysoft&#x2F;oob&#x2F;client  --with-unixODBC&#x3D;DIR     Include unixODBC support &#x2F;usr&#x2F;local  --with-dbmaker&#x3D;DIR      Include DBMaker support  --disable-opcache       Disable Zend OPcache support  --disable-opcache-file  Disable file based caching  --disable-huge-code-pages                          Disable copying PHP CODE pages into HUGE PAGES  --enable-pcntl          Enable pcntl support (CLI&#x2F;CGI only)  --disable-pdo           Disable PHP Data Objects support  --with-pdo-dblib&#x3D;DIR    PDO: DBLIB-DB support.  DIR is the FreeTDS home directory  --with-pdo-firebird&#x3D;DIR PDO: Firebird support.  DIR is the Firebird base                          install directory &#x2F;opt&#x2F;firebird  --with-pdo-mysql&#x3D;DIR    PDO: MySQL support. DIR is the MySQL base directory                          If no value or mysqlnd is passed as DIR, the                          MySQL native driver will be used  --with-zlib-dir&#x3D;DIR     PDO_MySQL: Set the path to libz install prefix  --with-pdo-oci&#x3D;DIR      PDO: Oracle OCI support. DIR defaults to $ORACLE_HOME.                          Use --with-pdo-oci&#x3D;instantclient,&#x2F;path&#x2F;to&#x2F;instant&#x2F;client&#x2F;lib                          for an Oracle Instant Client installation.  --with-pdo-odbc&#x3D;flavour,dir                          PDO: Support for &#39;flavour&#39; ODBC driver.  include and lib dirs are looked for under &#39;dir&#39;.  &#39;flavour&#39; can be one of:  ibm-db2, iODBC, unixODBC, generic  If &#39;,dir&#39; part is omitted, default for the flavour  you have selected will be used. e.g.:    --with-pdo-odbc&#x3D;unixODBC  will check for unixODBC under &#x2F;usr&#x2F;local. You may attempt  to use an otherwise unsupported driver using the \&quot;generic\&quot;  flavour.  The syntax for generic ODBC support is:    --with-pdo-odbc&#x3D;generic,dir,libname,ldflags,cflags  When built as &#39;shared&#39; the extension filename is always pdo_odbc.so  --with-pdo-pgsql&#x3D;DIR    PDO: PostgreSQL support.  DIR is the PostgreSQL base                          install directory or the path to pg_config  --without-pdo-sqlite&#x3D;DIR                          PDO: sqlite 3 support.  DIR is the sqlite base                          install directory BUNDLED  --with-pgsql&#x3D;DIR        Include PostgreSQL support.  DIR is the PostgreSQL                          base install directory or the path to pg_config  --disable-phar          Disable phar support  --disable-posix         Disable POSIX-like functions  --with-pspell&#x3D;DIR       Include PSPELL support.                          GNU Aspell version 0.50.0 or higher required  --with-libedit&#x3D;DIR      Include libedit readline replacement (CLI&#x2F;CGI only)  --with-readline&#x3D;DIR     Include readline support (CLI&#x2F;CGI only)  --with-recode&#x3D;DIR       Include recode support  --disable-session       Disable session support  --with-mm&#x3D;DIR           SESSION: Include mm support for session storage  --enable-shmop          Enable shmop support  --disable-simplexml     Disable SimpleXML support  --with-libxml-dir&#x3D;DIR   SimpleXML: libxml2 install prefix  --with-snmp&#x3D;DIR         Include SNMP support  --with-openssl-dir&#x3D;DIR  SNMP: openssl install prefix  --enable-soap           Enable SOAP support  --with-libxml-dir&#x3D;DIR   SOAP: libxml2 install prefix  --enable-sockets        Enable sockets support  --with-sodium&#x3D;DIR     Include sodium support  --with-password-argon2&#x3D;DIR           Include Argon2 support in password_*. DIR is the Argon2 shared library path]  --enable-sysvmsg        Enable sysvmsg support  --enable-sysvsem        Enable System V semaphore support  --enable-sysvshm        Enable the System V shared memory support  --with-tidy&#x3D;DIR         Include TIDY support  --disable-tokenizer     Disable tokenizer support  --enable-wddx           Enable WDDX support  --with-libxml-dir&#x3D;DIR   WDDX: libxml2 install prefix  --with-libexpat-dir&#x3D;DIR WDDX: libexpat dir for XMLRPC-EPI (deprecated)  --disable-xml           Disable XML support  --with-libxml-dir&#x3D;DIR   XML: libxml2 install prefix  --with-libexpat-dir&#x3D;DIR XML: libexpat install prefix (deprecated)  --disable-xmlreader     Disable XMLReader support  --with-libxml-dir&#x3D;DIR   XMLReader: libxml2 install prefix  --with-xmlrpc&#x3D;DIR       Include XMLRPC-EPI support  --with-libxml-dir&#x3D;DIR   XMLRPC-EPI: libxml2 install prefix  --with-libexpat-dir&#x3D;DIR XMLRPC-EPI: libexpat dir for XMLRPC-EPI (deprecated)  --with-iconv-dir&#x3D;DIR    XMLRPC-EPI: iconv dir for XMLRPC-EPI  --disable-xmlwriter     Disable XMLWriter support  --with-libxml-dir&#x3D;DIR   XMLWriter: libxml2 install prefix  --with-xsl&#x3D;DIR          Include XSL support.  DIR is the libxslt base                          install directory (libxslt &gt;&#x3D; 1.1.0 required)  --enable-zend-test           Enable zend-test extension  --enable-zip            Include Zip read&#x2F;write support  --with-zlib-dir&#x3D;DIR     ZIP: Set the path to libz install prefix  --with-pcre-dir         ZIP: pcre install prefix  --with-libzip&#x3D;DIR       ZIP: use libzip  --enable-mysqlnd        Enable mysqlnd explicitly, will be done implicitly                          when required by other extensions  --disable-mysqlnd-compression-support                          Disable support for the MySQL compressed protocol in mysqlnd  --with-zlib-dir&#x3D;DIR     mysqlnd: Set the path to libz install prefixPEAR:  --with-pear&#x3D;DIR         Install PEAR in DIR [PREFIX&#x2F;lib&#x2F;php]  --without-pear          Do not install PEARZend:  --enable-maintainer-zts Enable thread safety - for code maintainers only!!  --disable-inline-optimization                          If building zend_execute.lo fails, try this switch  --disable-zend-signals  whether to enable zend signal handlingTSRM:  --with-tsrm-pth&#x3D;pth-config                          Use GNU Pth  --with-tsrm-st          Use SGI&#39;s State Threads  --with-tsrm-pthreads    Use POSIX threads (default)Libtool:  --enable-shared&#x3D;PKGS    Build shared libraries default&#x3D;yes  --enable-static&#x3D;PKGS    Build static libraries default&#x3D;yes  --enable-fast-install&#x3D;PKGS                          Optimize for fast installation default&#x3D;yes  --with-gnu-ld           Assume the C compiler uses GNU ld default&#x3D;no  --disable-libtool-lock  Avoid locking (might break parallel builds)  --with-pic              Try to use only PIC&#x2F;non-PIC objects default&#x3D;use both  --with-tags&#x3D;TAGS        Include additional configurations automaticSome influential environment variables:  CC          C compiler command  CFLAGS      C compiler flags  LDFLAGS     linker flags, e.g. -L&lt;lib dir&gt; if you have libraries in a              nonstandard directory &lt;lib dir&gt;  LIBS        libraries to pass to the linker, e.g. -l&lt;library&gt;  CPPFLAGS    (Objective) C&#x2F;C++ preprocessor flags, e.g. -I&lt;include dir&gt; if              you have headers in a nonstandard directory &lt;include dir&gt;  CPP         C preprocessor  YACC        The &#96;Yet Another Compiler Compiler&#39; implementation to use.              Defaults to the first program found out of: &#96;bison -y&#39;, &#96;byacc&#39;,              &#96;yacc&#39;.  YFLAGS      The list of arguments that will be passed by default to $YACC.              This script will default YFLAGS to the empty string to avoid a              default value of &#96;-d&#39; given by some make applications.  CXX         C++ compiler command  CXXFLAGS    C++ compiler flags  CXXCPP      C++ preprocessorUse these variables to override the choices made by &#96;configure&#39; or to helpit to find libraries and programs with nonstandard names&#x2F;locations.</code></pre><h2 id="é»˜è®¤æ‹“å±•"><a href="#é»˜è®¤æ‹“å±•" class="headerlink" title="é»˜è®¤æ‹“å±•"></a>é»˜è®¤æ‹“å±•</h2><p>å½“ä¸é…ç½®ä»»ä½•å‚æ•°æ—¶ï¼Œå®ƒé»˜è®¤ä¼šæœ‰å“ªäº›æ‹“å±•å‘¢ï¼Ÿ</p><pre class="language-none"><code class="language-none">php -m</code></pre><pre class="language-none"><code class="language-none">[PHP Modules]CorectypedatedomfileinfofilterhashiconvjsonlibxmlpcrePDOpdo_sqlitePharposixReflectionsessionSimpleXMLSPLsqlite3standardtokenizerxmlxmlreaderxmlwriter[Zend Modules]</code></pre><p>æ­¤æ—¶ä½ ä¼šå‘ç°è¿<code>php-fpm</code>éƒ½æ²¡æœ‰</p><h2 id="å¸¸ç”¨é…ç½®"><a href="#å¸¸ç”¨é…ç½®" class="headerlink" title="å¸¸ç”¨é…ç½®"></a>å¸¸ç”¨é…ç½®</h2><h3 id="ä¾èµ–å®‰è£…"><a href="#ä¾èµ–å®‰è£…" class="headerlink" title="ä¾èµ–å®‰è£…"></a>ä¾èµ–å®‰è£…</h3><pre class="language-none"><code class="language-none">yum install -y libxml2-devel openssl-devel</code></pre><pre class="language-none"><code class="language-none">.&#x2F;configure --enable-fpm  --enable-bcmath  --with-openssl \--enable-mbstring --with-mysqli --enable-mysqlnd</code></pre><h3 id="ç¼–è¯‘å®‰è£…"><a href="#ç¼–è¯‘å®‰è£…" class="headerlink" title="ç¼–è¯‘å®‰è£…"></a>ç¼–è¯‘å®‰è£…</h3><pre class="language-none"><code class="language-none">make &amp;&amp; make install</code></pre><h2 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h2><h3 id="æŸ¥çœ‹inié…ç½®"><a href="#æŸ¥çœ‹inié…ç½®" class="headerlink" title="æŸ¥çœ‹inié…ç½®"></a>æŸ¥çœ‹inié…ç½®</h3><pre class="language-none"><code class="language-none">php -ini | grep &#39;ini&#39;</code></pre><pre class="language-none"><code class="language-none">Configuration File (php.ini) Path &#x3D;&gt; &#x2F;usr&#x2F;local&#x2F;libLoaded Configuration File &#x3D;&gt; &#x2F;usr&#x2F;local&#x2F;lib&#x2F;php.iniScan this dir for additional .ini files &#x3D;&gt; (none)Additional .ini files parsed &#x3D;&gt; (none)user_ini.cache_ttl &#x3D;&gt; 300 &#x3D;&gt; 300user_ini.filename &#x3D;&gt; .user.ini &#x3D;&gt; .user.iniinit_command_executed_count &#x3D;&gt; 0init_command_failed_count &#x3D;&gt; 0com_init_db &#x3D;&gt; 0</code></pre><p>ä»æºä»£ç ç›®å½• å¤åˆ¶é…ç½®æ–‡ä»¶åˆ°<code>Configuration File (php.ini) Path</code></p><pre class="language-none"><code class="language-none">cp php.ini-production &#x2F;usr&#x2F;local&#x2F;lib&#x2F;php.ini</code></pre><h2 id="è®¾ç½®æœåŠ¡-amp-å¼€æœºå¯åŠ¨-centos-7"><a href="#è®¾ç½®æœåŠ¡-amp-å¼€æœºå¯åŠ¨-centos-7" class="headerlink" title="è®¾ç½®æœåŠ¡&amp;å¼€æœºå¯åŠ¨(centos 7+)"></a>è®¾ç½®æœåŠ¡&amp;å¼€æœºå¯åŠ¨(centos 7+)</h2><p>æœåŠ¡æœåŠ¡è„šæœ¬åˆ°systemd</p><pre class="language-none"><code class="language-none">cp sapi&#x2F;fpm&#x2F;php-fpm.service &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;</code></pre><p>æŸ¥çœ‹å¯åŠ¨è„šæœ¬</p><pre class="language-none"><code class="language-none">cat sapi&#x2F;fpm&#x2F;php-fpm.service</code></pre><p>ç»“æœ</p><pre class="language-none"><code class="language-none"># It&#39;s not recommended to modify this file in-place, because it# will be overwritten during upgrades.  If you want to customize,# the best way is to use the &quot;systemctl edit&quot; command.[Unit]Description&#x3D;The PHP FastCGI Process ManagerAfter&#x3D;network.target[Service]Type&#x3D;simplePIDFile&#x3D;&#x2F;usr&#x2F;local&#x2F;var&#x2F;run&#x2F;php-fpm.pidExecStart&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin&#x2F;php-fpm --nodaemonize --fpm-config &#x2F;usr&#x2F;local&#x2F;etc&#x2F;php-fpm.confExecReload&#x3D;&#x2F;bin&#x2F;kill -USR2 $MAINPIDPrivateTmp&#x3D;true[Install]WantedBy&#x3D;multi-user.target</code></pre><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><pre class="language-none"><code class="language-none">cp sapi&#x2F;fpm&#x2F;php-fpm.conf &#x2F;usr&#x2F;local&#x2F;etc&#x2F;php-fpm.conf</code></pre><p>ä¿®æ”¹php-fpm.conf ç›¸åº”é…ç½®ä½¿å¾—PIDFileæ–‡ä»¶ä½ç½®ä¸php-fpm.serviceé…ç½®çš„ä¸€è‡´ã€‚å¹¶å¤åˆ¶<a href="http://www.confåˆ°å¯¹åº”ç›®å½•">www.confåˆ°å¯¹åº”ç›®å½•</a></p><h3 id="å¯åŠ¨-1"><a href="#å¯åŠ¨-1" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h3><pre class="language-none"><code class="language-none">systemctl daemon-reloadsystemctl start php-fpm.servicesystemctl status php-fpm.servicesystemctl enable php-fpm.service</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>supervisorä½¿ç”¨</title>
      <link href="2020/09/02/supervisor%E4%BD%BF%E7%94%A8/"/>
      <url>2020/09/02/supervisor%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>ä½œä¸ºä¸€æ¬¾è¿›ç¨‹ç®¡ç†å·¥å…·ï¼Œsupervisoræ™®éç”¨æ¥ç®¡ç†åº”ç”¨çš„å®ˆæŠ¤è¿›ç¨‹</p><span id="more"></span><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>å¸¸è§„å®‰è£…çš„æ–¹å¼æœ‰ä¸¤ç§,pipå®‰è£…æˆ–å‘è¡Œç‰ˆå®‰è£…</p><p>ä»¥centos 8ä¸ºpipå®‰è£…æ–¹å¼ä¸ºä¾‹ã€‚</p><h3 id="pipå®‰è£…"><a href="#pipå®‰è£…" class="headerlink" title="pipå®‰è£…"></a>pipå®‰è£…</h3><pre class="language-shell" data-language="shell"><code class="language-shell">pip <span class="token function">install</span> supervisor</code></pre><h2 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h2><h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><pre class="language-none"><code class="language-none">echo_supervisord_conf &gt; &#x2F;etc&#x2F;supervisord.conf</code></pre><p>ç”Ÿæˆé…ç½®æ–‡ä»¶</p><h3 id="é…ç½®systemdæœåŠ¡"><a href="#é…ç½®systemdæœåŠ¡" class="headerlink" title="é…ç½®systemdæœåŠ¡"></a>é…ç½®systemdæœåŠ¡</h3><p>å¦‚æœæ˜¯å‘è¡Œç‰ˆå®‰è£…ï¼Œé»˜è®¤ä¼šé…ç½®å¥½å¼€æœºå¯åŠ¨æœåŠ¡ã€‚å¦‚æœéå‘è¡Œç‰ˆå®‰è£…ï¼Œå¯ä»¥æ‰‹åŠ¨é…ç½®ã€‚</p><p>There are user-contributed scripts for various operating systems at: <a href="https://github.com/Supervisor/initscripts">https://github.com/Supervisor/initscripts</a></p><p>æ³¨æ„ï¼Œäº‹å®ä¸Šgithubä¸Šçš„è„šæœ¬æœ‰ç‚¹é—®é¢˜ï¼Œä¸å®é™…å®‰è£…çš„ç›®å½•ä½ç½®ä¸åŒ¹é…ã€‚ç¨ä½œä¿®æ”¹</p><pre class="language-ini" data-language="ini"><code class="language-ini"><span class="token comment"># supervisord service for systemd (CentOS 7.0+)</span><span class="token comment"># by ET-CS (https://github.com/ET-CS)</span><span class="token header"><span class="token punctuation">[</span><span class="token section-name selector">Unit</span><span class="token punctuation">]</span></span><span class="token key attr-name">Description</span><span class="token punctuation">=</span><span class="token value attr-value">Supervisor daemon</span><span class="token header"><span class="token punctuation">[</span><span class="token section-name selector">Service</span><span class="token punctuation">]</span></span><span class="token key attr-name">Type</span><span class="token punctuation">=</span><span class="token value attr-value">forking</span><span class="token key attr-name">ExecStart</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/local/bin/supervisord</span><span class="token key attr-name">ExecStop</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/local/bin/supervisorctl $OPTIONS shutdown</span><span class="token key attr-name">ExecReload</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/local/bin/supervisorctl $OPTIONS reload</span><span class="token key attr-name">KillMode</span><span class="token punctuation">=</span><span class="token value attr-value">process</span><span class="token key attr-name">Restart</span><span class="token punctuation">=</span><span class="token value attr-value">on-failure</span><span class="token key attr-name">RestartSec</span><span class="token punctuation">=</span><span class="token value attr-value">42s</span><span class="token header"><span class="token punctuation">[</span><span class="token section-name selector">Install</span><span class="token punctuation">]</span></span><span class="token key attr-name">WantedBy</span><span class="token punctuation">=</span><span class="token value attr-value">multi-user.target</span></code></pre><p>å°†æ­¤æ–‡ä»¶ä¸ºä¿å­˜ä¸º <code>vim /etc/systemd/system/supervisord.service</code></p><h3 id="å¯åŠ¨æœåŠ¡"><a href="#å¯åŠ¨æœåŠ¡" class="headerlink" title="å¯åŠ¨æœåŠ¡"></a>å¯åŠ¨æœåŠ¡</h3><p>é‡æ–°è¯»å–æ‰€æœ‰æœåŠ¡é¡¹</p><pre class="language-none"><code class="language-none">systemctl daemon-reload</code></pre><p>å¯åŠ¨æœåŠ¡</p><pre class="language-none"><code class="language-none">systemctl start supervisord.service</code></pre><p>å¼€æœºå¯åŠ¨</p><pre class="language-none"><code class="language-none">systemctl enable supervisord.service</code></pre><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><h3 id="å¯ç”¨å­é…ç½®ç›®å½•"><a href="#å¯ç”¨å­é…ç½®ç›®å½•" class="headerlink" title="å¯ç”¨å­é…ç½®ç›®å½•"></a>å¯ç”¨å­é…ç½®ç›®å½•</h3><p><code>vim /etc/supervisord.conf</code><br>æœ€å2è¡Œæ‰“å¼€æ³¨é‡Šå¹¶ç¼–è¾‘ä¸º</p><pre class="language-none"><code class="language-none">[include]files &#x3D; .&#x2F;supervisord.d&#x2F;*.ini</code></pre><p>é‡å¯</p><pre class="language-none"><code class="language-none">systemctl reload supervisord.service# æˆ–è€…supervisorctl reload</code></pre><h3 id="æ·»åŠ é¡¹ç›®"><a href="#æ·»åŠ é¡¹ç›®" class="headerlink" title="æ·»åŠ é¡¹ç›®"></a>æ·»åŠ é¡¹ç›®</h3><p><code>vim /etc/supervisord.d/glances.ini</code></p><pre class="language-ini" data-language="ini"><code class="language-ini"><span class="token header"><span class="token punctuation">[</span><span class="token section-name selector">program:glances</span><span class="token punctuation">]</span></span><span class="token key attr-name">command</span><span class="token punctuation">=</span><span class="token value attr-value">glances --export influxdb -q</span><span class="token key attr-name">process_name</span><span class="token punctuation">=</span><span class="token value attr-value">%(program_name)s</span><span class="token key attr-name">numprocs</span><span class="token punctuation">=</span><span class="token value attr-value">1</span><span class="token key attr-name">directory</span><span class="token punctuation">=</span><span class="token value attr-value">/tmp</span><span class="token key attr-name">umask</span><span class="token punctuation">=</span><span class="token value attr-value">022</span><span class="token key attr-name">priority</span><span class="token punctuation">=</span><span class="token value attr-value">999</span><span class="token key attr-name">autostart</span><span class="token punctuation">=</span><span class="token value attr-value">true</span><span class="token key attr-name">autorestart</span><span class="token punctuation">=</span><span class="token value attr-value">unexpected</span><span class="token key attr-name">startsecs</span><span class="token punctuation">=</span><span class="token value attr-value">10</span><span class="token key attr-name">startretries</span><span class="token punctuation">=</span><span class="token value attr-value">3</span><span class="token key attr-name">exitcodes</span><span class="token punctuation">=</span><span class="token value attr-value">0</span><span class="token key attr-name">stopsignal</span><span class="token punctuation">=</span><span class="token value attr-value">TERM</span><span class="token key attr-name">stopwaitsecs</span><span class="token punctuation">=</span><span class="token value attr-value">10</span><span class="token key attr-name">stopasgroup</span><span class="token punctuation">=</span><span class="token value attr-value">false</span><span class="token key attr-name">killasgroup</span><span class="token punctuation">=</span><span class="token value attr-value">false</span><span class="token key attr-name">user</span><span class="token punctuation">=</span><span class="token value attr-value">root</span><span class="token key attr-name">redirect_stderr</span><span class="token punctuation">=</span><span class="token value attr-value">false</span><span class="token key attr-name">stdout_logfile</span><span class="token punctuation">=</span><span class="token value attr-value">/var/log/glances/glances-out.log</span><span class="token key attr-name">stdout_logfile_maxbytes</span><span class="token punctuation">=</span><span class="token value attr-value">1MB</span><span class="token key attr-name">stdout_logfile_backups</span><span class="token punctuation">=</span><span class="token value attr-value">10</span><span class="token key attr-name">stdout_capture_maxbytes</span><span class="token punctuation">=</span><span class="token value attr-value">1MB</span><span class="token key attr-name">stdout_events_enabled</span><span class="token punctuation">=</span><span class="token value attr-value">false</span><span class="token key attr-name">stderr_logfile</span><span class="token punctuation">=</span><span class="token value attr-value">/var/log/glances/glances-err.log</span><span class="token key attr-name">stderr_logfile_maxbytes</span><span class="token punctuation">=</span><span class="token value attr-value">1MB</span><span class="token key attr-name">stderr_logfile_backups</span><span class="token punctuation">=</span><span class="token value attr-value">10</span><span class="token key attr-name">stderr_capture_maxbytes</span><span class="token punctuation">=</span><span class="token value attr-value">1MB</span></code></pre><p>æ³¨æ„å…ˆå»ºå¥½ç›®å½• <code>/var/log/glances</code></p><h3 id="é‡æ–°è¯»å–é…ç½®å¹¶å¯ç”¨"><a href="#é‡æ–°è¯»å–é…ç½®å¹¶å¯ç”¨" class="headerlink" title="é‡æ–°è¯»å–é…ç½®å¹¶å¯ç”¨"></a>é‡æ–°è¯»å–é…ç½®å¹¶å¯ç”¨</h3><pre class="language-none"><code class="language-none">supervisorctl reloadsupervisorctl start glances</code></pre><h3 id="å¯æŸ¥çœ‹è¿è¡ŒçŠ¶æ€"><a href="#å¯æŸ¥çœ‹è¿è¡ŒçŠ¶æ€" class="headerlink" title="å¯æŸ¥çœ‹è¿è¡ŒçŠ¶æ€"></a>å¯æŸ¥çœ‹è¿è¡ŒçŠ¶æ€</h3><pre class="language-none"><code class="language-none">supervisorctl status</code></pre><p>ç»“æœ</p><pre class="language-none"><code class="language-none">glances                          RUNNING   pid 46026, uptime 0:05:05</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> è¿ç»´ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysqlå­—ç¬¦é›†é—®é¢˜</title>
      <link href="2020/09/01/mysql%E5%AD%97%E7%AC%A6%E9%9B%86%E9%97%AE%E9%A2%98/"/>
      <url>2020/09/01/mysql%E5%AD%97%E7%AC%A6%E9%9B%86%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>ç°ä»£äº§å“å’Œå›½é™…åŒ–äº§å“å»ºè®®éƒ½ä½¿ç”¨utf8mb4å­—ç¬¦é›†ï¼Œè¡¨æƒ…å·²æ— å¤„ä¸åœ¨ğŸ¤–ğŸ¦–ã€‚äººç”Ÿè‹¦çŸ­å»ºè®®mb4.</p><span id="more"></span><p>mysql å¯ä»¥è®¾ç½®æ•°æ®åº“çº§åˆ«ï¼Œè¡¨çº§åˆ«ï¼Œåˆ—çº§åˆ« å­—ç¬¦é›†ç¼–ç ï¼›æ§åˆ¶ç²’åº¦ä¾æ¬¡ç»†åŒ–ï¼Œä¹Ÿå°±æ˜¯å¦‚æœéƒ½è®¾ç½®äº†ï¼Œåˆ—çº§åˆ«ä¼˜å…ˆçº§æœ€é«˜ã€‚</p><p>å®šä¹‰æ•°æ®è¡¨ç»“æ„æ—¶å»ºè®®ä¸è¦å®šä¹‰åˆ—çš„å­—ç¬¦é›†ï¼Œä»¥å…å°†æ¥ä¿®æ”¹å˜å¾—éº»çƒ¦ã€‚</p><h2 id="ä¿®æ”¹è¡¨çš„å­—ç¬¦é›†"><a href="#ä¿®æ”¹è¡¨çš„å­—ç¬¦é›†" class="headerlink" title="ä¿®æ”¹è¡¨çš„å­—ç¬¦é›†"></a>ä¿®æ”¹è¡¨çš„å­—ç¬¦é›†</h2><h3 id="ä¿®æ”¹è¡¨çš„å­—ç¬¦é›†-å¹¶åˆ·æ–°ä¹‹å‰å·²å­˜åœ¨çš„æ•°æ®"><a href="#ä¿®æ”¹è¡¨çš„å­—ç¬¦é›†-å¹¶åˆ·æ–°ä¹‹å‰å·²å­˜åœ¨çš„æ•°æ®" class="headerlink" title="ä¿®æ”¹è¡¨çš„å­—ç¬¦é›† å¹¶åˆ·æ–°ä¹‹å‰å·²å­˜åœ¨çš„æ•°æ®"></a>ä¿®æ”¹è¡¨çš„å­—ç¬¦é›† å¹¶åˆ·æ–°ä¹‹å‰å·²å­˜åœ¨çš„æ•°æ®</h3><pre class="language-none"><code class="language-none">ALTER table table_name CONVERT to CHARACTER set  æ–°çš„å­—ç¬¦é›†; </code></pre><h3 id="ä¿®æ”¹è¡¨çš„å­—ç¬¦é›†ï¼Œä½†ä¸å¯¹ä¹‹å‰å·²å­˜åœ¨çš„æ•°æ®åˆ·æ–°"><a href="#ä¿®æ”¹è¡¨çš„å­—ç¬¦é›†ï¼Œä½†ä¸å¯¹ä¹‹å‰å·²å­˜åœ¨çš„æ•°æ®åˆ·æ–°" class="headerlink" title="ä¿®æ”¹è¡¨çš„å­—ç¬¦é›†ï¼Œä½†ä¸å¯¹ä¹‹å‰å·²å­˜åœ¨çš„æ•°æ®åˆ·æ–°"></a>ä¿®æ”¹è¡¨çš„å­—ç¬¦é›†ï¼Œä½†ä¸å¯¹ä¹‹å‰å·²å­˜åœ¨çš„æ•°æ®åˆ·æ–°</h3><pre class="language-none"><code class="language-none">ALTER table table_name DEFAULT to CHARACTER set  æ–°çš„å­—ç¬¦é›†; </code></pre><h2 id="æ‰¹é‡ä¿®æ”¹"><a href="#æ‰¹é‡ä¿®æ”¹" class="headerlink" title="æ‰¹é‡ä¿®æ”¹"></a>æ‰¹é‡ä¿®æ”¹</h2><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span>CONCAT<span class="token punctuation">(</span><span class="token string">'ALTER TABLE '</span><span class="token punctuation">,</span>TABLE_NAME<span class="token punctuation">,</span><span class="token string">' CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;'</span><span class="token punctuation">)</span><span class="token keyword">FROM</span>information_schema<span class="token punctuation">.</span><span class="token punctuation">`</span><span class="token keyword">TABLES</span><span class="token punctuation">`</span><span class="token keyword">WHERE</span>TABLE_SCHEMA <span class="token operator">=</span> <span class="token string">'DATABASE_NAME'</span><span class="token punctuation">;</span></code></pre><p>å¾—åˆ°ä¿®æ”¹è¯­å¥ï¼Œå¤åˆ¶å‡ºæ‰§è¡Œè¯­å¥ï¼Œè¿›è¡Œæ‰§è¡Œã€‚å¦‚æœæ•°æ®åº“æ•°æ®è¾ƒå¤šï¼Œå°†ä¼šæ¯”è¾ƒè€—æ—¶ã€‚</p><p>å¦‚æœåªæ˜¯ä¿®æ”¹é»˜è®¤å­—ç¬¦é›†ä¸ä¿®æ”¹æ•°æ®ã€‚</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span>CONCAT<span class="token punctuation">(</span><span class="token string">'ALTER TABLE '</span><span class="token punctuation">,</span>TABLE_NAME<span class="token punctuation">,</span><span class="token string">' DEFAULT  CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;'</span><span class="token punctuation">)</span><span class="token keyword">FROM</span>information_schema<span class="token punctuation">.</span><span class="token punctuation">`</span><span class="token keyword">TABLES</span><span class="token punctuation">`</span><span class="token keyword">WHERE</span>TABLE_SCHEMA <span class="token operator">=</span> <span class="token string">'DATABASE_NAME'</span><span class="token punctuation">;</span></code></pre><p>è¿™æ ·æ‰§è¡Œåº”è¯¥è¾ƒä¸ºå®‰å…¨ï¼Œä¹Ÿæ»¡è¶³ä¸€èˆ¬éœ€æ±‚ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javaå¼€å‘ç¯å¢ƒå‡†å¤‡</title>
      <link href="2020/08/27/java/mac%E4%B8%8B%E4%BD%BF%E7%94%A8openjdk-11/"/>
      <url>2020/08/27/java/mac%E4%B8%8B%E4%BD%BF%E7%94%A8openjdk-11/</url>
      
        <content type="html"><![CDATA[<h2 id="JDK"><a href="#JDK" class="headerlink" title="JDK"></a>JDK</h2><p>æœ€è¿‘ä¼¼ä¹java 8ä»¥ä¸Šçš„ç‰ˆæœ¬éƒ½ä¸èƒ½ä»oracleå®˜ç½‘ä¸‹è½½äº†ï¼Œäºæ˜¯å°±å°è¯•ä½¿ç”¨open jdk11</p><p><img src="http://img.rc5j.cn/blog20200827114344.png" alt=""></p><span id="more"></span><h3 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h3><p>å¯ä»¥ä» <a href="https://mirrors.huaweicloud.com/openjdk/">https://mirrors.huaweicloud.com/openjdk/</a> ä¸‹è½½å¾—åˆ°</p><h3 id="macå®‰è£…"><a href="#macå®‰è£…" class="headerlink" title="macå®‰è£…"></a>macå®‰è£…</h3><pre class="language-none"><code class="language-none">sudo mv &#x2F;Downloads&#x2F;jdk11 &#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk-11.jdk</code></pre><h3 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h3><p>é…ç½®bash_profile</p><p><code>vim ~/.bash_profile</code></p><pre class="language-none"><code class="language-none">JAVA_HOME&#x3D;&quot;&#x2F;usr&#x2F;local&#x2F;jdk-11.0.2&quot;PATH&#x3D;$PATH:$HOME&#x2F;bin:$JAVA_HOME&#x2F;binexport PATH</code></pre><h2 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h2><h3 id="æºç å®‰è£…"><a href="#æºç å®‰è£…" class="headerlink" title="æºç å®‰è£…"></a>æºç å®‰è£…</h3><p>Maven ä¸‹è½½åœ°å€ï¼š<a href="http://maven.apache.org/download.cgi">http://maven.apache.org/download.cgi</a></p><h3 id="mac-brew-å®‰è£…"><a href="#mac-brew-å®‰è£…" class="headerlink" title="mac brew å®‰è£…"></a>mac brew å®‰è£…</h3><pre class="language-shell" data-language="shell"><code class="language-shell">brew <span class="token function">install</span> maven</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>glances+influxdb+granfanaæ‰“é€ æœåŠ¡å™¨ç›‘æ§ç³»ç»Ÿ</title>
      <link href="2020/08/25/glances-influxdb-granfana%E6%89%93%E9%80%A0%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F/"/>
      <url>2020/08/25/glances-influxdb-granfana%E6%89%93%E9%80%A0%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F/</url>
      
        <content type="html"><![CDATA[<p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210430141234.png" alt=""></p><p>æœåŠ¡ç›‘æ§å°±æ˜¯ä½ çš„çœ¼ç›ï¼Œå½“ä½ å¯¹æœåŠ¡å™¨è¿è¡ŒçŠ¶å†µä¸€æ— æ‰€çŸ¥æ—¶ï¼Œä½ åº”è¯¥æ„Ÿåˆ°åç«‹ä¸å®‰ã€‚</p><span id="more"></span><h2 id="glanceså®‰è£…"><a href="#glanceså®‰è£…" class="headerlink" title="glanceså®‰è£…"></a>glanceså®‰è£…</h2><p>glancesæ˜¯ç”±pythonç¼–å†™çš„ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨pipç›´æ¥å®‰è£…</p><pre class="language-none"><code class="language-none">pip3 install glances</code></pre><h2 id="influxdbå®‰è£…"><a href="#influxdbå®‰è£…" class="headerlink" title="influxdbå®‰è£…"></a>influxdbå®‰è£…</h2><pre class="language-none"><code class="language-none">wget https:&#x2F;&#x2F;dl.influxdata.com&#x2F;influxdb&#x2F;releases&#x2F;influxdb-1.8.2.x86_64.rpmsudo yum localinstall influxdb-1.8.2.x86_64.rpm</code></pre><h2 id="æ”¶é›†æ•°æ®åˆ°influxdb"><a href="#æ”¶é›†æ•°æ®åˆ°influxdb" class="headerlink" title="æ”¶é›†æ•°æ®åˆ°influxdb"></a>æ”¶é›†æ•°æ®åˆ°influxdb</h2><p>é…ç½® glances</p><p><code>vim /etc/glances/glances.conf</code></p><pre class="language-ini" data-language="ini"><code class="language-ini"><span class="token header"><span class="token punctuation">[</span><span class="token section-name selector">influxdb</span><span class="token punctuation">]</span></span><span class="token comment"># Configuration for the --export influxdb option</span><span class="token comment"># https://influxdb.com/</span><span class="token key attr-name">host</span><span class="token punctuation">=</span><span class="token value attr-value">localhost</span><span class="token key attr-name">port</span><span class="token punctuation">=</span><span class="token value attr-value">8086</span><span class="token key attr-name">user</span><span class="token punctuation">=</span><span class="token value attr-value">root</span><span class="token key attr-name">password</span><span class="token punctuation">=</span><span class="token value attr-value">root</span><span class="token key attr-name">db</span><span class="token punctuation">=</span><span class="token value attr-value">glances</span><span class="token key attr-name">prefix</span><span class="token punctuation">=</span><span class="token value attr-value">localhost</span><span class="token comment">#tags=foo:bar,spam:eggs</span></code></pre><pre class="language-none"><code class="language-none">pip3 install influxdbglances --export influxdb</code></pre><p>æ‰§è¡Œ <code>glances --export influxdb</code> æµ‹è¯•ä¸‹ï¼ŒæŠ¥é”™</p><p><code>InfluxDB database &#39;glances&#39; did not exist. Please create it</code>éœ€è¦æ–°å»ºæ•°æ®åº“ã€‚</p><p>æ‰§è¡Œshell <code>influx</code></p><pre class="language-none"><code class="language-none">CREATE DATABASE glances  #åˆ›å»ºæ•°æ®SHOW DATABASES   # æŸ¥çœ‹æ•°æ®åº“</code></pre><p>å†æ¬¡æ‰§è¡Œ<code>glances --export influxdb</code> ,å¯æ˜¾ç¤ºå¦‚ä¸‹ä»£è¡¨ç›®å‰ä¸€åˆ‡æ­£å¸¸</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210430141339.png" alt=""></p><h2 id="ä½œä¸ºæœåŠ¡è¿è¡Œ"><a href="#ä½œä¸ºæœåŠ¡è¿è¡Œ" class="headerlink" title="ä½œä¸ºæœåŠ¡è¿è¡Œ"></a>ä½œä¸ºæœåŠ¡è¿è¡Œ</h2><p>æ­¤æ—¶æˆ‘ä»¬éœ€è¦ç¼–å†™.serviceè„šæœ¬ä½œä¸ºæœåŠ¡åå°è¿è¡Œ</p><pre class="language-service" data-language="service"><code class="language-service">[Unit]Description&#x3D;glances  daemonAfter&#x3D;network.target influxdb.service[Service]User&#x3D;rootGroup&#x3D;rootExecStart&#x3D;&#x2F;usr&#x2F;local&#x2F;bin&#x2F;glances --quiet --export influxdbType&#x3D;simpleKillMode&#x3D;process[Install]WantedBy&#x3D;multi-user.target</code></pre><p>å‘½åè¯¥æ–‡ä»¶ä¸º<code>glances.service</code>å¹¶æ”¾åˆ°<code>/usr/lib/systemd/system</code>ç›®å½•ä¸‹</p><p><code>systemctl start glances</code> å¯åŠ¨</p><p>æ›´å¤šçš„ <code>service</code>è„šæœ¬ç¼–å†™å¯å‚è€ƒï¼Œ<a href="http://www.jinbuguo.com/systemd/systemd.service.html">http://www.jinbuguo.com/systemd/systemd.service.html</a></p><h2 id="granfanaå®‰è£…"><a href="#granfanaå®‰è£…" class="headerlink" title="granfanaå®‰è£…"></a>granfanaå®‰è£…</h2><pre class="language-none"><code class="language-none">wget https:&#x2F;&#x2F;dl.grafana.com&#x2F;oss&#x2F;release&#x2F;grafana-7.1.5-1.x86_64.rpmsudo yum install grafana-7.1.5-1.x86_64.rpm</code></pre><h3 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h3><pre class="language-shell" data-language="shell"><code class="language-shell">systemctl daemon-reloadsystemctl start grafana-serversystemctl status grafana-serversystemctl <span class="token builtin class-name">enable</span> grafana-server.service</code></pre><h3 id="docker-granfanaå®‰è£…"><a href="#docker-granfanaå®‰è£…" class="headerlink" title="docker-granfanaå®‰è£…"></a>docker-granfanaå®‰è£…</h3><pre class="language-yml" data-language="yml"><code class="language-yml"><span class="token comment"># docker-compose.yml</span><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3.1"</span><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">grafana</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> grafana/grafana<span class="token punctuation">:</span>5.1.0    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> 3001<span class="token punctuation">:</span><span class="token number">3000</span>    <span class="token key atrule">environment</span><span class="token punctuation">:</span>        <span class="token punctuation">-</span> GF_SECURITY_ADMIN_PASSWORD__FILE=/run/secrets/granfa_admin_pwd <span class="token comment"># 5.2.0ä¹‹åæ‰å¯ç”¨</span></code></pre><h3 id="nginxé…ç½®"><a href="#nginxé…ç½®" class="headerlink" title="nginxé…ç½®"></a>nginxé…ç½®</h3><pre class="language-conf" data-language="conf"><code class="language-conf"> server &#123;        listen       80;        server_name  grafana-dev.domain.cn;        #charset koi8-r;        location &#x2F; &#123;           proxy_pass  http:&#x2F;&#x2F;127.0.0.1:3001;           proxy_http_version 1.1;           proxy_set_header Upgrade $http_upgrade;           proxy_set_header Connection &quot;upgrade&quot;;        &#125;&#125;</code></pre><p>å°±å¯ä»¥åœ¨webä¸Šè¿›è¡Œè®¿é—®,åˆå§‹çš„è´¦å·å¯†ç éƒ½æ˜¯<code>admin</code></p><h3 id="é…ç½®æ•°æ®æº"><a href="#é…ç½®æ•°æ®æº" class="headerlink" title="é…ç½®æ•°æ®æº"></a>é…ç½®æ•°æ®æº</h3><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210430141408.png" alt=""></p><p>dockerå®‰è£…æƒ…å†µåº”æ³¨æ„dockerå®¹å™¨ip å’Œå®¿ä¸»æœºip</p><pre class="language-shell" data-language="shell"><code class="language-shell">docker network <span class="token function">ls</span> <span class="token comment"># æŸ¥çœ‹dockerç½‘ç»œ</span>docker network inspect <span class="token variable">$networkid</span> <span class="token comment"># æŸ¥çœ‹å…·ä½“ç½‘ç»œä¿¡æ¯</span></code></pre><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210811145603.png" alt=""></p><p>åœ¨é…ç½®<code>influxdb</code> æ•°æ®æºæ—¶ï¼Œå¦‚æœä½ æ˜¯ç”¨<code>docker</code>å®‰è£…ï¼Œéœ€è¦ä¿æŒ<code>granfana</code>å’Œ<code>influxdb</code>æ˜¯åœ¨åŒä¸€ä¸ªç½‘æ®µ</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210811145551.png" alt=""></p><p>æ·»åŠ ä¸€ä¸ªçœ‹æ¿</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210811150952.png" alt=""></p><p>grafana è¿˜æ”¯æŒzipkin</p><p><img src="https://vison-blog.oss-cn-beijing.aliyuncs.com/20210430141436.png" alt=""></p>]]></content>
      
      
      
        <tags>
            
            <tag> devops </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vuetifyjså›¾æ ‡è§£å†³æ–¹æ¡ˆ</title>
      <link href="2020/08/24/web/vuetifyjs%E5%9B%BE%E6%A0%87%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
      <url>2020/08/24/web/vuetifyjs%E5%9B%BE%E6%A0%87%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</url>
      
        <content type="html"><![CDATA[<p><img src="http://img.rc5j.cn/blog20200824102537.png" alt=""></p><p>vuetifyjså®˜æ–¹æä¾›çš„æ–¹æ³•å®é™…è¿ç”¨å½“ä¸­ä¼¼ä¹ä¼šå­˜åœ¨ä¸€äº›å…¼å®¹é—®é¢˜ï¼Œæ¯”å¦‚ä½¿ç”¨Font Awesomeæ—¶æœ‰äº›å›¾æ ‡å°±ä¸ä¼šæ­£å¸¸æ˜¾ç¤ºã€‚</p><span id="more"></span><h2 id="Font-Awesome"><a href="#Font-Awesome" class="headerlink" title="Font Awesome"></a>Font Awesome</h2><pre class="language-html" data-language="html"><code class="language-html"><span class="token comment">&lt;!-- å®˜æ–¹ --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-icon</span><span class="token punctuation">></span></span>fas fa-php<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-icon</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- æ›¿ä»£ --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fab fa-php v-icon<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span></code></pre><p>æœ‰äº›å›¾æ ‡ä¸æ˜¾ç¤ºçš„é—®é¢˜å¯ä»¥ä½¿ç”¨ä¸Šè¿°æ–¹æ³•æ›¿ä»£è§£å†³</p><h2 id="ä½¿ç”¨é˜¿é‡Œå·´å·´å­—ä½“"><a href="#ä½¿ç”¨é˜¿é‡Œå·´å·´å­—ä½“" class="headerlink" title="ä½¿ç”¨é˜¿é‡Œå·´å·´å­—ä½“"></a>ä½¿ç”¨é˜¿é‡Œå·´å·´å­—ä½“</h2><p>é˜¿é‡Œå·´å·´å­—ä½“éå¸¸å¤šéå¸¸åºå¤§ï¼ŒåŸºæœ¬æƒ³è¦çš„éƒ½æœ‰ï¼Œè€Œå›½å¤–çš„å¾ˆå¤šä¸èƒ½ç”¨ã€‚æ‰€ä»¥å¯ä»¥ä½¿ç”¨é˜¿é‡Œå·´å·´å­—ä½“æ›¿ä»£ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼šæ‹·è´é¡¹ç›®ä¸‹é¢ç”Ÿæˆçš„fontclassä»£ç ï¼š</p><p>å¯ä»¥åœ¨public/index.html ä¸‹ç”¨ link æ ‡ç­¾å¼•å…¥</p><p>//at.alicdn.com/t/font_8d5l8fzk5b87iudi.css</p><p>ç¬¬äºŒæ­¥ï¼šæŒ‘é€‰ç›¸åº”å›¾æ ‡å¹¶è·å–ç±»åï¼Œåº”ç”¨äºé¡µé¢ï¼š</p><pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>iconfont icon-xxx<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> webå‰ç«¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gunicorn+flask_restæ„å»ºéƒ¨ç½²è½»é‡çº§apiæœåŠ¡</title>
      <link href="2020/08/20/python/gunicorn-flask-rest%E6%9E%84%E5%BB%BA%E9%83%A8%E7%BD%B2%E8%BD%BB%E9%87%8F%E7%BA%A7api%E6%9C%8D%E5%8A%A1/"/>
      <url>2020/08/20/python/gunicorn-flask-rest%E6%9E%84%E5%BB%BA%E9%83%A8%E7%BD%B2%E8%BD%BB%E9%87%8F%E7%BA%A7api%E6%9C%8D%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<p><img src="http://img.rc5j.cn/blog20200820155306.png" alt=""></p><span id="more"></span><h2 id="flask-ç»“æ„"><a href="#flask-ç»“æ„" class="headerlink" title="flask ç»“æ„"></a>flask ç»“æ„</h2><p>é¦–å…ˆç®€å•çœ‹çœ‹ flask_restçš„ç›®å½•ç»“æ„ã€‚</p><p><img src="http://img.rc5j.cn/blog20200820155423.png" alt=""></p><h3 id="å…¥å£æ–‡ä»¶"><a href="#å…¥å£æ–‡ä»¶" class="headerlink" title="å…¥å£æ–‡ä»¶"></a>å…¥å£æ–‡ä»¶</h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#app.py</span><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token keyword">from</span> flask_restful <span class="token keyword">import</span> Resource<span class="token punctuation">,</span> Api<span class="token keyword">from</span> resources<span class="token punctuation">.</span>bd <span class="token keyword">import</span> Index<span class="token punctuation">,</span>Format<span class="token keyword">from</span> flask_cors <span class="token keyword">import</span> CORS<span class="token comment"># from common import config</span>app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>CORS<span class="token punctuation">(</span>app<span class="token punctuation">)</span>api <span class="token operator">=</span> Api<span class="token punctuation">(</span>app<span class="token punctuation">)</span>api<span class="token punctuation">.</span>add_resource<span class="token punctuation">(</span>Format<span class="token punctuation">,</span> <span class="token string">'/bd/format'</span><span class="token punctuation">)</span><span class="token comment"># if __name__ == '__main__':</span><span class="token comment">#     app.run(debug=True)</span></code></pre><p>å¦‚æœä½¿ç”¨gunicornå¯åŠ¨ï¼Œåˆ™æ³¨é‡Šæ‰app.run</p><h2 id="gunicornå¯åŠ¨é…ç½®"><a href="#gunicornå¯åŠ¨é…ç½®" class="headerlink" title="gunicornå¯åŠ¨é…ç½®"></a>gunicornå¯åŠ¨é…ç½®</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># config.py</span><span class="token keyword">import</span> os<span class="token keyword">import</span> gevent<span class="token punctuation">.</span>monkeygevent<span class="token punctuation">.</span>monkey<span class="token punctuation">.</span>patch_all<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">import</span> multiprocessingdebug <span class="token operator">=</span> <span class="token boolean">True</span>loglevel <span class="token operator">=</span> <span class="token string">'debug'</span>bind <span class="token operator">=</span> <span class="token string">"0.0.0.0:5000"</span>pidfile <span class="token operator">=</span> <span class="token string">"logs/gunicorn.pid"</span>accesslog <span class="token operator">=</span> <span class="token string">"logs/access.log"</span>errorlog <span class="token operator">=</span> <span class="token string">"logs/debug.log"</span>daemon <span class="token operator">=</span> <span class="token boolean">True</span><span class="token comment"># å¯åŠ¨çš„è¿›ç¨‹æ•°</span>workers <span class="token operator">=</span> multiprocessing<span class="token punctuation">.</span>cpu_count<span class="token punctuation">(</span><span class="token punctuation">)</span>worker_class <span class="token operator">=</span> <span class="token string">'gevent'</span>x_forwarded_for_header <span class="token operator">=</span> <span class="token string">'X-FORWARDED-FOR'</span></code></pre><h2 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h2><pre class="language-shell" data-language="shell"><code class="language-shell">python3 -m venv webpj<span class="token builtin class-name">source</span> webpj/bin/activatepip <span class="token function">install</span> -r requirements.txt -i http://mirrors.aliyun.com/pypi/simple/ --trusted-host mirrors.aliyun.compip <span class="token function">install</span> xlrd -i http://mirrors.aliyun.com/pypi/simple/ --trusted-host mirrors.aliyun.compip <span class="token function">install</span> openpyxl -i http://mirrors.aliyun.com/pypi/simple/ --trusted-host mirrors.aliyun.comgunicorn -c config.py app:app</code></pre><h2 id="å¹³æ»‘é‡å¯"><a href="#å¹³æ»‘é‡å¯" class="headerlink" title="å¹³æ»‘é‡å¯"></a>å¹³æ»‘é‡å¯</h2><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">cat</span> logs/gunicorn.pid <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token function">kill</span> -HUP</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pandasæ•°æ®å¿«é€Ÿå¤„ç†</title>
      <link href="2020/07/31/pandas%E6%95%B0%E6%8D%AE%E5%BF%AB%E9%80%9F%E5%A4%84%E7%90%86/"/>
      <url>2020/07/31/pandas%E6%95%B0%E6%8D%AE%E5%BF%AB%E9%80%9F%E5%A4%84%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p><img src="http://img.rc5j.cn/blog20200731122918.png" alt=""></p><p>é”€å”®åŒäº‹æ‹¿åˆ°ä¸€ä»½æ•°æ®ï¼Œä½†æ˜¯æ•°æ®å¯¼å‡ºåˆ—æ˜¯json,æˆ‘é¡ºæ‰‹å°±å¸®ä»–å¤„ç†äº†ä¸‹ã€‚ä¸å¾—ä¸è¯´ pandasåœ¨å¤„ç†è¿™ç±»é—®é¢˜è¿˜æ˜¯éå¸¸æ•ˆç‡é«˜çš„.</p><span id="more"></span><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas<span class="token keyword">import</span> jsondata <span class="token operator">=</span> pandas<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">'data.xlsx'</span><span class="token punctuation">)</span>address <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'address'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>ordertime_list <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'order_datetime'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>address_new_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">for</span> ad <span class="token keyword">in</span> address<span class="token punctuation">:</span>    addressJson <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>ad<span class="token punctuation">)</span>    address_new_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>addressJson<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">for</span> ad <span class="token keyword">in</span> address_new_list<span class="token punctuation">:</span>    <span class="token keyword">for</span> t <span class="token keyword">in</span> ordertime_list<span class="token punctuation">:</span>        ad<span class="token punctuation">[</span><span class="token string">'order_time'</span><span class="token punctuation">]</span> <span class="token operator">=</span> tdf <span class="token operator">=</span> pandas<span class="token punctuation">.</span>DataFrame<span class="token punctuation">.</span>from_records<span class="token punctuation">(</span>address_new_list<span class="token punctuation">)</span>df<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span><span class="token string">'new_data.xlsx'</span><span class="token punctuation">)</span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>phpç”Ÿæ€ä¹‹æ€§èƒ½åˆ†æ</title>
      <link href="2020/07/23/php/php%E7%94%9F%E6%80%81%E4%B9%8B%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/"/>
      <url>2020/07/23/php/php%E7%94%9F%E6%80%81%E4%B9%8B%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p><img src="http://img.rc5j.cn/blog20200724153643.png" alt=""></p><p>ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬å¹¶ä¸ä¼šå¤ªå…³æ³¨PHPçš„æ‰§è¡Œæ•ˆç‡ï¼Œå› ä¸ºä¸€èˆ¬è€Œè¨€ä»–éƒ½è¡¨ç°æ­£å¸¸æ»¡è¶³éœ€æ±‚ã€‚ä½†å½“çœŸæ­£é‡åˆ°é—®é¢˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æœ‰åˆ†ææ€§èƒ½åœ¨å“ªä¸¢å¤±çš„èƒ½åŠ›ã€‚</p><span id="more"></span><p><code>xhprof</code>æ­£æ˜¯è¿™æ ·çš„å·¥å…·ã€‚ä½†æ˜¯ç”±äºå¹´ä¹…å¤±ä¿®ï¼Œç›®å‰å·²ç»ä¸æ”¯æŒPHP7 .</p><p><img src="http://img.rc5j.cn/blog20200724154122.png" alt=""></p><p>ä¸è¿‡ï¼Œå¥½åœ¨è¿˜æœ‰éå®˜æ–¹å•†ä¸šç»„ç»‡å¼€æºäº†PHP7ç‰ˆæœ¬,<code>tideways-xhprof</code>ã€‚</p><p><img src="http://img.rc5j.cn/blog20200724154306.gif" alt=""></p><p>å®˜ç½‘  <a href="https://tideways.com/profiler/xhprof-for-php7">https://tideways.com/profiler/xhprof-for-php7</a></p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">git</span> clone <span class="token string">"https://github.com/tideways/php-xhprof-extension.git"</span><span class="token builtin class-name">cd</span> php-xhprof-extensionphpize./configure<span class="token function">make</span><span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span></code></pre><p>é…ç½®å¥½iniï¼Œé‡å¯æŸ¥çœ‹ä¸‹php -m</p><h2 id="å›¾å½¢åŒ–"><a href="#å›¾å½¢åŒ–" class="headerlink" title="å›¾å½¢åŒ–"></a>å›¾å½¢åŒ–</h2><p><code>tideways-xhprof</code> å¯ä»¥å°†åˆ†æå‡ºæ–¹æ³•è°ƒç”¨ã€æ–¹æ³•è°ƒç”¨è¿‡ç¨‹å’Œæ€§èƒ½æ¶ˆè€—æ•°æ®ã€‚</p><p><code>tideways-xhprof</code> æœ¬èº«è¿˜æä¾›å•†ä¸šåŒ–æœåŠ¡ï¼Œæœ‰ç€æ¯”è¾ƒå¥½çš„ä½“éªŒã€‚ä¸è¿‡ä¹ŸåŒæ—¶æœ‰å¼€æºçš„å›¾å½¢åŒ–å·¥å…·ã€‚æ¯”è¾ƒå¥½çš„æ˜¯<code>xhgui</code>å’Œä»–é…å¥—çš„æ˜¯<code>perftools/php-profiler</code>.çœ‹äº†ä¸‹ä½œè€…ï¼Œè¿˜æ˜¯<code>markstory</code>ï¼Œcakephpçš„ä½œè€…ï¼Œå‡ å¹´å‰ä½¿ç”¨cakephpçš„æ—¶å€™ï¼Œè¿˜æœ‰è¿‡äº¤æµã€‚</p><h2 id="xguiå®‰è£…"><a href="#xguiå®‰è£…" class="headerlink" title="xguiå®‰è£…"></a>xguiå®‰è£…</h2><p>å¯ä»¥é€‰æ‹©æºç éƒ¨ç½²ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©dockeréƒ¨ç½²ã€‚æ–¹ä¾¿ç‚¹é€‰æ‹©ä½¿ç”¨dockerã€‚</p><ol><li><p>Clone or download xhgui from GitHub.</p></li><li><p>Startup the containers: docker-compose up -d</p></li><li><p>Open your browser at <a href="http://xhgui.127.0.0.1.xip.io:8142">http://xhgui.127.0.0.1.xip.io:8142</a> or just <a href="http://localhost:8142">http://localhost:8142</a></p></li></ol><h2 id="php-profilerä½¿ç”¨"><a href="#php-profilerä½¿ç”¨" class="headerlink" title="php-profilerä½¿ç”¨"></a>php-profilerä½¿ç”¨</h2><p>å®˜æ–¹githubä¸Šå†™å‡ ç§æ¥å…¥æ–¹å¼ï¼Œæˆ‘æ¨èç”¨æ³¨å†Œshutdownæ–¹å¼ï¼Œæ­£åœ¨å¯¹é¡¹ç›®ä»£ç æ— å…¥ä¾µã€‚ä¿å­˜è¿‡ç¨‹åœ¨shutdownä¹‹åã€‚</p><pre class="language-PHP" data-language="PHP"><code class="language-PHP"> $profiler &#x3D; new \Xhgui\Profiler\Profiler($config);    &#x2F;&#x2F; The profiler itself checks whether it should be enabled    &#x2F;&#x2F; for request (executes lambda function from config)$profiler-&gt;enable();    &#x2F;&#x2F; shutdown handler collects and stores the data.$profiler-&gt;registerShutdownHandler();</code></pre><p>ä¸Šé¢çš„<code>$config</code>ï¼Œåœ¨ä½¿ç”¨éæ–‡ä»¶å­˜å‚¨çš„æ—¶å€™è¦æ³¨æ„ä¸è¦å®‰è£…å®˜æ–¹é…ç½®æ¥ï¼Œå®˜æ–¹é…ç½®ç›®å‰å­˜åœ¨ä¸€ç‚¹é—®é¢˜ï¼Œæ–°é…ç½®ä¼šä¸ç”Ÿæ•ˆã€‚æˆ‘çœ‹äº†æºç ï¼Œå¹¶ä¸”æäº¤äº†PRã€‚</p><pre class="language-PHP" data-language="PHP"><code class="language-PHP">&#x2F;&#x2F;    &#39;db.host&#39; &#x3D;&gt; &#39;mongodb:&#x2F;&#x2F;127.0.0.1:27018&#39;,&#x2F;&#x2F;    &#39;db.db&#39; &#x3D;&gt; &#39;xhprof&#39;,    &#39;save.handler.mongodb&#39; &#x3D;&gt; array(        &#39;dsn&#39; &#x3D;&gt; &#39;mongodb:&#x2F;&#x2F;127.0.0.1:27018&#39;,        &#39;database&#39; &#x3D;&gt; &#39;xhprof&#39;,        &#x2F;&#x2F; Allows you to pass additional options like replicaSet to MongoClient.        &#x2F;&#x2F; &#39;username&#39;, &#39;password&#39; and &#39;db&#39; (where the user is added)        &#39;options&#39; &#x3D;&gt; array(),    ),</code></pre><p>æ³¨é‡Šéƒ¨åˆ†æ‰æœ‰æ•ˆ.</p><h2 id="é»˜è®¤é…ç½®"><a href="#é»˜è®¤é…ç½®" class="headerlink" title="é»˜è®¤é…ç½®"></a>é»˜è®¤é…ç½®</h2><pre class="language-PHP" data-language="PHP"><code class="language-PHP">&lt;?php&#x2F;** * Default configuration for Xhgui *&#x2F;$mongoUri &#x3D; getenv(&#39;XHGUI_MONGO_URI&#39;) ?: &#39;127.0.0.1:27017&#39;;$mongoUri &#x3D; str_replace(&#39;mongodb:&#x2F;&#x2F;&#39;, &#39;&#39;, $mongoUri);$mongoDb &#x3D; getenv(&#39;XHGUI_MONGO_DB&#39;) ?: &#39;xhprof&#39;;return array(    &#39;debug&#39; &#x3D;&gt; false,    &#39;mode&#39; &#x3D;&gt; &#39;development&#39;,    &#x2F;&#x2F; Can be mongodb, file or upload.    &#x2F;&#x2F; For file    &#x2F;&#x2F;    &#x2F;&#x2F;&#39;save.handler&#39; &#x3D;&gt; &#39;file&#39;,    &#x2F;&#x2F;&#39;save.handler.filename&#39; &#x3D;&gt; dirname(__DIR__) . &#39;&#x2F;cache&#x2F;&#39; . &#39;xhgui.data.&#39; . microtime(true) . &#39;_&#39; . substr(md5($url), 0, 6),    &#x2F;&#x2F; For upload    &#x2F;&#x2F;    &#x2F;&#x2F; Saving profile data by upload is only recommended with HTTPS    &#x2F;&#x2F; endpoints that have IP whitelists applied.    &#x2F;&#x2F;    &#x2F;&#x2F; The timeout option is in seconds and defaults to 3 if unspecified.    &#x2F;&#x2F;    &#x2F;&#x2F;&#39;save.handler&#39; &#x3D;&gt; &#39;upload&#39;,    &#x2F;&#x2F;&#39;save.handler.upload.uri&#39; &#x3D;&gt; &#39;https:&#x2F;&#x2F;example.com&#x2F;run&#x2F;import&#39;,    &#x2F;&#x2F;&#39;save.handler.upload.timeout&#39; &#x3D;&gt; 3,    &#x2F;&#x2F; For MongoDB    &#39;save.handler&#39; &#x3D;&gt; &#39;mongodb&#39;,    &#39;db.host&#39; &#x3D;&gt; sprintf(&#39;mongodb:&#x2F;&#x2F;%s&#39;, $mongoUri),    &#39;db.db&#39; &#x3D;&gt; $mongoDb,    &#39;pdo&#39; &#x3D;&gt; array(        &#39;dsn&#39; &#x3D;&gt; &#39;sqlite:&#x2F;tmp&#x2F;xhgui.sqlite3&#39;,        &#39;user&#39; &#x3D;&gt; null,        &#39;pass&#39; &#x3D;&gt; null,        &#39;table&#39; &#x3D;&gt; &#39;results&#39;    ),    &#x2F;&#x2F; Allows you to pass additional options like replicaSet to MongoClient.    &#x2F;&#x2F; &#39;username&#39;, &#39;password&#39; and &#39;db&#39; (where the user is added)    &#39;db.options&#39; &#x3D;&gt; array(),    &#39;templates.path&#39; &#x3D;&gt; dirname(__DIR__) . &#39;&#x2F;src&#x2F;templates&#39;,    &#39;date.format&#39; &#x3D;&gt; &#39;M jS H:i:s&#39;,    &#39;detail.count&#39; &#x3D;&gt; 6,    &#39;page.limit&#39; &#x3D;&gt; 25,    &#x2F;&#x2F; call fastcgi_finish_request() in shutdown handler    &#39;fastcgi_finish_request&#39; &#x3D;&gt; true,    &#x2F;&#x2F; Profile x in 100 requests. (E.g. set XHGUI_PROFLING_RATIO&#x3D;50 to profile 50% of requests)    &#x2F;&#x2F; You can return true to profile every request.    &#39;profiler.enable&#39; &#x3D;&gt; function() &#123;        $ratio &#x3D; getenv(&#39;XHGUI_PROFILING_RATIO&#39;) ?: 100;        return (getenv(&#39;XHGUI_PROFILING&#39;) !&#x3D;&#x3D; false) &amp;&amp; (mt_rand(1, 100) &lt;&#x3D; $ratio);    &#125;,    &#39;profiler.simple_url&#39; &#x3D;&gt; function($url) &#123;        return preg_replace(&#39;&#x2F;\&#x3D;\d+&#x2F;&#39;, &#39;&#39;, $url);    &#125;,        &#x2F;&#x2F;&#39;profiler.replace_url&#39; &#x3D;&gt; function($url) &#123;    &#x2F;&#x2F;    return str_replace(&#39;token&#39;, &#39;&#39;, $url);    &#x2F;&#x2F;&#125;,    &#39;profiler.options&#39; &#x3D;&gt; array(),    &#39;profiler.skip_built_in&#39; &#x3D;&gt; false,);</code></pre><p>ä»¥ä¸Šæ˜¯é»˜è®¤é…ç½®</p><h2 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h2><p><img src="http://img.rc5j.cn/blog20200724134032.png" alt=""></p><p>å›¾ä¸­å¯ä»¥çœ‹åˆ°,æ¯æ¬¡è¯·æ±‚çš„èŠ±è´¹æ—¶é—´ã€‚</p><p><img src="http://img.rc5j.cn/blog20200724165205.png" alt=""></p><p><img src="http://img.rc5j.cn/blog20200724165354.png" alt=""></p><p>é€šè¿‡è§‚å¯Ÿæ–¹æ³•è°ƒç”¨æ¬¡æ•°ï¼Œå¯ä»¥å‘ç°symfony ErrorHandlerè¿™ä¸ªç»„ä»¶æ–¹æ³•æ‰§è¡Œçš„ç‰¹åˆ«å¤šã€‚</p><p>äºæ˜¯æˆ‘å–æ¶ˆäº†è¿™ä¸ªç»„ä»¶ï¼Œå‘ç°æ¥å£è¯·æ±‚æ—¶é—´ä»<code>113ms</code>ç›´æ¥å°±é™åˆ°äº†<code>71ms</code>.</p><p><strong>è¿™å°±æ˜¯å¾ˆç›´è§‚çš„æ€§èƒ½å®šä½äº†</strong></p>]]></content>
      
      
      
        <tags>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>edgeä½¿ç”¨google theme</title>
      <link href="2020/07/10/edge%E4%BD%BF%E7%94%A8google-theme/"/>
      <url>2020/07/10/edge%E4%BD%BF%E7%94%A8google-theme/</url>
      
        <content type="html"><![CDATA[<p>ç”¨edgeæ‰“å¼€ edge://flags/#edge-allow-store-extension-themes</p><p><img src="http://img.rc5j.cn/blog20200710172834.png" alt=""></p><p>æ”¹ä¸ºå¯ç”¨ï¼</p><p>è®¿é—® <a href="https://chrome.google.com/webstore/category/themes">https://chrome.google.com/webstore/category/themes</a></p><p>å®‰è£…å³å¯å•¦ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>kafkaæ­å»ºå’Œä½¿ç”¨(PHPè¯­è¨€ç‰ˆæœ¬)</title>
      <link href="2020/07/08/php/kafka%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8-PHP%E8%AF%AD%E8%A8%80%E7%89%88%E6%9C%AC/"/>
      <url>2020/07/08/php/kafka%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8-PHP%E8%AF%AD%E8%A8%80%E7%89%88%E6%9C%AC/</url>
      
        <content type="html"><![CDATA[<p><img src="http://img.rc5j.cn/blog20200723094704.png" alt=""></p><p>é¦–å…ˆ,å®‰è£…ç¡®å®æ˜¯ä¸€ä¸ªè´¹æ—¶è´¹åŠ›çš„äº‹æƒ…ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨dockerå®‰è£…ã€‚</p><span id="more"></span><h2 id="dockeræ­å»ºkafka"><a href="#dockeræ­å»ºkafka" class="headerlink" title="dockeræ­å»ºkafka"></a>dockeræ­å»ºkafka</h2><pre class="language-yml" data-language="yml"><code class="language-yml"><span class="token comment">## docker-compose.yml</span><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.1'</span><span class="token key atrule">services</span><span class="token punctuation">:</span>    <span class="token key atrule">zookeeper</span><span class="token punctuation">:</span>        <span class="token key atrule">image</span><span class="token punctuation">:</span> wurstmeister/zookeeper        <span class="token key atrule">ports</span><span class="token punctuation">:</span>          <span class="token punctuation">-</span> <span class="token string">"2181:2181"</span>    <span class="token key atrule">kafka</span><span class="token punctuation">:</span>        <span class="token key atrule">image</span><span class="token punctuation">:</span> wurstmeister/kafka        <span class="token key atrule">ports</span><span class="token punctuation">:</span>          <span class="token punctuation">-</span> <span class="token string">"9092:9092"</span>        <span class="token key atrule">environment</span><span class="token punctuation">:</span>           <span class="token key atrule">KAFKA_ADVERTISED_HOST_NAME</span><span class="token punctuation">:</span> 172.17.0.1           <span class="token key atrule">KAFKA_ZOOKEEPER_CONNECT</span><span class="token punctuation">:</span> zookeeper<span class="token punctuation">:</span><span class="token number">2181</span>           <span class="token key atrule">KAFKA_ADVERTISED_PORT</span><span class="token punctuation">:</span> <span class="token number">9092</span></code></pre><p>æ›´å¤šç»†èŠ‚å»ºè®®è®¿é—®å®˜æ–¹æ–‡æ¡£æŸ¥é˜…ã€‚</p><h2 id="PHPå®ç°"><a href="#PHPå®ç°" class="headerlink" title="PHPå®ç°"></a>PHPå®ç°</h2><h3 id="ç”Ÿäº§è€…"><a href="#ç”Ÿäº§è€…" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h3><pre class="language-PHP" data-language="PHP"><code class="language-PHP">public function kafka(Request $request)   &#123;       $faker &#x3D; Factory::create(&#39;zh_CN&#39;);       $message &#x3D; $faker-&gt;name();       Log::debug(&#39;æ¶ˆæ¯&#39;, [&#39;message&#39; &#x3D;&gt; $message]);       $conf &#x3D; new Conf();       $conf-&gt;set(&#39;log_level&#39;, (string) LOG_DEBUG);       $conf-&gt;set(&#39;debug&#39;, &#39;all&#39;);       $conf-&gt;set(&#39;metadata.broker.list&#39;, &#39;127.0.0.1:9092&#39;);       $conf-&gt;setDrMsgCb(function ($kafka, $message) &#123;           Log::debug(&quot;kafkaä¿¡æ¯&quot;, [&#39;message&#39; &#x3D;&gt; var_export($message, true)]);       &#125;);       $conf-&gt;setErrorCb(function ($kafka, $err, $reason) &#123;           Log::debug(&quot;kafkaé”™è¯¯&quot;, [&#39;err&#39; &#x3D;&gt; $err, &#39;reason&#39; &#x3D;&gt; $reason]);       &#125;);       $conf-&gt;setLogCb(function ($kafka, $level, $facility, $message) &#123;           Log::debug(vsprintf(&quot;Kafka %s: %s (level: %d)\n&quot;, [$facility, $message, $level]));       &#125;);       &#x2F;&#x2F;If you need to produce exactly once and want to keep the original produce order, uncomment the line below       &#x2F;&#x2F;$conf-&gt;set(&#39;enable.idempotence&#39;, &#39;true&#39;);       $producer &#x3D; new Producer($conf);       $topic &#x3D; $producer-&gt;newTopic(&quot;test&quot;);       $topic-&gt;produce(RD_KAFKA_PARTITION_UA, 0, $faker-&gt;name());       $producer-&gt;poll(0);       $result &#x3D; $producer-&gt;flush(10000);       if (RD_KAFKA_RESP_ERR_NO_ERROR !&#x3D;&#x3D; $result) &#123;           throw new \RuntimeException(&#39;Was unable to flush, messages might be lost!&#39;);       &#125;       return new ActionResponse($result);   &#125;</code></pre><h3 id="æ¶ˆè´¹è€…"><a href="#æ¶ˆè´¹è€…" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h3><pre class="language-PHP" data-language="PHP"><code class="language-PHP">public function consume()    &#123;        $conf &#x3D; new Conf();&#x2F;&#x2F; Configure the group.id. All consumer with the same group.id will consume&#x2F;&#x2F; different partitions.        $conf-&gt;set(&#39;group.id&#39;, &#39;myConsumerGroup&#39;);&#x2F;&#x2F; Initial list of Kafka brokers        $conf-&gt;set(&#39;metadata.broker.list&#39;, &#39;127.0.0.1&#39;);&#x2F;&#x2F; Set where to start consuming messages when there is no initial offset in&#x2F;&#x2F; offset store or the desired offset is out of range.&#x2F;&#x2F; &#39;smallest&#39;: start from the beginning        $conf-&gt;set(&#39;auto.offset.reset&#39;, &#39;smallest&#39;);        $consumer &#x3D; new KafkaConsumer($conf);&#x2F;&#x2F; Subscribe to topic &#39;test&#39;        $consumer-&gt;subscribe([&#39;test&#39;]);        echo &quot;Waiting for partition assignment... (make take some time when\n&quot;;        echo &quot;quickly re-joining the group after leaving it.)\n&quot;;        while (true) &#123;            $message &#x3D; $consumer-&gt;consume(120 * 1000);            switch ($message-&gt;err) &#123;                case RD_KAFKA_RESP_ERR_NO_ERROR:                    $this-&gt;info($message-&gt;payload);                    break;                case RD_KAFKA_RESP_ERR__PARTITION_EOF:                    echo &quot;No more messages; will wait for more\n&quot;;                    break;                case RD_KAFKA_RESP_ERR__TIMED_OUT:                    $this-&gt;info(&quot;Timed out&quot;);                    break;                default:                    throw new Exception($message-&gt;errstr(), $message-&gt;err);                    break;            &#125;        &#125;    &#125;</code></pre><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>ç”Ÿäº§è€…æ˜¯ä¸€ä¸ªrestfulçš„apiï¼Œç›´æ¥è°ƒç”¨ä¼šå¾€kafkaé‡Œå†™å…¥1ä¸ªä¸­æ–‡å§“åçš„æ¶ˆæ¯ã€‚</p><p>æ¶ˆè´¹è€…æ˜¯ä¸€ä¸ªPHPè„šæœ¬è¿›ç¨‹ï¼Œå¯åŠ¨ä¼šå¼€å§‹æ¶ˆè´¹kafkaæ¶ˆæ¯</p><pre class="language-shell" data-language="shell"><code class="language-shell">php bin/cli.php kafka consume</code></pre><p><img src="http://img.rc5j.cn/blog20200709115956.png" alt=""></p><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>è™½ç„¶å·²ç»æ­å»ºäº†kafka<code>æ¶ˆæ¯ä¸­é—´ä»¶</code>,å’Œç¼–å†™äº†<code>ç”Ÿäº§è€…</code>å’Œ<code>æ¶ˆè´¹è€…</code>.ä½†æ˜¯å…³äºå…¶ä¸­çš„è®¸å¤šç»†èŠ‚è¿˜è¦ææ¸…é™¤ã€‚åŒ…æ‹¬:</p><ul><li>ä»€ä¹ˆæ˜¯broken</li><li>ä»€ä¹ˆæ˜¯partition</li><li>æ¶ˆæ¯flushæ˜¯åšä»€ä¹ˆ</li><li>pollåˆæ˜¯åšä»€ä¹ˆ</li><li>ç­‰ç­‰æ›´å¤šç»†èŠ‚</li></ul><h2 id="broken"><a href="#broken" class="headerlink" title="broken"></a>broken</h2>]]></content>
      
      
      
        <tags>
            
            <tag> kafka </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€ä¸ªçº¿ä¸Šé—®é¢˜å¼•å‘çš„å¯¹PHPç”Ÿå‘½å‘¨æœŸå’ŒSESSIONæœºåˆ¶æ€è€ƒ</title>
      <link href="2020/07/01/php/%E4%B8%80%E4%B8%AA%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E5%BC%95%E5%8F%91%E7%9A%84%E5%AF%B9PHP%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%92%8CSESSION%E6%9C%BA%E5%88%B6%E6%80%9D%E8%80%83/"/>
      <url>2020/07/01/php/%E4%B8%80%E4%B8%AA%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E5%BC%95%E5%8F%91%E7%9A%84%E5%AF%B9PHP%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%92%8CSESSION%E6%9C%BA%E5%88%B6%E6%80%9D%E8%80%83/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>PHPç”Ÿæ€ä¹‹è‡ªåŠ¨åŒ–æµ‹è¯•</title>
      <link href="2020/07/01/php/PHP%E7%94%9F%E6%80%81%E4%B9%8B%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/"/>
      <url>2020/07/01/php/PHP%E7%94%9F%E6%80%81%E4%B9%8B%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<p>PHP TESTING FOR EVERYONE</p><span id="more"></span><p><img src="http://img.rc5j.cn/blog20200701101728.png" alt=""></p><p>åœ¨é•¿ä¹…çš„å·¥ä½œç»å†ä¸­ï¼Œæµ‹è¯•å¤§ä½¬å¸¸ä¼šåœ¨ä½ è€³æ—å˜€å’•å¼€å‘è¦è‡ªæµ‹è¦è‡ªæµ‹ã€‚ä½†æ˜¯å®é™…ä¸Šå¼€å‘å¾€å¾€åªä¼šå…³å¿ƒå½“å‰è´Ÿè´£çš„å•å…ƒåŠŸèƒ½çš„æ­£ç¡®ä¸å¦ã€‚ç¹æ‚çš„å¼€å‘ä»»åŠ¡å½“ä¸­ï¼Œè¿˜è¦å…¼é¡¾æ‰€æœ‰æµç¨‹çš„åŠŸèƒ½è¿è½¬å¯èƒ½å°±æ²¡é‚£ä¸ªç²¾åŠ›äº†ï¼Œæˆ–è€…è¯´è¿™æœ¬èº«å°±æ˜¯æµ‹è¯•çš„å·¥ä½œã€‚åœ¨è¿œå¤æ—¶ä»£äº’è”ç½‘é¢†åŸŸå·¥ä½œè¿˜æ²¡ç»†åˆ†åˆ°å‰ç«¯ã€åç«¯ã€æµ‹è¯•ã€UIçš„æ—¶å€™ï¼Œæ‰€æœ‰ä¸€æ½å­æ´»éƒ½åªæœ‰ä¸€ä¸ªäººåšï¼Œé‚£å°±æ˜¯ç¨‹åºå‘˜ã€‚</p><p><strong>ä½†æ˜¯å¦‚ä½•å°½é‡ä¿è¯ç¨‹åºè¿”å›ç»“æœæ˜¯é¢„æœŸçš„ï¼Ÿ</strong> èƒ½å¦åšåˆ°æ¯æ¬¡å‘å¸ƒä¹‹å‰è‡ªåŠ¨å¯¹ç¨‹åºæµ‹è¯•çœ‹æ˜¯å¦è¾¾åˆ°é¢„æœŸï¼Ÿ<br>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥å¼•å…¥<strong>è‡ªåŠ¨åŒ–æµ‹è¯•</strong>ã€‚</p><h2 id="è‡ªåŠ¨åŒ–æµ‹è¯•èŒƒå›´"><a href="#è‡ªåŠ¨åŒ–æµ‹è¯•èŒƒå›´" class="headerlink" title="è‡ªåŠ¨åŒ–æµ‹è¯•èŒƒå›´"></a>è‡ªåŠ¨åŒ–æµ‹è¯•èŒƒå›´</h2><ul><li>UIæµ‹è¯•</li><li>æ¥å£æµ‹è¯•</li><li>å•å…ƒæµ‹è¯•</li><li>æ•°æ®æµ‹è¯•</li></ul><p>å…¶ä¸­UIæµ‹è¯•å’Œæ•°æ®æµ‹è¯•çš„è‡ªåŠ¨åŒ–å¯èƒ½æ˜¯æœ€ä¸å®¹æ˜“åšä¸”æ•ˆç›Šæœ€å°çš„ã€‚è¿™éƒ¨åˆ†å¯èƒ½æœ€å¥½æ˜¯äººä¸ºçš„è¿›è¡Œæµ‹è¯•æ•ˆæœæœ€å¥½ã€‚</p><p>åœ¨ä½“éªŒäº†java çš„junitä¹‹åç‰¹åˆ«è§‰å¾—junitçš„å¼ºå¤§,å…¶å®PHPä¹Ÿå¯ä»¥åšã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ¥äº†è§£ä¸‹PHPçš„æµ‹è¯•æ¡†æ¶<code>codeception</code></p><h2 id="å®‰è£…ä½¿ç”¨"><a href="#å®‰è£…ä½¿ç”¨" class="headerlink" title="å®‰è£…ä½¿ç”¨"></a>å®‰è£…ä½¿ç”¨</h2><h3 id="install"><a href="#install" class="headerlink" title="install"></a>install</h3><pre class="language-none"><code class="language-none">composer require &quot;codeception&#x2F;codeception&quot; --dev</code></pre><h3 id="setup"><a href="#setup" class="headerlink" title="setup"></a>setup</h3><pre class="language-none"><code class="language-none">php vendor&#x2F;bin&#x2F;codecept bootstrap</code></pre><p>è¯¥å‘½ä»¤ä¼šåˆå§‹åŒ–é…ç½®æ–‡ä»¶å’Œç›®å½•</p><h3 id="è½»é‡å®‰è£…"><a href="#è½»é‡å®‰è£…" class="headerlink" title="è½»é‡å®‰è£…"></a>è½»é‡å®‰è£…</h3><p>Use predefined installation templates for common use cases. Run them instead of bootstrap command.</p><p><code>bootstrap</code>ä¼šé»˜è®¤åˆå§‹åŒ–æ‰€æœ‰æµ‹è¯•ç±»å‹æ‰€éœ€è¦çš„ç»„ä»¶ï¼Œæœ‰äº›ä½ ä¸ä¼šç”¨åˆ°çš„ç±»åº“ä¹Ÿä¼šå®‰è£…ã€‚æ¨èä½¿ç”¨è½»é‡å®‰è£…æ‰€ç”¨èƒ½åˆ°çš„æµ‹è¯•ç±»å‹ã€‚</p><p>ä¾‹å¦‚ä½ åªéœ€è¦å•å…ƒæµ‹è¯•ï¼Œåˆ™å¯ä»¥</p><pre class="language-none"><code class="language-none">php vendor&#x2F;bin&#x2F;codecept init unit</code></pre><p><strong>suiteé…ç½®</strong></p><p>åˆå§‹åŒ–ä¹‹åè¿˜è¦å¯¹æµ‹è¯•ç±»å‹è¿›è¡Œç›¸åº”çš„é…ç½®,åœ¨testsç›®å½•ä¸‹æ–°å»ºunitçš„é…ç½®</p><pre class="language-yml" data-language="yml"><code class="language-yml"><span class="token comment"># unit.suite.yml</span><span class="token comment"># Codeception Test Suite Configuration</span><span class="token comment">#</span><span class="token comment"># Suite for unit or integration tests.</span><span class="token key atrule">actor</span><span class="token punctuation">:</span> UnitTester<span class="token key atrule">modules</span><span class="token punctuation">:</span>    <span class="token key atrule">enabled</span><span class="token punctuation">:</span>        <span class="token punctuation">-</span> Asserts        <span class="token punctuation">-</span> \Helper\Unit    <span class="token key atrule">step_decorators</span><span class="token punctuation">:</span> <span class="token null important">~</span>        </code></pre><p><img src="http://img.rc5j.cn/blog20200702152857.png" alt=""></p><h2 id="codeceptionå•å…ƒæµ‹è¯•"><a href="#codeceptionå•å…ƒæµ‹è¯•" class="headerlink" title="codeceptionå•å…ƒæµ‹è¯•"></a>codeceptionå•å…ƒæµ‹è¯•</h2><p><img src="http://img.rc5j.cn/blog20200702143824.png" alt=""></p><p>codeceptionçš„å•å…ƒæµ‹è¯•å…¶å®ä¹Ÿæ˜¯åŸºäºphpunitä¹‹ä¸Šæ„å»ºçš„ã€‚phpunitçš„å•å…ƒæµ‹è¯•ç”¨ä¾‹å¯ä»¥ä¹‹å‰åœ¨codeceptionä¸Šæ‰§è¡Œã€‚</p><h3 id="åˆ›å»ºå•å…ƒæµ‹è¯•"><a href="#åˆ›å»ºå•å…ƒæµ‹è¯•" class="headerlink" title="åˆ›å»ºå•å…ƒæµ‹è¯•"></a>åˆ›å»ºå•å…ƒæµ‹è¯•</h3><pre class="language-none"><code class="language-none">php vendor&#x2F;bin&#x2F;codecept generate:test unit Example</code></pre><p>æ‰§è¡Œå®Œä¼šåœ¨tests/unitç›®å½•é‡Œåˆ›å»ºæµ‹è¯•ç”¨ä¾‹æ–‡ä»¶ </p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">ExampleTest</span> <span class="token keyword">extends</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Codeception<span class="token punctuation">\</span>Test<span class="token punctuation">\</span>Unit</span><span class="token punctuation">&#123;</span>    <span class="token comment">/**     * @var \UnitTester     */</span>    <span class="token keyword">protected</span> <span class="token variable">$tester</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">_before</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">_after</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// tests</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">testMe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><ul><li>all public methods with test prefix are tests</li><li>_before method is executed before each test (like setUp in PHPUnit)</li><li>_after method is executed after each test (like tearDown in PHPUnit)</li></ul><h3 id="è¿è¡Œç”¨ä¾‹"><a href="#è¿è¡Œç”¨ä¾‹" class="headerlink" title="è¿è¡Œç”¨ä¾‹"></a>è¿è¡Œç”¨ä¾‹</h3><pre class="language-none"><code class="language-none">php vendor&#x2F;bin&#x2F;codecept run unit ExampleTest</code></pre><p>å¦‚æœæœ‰ç›®å½•å¯ä»¥æ‰§è¡Œåˆ°æ–‡ä»¶</p><pre class="language-none"><code class="language-none">php bin&#x2F;codecept run unit tests&#x2F;unit&#x2F;src&#x2F;Service&#x2F;InvoiceServiceTest.php       </code></pre><p>è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•ç”¨ä¾‹</p><pre class="language-none"><code class="language-none">php vendor&#x2F;bin&#x2F;codecept run unit</code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">UserTest</span> <span class="token keyword">extends</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Codeception<span class="token punctuation">\</span>Test<span class="token punctuation">\</span>Unit</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">testValidation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$user</span><span class="token operator">-></span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token constant">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">assertFalse</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-></span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$user</span><span class="token operator">-></span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'toolooooongnaaaaaaameeee'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">assertFalse</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-></span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$user</span><span class="token operator">-></span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'davert'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-></span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h3 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h3><p><img src="http://img.rc5j.cn/blog20200723093255.png" alt=""></p><p><img src="http://img.rc5j.cn/blog20200723093429.png" alt=""></p><p>å¯ä»¥ç»Ÿè®¡åˆ°æ‰€æœ‰æ–‡ä»¶çš„è¦†ç›–ç‡å’Œç”¨ä¾‹æµ‹è¯•ç»“æœã€‚</p><p>ç»“åˆgité’©å­æˆ‘ä»¬å¯ä»¥åœ¨æ¯æ¬¡åˆ†æ”¯æäº¤æ—¶è¿›è¡Œè‡ªåŠ¨çš„ç”¨ä¾‹æµ‹è¯•ï¼Œèƒ½ä¸€å®šç¨‹åº¦ä¸Šé˜²æ­¢ä»£ç æ›´æ”¹äº†è€Œæ²¡æµ‹è¯•äº§ç”Ÿéé¢„æœŸçš„é—®é¢˜ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>intlå®‰è£…çš„é‚£äº›äº‹å„¿</title>
      <link href="2020/06/19/php/intl%E5%AE%89%E8%A3%85%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/"/>
      <url>2020/06/19/php/intl%E5%AE%89%E8%A3%85%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/</url>
      
        <content type="html"><![CDATA[<p>è¢«intlæŠ˜ç£¨çš„è¿˜ä¸å¤Ÿä¹ˆ</p><span id="more"></span><p>To build the extension you need to install the Â» ICU library, version 4.0.0 or newer is required. As of PHP 7.4.0 ICU 50.1 or newer is required.</p><p>This extension is bundled with PHP as of PHP version 5.3.0. Alternatively, the PECL version of this extension may be used with all PHP versions greater than 5.2.0 (5.2.4+ recommended).</p><h2 id="ICUå®‰è£…"><a href="#ICUå®‰è£…" class="headerlink" title="ICUå®‰è£…"></a>ICUå®‰è£…</h2><p>ç°åœ¨icuå·²è¢«æ”¾åˆ°githubï¼Œä¸‹è½½å»ºè®®ç›´æ¥ä»githubä¸‹è½½æºç åˆ°æœ¬åœ°ã€‚</p><p><a href="https://github.com/unicode-org/icu/releases/tag/release-60-3">https://github.com/unicode-org/icu/releases/tag/release-60-3</a></p><p>ä¸‹è½½åç¼–è¯‘å®‰è£…</p><h2 id="æ‹“å±•å®‰è£…"><a href="#æ‹“å±•å®‰è£…" class="headerlink" title="æ‹“å±•å®‰è£…"></a>æ‹“å±•å®‰è£…</h2><pre class="language-shell" data-language="shell"><code class="language-shell">pecl <span class="token function">install</span> intl</code></pre><p>æ€»ä¼šé‡åˆ°é—®é¢˜,å»ºè®®ç”¨phpize æºç å®‰è£…ã€‚è¿›å…¥æºç extä¸‹çš„intlç›®å½•</p><pre class="language-none"><code class="language-none">.&#x2F;configure  --enable-intl   --with-php-config&#x3D;&#x2F;usr&#x2F;local&#x2F;php7&#x2F;bin&#x2F;php-configmakemake install</code></pre><p>é‡å¯php-fpm</p>]]></content>
      
      
      
        <tags>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MyBatis Dynamic SQLä½¿ç”¨å°è¯•</title>
      <link href="2020/06/01/java/MyBatis-Dynamic-SQL%E4%BD%BF%E7%94%A8%E5%B0%9D%E8%AF%95/"/>
      <url>2020/06/01/java/MyBatis-Dynamic-SQL%E4%BD%BF%E7%94%A8%E5%B0%9D%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<p>é¦–å…ˆè¯´æ˜ä¸‹ï¼Œæˆ‘å¯èƒ½æ˜¯è¢«è¿™ä¸ªæ’ä»¶çš„åå­—ç»™è¯¯å¯¼äº†ã€‚æˆ‘åŸæœ¬ä»¥ä¸ºDynamic SQLæ˜¯ä¸ºäº†è§£å†³åŠ¨æ€æŸ¥è¯¢åœºæ™¯çš„ã€‚ä½†å¯èƒ½<code>MyBatis Dynamic SQL</code> å¹¶ä¸æ˜¯æ¥è§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚</p><p>20.06.04æ›´æ–°</p><p><strong>æ‰“è„¸äº†</strong>ï¼ŒåŸæ¥å®ƒæ˜¯æ”¯æŒçš„ï¼Œæœç„¶æ˜¯åŠ¨æ€sql.å¹¶ä¸”è¿˜çœŸé¦™ï¼</p><span id="more"></span><h2 id="MyBatis-Dynamic-SQL"><a href="#MyBatis-Dynamic-SQL" class="headerlink" title="MyBatis Dynamic SQL"></a>MyBatis Dynamic SQL</h2><h3 id="å®˜æ–¹å®šä¹‰"><a href="#å®˜æ–¹å®šä¹‰" class="headerlink" title="å®˜æ–¹å®šä¹‰"></a>å®˜æ–¹å®šä¹‰</h3><p>This library is a framework for generating dynamic SQL statements. Think of it as a typesafe SQL templating library, with additional support for MyBatis3 and Spring JDBC Templates.</p><p>The primary goals of the library are:</p><ul><li>Typesafe - to the extent possible, the library will ensure that parameter types match the database column types</li><li>Expressive - statements are built in a way that clearly communicates their meaning (thanks to Hamcrest for some inspiration)</li><li>Flexible - where clauses can be built using any combination of and, or, and nested conditions</li><li>Extensible - the library will render statements for MyBatis3, Spring JDBC templates or plain JDBC. It can be extended to generate clauses for other frameworks as well. Custom where conditions can be added easily if none of the built in conditions are sufficient for your needs.</li><li>Small - the library is a small dependency to add. It has no transitive dependencies.</li></ul><p>å®˜æ–¹ä¼¼ä¹è¯´åˆ°è¿™ä¸ªç±»åº“çš„ä¸»è¦ç›®æ ‡æ˜¯è§£å†³ç±»å‹å®‰å…¨é—®é¢˜ã€‚</p><p>This library grew out of a desire to create a utility that could be used to improve the code generated by MyBatis Generator, but the library can be used on itâ€™s own with very little setup required.</p><p>å®˜æ–¹è¯´å¯ä»¥ä½¿ç”¨<code>MyBatis Generator</code>ç”Ÿæˆä»£ç æ–‡ä»¶ã€‚</p><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.mybatis.dynamic-sql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis-dynamic-sql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.1.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><h2 id="MyBatis-Generator"><a href="#MyBatis-Generator" class="headerlink" title="MyBatis Generator"></a>MyBatis Generator</h2><p>MyBatis Generator may generate:</p><p>Java or Kotlin classes that match the table structure. This may include:</p><ul><li>a class to match the primary key of the table (if there is a primary key)</li><li>a class to match the non-primary key fields of the table (except BLOB fields)</li><li>a class to include the BLOB fields of a table (if the table has BLOB fields)</li><li>a class to enable dynamic selects, updates, and deletes</li></ul><p><code>MyBatis Generator</code>å°†ä¼šç”Ÿæˆä¸‹è¿°ä¸‰ä¸ªæ–‡ä»¶ï¼š</p><ul><li>ä¸è¡¨å¯¹åº”çš„ model ç±» Employee.java</li><li>å®šä¹‰äº†è¡¨ä¿¡æ¯å’Œåˆ—ä¿¡æ¯çš„ support ç±» EmployeeDynamicSqlSupport.java</li><li>ä»¥æ³¨è§£å½¢å¼å®ç°çš„ mapper æ¥å£ EmployeeMapper.java</li></ul><h3 id="Running-MyBatis-Generator-With-Maven"><a href="#Running-MyBatis-Generator-With-Maven" class="headerlink" title="Running MyBatis Generator With Maven"></a>Running MyBatis Generator With Maven</h3><ol><li>é…ç½®pom.xml</li></ol><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.mybatis.generator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis-generator-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.4.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">></span></span>             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>Generate MyBatis Artifacts<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">></span></span>                 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">></span></span>generate<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">></span></span>             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>8.0.20<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span></code></pre><p>æ³¨æ„<code>mysql-connector-java</code>ä¾èµ–é…ç½®</p><ol start="2"><li>é…ç½® generatorConfig.xml</li></ol><p>åœ¨resourceä¸­é…ç½®ç”Ÿæˆé…ç½®æ–‡ä»¶generatorConfig.xml</p><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">generatorConfiguration</span> <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN"</span> <span class="token string">"http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>generatorConfiguration</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>context</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dsql<span class="token punctuation">"</span></span> <span class="token attr-name">targetRuntime</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>MyBatis3DynamicSql<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jdbcConnection</span> <span class="token attr-name">driverClass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.mysql.jdbc.Driver<span class="token punctuation">"</span></span>        <span class="token attr-name">connectionURL</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>jdbc:mysql://localhost:3306/db_itdoc<span class="token punctuation">"</span></span> <span class="token attr-name">userId</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>javaModelGenerator</span> <span class="token attr-name">targetPackage</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.vison.itdoc.entity<span class="token punctuation">"</span></span> <span class="token attr-name">targetProject</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>src/main/java<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>javaClientGenerator</span> <span class="token attr-name">targetPackage</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.vison.itdoc.dao<span class="token punctuation">"</span></span> <span class="token attr-name">targetProject</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>src/main/java<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">tableName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>task<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>context</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>generatorConfiguration</span><span class="token punctuation">></span></span></code></pre><p><code>userId</code>å’Œ<code>password</code>åˆ†åˆ«æ˜¯æ•°æ®åº“ç”¨æˆ·åå’Œå¯†ç </p><ol start="3"><li>æ‰§è¡Œç”Ÿæˆ</li></ol><pre class="language-shell" data-language="shell"><code class="language-shell">$ mvn mybatis-generator:generate</code></pre><h2 id="ä½¿ç”¨MyBatis-Dynamic-SQL"><a href="#ä½¿ç”¨MyBatis-Dynamic-SQL" class="headerlink" title="ä½¿ç”¨MyBatis Dynamic SQL"></a>ä½¿ç”¨MyBatis Dynamic SQL</h2><p>å½“ç›¸åº”çš„æ–‡ä»¶ç”Ÿæˆä¹‹åï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ç›´æ¥ä½¿ç”¨äº†ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">SelectStatementProvider</span> queryCount <span class="token operator">=</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>             <span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span>             <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>             <span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token class-name">RenderingStrategies</span><span class="token punctuation">.</span>MYBATIS3<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token class-name">Long</span> taskCount <span class="token operator">=</span> taskMapper<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>queryCount<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">double</span> total <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>taskCount <span class="token operator">/</span> iPageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token class-name">SelectStatementProvider</span> tasksQuerypProvider <span class="token operator">=</span> <span class="token function">select</span><span class="token punctuation">(</span>createTime<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span>             <span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span>createTime<span class="token punctuation">)</span>             <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>iPageSize<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span>iOffset<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>             <span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token class-name">RenderingStrategy</span><span class="token punctuation">.</span>MYBATIS3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">></span></span> tasks <span class="token operator">=</span> taskMapper<span class="token punctuation">.</span><span class="token function">selectMany</span><span class="token punctuation">(</span>tasksQuerypProvider<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><code>MyBatis Dynamic SQL</code>éå¸¸ä¼˜é›…å¾—sqlbuilderæ–¹å¼,ä¼šæç¤ºè¡¨å­—æ®µåã€‚</p><h3 id="åŠ¨æ€sql"><a href="#åŠ¨æ€sql" class="headerlink" title="åŠ¨æ€sql"></a>åŠ¨æ€sql</h3><p>åœ¨è¿™ä¹‹å‰<code>mybatis</code>å¯ä»¥ä½¿ç”¨xmlæˆ–æ³¨è§£æ–¹å¼è¿›è¡ŒåŠ¨æ€ç»„ç»‡sql</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TaskService</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">queryCount</span><span class="token punctuation">(</span><span class="token class-name">String</span> type<span class="token punctuation">,</span> <span class="token class-name">String</span> remark<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token function">SQL</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token punctuation">&#123;</span>                <span class="token function">SELECT</span><span class="token punctuation">(</span><span class="token string">"T.ID"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">FROM</span><span class="token punctuation">(</span><span class="token string">"TASK T"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token function">WHERE</span><span class="token punctuation">(</span><span class="token string">"T.type = #&#123;type&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>remark <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token function">WHERE</span><span class="token punctuation">(</span><span class="token string">"T.remark = #&#123;remark&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token function">ORDER_BY</span><span class="token punctuation">(</span><span class="token string">"T.create_time"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><p>åœ¨mapperä¸Š</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@SelectProvider</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">TaskService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">"queryCount"</span><span class="token punctuation">)</span>  <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">queryCount</span><span class="token punctuation">(</span><span class="token class-name">String</span> type<span class="token punctuation">,</span> <span class="token class-name">String</span> remark<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ç°åœ¨å¯ä»¥æ¢å¦ä¸€ç§æ–¹å¼</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">SelectStatementProvider</span> <span class="token function">countTask</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> typeInteger<span class="token punctuation">,</span> <span class="token class-name">String</span> remarkString<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">QueryExpressionDSL</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectModel</span><span class="token punctuation">></span></span><span class="token punctuation">.</span>QueryExpressionWhereBuilder builder <span class="token operator">=</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>typeInteger <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        builder<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> <span class="token function">isEqualTo</span><span class="token punctuation">(</span>typeInteger<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>remarkString <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        builder<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span>remark<span class="token punctuation">,</span> <span class="token function">isEqualTo</span><span class="token punctuation">(</span>remarkString<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token class-name">RenderingStrategy</span><span class="token punctuation">.</span>MYBATIS3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token class-name">SelectStatementProvider</span> <span class="token function">search</span><span class="token punctuation">(</span><span class="token class-name">Object</span> searchObj<span class="token punctuation">,</span> <span class="token class-name">Integer</span> iPageSize<span class="token punctuation">,</span> <span class="token class-name">Integer</span> iOffset<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">QueryExpressionDSL</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectModel</span><span class="token punctuation">></span></span><span class="token punctuation">.</span>QueryExpressionWhereBuilder builder <span class="token operator">=</span> <span class="token function">select</span><span class="token punctuation">(</span>remark<span class="token punctuation">,</span> type<span class="token punctuation">,</span> createTime<span class="token punctuation">,</span> modifyTime<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    builder            <span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span>createTime<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>iPageSize<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span>iOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token class-name">RenderingStrategy</span><span class="token punctuation">.</span>MYBATIS3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>ä»ç¼–ç æ„Ÿå—ä¸Šï¼Œç”±äºæ ¹æ®è¡¨ç»“æ„ç”Ÿæˆäº†<code>SqlSupport</code>.ä»»ä½•å¯¹è¡¨çš„ä¿¡æ¯å¼•ç”¨éƒ½èƒ½æœ‰æç¤ºï¼ŒåŒ…æ‹¬è¡¨åã€å­—æ®µåã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">></span></span> tasks <span class="token operator">=</span> taskMapper<span class="token punctuation">.</span><span class="token function">selectMany</span><span class="token punctuation">(</span>taskService<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> iPageSize<span class="token punctuation">,</span> iOffset<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>è°ƒç”¨ä¸Šé¢ï¼Œä¹Ÿæ— éœ€åœ¨mapperä¸Šå†ç¼–å†™æ–¹æ³•ï¼Œå› ä¸ºå·²ç»å…¨éƒ¨ç”Ÿæˆäº†ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://blog.olowolo.com/post/new-mybatis-dynamic-sql/">Mybatis Dynamic SQL - é‡æ–°å®šä¹‰ Mybatis åŠ¨æ€ SQL</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ©ç”¨ä¿¡å·æ§åˆ¶phpå¸¸é©»è¿›ç¨‹å¹³æ»‘ä¸­æ–­æ€è€ƒ</title>
      <link href="2020/05/30/php/php%E5%B8%B8%E9%A9%BB%E8%BF%9B%E7%A8%8B%E5%B9%B3%E6%BB%91%E4%B8%AD%E6%96%AD/"/>
      <url>2020/05/30/php/php%E5%B8%B8%E9%A9%BB%E8%BF%9B%E7%A8%8B%E5%B9%B3%E6%BB%91%E4%B8%AD%E6%96%AD/</url>
      
        <content type="html"><![CDATA[<p>å¾ˆå¤šåœºæ™¯ä¸‹æˆ‘ä»¬éƒ½éœ€è¦è¿›ç¨‹ç¨‹åºåœ¨åå°ä¸€ç›´å¤„ç†ä»»åŠ¡ï¼Œæ¯”å¦‚é˜Ÿåˆ—æ¶ˆè´¹ã€‚å¯é‡‡ç”¨while trueçš„æ–¹å¼è®©è¿›ç¨‹å¸¸é©»æŒ‰ä¸€å®šçš„é¢‘æ¬¡æ‰§è¡Œä»»åŠ¡ã€‚ä½†æ˜¯ä½†æˆ‘ä»¬è¦é‡å¯è¿›ç¨‹æˆ–ä¸­æ­¢è¿›ç¨‹æ—¶ï¼Œå¦‚ä½•ä¿è¯è¿›ç¨‹å†…æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•å†ä¸­æ­¢å‘¢ï¼Ÿ</p><span id="more"></span><p>æ€è€ƒä¸€ä¸‹ï¼Œå¯ä¸å¯ä»¥æˆ‘ä»¬é€šè¿‡ä¸€ç§æŒ‡ä»¤å‘Šè¯‰è¿›ç¨‹ï¼Œâ€è¯¶ï¼Œæˆ‘ç°åœ¨è¦é‡å¯ä¸€ä¸‹ï¼Œä½ èƒ½æŠŠæ­£åœ¨åšçš„äº‹æƒ…åšå®Œäº†å…ˆé€€å‡ºæ­‡ä¼šä¹ˆï¼Ÿâ€</p><p><code>kill</code>å‘½ä»¤å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h2 id="å†çœ‹kill"><a href="#å†çœ‹kill" class="headerlink" title="å†çœ‹kill"></a>å†çœ‹kill</h2><p>è®¸äººè‚¯å®šä¼šè§‰å¾— kill ä¸å°±æ˜¯æ€æ‰è¿›ç¨‹ä¹ˆï¼Ÿ æˆ‘ç»å¸¸ç”¨<code>kill -9</code>æ€è¿›ç¨‹ã€‚ è¿™ä¹ˆè¯´ä¹Ÿæ²¡é”™ï¼Œä¸è¿‡æˆ‘ä»¬ç°åœ¨å¯ä»¥ç³»ç»Ÿåœ°æ¥çœ‹çœ‹<code>kill</code>å‘½ä»¤.</p><p>æˆ‘ä»¬å…ˆçœ‹ä¸‹å®˜æ–¹çš„å®šä¹‰,è®©é‚£ä¸ªç”·äººæ¥è·Ÿæˆ‘ä»¬è®²è®²ã€‚</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">man</span> shell</code></pre><pre class="language-none"><code class="language-none">KILL(1)                                                                         User Commands                                                                         KILL(1)NAME       kill - terminate a processSYNOPSIS       kill [-s signal|-p] [-q sigval] [-a] [--] pid...       kill -l [signal]DESCRIPTION       The command kill sends the specified signal to the specified process or process group.  If no signal is specified, the TERM signal is sent.  The TERM signal will kill       processes which do not catch this signal.  For other processes, it may be necessary to use the KILL (9) signal, since this signal cannot be caught.       Most modern shells have a builtin kill function, with a usage rather similar to that of the command described here.  The &#39;-a&#39; and &#39;-p&#39; options, and the possibility to       specify processes by command name are a local extension.       If sig is 0, then no signal is sent, but error checking is still performed.</code></pre><ul><li>å®˜æ–¹è§£é‡Š<code>kill</code>æ˜¯ç”¨æ¥ç»ˆæ­¢è¿›ç¨‹çš„ã€‚</li><li><code>kill</code> å‘é€æŒ‡å®šçš„ä¿¡å·ç»™åˆ°è¿›ç¨‹æˆ–è¿›ç¨‹ç»„ã€‚</li><li>å¦‚æœæ²¡æœ‰æŒ‡å®šä¿¡å·ï¼Œé»˜è®¤å‘é€<code>TERM</code>ä¿¡å·ã€‚</li><li><code>TERM</code>ä¿¡å·å°†ä¼šæ€æ‰è¿›ç¨‹ï¼Œå½“<code>TERM</code>æœªè¢«æ•è·çš„æ—¶å€™ã€‚</li><li><code>9</code>ä¿¡å·ä¸èƒ½è¢«æ•è·</li></ul><p><strong>è°ˆè°ˆæˆ‘çš„ç†è§£</strong></p><ol><li>killå‘½ä»¤å°±æ˜¯ç”¨æ¥æ€æ‰è¿›ç¨‹çš„</li><li>å®ƒå¯ä»¥ç»™è¿›ç¨‹å‘é€ä¸€äº›æŒ‡ä»¤ï¼Œè®©ç¨‹åºå»æ•è·åšç‰¹æ®Šå¤„ç†ã€‚æ¯”å¦‚ä¸Šé¢è¯´åˆ°çš„åœºæ™¯ï¼Œè®©ç¨‹åºæ‰§è¡Œå®Œæ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå†é€€å‡ºã€‚</li></ol><h2 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬ç”¨PHPè„šæœ¬æ¥éªŒè¯ä¸‹ä¸Šé¢çš„ç†è§£ã€‚æˆ‘ä»¬ç”¨<code>pcntl_signal</code>æ¥å¯¹ä¿¡å·è¿›è¡Œæ•è·ã€‚</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">SignalShell</span> <span class="token keyword">extends</span> <span class="token class-name">Shell</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$taskFinish</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span><span class="token comment">//        pcntl_signal(SIGTERM, [$this, 'sig_handler']);</span><span class="token comment">//        pcntl_signal(SIGHUP, [$this, 'sig_handler']);</span>        <span class="token function">pcntl_signal</span><span class="token punctuation">(</span><span class="token constant">SIGINT</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token variable">$this</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'sig_handler'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        pcntl_signal(SIGQUIT, [$this, 'sig_handler']);</span>        <span class="token function">pcntl_signal</span><span class="token punctuation">(</span><span class="token constant">SIGILL</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token variable">$this</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'sig_handler'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">pcntl_signal</span><span class="token punctuation">(</span><span class="token constant">SIGPIPE</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token variable">$this</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'sig_handler'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">pcntl_signal</span><span class="token punctuation">(</span><span class="token constant">SIGALRM</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token variable">$this</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'sig_handler'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">pcntl_signal</span><span class="token punctuation">(</span><span class="token constant">SIGUSR1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token variable">$this</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'sig_handler'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"æ³¨å†Œä¿¡å·"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">task</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token constant boolean">true</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">taskFinish</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">info</span><span class="token punctuation">(</span><span class="token function">uniqid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">sig_handler</span><span class="token punctuation">(</span><span class="token variable">$signo</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$time</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Y-m-d H:i:s'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$signo</span> <span class="token operator">==</span> <span class="token number">14</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//å¿½ç•¥alarmä¿¡å·</span>            <span class="token keyword">echo</span> <span class="token variable">$time</span> <span class="token operator">.</span> <span class="token string double-quoted-string">" ignore alarm signo[<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$signo</span><span class="token punctuation">&#125;</span></span>]\r\n"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token variable">$time</span> <span class="token operator">.</span> <span class="token string double-quoted-string">" exit  signo[<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$signo</span><span class="token punctuation">&#125;</span></span>]\r\n"</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$signo</span> <span class="token operator">==</span> <span class="token constant">SIGUSR1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"æ•è·è‡ªå®šä¹‰"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">taskFinish</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>ä»£ç å¾ˆç®€å•ï¼Œå°±æ˜¯è®©è„šæœ¬æ¯éš”10ç§’è¾“å‡ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä»»åŠ¡ä¹‹å‰å¯¹ä¸€äº›ä¿¡å·è¿›è¡Œæ•è·ã€‚</p><p><img src="http://img.rc5j.cn/blog20200530114817.png" alt=""></p><p>åˆ†åˆ«å¯¹è¿›ç¨‹æ‰§è¡Œäº†ï¼Œkillã€kill QUITã€kill HUP å‘ç°è¿›ç¨‹éƒ½ä¼šè¢«ç›´æ¥ç»ˆæ­¢ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬å¼€å§‹,å¯¹<code>TERM</code>è¿›è¡Œæ•è·ã€‚</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">pcntl_signal</span><span class="token punctuation">(</span><span class="token constant">SIGTERM</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token variable">$this</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'sig_handler'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æ‰“å¼€æ³¨é‡Šã€‚</p><p><img src="http://img.rc5j.cn/blog20200530115128.png" alt=""></p><p>15ä¿¡å·(TERM)è¢«æ•è·åˆ°äº†ï¼Œä½†æ˜¯è¿›ç¨‹å¹¶æ²¡æœ‰é€€å‡º,è¿˜å†ç»§ç»­æ‰§è¡Œã€‚</p><p>æˆ‘ä»¬å†è¯•ä¸‹USR1ä¿¡å·ã€‚</p><p><img src="http://img.rc5j.cn/blog20200530115632.png" alt=""></p><p>USR1è¢«æ•è·åˆ°äº†ï¼Œå¹¶ä¸”ç¨‹åºç«‹å³æ‰§è¡Œå®Œä¸€æ¬¡è¾“å‡ºé€€å‡ºäº†ã€‚æ³¨æ„æˆ‘æ˜¯ç¨‹åºè‡ªå·±æ§åˆ¶äº†,æ•è·åˆ°USR1ä¹‹åä¸ç»§ç»­æ‰§è¡Œå¾ªç¯ã€‚</p><p>ç»†å¿ƒçš„æœ‹å‹ä»¬å¯èƒ½ä¼šå‘ç°ï¼Œç¨‹åºä¸­çš„sleepè¢«è·³è¿‡äº†ã€‚</p><p><strong>è¿™æ˜¯ä»€ä¹ˆåŸå› å‘¢?</strong></p><h2 id="sleep"><a href="#sleep" class="headerlink" title="sleep"></a>sleep</h2><p>äº‹å®ä¸Šsleepæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å‡½æ•°ã€‚å…¶å®å®˜æ–¹æ–‡æ¡£æœ‰è§£é‡Š:</p><p><img src="http://img.rc5j.cn/blog20200530120859.png" alt=""></p><p><code>sleep</code>åœ¨è¢«ä¿¡å·ä¸­æ­¢æ—¶ï¼Œä¼šè¿”å›é0å€¼,éwindowsä¸‹ä¼šè¿”å›å‰©ä½™ç§’æ•°ã€‚</p><p>è®©æˆ‘ä»¬æ¥éªŒè¯ä¸‹ã€‚</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token constant boolean">true</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">taskFinish</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>           <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"sleepè¿”å›:"</span><span class="token operator">.</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">info</span><span class="token punctuation">(</span><span class="token function">uniqid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>æˆ‘ä»¬è®°å½•äº†sleepæ‰§è¡Œå®Œçš„è¿”å›å€¼ã€‚</p><p><img src="http://img.rc5j.cn/blog20200530121207.png" alt=""></p><p>å‘ç°ä¿¡å·ç»™åˆ°æ—¶ï¼Œsleepç¡®å®ä¼šè¿”å›å‰©ä½™ç§’æ•°ã€‚è¿™å°±è§£é‡Šäº†ä¸ºä»€ä¹ˆä¸Šé¢çœ‹åˆ°çš„sleepè¢«è·³è¿‡äº†ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><blockquote><p>A process can define how to handle incoming POSIX signals. If a process does not define a behaviour for a signal, then the default handler for that signal is being used. The table below lists some default actions for POSIX-compliant UNIX systems, such as FreeBSD, OpenBSD and Linux.</p></blockquote><ol><li>killèƒ½ç»™è¿›ç¨‹å‘é€ä¿¡å·é‡ï¼Œå‘Šè¯‰è¿›ç¨‹æŒ‰ä»€ä¹ˆæ–¹å¼ç»“æŸã€‚</li><li>killå®šä¹‰çš„ä¸åŒä¿¡å·é‡ï¼Œç”¨æ³•ä¸åŒï¼Œä½†æ˜¯éœ€è¦ç¨‹åºè‡ªå·±å»å¤„ç†ã€‚å®ƒåªæ˜¯å®šä¹‰äº†ç›®çš„ï¼Œä½†æœªå®šä¹‰è¿‡ç¨‹å’Œå®é™…ç»“æœã€‚</li></ol><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://en.wikipedia.org/wiki/Signal_(IPC)">https://en.wikipedia.org/wiki/Signal_(IPC)</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> php linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>spring bootåˆ†ç¯å¢ƒè‡ªå®šä¹‰é…ç½®</title>
      <link href="2020/05/26/java/spring-boot%E5%88%86%E7%8E%AF%E5%A2%83%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE/"/>
      <url>2020/05/26/java/spring-boot%E5%88%86%E7%8E%AF%E5%A2%83%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ä¸€èˆ¬è§„æ¨¡ä¼ä¸šï¼Œåº”å½“éƒ½æœ‰æµ‹è¯•ç¯å¢ƒå’Œæ­£å¼ç¯å¢ƒåŒºåˆ«ï¼Œæˆ–è€…è‡³å°‘ä¹Ÿæœ‰å¼€å‘ç¯å¢ƒå’Œæ­£å¼ç¯å¢ƒã€‚é‚£ä¸åŒç¯å¢ƒå¿…ç„¶å°±ä¼šæœ‰ä¸€äº›ç¯å¢ƒä¾èµ–çš„ä¸åŒï¼Œä¸ç®¡æ˜¯å‡ºäºå®‰å…¨æ€§è€ƒè™‘è¿˜æ˜¯å…¶ä»–åŸå› å¯¼è‡´çš„ã€‚æ¯”å¦‚æ•°æ®åº“é…ç½®ã€OSSè´¦å·ä¿¡æ¯ç­‰ã€‚é‚£ç¨‹åºå½“ä¸­å°±éœ€è¦é…ç½®å¤šä»½é…ç½®ä¿¡æ¯å’Œæ ¹æ®ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒé…ç½®</p><span id="more"></span><h2 id="åˆ†ç¯å¢ƒé…ç½®"><a href="#åˆ†ç¯å¢ƒé…ç½®" class="headerlink" title="åˆ†ç¯å¢ƒé…ç½®"></a>åˆ†ç¯å¢ƒé…ç½®</h2><p><img src="http://img.rc5j.cn/blog20200526133442.png" alt=""></p><pre class="language-none"><code class="language-none"># æ¿€æ´»æ—¥å¿—ç¯å¢ƒspring.profiles.active&#x3D;prd</code></pre><p>å…¬å…±é…ç½®è¿˜æ˜¯å†™åœ¨applicationã€‚<br>ç›¸åº”é…ç½®å†™åœ¨-{env} æ–‡ä»¶é‡Œã€‚</p><h2 id="è‡ªå®šä¹‰é…ç½®è·å–"><a href="#è‡ªå®šä¹‰é…ç½®è·å–" class="headerlink" title="è‡ªå®šä¹‰é…ç½®è·å–"></a>è‡ªå®šä¹‰é…ç½®è·å–</h2><p>ä¸Šé¢æ˜¯springæ¡†æ¶æ‰€éœ€çš„é»˜è®¤é…ç½®æ–¹æ³•ï¼Œæˆ‘ä»¬é€šå¸¸è¿˜éœ€è¦éå¸¸å¤šçš„è‡ªå®šä¹‰é…ç½®ã€‚æ¯”å¦‚å¯†ç çš„åŠ ç›saltç­‰ç­‰ï¼Œè¿™æ˜¯é¡¹ç›®çš„è‡ªå®šä¹‰é…ç½®ã€‚</p><p>é‚£å¦‚æœå¯¹è¿™äº›è‡ªå®šä¹‰å†…å®¹è¿›è¡Œé…ç½®å’Œè·å–å‘¢ã€‚</p><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>æˆ‘ä»¬ä¾ç„¶å¯ä»¥åœ¨application.propertiesè¿›è¡Œé…ç½®ã€‚</p><p>ä¾‹å¦‚ï¼š</p><pre class="language-properties" data-language="properties"><code class="language-properties"><span class="token attr-name">app.security.salt</span><span class="token punctuation">=</span><span class="token attr-value">zM2Y&amp;*21.rkJr=11</span><span class="token attr-name">app.oss.host</span><span class="token punctuation">=</span><span class="token attr-value">http://oss-cn-beijing.aliyuncs.com</span><span class="token attr-name">app.oss.bucket</span><span class="token punctuation">=</span><span class="token attr-value">bucketNanme</span><span class="token attr-name">app.oss.accessKey</span><span class="token punctuation">=</span><span class="token attr-value">accessKey</span><span class="token attr-name">app.oss.accessSecret</span><span class="token punctuation">=</span><span class="token attr-value">accessSecret</span></code></pre><h2 id="è·å–é…ç½®"><a href="#è·å–é…ç½®" class="headerlink" title="è·å–é…ç½®"></a>è·å–é…ç½®</h2><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Service</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OssService</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;app.oss.host&#125;"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> host<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;app.oss.accessKey&#125;"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> accessKeyId<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;app.oss.accessSecret&#125;"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> accessKeySecret<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;app.oss.bucket&#125;"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> bucketName<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p><strong>ä¸€å®šè¦æ˜¯åœ¨spring beané‡Œè¿›è¡Œè·å–ï¼Œå¦åˆ™æ— æ³•è·å–åˆ°ã€‚</strong></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol><li><a href="https://docs.spring.io/spring-boot/docs/1.5.22.RELEASE/reference/html/boot-features-external-config.html">https://docs.spring.io/spring-boot/docs/1.5.22.RELEASE/reference/html/boot-features-external-config.html</a></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> java spring-boot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysqlå•ä¸ªè¡¨çš„æƒé™æ§åˆ¶</title>
      <link href="2020/05/08/mysql%E5%8D%95%E4%B8%AA%E8%A1%A8%E7%9A%84%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/"/>
      <url>2020/05/08/mysql%E5%8D%95%E4%B8%AA%E8%A1%A8%E7%9A%84%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<blockquote><p>åœ¨ç³»ç»Ÿå¼€å‘å½“ä¸­æœ‰è¿™æ ·çš„éœ€æ±‚ï¼ŒAç³»ç»Ÿéœ€è¦è¯»å†™Bç³»ç»Ÿçš„æ•°æ®åº“æ•°æ®,ä½†æ˜¯æŸäº›ç‰¹æ®Šçš„è¡¨æ•°æ®åªå…è®¸è¯»æ“ä½œã€‚è¿™æ—¶å€™å°±éœ€è¦åšåˆ°è¡¨çº§çš„æƒé™æ§åˆ¶ã€‚</p></blockquote><span id="more"></span><h2 id="revoke"><a href="#revoke" class="headerlink" title="revoke"></a>revoke</h2><p>Mysqlæœ¬èº«æ˜¯æ”¯æŒç”¨revokeè¿›è¡Œæƒé™å›æ”¶æ“ä½œçš„ã€‚</p><p><a href="https://dev.mysql.com/doc/refman/5.6/en/revoke.html">https://dev.mysql.com/doc/refman/5.6/en/revoke.html</a></p><pre class="language-none"><code class="language-none">REVOKE    priv_type [(column_list)]      [, priv_type [(column_list)]] ...    ON [object_type] priv_level    FROM user [, user] ...REVOKE ALL [PRIVILEGES], GRANT OPTION    FROM user [, user] ...REVOKE PROXY ON user    FROM user [, user] ...</code></pre><p>ä»è¯­æ³•å½“ä¸­å¯ä»¥çœ‹åˆ°è¿˜å¯ä»¥åšåˆ°åˆ—çº§åˆ«çš„æ§åˆ¶ã€‚</p><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><pre class="language-none"><code class="language-none">mysql&gt; revoke insert,delete,update on db_oms.t_order from &#39;oms_order_ro&#39;@&#39;localhost&#39;;ERROR 1147 (42000): There is no such grant defined for user &#39;oms_order_ro&#39; on host &#39;localhost&#39; on table &#39;t_order&#39;</code></pre><p>ä½†æ˜¯äº‹å®ä¸Šï¼Œæ‰§è¡Œçš„æ—¶å€™ä¼šé‡åˆ°é—®é¢˜ã€‚</p><p><strong>ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ</strong></p><pre class="language-none"><code class="language-none">mysql&gt; show grants for oms_order_ro@localhost    -&gt; ;+----------------------------------------------------------------------------------+| Grants for oms_order_ro@localhost                                                |+----------------------------------------------------------------------------------+| GRANT USAGE ON *.* TO &#39;oms_order_ro&#39;@&#39;localhost&#39;                                 || GRANT SELECT, INSERT, UPDATE, DELETE ON &#96;db_oms&#96;.* TO &#39;oms_order_ro&#39;@&#39;localhost&#39; |+----------------------------------------------------------------------------------+</code></pre><p>ä»”ç»†çœ‹ä¸‹ï¼Œæˆ‘ä»¬æ˜¯ä½¿ç”¨çš„é€šé…ç¬¦å»è¿›è¡Œèµ‹æƒé™ã€‚çœ‹èµ·æ¥è¿™é‡Œmysqlè¿˜æ˜¯è¡¨ç°çš„æ¯”è¾ƒæœ¬ã€‚è®¤ä¸ºæ²¡æœ‰è¯¥æƒé™è¿›è¡Œå›æ”¶ã€‚</p><p>é‚£ä¹ˆæ­£ç¡®çš„åšæ³•åº”è¯¥æ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</p><blockquote><p>Managing access in mysql can be quite dificult !!</p></blockquote><p>Once you gave him database.* you cannot revoke access for an object that is in that class. MySQL doesnâ€™t expand the Hotels.* wildcard to the individual tables The permissions tables store the granted permissions. Therefore, since you didnâ€™t actually grant anything on Hotels.AllHotels , thereâ€™s nothing for MySQL to revoke. In this case you need to do it granular form the start !</p><p>Remove all privileges on database, table, column levels, etccc.</p><p>Grant privileges to EACH table, except â€˜you chooseâ€™.<br>Grant privilege to specified fields in table â€˜you chooseâ€™.</p><p><strong>æˆ‘ä»¬å¿…é¡»è¦é€ä¸ªé€ä¸ªè¡¨è¿›è¡Œèµ‹æƒé™ï¼Œç„¶åè¿›è¡Œå›æ”¶ã€‚</strong></p><p>å®é™…ä¸Šè¿™ä¹ˆæ“ä½œè™½ç„¶èƒ½è§£å†³é—®é¢˜ï¼Œä½†æ˜¯ä¼šå¸¦æ¥è·Ÿå¤šé—®é¢˜ï¼Œå¦‚æœè¡¨å¢åŠ äº†ã€‚ä½ å¿…é¡»å†å¯¹è¿™ä¸ªè¡¨è¿›è¡Œèµ‹æƒé™å’Œå›æ”¶æƒé™ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Seleniumè‡ªåŠ¨åŒ–æµ‹è¯•åœ¨é¡µé¢webæ€§èƒ½æµ‹è¯•åº”ç”¨çš„å°è¯•</title>
      <link href="2020/05/07/Selenium%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E5%9C%A8%E9%A1%B5%E9%9D%A2web%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%BA%94%E6%9C%89%E7%9A%84%E5%B0%9D%E8%AF%95/"/>
      <url>2020/05/07/Selenium%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E5%9C%A8%E9%A1%B5%E9%9D%A2web%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%BA%94%E6%9C%89%E7%9A%84%E5%B0%9D%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<p>å¯¹äºwebæµ‹è¯•ï¼Œæˆ‘ä»¬é€šå¸¸åœ¨åšçš„æµ‹è¯•éƒ½æ˜¯äººå·¥çš„åŠŸèƒ½æµ‹è¯•ã€‚é‚£ä¹ˆå°‘è§çš„è‡ªåŠ¨åŒ–æµ‹è¯•åˆ°åº•é€‚ç”¨å“ªäº›åœºæ™¯å‘¢ï¼Ÿ</p><span id="more"></span><h1 id="ç”¨pythonè¿›è¡Œwebè‡ªåŠ¨åŒ–æµ‹è¯•"><a href="#ç”¨pythonè¿›è¡Œwebè‡ªåŠ¨åŒ–æµ‹è¯•" class="headerlink" title="ç”¨pythonè¿›è¡Œwebè‡ªåŠ¨åŒ–æµ‹è¯•"></a>ç”¨pythonè¿›è¡Œwebè‡ªåŠ¨åŒ–æµ‹è¯•</h1><blockquote><p>å‰æ®µæ—¶é—´ï¼Œåœ¨å®¢æœä¿¡æ¯ç³»ç»Ÿè¿›å…¥ç”¨æˆ·ä½“éªŒé˜¶æ®µæ—¶å‘ç°å†…å­˜å­˜åœ¨æ³„éœ²é—®é¢˜ã€‚æˆ‘ä»¬èŠ±äº†å¾ˆå¤šæ—¶é—´å»æ’æŸ¥åŸå› ã€‚ç»è¿‡å„ç§å¯èƒ½çš„ä¼˜åŒ–æ–¹æ¡ˆï¼Œç»“æœå‘ç°æ²¡æœ‰å®è´¨æ€§çš„æ•ˆæœï¼Œäºæ˜¯æˆ‘ä»¬å†³å®šé‡æ„ã€‚ä½†æ˜¯å¦‚ä½•ä¿è¯é‡æ„æ–¹æ¡ˆçš„å¯è¡Œå‘¢ï¼Ÿäºæ˜¯æˆ‘ä»¬ç”¨åˆ°äº†python+Selenium</p></blockquote><h2 id="ä¸ºä»€ä¹ˆä¼šç”¨åˆ°webè‡ªåŠ¨åŒ–æµ‹è¯•"><a href="#ä¸ºä»€ä¹ˆä¼šç”¨åˆ°webè‡ªåŠ¨åŒ–æµ‹è¯•" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šç”¨åˆ°webè‡ªåŠ¨åŒ–æµ‹è¯•"></a>ä¸ºä»€ä¹ˆä¼šç”¨åˆ°webè‡ªåŠ¨åŒ–æµ‹è¯•</h2><h3 id="webè‡ªåŠ¨åŒ–æµ‹è¯•é€‚ç”¨åœºæ™¯"><a href="#webè‡ªåŠ¨åŒ–æµ‹è¯•é€‚ç”¨åœºæ™¯" class="headerlink" title="webè‡ªåŠ¨åŒ–æµ‹è¯•é€‚ç”¨åœºæ™¯"></a>webè‡ªåŠ¨åŒ–æµ‹è¯•é€‚ç”¨åœºæ™¯</h3><p>å¯¹äºwebæµ‹è¯•ï¼Œæˆ‘ä»¬é€šå¸¸åœ¨åšçš„æµ‹è¯•éƒ½æ˜¯äººå·¥çš„åŠŸèƒ½æµ‹è¯•ã€‚é‚£ä¹ˆå°‘è§çš„è‡ªåŠ¨åŒ–æµ‹è¯•åˆ°åº•é€‚ç”¨å“ªäº›åœºæ™¯å‘¢ï¼Ÿ</p><ul><li>å›å½’æµ‹è¯•ã€‚æ¯ä¸€æ¬¡åº”ç”¨å‘å¸ƒï¼Œéƒ½ä¼´éšç€ä¸€æ¬¡å›å½’æµ‹è¯•ã€‚å¯¹äºé‡å¤æ€§çš„å·¥ä½œï¼Œæœºå™¨æ˜¾ç„¶æ›´é€‚åˆã€‚</li><li>å…¼å®¹æ€§æµ‹è¯•ã€‚ä¸ç®¡æ˜¯Webæµ‹è¯•ï¼Œè¿˜æ˜¯Appæµ‹è¯•ï¼Œå…¼å®¹æ€§æµ‹è¯•éƒ½æ˜¯å¿…ä¸å¯å°‘çš„ä¸€ç¯ã€‚ä»¥Webæµ‹è¯•ä¸ºä¾‹ï¼ŒåŒæ ·çš„æµ‹è¯•ç”¨ä¾‹ï¼Œéœ€è¦åœ¨ä¸åŒçš„æµè§ˆå™¨ä¸Šåˆ†åˆ«è¿è¡Œä¸€éï¼Œè¿™å¯¹æµ‹è¯•äººå‘˜è€Œè¨€ä¸å¯è°“ä¸æ˜¯ä¸€ç§æŠ˜ç£¨ã€‚</li><li>å¤§è§„æ¨¡æµ‹è¯•ã€‚å¦‚æœä¸€æ¬¡æµ‹è¯•æ¶‰åŠçš„æµ‹è¯•ç”¨ä¾‹è¿‡å¤šï¼ˆæ¯”å¦‚100+ï¼‰ï¼ŒåŠŸèƒ½æµ‹è¯•éš¾å…ä¼šæœ‰é—æ¼æˆ–è€…é‡å¤ï¼Œè€Œè‡ªåŠ¨åŒ–æµ‹è¯•å¯ä»¥è½»æ¾ç¡®ä¿ä¸€ä¸ªä¸å°‘ï¼Œä¸€ä¸ªä¹Ÿä¸å¤šã€‚</li><li>æ€§èƒ½æµ‹è¯•</li></ul><h3 id="å¼Šç«¯"><a href="#å¼Šç«¯" class="headerlink" title="å¼Šç«¯"></a>å¼Šç«¯</h3><p>ä¸‡äº‹çš†æœ‰åˆ©å¼Šï¼Œæœºå™¨çš„è‡ªåŠ¨åŒ–æµ‹è¯•æ²¡æœ‰å¹¿æ³›åº”ç”¨è‚¯å®šæ˜¯æœ‰åŸå› çš„ã€‚</p><ul><li>ä¸ä½çš„æŠ€æœ¯é—¨æ§›ã€‚ä¸è®ºæ˜¯ä½¿ç”¨å“ªç§è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ï¼Œå¯¹äºæµ‹è¯•äººå‘˜è€Œè¨€ï¼Œéƒ½å­˜åœ¨ä¸€å®šçš„æŠ€æœ¯é—¨æ§›ï¼Œä¸€èˆ¬è‡³å°‘éœ€è¦å­¦ä¹ å¹¶æŒæ¡ä¸€é—¨ç¼–ç¨‹è¯­è¨€ã€‚<br>å¯è§‚çš„å¼€å‘æˆæœ¬å’Œç»´æŠ¤æˆæœ¬ã€‚è·Ÿä»»ä½•ç¨‹åºä¸€æ ·ï¼Œæ— è®ºæ˜¯ç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ï¼Œè¿˜æ˜¯åœ¨éœ€æ±‚å˜åŒ–æ—¶ä¿®æ”¹è„šæœ¬ï¼Œéƒ½éœ€è¦èŠ±è´¹å¤§é‡çš„æ—¶é—´ã€‚</li><li>éœ€æ±‚è¦ç¨³å®šã€‚è‡ªåŠ¨åŒ–æµ‹è¯•çš„å‰ææ˜¯æµ‹è¯•ç”¨ä¾‹è¦ç¨³å®šï¼Œè€Œæµ‹è¯•ç”¨ä¾‹ç¨³å®šçš„å‰ææ˜¯éœ€æ±‚è¦ç¨³å®šã€‚å¯¹äºä¸´æ—¶çš„æˆ–è€…è¯´ä¸€æ¬¡æ€§çš„éœ€æ±‚ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•å¾€å¾€æ˜¯å¾—ä¸å¿å¤±çš„ã€‚</li><li>åº”ç”¨å‘¨æœŸé•¿ã€‚åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸè¶Šé•¿ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•èŠ‚çœçš„æ—¶é—´è¶Šå¤šï¼Œå¸¦æ¥çš„ä»·å€¼ä¹Ÿè¶Šå¤§ã€‚</li></ul><h3 id="æ€§èƒ½æµ‹è¯•"><a href="#æ€§èƒ½æµ‹è¯•" class="headerlink" title="æ€§èƒ½æµ‹è¯•"></a>æ€§èƒ½æµ‹è¯•</h3><p>éšç€webå‰ç«¯æŠ€æœ¯å‘å±•æ›´æ–°è¶Šæ¥è¶Šè¿…çŒ›çš„æ€åŠ¿ï¼Œå‰ç«¯æŠ€æœ¯å’Œæ¡†æ¶å±‚å‡ºä¸ç©·ã€‚ä½†å¾€å¾€æˆ‘ä»¬ä¼šåœ¨çŸ­æœŸå†…é«˜ä¼°æŠ€æœ¯å¸¦æ¥çš„å½±å“ã€‚</p><p><img src="http://img.rc5j.cn/blog20190524140107.png" alt=""></p><p>æ‰€ä»¥å¯¹äºä»»ä½•ä¸€ä¸ªæ–°çš„äº‹ç‰©ï¼Œæˆ‘ä»¬é‡‡å–ä¿å®ˆçš„æ€åº¦å¯¹å¾…å¯èƒ½ä¼šå°‘è·Œå…¥ä¸€äº›<strong>å¹»ç­çš„ä½è°·æœŸ</strong>ã€‚å¯¹äºæ–°æŠ€æœ¯åšå……åˆ†çš„è¯„ä¼°æµ‹è¯•ï¼Œå¯èƒ½ä¼šè®©æˆ‘ä»¬å°‘è¸©ä¸€äº›å‘ã€‚å½“ç„¶å¾€å¾€è¿™è¯ï¼Œéƒ½æ˜¯åœ¨äº‹åæ‰ä¼šæå‡ºæ¥ã€‚</p><p>ä¸ºä»€ä¹ˆå¯ä»¥ç”¨è‡ªåŠ¨åŒ–æµ‹è¯•åšæ€§èƒ½æµ‹è¯•ï¼Ÿ<br>ç½‘ä¸Šä¼¼ä¹éƒ½æ²¡æœ‰è¿™ç§å…ˆä¾‹ã€‚æˆ‘æ€»ç»“ä»¥ä¸‹å‡ ä¸ªåŸå› ï¼š</p><ol><li>è„šæœ¬èƒ½å¼ºæœ‰è§„å¾‹åœ°é‡å¤æ‰§è¡Œæ“ä½œï¼Œè€Œå¼€å‘æˆ–æµ‹è¯•è‡ªå·±åšè¿™ä¸ªå·¥ä½œä¼šå¾ˆç¹çè€Œä¸”å‡ºäº†ä¸€æ­¥å·®é”™å°±å¾—é‡æ¥</li><li>è„šæœ¬èƒ½å°†æ‰§è¡Œæ“ä½œå’Œæ•°æ®è®°å½•ç»“åˆèµ·æ¥ã€‚è€Œäººç±»æ‰§è¡Œä¸€æ¬¡æ•°æ®è®°å½•å’ŒåŠ¨ä½œæ‰§è¡Œä¹Ÿè®¸æ²¡é—®é¢˜ï¼Œä½†é‡å¤500æ¬¡æˆ–æ›´å¤šè€Œæ— å·®é”™é‚£å°±å›°éš¾äº†ã€‚</li></ol><h2 id="webè‡ªåŠ¨åŒ–æµ‹è¯•æ–¹æ³•"><a href="#webè‡ªåŠ¨åŒ–æµ‹è¯•æ–¹æ³•" class="headerlink" title="webè‡ªåŠ¨åŒ–æµ‹è¯•æ–¹æ³•"></a>webè‡ªåŠ¨åŒ–æµ‹è¯•æ–¹æ³•</h2><ul><li>python+Selenium è·¨æµè§ˆå™¨æ”¯æŒ</li><li>puppeteer ä¸“æ³¨äºchrome</li><li>airtest è·¨å¹³å°ï¼Œå®‰å“ã€iosã€webï¼Œwebè¿˜æ˜¯ç”¨çš„Selenium</li></ul><h2 id="æµ‹è¯•ç»“æœ"><a href="#æµ‹è¯•ç»“æœ" class="headerlink" title="æµ‹è¯•ç»“æœ"></a>æµ‹è¯•ç»“æœ</h2><p><img src="http://img.rc5j.cn/blog20190514101858.png" alt=""></p><p>æ‰§è¡Œè„šæœ¬</p><p><img src="http://img.rc5j.cn/blog20190524162047.gif" alt=""></p><p>è„šæœ¬è¿è¡Œæƒ…å†µï¼Œæµè§ˆå™¨åœ¨è‡ªåŠ¨è¿›è¡Œæ“ä½œ</p><p><img src="http://img.rc5j.cn/blog20190524162725.png" alt=""></p><p>å¾—å‡ºç»Ÿè®¡ç»“æœã€‚æˆ‘ä»¬æ¨¡æ‹Ÿç”¨æˆ·çš„æŸä¸ªæœ€é¢‘ç¹çš„æ“ä½œï¼Œå‘ç°é‡‡ç”¨æ–°çš„æ–¹æ¡ˆåå†…å­˜ä¼šåœ¨çŸ­æ—¶é—´å†…æœ‰æ•ˆå›æ”¶ã€‚æ•´ä½“ä¸Šï¼Œé¡µé¢å†…å­˜ä¼šè¶‹äºç¨³å®šçš„æ€åŠ¿ã€‚</p><h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><h3 id="åŠ¨æ€çš„ggcode"><a href="#åŠ¨æ€çš„ggcode" class="headerlink" title="åŠ¨æ€çš„ggcode"></a>åŠ¨æ€çš„ggcode</h3><pre class="language-python" data-language="python"><code class="language-python">ggcode <span class="token operator">=</span> prompt<span class="token punctuation">(</span><span class="token string">"è¾“å…¥è°·æ­Œç : "</span><span class="token punctuation">)</span></code></pre><p>ç”±äºç™»å½•ç”¨çš„è°·æ­Œç æ˜¯åŠ¨æ€çš„ï¼Œæ‰€ä»¥è¿™é‡Œåªèƒ½æ¯æ¬¡è¾“å…¥è¿›è¡Œå¡«å……ã€‚è¿™é‡Œæˆ‘ä»¬å¼•å…¥prompt_toolkitè¿›è¡Œç»ˆç«¯çš„äº¤äº’</p><h3 id="è·å–å…ƒç´ "><a href="#è·å–å…ƒç´ " class="headerlink" title="è·å–å…ƒç´ "></a>è·å–å…ƒç´ </h3><p>å¦‚ä»Šçš„å‰ç«¯é¡¹ç›®ï¼Œç”±äºä½¿ç”¨çš„æ˜¯æ•°æ®é©±åŠ¨domï¼Œä¸æ˜¯ä¼ ç»Ÿçš„jqueryæ“ä½œï¼Œç°åœ¨åŸºæœ¬çœ‹ä¸åˆ°id classç­‰è¿›è¡Œå…ƒç´ å®šä½ã€‚ç°åœ¨æœ€æ–¹ä¾¿çš„åšæ³•åªèƒ½æ˜¯é€šè¿‡xpathå¯»æ‰¾å…ƒç´ ã€‚</p><p><img src="http://img.rc5j.cn/blog20190524180042.png" alt=""></p><pre class="language-none"><code class="language-none">xpath &#x3D; &#39;&#x2F;&#x2F;*[@id&#x3D;&quot;app&quot;]&#x2F;div&#x2F;div[2]&#x2F;div[1]&#39;element &#x3D; self.browser.find_element_by_xpath(                    xpath)</code></pre><p><strong>ç”±äºä¸æ˜¯å›ºå®šidï¼Œé¡µé¢ä¸€æ—¦æ”¹å˜xpathå¾ˆæœ‰å¯èƒ½æ”¹å˜ï¼Œä¼šå¯¼è‡´å…ƒç´ æ‰¾ä¸åˆ°ã€‚</strong></p><h3 id="webdriverè¿›ç¨‹ä¸é€€å‡º"><a href="#webdriverè¿›ç¨‹ä¸é€€å‡º" class="headerlink" title="webdriverè¿›ç¨‹ä¸é€€å‡º"></a>webdriverè¿›ç¨‹ä¸é€€å‡º</h3><p>åœ¨ä½¿ç”¨è¿‡ç¨‹å½“ä¸­å‘ç°æä¾›çš„<code>quit()</code> æ–¹æ³•å¹¶ä¸èƒ½è®©è¿›ç¨‹é€€å‡ºï¼Œæ‰€ä»¥åªèƒ½è‡ªå·±å°†è¿›ç¨‹killæ‰ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">close_browser</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></code></pre><h3 id="ç‚¹å‡»"><a href="#ç‚¹å‡»" class="headerlink" title="ç‚¹å‡»"></a>ç‚¹å‡»</h3><p>åœ¨è¿›è¡ŒæŒ‰é’®ç‚¹å‡»çš„æ—¶å€™ï¼Œç»å¸¸ä¼šå› ä¸ºé¡µé¢æœªåŠ è½½å®Œç­‰åŸå› å¯¼è‡´æ— æ³•ç‚¹å‡»ã€‚ç»“æœå°±æ˜¯å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚å¯¹äºè¿™ç§æƒ…å†µwebdriveræœ¬èº«æœ‰æä¾›waitç­‰å¾…ã€‚</p><pre class="language-python" data-language="python"><code class="language-python">wait <span class="token operator">=</span> WebDriverWait<span class="token punctuation">(</span>self<span class="token punctuation">.</span>browser<span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>            element <span class="token operator">=</span> wait<span class="token punctuation">.</span>until<span class="token punctuation">(</span>EC<span class="token punctuation">.</span>element_to_be_clickable<span class="token punctuation">(</span><span class="token punctuation">(</span>By<span class="token punctuation">.</span>XPATH<span class="token punctuation">,</span> xpath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p><code>WebDriverWait</code> éœ€è¦è®¾ç½®ä¸€ä¸ªç­‰å¾…æ—¶é•¿ï¼Œä¸å¯èƒ½æ— é™ç­‰å¾…</p><p>è¿˜æœ‰äº›æƒ…å†µä¸‹ï¼Œæ˜¯ç”±äºéœ€è¦ä¸‹æ‹‰æ»šåŠ¨æ¡æ‰èƒ½è¿›è¡Œç‚¹å‡»ã€‚è¿™ç§æƒ…å†µå¯ä»¥è€ƒè™‘æ‰§è¡Œjsè¿›è¡Œç‚¹å‡»ã€‚</p><pre class="language-python" data-language="python"><code class="language-python">js_click_next_page <span class="token operator">=</span> <span class="token string">'document.querySelector("body > div.worker-order-search-list > div.content-wrapper > section > ul > li.ivu-page-next").click()'</span>                browser<span class="token punctuation">.</span>execute_script<span class="token punctuation">(</span>js_click_next_page<span class="token punctuation">)</span></code></pre><p><strong>ä½¿ç”¨webdriver.clickè¿˜æ˜¯ç”¨jsç‚¹å‡»ï¼Ÿ</strong></p><blockquote><p>When Should You Use JavaScript for Clicking?<br>If you are using Selenium for testing an application, my answer to this question is â€œalmost neverâ€. By and large, your Selenium test should reproduce what a user would do with the browser. Taking the example of the drop down menu: a test should click on the button that brings up the drop down first, and then click on the menu item. If there is a problem with the GUI because the button is invisible, or the button fails to show the menu items, or something similar, then your test will fail and youâ€™ll have detected the bug. If you use JavaScript to click around, you wonâ€™t be able to detect these bugs through automated testing.</p></blockquote><p><strong>æ€»ä¹‹è¿˜æ˜¯çœ‹ä½ çš„ä½¿ç”¨ç›®çš„ï¼Œå¦‚æœè‡ªåŠ¨åŒ–æµ‹è¯•çš„ç›®çš„å€¾å‘äºæµ‹è¯•é¡µé¢åŠŸèƒ½ã€‚é‚£ä¹ˆå»ºè®®ä½¿ç”¨webdriver.clickã€‚å¦‚æœæ˜¯ä¸ºäº†æµ‹è¯•æ€§èƒ½ï¼Œé‚£å¯ä»¥è¿›è¡Œjsç‚¹å‡»äº†ã€‚</strong></p><h2 id="è·å–é¡µé¢å†…å­˜"><a href="#è·å–é¡µé¢å†…å­˜" class="headerlink" title="è·å–é¡µé¢å†…å­˜"></a>è·å–é¡µé¢å†…å­˜</h2><p>æµè§ˆå™¨çš„ä»»åŠ¡ç®¡ç†å™¨å¯ä»¥å¾ˆå®¹æ˜“çš„çœ‹åˆ°é¡µé¢çš„å†…å­˜ã€cpuã€ç½‘ç»œæƒ…å†µï¼Œä½†æ˜¯å¦‚ä½•è·å–åˆ°è®°å½•å¹¶ç»Ÿè®¡å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ï¼Œå¾ˆå¯æƒœç°åœ¨è¿˜æ²¡æ‰¾åˆ°ã€‚å¦‚æœæœ‰å®˜æ–¹åŠæ³•ï¼Œè¯·å‘Šè¯‰æˆ‘ã€‚</p><p>æˆ‘èµ°äº†ä¸€ä¸ªå…¶ä»–é€”å¾„è·å–ï¼Œä»æ“ä½œç³»ç»Ÿå±‚é¢è·å–è¿›ç¨‹ã€‚è·å–ä¸€ä¸ªè¿›ç¨‹å¾—å†…å­˜å ç”¨æ˜¯ä¸€ä¸ªç®€å•çš„äº‹ï¼Œä½†æ˜¯å¦‚ä½•çŸ¥é“æŸä¸ªé¡µé¢çš„è¿›ç¨‹idå‘¢ã€‚å¾ˆé—æ†¾çš„æ˜¯ï¼ŒwebdriveråŒæ ·æ²¡æœ‰æ¥å£æ–¹æ³•æä¾›ã€‚äºæ˜¯æˆ‘åªèƒ½ä»webdriverå­è¿›ç¨‹å…¥æ‰‹ï¼Œçœ‹æœ‰æ²¡æœ‰ä¿¡æ¯èƒ½ä¸pageå…³è”ä¸Šã€‚å¾ˆé—æ†¾çš„äº‹ï¼Œå•å•ä»å­è¿›ç¨‹åçœ‹ä¸é¡µé¢æ¯«æ— å…³è”ã€‚æ‰€ä»¥ã€‚ã€‚æœ€åï¼Œæˆ‘åªèƒ½åšä¸€ä¸ªå‡è®¾ï¼Œå‡è®¾æµè§ˆå™¨å¯åŠ¨ç±»ä¼¼linuxå¯åŠ¨ã€‚å¯åŠ¨çš„ç¨‹åºæ˜¯æœ‰å…ˆåå…³ç³»çš„ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">get_page_pid</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> page_num<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""[è·å–å¯åŠ¨é¡µé¢çš„è¿›ç¨‹id,éå®˜æ–¹æ–¹æ³•,ä¸ä¸€å®šæ­£ç¡®ã€‚            åŸç†:å‡è®¾chromeä¸»è¿›ç¨‹å¯åŠ¨å­è¿›ç¨‹æ˜¯æœ‰é¡ºåºçš„,é‚£ä¹ˆæ‰“å¼€çš„é¡µé¢è¿›ç¨‹åœ¨ç¬¬4ä¸ªå¼€å§‹å¯åŠ¨]        Returns:            [type] -- [description]        """</span>        webdriver_pid <span class="token operator">=</span> self<span class="token punctuation">.</span>browser<span class="token punctuation">.</span>service<span class="token punctuation">.</span>process<span class="token punctuation">.</span>pid        ps <span class="token operator">=</span> psutil<span class="token punctuation">.</span>Process<span class="token punctuation">(</span>webdriver_pid<span class="token punctuation">)</span>        ps_children <span class="token operator">=</span> ps<span class="token punctuation">.</span>children<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> ps_children<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">+</span>page_num<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pid</code></pre><p>è¿™æ˜¯ä¸€ç§å¯¹é¡¹ç›®æ— ä¾µå…¥çš„åšæ³•ï¼Œä½ ä¸éœ€è¦æ”¹åŠ¨é¡¹ç›®ä»£ç ï¼Œå°±å¯ä»¥å¯¹æµè§ˆå™¨é¡µé¢å†…å­˜è¿›è¡Œç»Ÿè®¡ã€‚è¿˜æœ‰å…¶ä»–åšæ³•ï¼Œå¯ä»¥å¯¹é¡¹ç›®è¿›è¡Œå¢åŠ å†…å­˜ä¸ŠæŠ¥è¿›è¡Œç»Ÿè®¡ã€‚ä½†è¿™æ ·çš„åšæ³•åŒæ ·æœ‰å¼Šç«¯ï¼š</p><ol><li>éœ€è¦åŠ¨è¢«æµ‹é¡¹ç›®ï¼Œå¯¹é¡¹ç›®å¹²æ‰°</li><li>å¢åŠ å·¥ä½œé‡ï¼Œä¸å…‰æ˜¯ä¸ŠæŠ¥è¿˜åŒ…æ‹¬æ¥æ”¶ä¸ŠæŠ¥æ¥å£</li><li>å¦‚æœæ˜¯å¤šiframeé¡µç­¾æ–¹å¼ï¼Œç»Ÿè®¡èšåˆä¸ŠæŠ¥å°†éå¸¸ç¹ç</li></ol><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç»Ÿè®¡é¡µé¢è¿›ç¨‹æ–¹æ³•ã€‚<strong>å¾—åˆ°çš„æ•°æ®æ˜¯æ•´ä¸ªé¡µé¢è¿›ç¨‹æ‰€å ç”¨çš„å†…å­˜ï¼Œå¹¶éé¡µé¢jså ç”¨å†…å­˜ã€‚</strong></p><h2 id="ç»Ÿè®¡"><a href="#ç»Ÿè®¡" class="headerlink" title="ç»Ÿè®¡"></a>ç»Ÿè®¡</h2><p>åœ¨ç»Ÿè®¡ä¸Šï¼Œæˆ‘ä½¿ç”¨äº†chartify+pandas,åªè¦ä¼ å…¥æ•°æ®å°±èƒ½å¿«æ·åœ°ç”Ÿæˆå›¾è¡¨</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">chartArea</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">,</span> x_column<span class="token punctuation">,</span> y_column<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""[ç»˜åˆ¶åŒºåŸŸå›¾]        Arguments:            data &#123;[dict]&#125; -- [æ•°æ®çŸ©é˜µ,æ‹¿å»æ„å»ºpandas dataFrame]            x_column &#123;[type]&#125; -- [xè½´å­—æ®µ]            y_column &#123;[type]&#125; -- [yè½´å­—æ®µ]        """</span>        data_frame <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>data<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>data_frame<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>ch<span class="token punctuation">.</span>plot<span class="token punctuation">.</span>area<span class="token punctuation">(</span>data_frame<span class="token operator">=</span>data_frame<span class="token punctuation">,</span>                          x_column<span class="token operator">=</span>x_column<span class="token punctuation">,</span> y_column<span class="token operator">=</span>y_column<span class="token punctuation">,</span> stacked<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> show_type<span class="token operator">=</span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>ch<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'./output/%s-%s.png'</span> <span class="token operator">%</span>                     <span class="token punctuation">(</span>self<span class="token punctuation">.</span>subtitle<span class="token punctuation">,</span> time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y%m%d%H%M%S"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'png'</span><span class="token punctuation">)</span></code></pre><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ­£å¦‚å‰é¢æ‰€è¯´ï¼Œwebè‡ªåŠ¨åŒ–æµ‹è¯•æ²¡æœ‰å¹¿æ³›åº”ç”¨è‚¯å®šæ˜¯æœ‰åŸå› çš„ã€‚ä½†æ˜¯åšä¸ºå‰ç«¯é—®é¢˜çš„è®ºè¯è¿˜æ˜¯æœ‰å¾ˆå¤§æ„ä¹‰ã€‚</p><p>æ¯”å¦‚ï¼Œé¡µé¢å ç”¨å†…å­˜é™åˆ¶æ˜¯å¤šå°‘ï¼Ÿæˆ‘æ‰¾äº†å¾ˆå¤šèµ„æ–™æ²¡æœ‰æ‰¾åˆ°(å®˜æ–¹çš„æ‰å¯ä¿¡)ã€‚</p><p>é€šè¿‡æµ‹è¯•ï¼Œæˆ‘å¾—åˆ°çš„ç»“æœæ˜¯ï¼Œchrome å¯¹å•é¡µé¢js å†…å­˜æœ‰é™åˆ¶2G,å¯¹é¡µé¢è¿›ç¨‹å†…å­˜æ— é™åˆ¶ã€‚ä½ ä¸€ä¸ªé¡µé¢è¿›ç¨‹ç”šè‡³å¯ä»¥è·‘åˆ°20Gã€‚</p><p>python+Selenium ä½¿ç”¨èµ·æ¥å¾ˆç®€å•ï¼Œæ„Ÿå…´è¶£åˆæœ‰éœ€è¦çš„è¯ï¼Œä¸å¦¨ä¸€è¯•ã€‚</p><h2 id="é™„åŠ "><a href="#é™„åŠ " class="headerlink" title="é™„åŠ "></a>é™„åŠ </h2>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello world</title>
      <link href="2020/05/07/Hello-world/"/>
      <url>2020/05/07/Hello-world/</url>
      
        <content type="html"><![CDATA[<pre class="language-none"><code class="language-none">hello,world </code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> éšç¬” </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å·¥æ¬²å–„å…¶äº‹å¿…å…ˆåˆ©å…¶å™¨-ç¨‹åºå‘˜å·¥å…·</title>
      <link href="2019/04/04/%E5%B7%A5%E6%AC%B2%E5%96%84%E5%85%B6%E4%BA%8B%E5%BF%85%E5%85%88%E5%88%A9%E5%85%B6%E5%99%A8/"/>
      <url>2019/04/04/%E5%B7%A5%E6%AC%B2%E5%96%84%E5%85%B6%E4%BA%8B%E5%BF%85%E5%85%88%E5%88%A9%E5%85%B6%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æé«˜å·¥ä½œæ•ˆç‡ï¼Œé¦–å…ˆä½ å¾—æœ‰ä¸€å¥—ç”¨çš„é¡ºæ‰‹çš„å·¥å…·</p></blockquote><p><img src="http://img.rc5j.cn/blog20190404140301.png" alt=""></p><h2 id="å›¾åºŠ"><a href="#å›¾åºŠ" class="headerlink" title="å›¾åºŠ"></a>å›¾åºŠ</h2><span id="more"></span><p><strong>PicGo</strong></p><p><img src="http://img.rc5j.cn/blog20190404140404.png" alt=""></p><p>æ”¯æŒç²˜è´´æ¿ï¼Œç›´æ¥ä¸Šä¼ åˆ°äº‘å­˜å‚¨ã€‚</p><p>æˆ‘ç”¨ä¸ƒç‰›äº‘ï¼Œä¸Šä¼ ä¹‹ååˆ¶åŠ¨æŠŠmarkdownçš„æ ¼å¼åœ°å€ï¼Œæ”¾åˆ°ç²˜è´´æ¿ç›´æ¥å¯ä»¥ç²˜è´´åˆ°markdown.</p><p>å¯¹å–œæ¬¢ç”¨markdownå†™ä½œçš„åŒå­¦éå¸¸æ–¹ä¾¿</p><h2 id="è®°äº‹æœ¬"><a href="#è®°äº‹æœ¬" class="headerlink" title="è®°äº‹æœ¬"></a>è®°äº‹æœ¬</h2><p><strong>avenote</strong></p><p>ä¹‹å‰avenoteæ— æ³•å†™markdownï¼Œæˆ‘æ˜¯æ€ä¹ˆä¹Ÿå–œæ¬¢ä¸ä¸Šã€‚æœ€è¿‘å‘ç°ç‰ˆæœ¬æ›´æ–°ä¹‹åå¯ä»¥æ–°å»ºmarkdownæ ¼å¼ã€‚æˆ‘ç”¨é‡æ–°ä½¿ç”¨ä¸Šäº†ã€‚</p><p><img src="http://img.rc5j.cn/blog20190404175017.png" alt=""></p><p><strong>boostnote</strong></p><p>è¿™æ˜¯ä¸€æ¬¾ä¸“ä¸ºç¨‹åºå‘˜è®¾è®¡çš„è®°äº‹æœ¬ï¼Œæ”¯æŒä»£ç ç‰‡æ®µæ ¼å¼å’Œmarkdownæ ¼å¼ã€‚</p><p><img src="http://img.rc5j.cn/blog20190404175220.png" alt=""></p><p>æˆ‘æœ€å–œæ¬¢çš„ä¸€ç‚¹æ˜¯å®ƒçš„å¾…åŠè¿›åº¦å±•ç¤ºï¼Œå¾ˆç›´è§‚ã€‚</p><p>ç¼ºç‚¹å°±æ˜¯æ²¡æœ‰äº‘ç«¯åŠŸèƒ½å’Œæ²¡æœ‰æ‰‹æœºç‰ˆã€‚</p><h2 id="restå®¢æˆ·ç«¯"><a href="#restå®¢æˆ·ç«¯" class="headerlink" title="restå®¢æˆ·ç«¯"></a>restå®¢æˆ·ç«¯</h2><p><strong>Insomnia</strong></p><p>å®ƒæœ€å¤§çš„äº®ç‚¹æ˜¯èƒ½æ”¯æŒä»curlå‘½ä»¤é‡Œæ–°å»ºrequestå®ä¾‹ï¼Œèƒ½ä»chromeåˆ©çš„copy as curl å¤åˆ¶è¿‡æ¥æ— ç¼å¯¹æ¥ã€‚åœ¨è°ƒè¯•æ¥å£çš„æ—¶å€™ç®€ç›´æ˜¯å®Œç¾ï¼</p><p><img src="http://img.rc5j.cn/blog20190404180843.png" alt=""></p><h2 id="gitå®¢æˆ·ç«¯"><a href="#gitå®¢æˆ·ç«¯" class="headerlink" title="gitå®¢æˆ·ç«¯"></a>gitå®¢æˆ·ç«¯</h2><p><strong>gitKarken</strong></p><p>ç« é±¼ğŸ™å“¥æ˜¯æˆ‘åˆ°ç›®å‰ä¸ºæ­¢æœ€å–œæ¬¢çš„gitå®¢æˆ·ç«¯ï¼Œç•Œé¢ç¾è§‚ï¼Œæ“ä½œè®¾è®¡èˆ’æœï¼Œå¯¹gitflowä¼˜é›…æ”¯æŒã€‚</p><p><img src="http://img.rc5j.cn/blog20190404181218.png" alt=""></p><p>git flow æ“ä½œå¾ˆæ–¹ä¾¿äº†ã€‚</p><p><img src="http://img.rc5j.cn/blog20190404181623.png" alt=""></p><p>æŒç»­æ›´æ–°ä¸­ã€‚ã€‚ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> ç¨‹åºäººç”Ÿ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker+compose+nginx+php</title>
      <link href="2018/07/22/docker-compose-nginx-php/"/>
      <url>2018/07/22/docker-compose-nginx-php/</url>
      
        <content type="html"><![CDATA[<p><img src="http://img.rc5j.cn/blog20200722165520.png" alt=""></p><span id="more"></span><blockquote><p>Docker å¯ä»¥è®©å¼€å‘è€…æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªè½»é‡çº§ã€å¯ç§»æ¤çš„å®¹å™¨ä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„ Linux æœºå™¨ä¸Šï¼Œä¹Ÿå¯ä»¥å®ç°è™šæ‹ŸåŒ–ã€‚</p></blockquote><h2 id="æˆ‘ç”¨dockeråšä»€ä¹ˆï¼Ÿ"><a href="#æˆ‘ç”¨dockeråšä»€ä¹ˆï¼Ÿ" class="headerlink" title="æˆ‘ç”¨dockeråšä»€ä¹ˆï¼Ÿ"></a>æˆ‘ç”¨dockeråšä»€ä¹ˆï¼Ÿ</h2><p>å¿«é€Ÿæ­å»ºå¼€å‘æ‰€éœ€ç¯å¢ƒï¼Œæµ‹è¯•å®éªŒæ–°ç»„ä»¶(å¦‚rabbitmq,kafka).é¿å…å› å®‰è£…è€Œæµªè´¹å¤ªå¤šæ—¶é—´ï¼Œæˆ‘çš„ç›®çš„æ˜¯å¿«é€Ÿå°è¯•ä½¿ç”¨ã€‚</p><h2 id="å®‰è£…docker"><a href="#å®‰è£…docker" class="headerlink" title="å®‰è£…docker"></a>å®‰è£…docker</h2><pre class="language-shell" data-language="shell"><code class="language-shell">brew cask install docker</code></pre><h2 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h2><p>Compose æ˜¯ä¸€ä¸ªç”¨æˆ·å®šä¹‰å’Œè¿è¡Œå¤šä¸ªå®¹å™¨çš„ Docker åº”ç”¨ç¨‹åºã€‚åœ¨ Compose ä¸­ä½ å¯ä»¥ä½¿ç”¨ YAML æ–‡ä»¶æ¥é…ç½®ä½ çš„åº”ç”¨æœåŠ¡ã€‚ç„¶åï¼Œåªéœ€è¦ä¸€ä¸ªç®€å•çš„å‘½ä»¤ï¼Œå°±å¯ä»¥åˆ›å»ºå¹¶å¯åŠ¨ä½ é…ç½®çš„æ‰€æœ‰æœåŠ¡ã€‚</p><h2 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h2><p><img src="http://upload-images.jianshu.io/upload_images/4033700-1a2d2c681ac9df9c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2018-08-07-14-17-25"></p><p>ä¸€ç»„æœåŠ¡å»ºç«‹ä¸€ä¸ªç›®å½•</p><h2 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h2><pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'2'</span><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">php7.2</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> php<span class="token punctuation">:</span>7.2<span class="token punctuation">-</span>fpm    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">"9000:9000"</span>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>       <span class="token punctuation">-</span> ./php<span class="token punctuation">:</span>/usr/local/etc/php      <span class="token punctuation">-</span> /Users/caowenpeng/www<span class="token punctuation">:</span>/www  <span class="token key atrule">nginx</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx    <span class="token key atrule">ports</span><span class="token punctuation">:</span>       <span class="token punctuation">-</span> <span class="token string">"80:80"</span>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> /Users/caowenpeng/www<span class="token punctuation">:</span>/www      <span class="token punctuation">-</span> ./nginx<span class="token punctuation">:</span>/etc/nginx</code></pre><h2 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h2><pre class="language-shell" data-language="shell"><code class="language-shell">docker-compose up -d</code></pre><h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>up</td><td>åˆ›å»ºå’Œå¯åŠ¨å®¹å™¨</td></tr><tr><td>ps</td><td>åˆ—å‡ºæ‰€æœ‰å®¹å™¨</td></tr><tr><td>down</td><td>åœæ­¢å¹¶åˆ é™¤å®¹å™¨ï¼Œé•œåƒï¼ŒæŒ‚è½½</td></tr><tr><td>start</td><td>å¯åŠ¨æœåŠ¡</td></tr><tr><td>stop</td><td>åœæ­¢æœåŠ¡</td></tr><tr><td>restart</td><td>é‡å¯æœåŠ¡</td></tr></tbody></table><p><strong>ç¬¬ä¸€æ¬¡ä½¿ç”¨up,ä¹‹åä½¿ç”¨start,å¦‚æœå†æ¬¡ä½¿ç”¨upå°†ä¼šé‡æ–°åˆ›å»ºå®¹å™¨ï¼Œä¸€äº›å¯¹å®¹å™¨çš„ä¿®æ”¹å°†ä¼šä¸¢å¤±</strong></p><h2 id="å…¶ä»–é—®é¢˜"><a href="#å…¶ä»–é—®é¢˜" class="headerlink" title="å…¶ä»–é—®é¢˜"></a>å…¶ä»–é—®é¢˜</h2><p>è¿›å…¥å®¹å™¨ </p><pre class="language-bash" data-language="bash"><code class="language-bash">docker-compose <span class="token builtin class-name">exec</span> php7.2 <span class="token function">bash</span></code></pre><p>è¿›å…¥å®¹å™¨åä¼šå‘ç°åªèƒ½ç”¨å°‘é‡å‘½ä»¤ï¼Œè¿psç­‰éƒ½æ²¡æœ‰ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦å®‰è£…ä¸€äº›ç¨‹åº</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt-get</span> update  <span class="token comment">##æ›´æ–°å…ƒ</span><span class="token function">apt-get</span> <span class="token function">install</span> procps  <span class="token comment">## å®‰è£… ps</span></code></pre><p>å®‰è£…php-rdkafkaæ‹“å±•</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt-get</span> <span class="token function">install</span> <span class="token function">wget</span><span class="token function">wget</span> https://github.com/edenhill/librdkafka/archive/master.zip<span class="token function">apt-get</span> <span class="token function">install</span> <span class="token function">unzip</span><span class="token function">unzip</span> master.zip<span class="token builtin class-name">cd</span> librdkafka./configure <span class="token function">make</span><span class="token function">make</span> <span class="token function">install</span> pecl <span class="token function">install</span> http://pecl.php.net/get/rdkafka-3.0.4.tgz<span class="token comment">#åœ¨php.ini é…ç½®å¯ç”¨ rdkafkaæ‹“å±•</span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ°ç†ä½ç½®geoå¤„ç†ä¹‹mysqlå‡½æ•°</title>
      <link href="2017/12/01/%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AEgeo%E5%A4%84%E7%90%86%E4%B9%8Bmysql%E5%87%BD%E6%95%B0/"/>
      <url>2017/12/01/%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AEgeo%E5%A4%84%E7%90%86%E4%B9%8Bmysql%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ç›®å‰è¶Šæ¥è¶Šå¤šçš„ä¸šåŠ¡éƒ½ä¼šåŸºäºLBSï¼Œé™„è¿‘çš„äººï¼Œå¤–å–ä½ç½®ï¼Œé™„è¿‘å•†å®¶ç­‰ç­‰ï¼Œç°å°±è®¨è®ºç¦»æˆ‘æœ€è¿‘è¿™ä¸€ä¸šåŠ¡åœºæ™¯çš„è§£å†³æ–¹æ¡ˆã€‚</p></blockquote><p>ç›®å‰å·²çŸ¥è§£å†³æ–¹æ¡ˆæœ‰:</p><ul><li>mysql è‡ªå®šä¹‰å‡½æ•°è®¡ç®—</li><li>mysql geoç´¢å¼•</li><li>mongodb geoç´¢å¼•</li><li>postgresql PostGisç´¢å¼•</li><li>redis geo</li><li>ElasticSearch</li></ul><p>æœ¬æ–‡æµ‹è¯•ä¸‹mysql å‡½æ•°è¿ç®—çš„æ€§èƒ½</p><span id="more"></span><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><h3 id="åˆ›å»ºæ•°æ®è¡¨"><a href="#åˆ›å»ºæ•°æ®è¡¨" class="headerlink" title="åˆ›å»ºæ•°æ®è¡¨"></a>åˆ›å»ºæ•°æ®è¡¨</h3><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>driver<span class="token punctuation">`</span> <span class="token punctuation">(</span>  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>lng<span class="token punctuation">`</span> <span class="token keyword">float</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>lat<span class="token punctuation">`</span> <span class="token keyword">float</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span></code></pre><h3 id="åˆ›å»ºæµ‹è¯•æ•°æ®"><a href="#åˆ›å»ºæµ‹è¯•æ•°æ®" class="headerlink" title="åˆ›å»ºæµ‹è¯•æ•°æ®"></a>åˆ›å»ºæµ‹è¯•æ•°æ®</h3><p>åœ¨åˆ›å»ºæ•°æ®ä¹‹å‰å…ˆäº†è§£ä¸‹åŸºæœ¬çš„åœ°ç†çŸ¥è¯†:</p><ul><li><p><strong>å…¨çƒç»çº¬åº¦çš„å–å€¼èŒƒå›´ä¸º:</strong> çº¬åº¦-90<del>90ï¼Œç»åº¦-180</del>180</p></li><li><p><strong>ä¸­å›½çš„ç»çº¬åº¦èŒƒå›´å¤§çº¦ä¸ºï¼š</strong> çº¬åº¦3.86<del>53.55ï¼Œç»åº¦73.66</del>135.05</p></li><li><p>åŒ—äº¬è¡Œæ”¿ä¸­å¿ƒçš„çº¬åº¦ä¸º39.92ï¼Œç»åº¦ä¸º116.46</p></li><li><p>è¶ŠåŒ—é¢çš„åœ°æ–¹çº¬åº¦æ•°å€¼è¶Šå¤§ï¼Œè¶Šä¸œé¢çš„åœ°æ–¹ç»åº¦æ•°å€¼è¶Šå¤§</p></li><li><p>åº¦åˆ†è½¬æ¢ï¼š å°†åº¦åˆ†å•ä½æ•°æ®è½¬æ¢ä¸ºåº¦å•ä½æ•°æ®ï¼Œå…¬å¼ï¼šåº¦=åº¦+åˆ†/60</p></li><li><p>åˆ†ç§’è½¬æ¢ï¼š å°†åº¦åˆ†ç§’å•ä½æ•°æ®è½¬æ¢ä¸ºåº¦å•ä½æ•°æ®ï¼Œå…¬å¼ï¼šåº¦ = åº¦ + åˆ† / 60 + ç§’ / 60 / 60</p></li></ul><p>åœ¨çº¬åº¦ç›¸ç­‰çš„æƒ…å†µä¸‹ï¼š</p><ul><li>ç»åº¦æ¯éš”0.00001åº¦ï¼Œè·ç¦»ç›¸å·®çº¦1ç±³</li></ul><p>åœ¨ç»åº¦ç›¸ç­‰çš„æƒ…å†µä¸‹ï¼š</p><ul><li>çº¬åº¦æ¯éš”0.00001åº¦ï¼Œè·ç¦»ç›¸å·®çº¦1.1ç±³</li></ul><h2 id="mysqlå‡½æ•°è®¡ç®—"><a href="#mysqlå‡½æ•°è®¡ç®—" class="headerlink" title="mysqlå‡½æ•°è®¡ç®—"></a>mysqlå‡½æ•°è®¡ç®—</h2><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DELIMITER</span> <span class="token comment">//</span><span class="token keyword">CREATE</span> <span class="token keyword">DEFINER</span><span class="token operator">=</span><span class="token punctuation">`</span>root<span class="token punctuation">`</span><span class="token variable">@`localhost`</span> <span class="token keyword">FUNCTION</span> <span class="token punctuation">`</span>getDistance<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>lng1<span class="token punctuation">`</span> <span class="token keyword">float</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span>     <span class="token punctuation">,</span><span class="token punctuation">`</span>lat1<span class="token punctuation">`</span> <span class="token keyword">float</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span>    <span class="token punctuation">,</span><span class="token punctuation">`</span>lng2<span class="token punctuation">`</span> <span class="token keyword">float</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span>     <span class="token punctuation">,</span><span class="token punctuation">`</span>lat2<span class="token punctuation">`</span> <span class="token keyword">float</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">RETURNS</span> <span class="token keyword">double</span>    <span class="token keyword">COMMENT</span> <span class="token string">'è®¡ç®—2åæ ‡ç‚¹è·ç¦»'</span><span class="token keyword">BEGIN</span><span class="token keyword">declare</span> d <span class="token keyword">double</span><span class="token punctuation">;</span>    <span class="token keyword">declare</span> radius <span class="token keyword">int</span><span class="token punctuation">;</span>    <span class="token keyword">set</span> radius <span class="token operator">=</span> <span class="token number">6371000</span><span class="token punctuation">;</span> <span class="token comment">#å‡è®¾åœ°çƒä¸ºæ­£çƒå½¢ï¼Œç›´å¾„ä¸º6371000ç±³</span>    <span class="token keyword">set</span> d <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>ATAN2<span class="token punctuation">(</span>SQRT<span class="token punctuation">(</span>SIN<span class="token punctuation">(</span><span class="token punctuation">(</span>lat1<span class="token operator">-</span>lat2<span class="token punctuation">)</span><span class="token operator">*</span>PI<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">180</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span>           <span class="token operator">*</span>SIN<span class="token punctuation">(</span><span class="token punctuation">(</span>lat1<span class="token operator">-</span>lat2<span class="token punctuation">)</span><span class="token operator">*</span>PI<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">180</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">+</span>           COS<span class="token punctuation">(</span>lat2<span class="token operator">*</span>PI<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">180</span><span class="token punctuation">)</span><span class="token operator">*</span>COS<span class="token punctuation">(</span>lat1<span class="token operator">*</span>PI<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">180</span><span class="token punctuation">)</span>           <span class="token operator">*</span>SIN<span class="token punctuation">(</span><span class="token punctuation">(</span>lng1<span class="token operator">-</span>lng2<span class="token punctuation">)</span><span class="token operator">*</span>PI<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">180</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span>           <span class="token operator">*</span>SIN<span class="token punctuation">(</span><span class="token punctuation">(</span>lng1<span class="token operator">-</span>lng2<span class="token punctuation">)</span><span class="token operator">*</span>PI<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">180</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>           SQRT<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>SIN<span class="token punctuation">(</span><span class="token punctuation">(</span>lat1<span class="token operator">-</span>lat2<span class="token punctuation">)</span><span class="token operator">*</span>PI<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">180</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span>           <span class="token operator">*</span>SIN<span class="token punctuation">(</span><span class="token punctuation">(</span>lat1<span class="token operator">-</span>lat2<span class="token punctuation">)</span><span class="token operator">*</span>PI<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">180</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span>           <span class="token operator">+</span>COS<span class="token punctuation">(</span>lat2<span class="token operator">*</span>PI<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">180</span><span class="token punctuation">)</span><span class="token operator">*</span>COS<span class="token punctuation">(</span>lat1<span class="token operator">*</span>PI<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">180</span><span class="token punctuation">)</span>           <span class="token operator">*</span>SIN<span class="token punctuation">(</span><span class="token punctuation">(</span>lng1<span class="token operator">-</span>lng2<span class="token punctuation">)</span><span class="token operator">*</span>PI<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">180</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span>           <span class="token operator">*</span>SIN<span class="token punctuation">(</span><span class="token punctuation">(</span>lng1<span class="token operator">-</span>lng2<span class="token punctuation">)</span><span class="token operator">*</span>PI<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">180</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span>radius<span class="token punctuation">;</span>    <span class="token keyword">return</span> d<span class="token punctuation">;</span><span class="token keyword">END</span><span class="token comment">//</span><span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span></code></pre><h2 id="åˆ›å»ºæ•°æ®pythonè„šæœ¬"><a href="#åˆ›å»ºæ•°æ®pythonè„šæœ¬" class="headerlink" title="åˆ›å»ºæ•°æ®pythonè„šæœ¬"></a>åˆ›å»ºæ•°æ®pythonè„šæœ¬</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># coding=utf-8</span><span class="token keyword">from</span> orator <span class="token keyword">import</span> DatabaseManager<span class="token punctuation">,</span> Model<span class="token keyword">import</span> logging<span class="token keyword">import</span> random<span class="token keyword">import</span> threading<span class="token triple-quoted-string string">""" ä¸­å›½çš„ç»çº¬åº¦èŒƒå›´ çº¬åº¦3.86~53.55ï¼Œç»åº¦73.66~135.05ã€‚å¤§æ¦‚0.00001åº¦å·®è·1ç±³ """</span><span class="token comment"># åˆ›å»º æ—¥å¿— å¯¹è±¡</span>logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span><span class="token punctuation">)</span>handler <span class="token operator">=</span> logging<span class="token punctuation">.</span>StreamHandler<span class="token punctuation">(</span><span class="token punctuation">)</span>formatter <span class="token operator">=</span> logging<span class="token punctuation">.</span>Formatter<span class="token punctuation">(</span>    <span class="token string">'%(asctime)s %(name)-12s %(levelname)-8s %(message)s'</span><span class="token punctuation">)</span>handler<span class="token punctuation">.</span>setFormatter<span class="token punctuation">(</span>formatter<span class="token punctuation">)</span>logger<span class="token punctuation">.</span>addHandler<span class="token punctuation">(</span>handler<span class="token punctuation">)</span>logger<span class="token punctuation">.</span>setLevel<span class="token punctuation">(</span>logging<span class="token punctuation">.</span>DEBUG<span class="token punctuation">)</span><span class="token comment"># Connect to the database</span>config <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">'mysql'</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>        <span class="token string">'driver'</span><span class="token punctuation">:</span> <span class="token string">'mysql'</span><span class="token punctuation">,</span>        <span class="token string">'host'</span><span class="token punctuation">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>        <span class="token string">'database'</span><span class="token punctuation">:</span> <span class="token string">'dbtest'</span><span class="token punctuation">,</span>        <span class="token string">'user'</span><span class="token punctuation">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>        <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>        <span class="token string">'prefix'</span><span class="token punctuation">:</span> <span class="token string">''</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>db <span class="token operator">=</span> DatabaseManager<span class="token punctuation">(</span>config<span class="token punctuation">)</span>Model<span class="token punctuation">.</span>set_connection_resolver<span class="token punctuation">(</span>db<span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">Driver</span><span class="token punctuation">(</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>    __table__ <span class="token operator">=</span> <span class="token string">'driver'</span>    __timestamps__ <span class="token operator">=</span> <span class="token boolean">False</span>    <span class="token keyword">pass</span><span class="token keyword">def</span> <span class="token function">ins_driver</span><span class="token punctuation">(</span>thread_name<span class="token punctuation">,</span>nums<span class="token punctuation">)</span><span class="token punctuation">:</span>    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'å¼€å¯çº¿ç¨‹%s'</span> <span class="token operator">%</span> thread_name<span class="token punctuation">)</span>    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">:</span>        lng <span class="token operator">=</span> <span class="token string">'%.5f'</span> <span class="token operator">%</span> random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">73.66</span><span class="token punctuation">,</span> <span class="token number">135.05</span><span class="token punctuation">)</span>        lat <span class="token operator">=</span> <span class="token string">'%.5f'</span> <span class="token operator">%</span> random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">3.86</span><span class="token punctuation">,</span> <span class="token number">53.55</span><span class="token punctuation">)</span>        driver <span class="token operator">=</span> Driver<span class="token punctuation">(</span><span class="token punctuation">)</span>        driver<span class="token punctuation">.</span>lng <span class="token operator">=</span> lng        driver<span class="token punctuation">.</span>lat <span class="token operator">=</span> lat        driver<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>thread_nums <span class="token operator">=</span> <span class="token number">10</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>thread_nums<span class="token punctuation">)</span><span class="token punctuation">:</span>    t <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>ins_driver<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">400000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p><img src="http://upload-images.jianshu.io/upload_images/4033700-dda526bdfcc5c759.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p>ä»¥ä¸Šè„šæœ¬åˆ›å»º10ä¸ªçº¿ç¨‹ï¼Œ10ä¸ªçº¿ç¨‹æ’å…¥4ä¸‡æ¡æ•°æ®ã€‚è€—è´¹150.18sæ‰§è¡Œå®Œ,æ€»å…±æ’å…¥40ä¸‡æ¡æ•°æ®</p><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><ul><li>æµ‹è¯•ç¯å¢ƒ</li></ul><p>ç³»ç»Ÿï¼šmac os</p><p>å†…å­˜ï¼š16G</p><p>cpu: intel core i5</p><p>ç¡¬ç›˜: 500g å›ºæ€ç¡¬ç›˜</p><p>æµ‹è¯•ä¸‹æŸ¥æ‰¾è·ç¦»(134.38753,18.56734)è¿™ä¸ªåæ ‡ç‚¹æœ€è¿‘çš„10ä¸ªå¸æœº</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span><span class="token punctuation">,</span><span class="token punctuation">`</span>getDistance<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token number">134.38753</span><span class="token punctuation">,</span><span class="token number">18.56734</span><span class="token punctuation">,</span><span class="token punctuation">`</span>lng<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>lat<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">as</span> dis <span class="token keyword">from</span> driver <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> dis <span class="token keyword">limit</span> <span class="token number">10</span></code></pre><ul><li>è€—æ—¶ï¼š18.0s</li><li>explain:å…¨è¡¨æ‰«æ</li></ul><p>æˆ‘æµ‹è¯•äº†ä»1ä¸‡åˆ°10ä¸‡é—´éš”1ä¸‡å’Œä»10ä¸‡åˆ°90ä¸‡æ¯é—´éš”10ä¸‡æµ‹è¯•çš„ç»“æœå˜åŒ–</p><p><img src="http://upload-images.jianshu.io/upload_images/4033700-c40f60c1ef7b3f18.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><ul><li>æ­¤æ–¹æ¡ˆåœ¨æ•°æ®é‡è¾¾åˆ°3ä¸‡æ¡æŸ¥è¯¢è€—æ—¶å°±ä¼šè¶…è¿‡1ç§’</li><li>å¤§çº¦æ¯å¢åŠ 1ä¸‡æ¡å°±ä¼šå¢åŠ 0.4ç§’çš„è€—æ—¶</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ°ç†ä½ç½®geoå¤„ç†ä¹‹mongodb geo ç´¢å¼•</title>
      <link href="2017/12/01/%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AE%E5%A4%84%E7%90%86%E4%B9%8Bmongodb/"/>
      <url>2017/12/01/%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AE%E5%A4%84%E7%90%86%E4%B9%8Bmongodb/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ç›®å‰è¶Šæ¥è¶Šå¤šçš„ä¸šåŠ¡éƒ½ä¼šåŸºäºLBSï¼Œé™„è¿‘çš„äººï¼Œå¤–å–ä½ç½®ï¼Œé™„è¿‘å•†å®¶ç­‰ç­‰ï¼Œç°å°±è®¨è®ºç¦»æˆ‘æœ€è¿‘è¿™ä¸€ä¸šåŠ¡åœºæ™¯çš„è§£å†³æ–¹æ¡ˆã€‚</p></blockquote><p>ç›®å‰å·²çŸ¥è§£å†³æ–¹æ¡ˆæœ‰:</p><ul><li>mysql è‡ªå®šä¹‰å‡½æ•°è®¡ç®—</li><li>mysql geoç´¢å¼•</li><li>mongodb geoç´¢å¼•</li><li>postgresql PostGisç´¢å¼•</li><li>redis geo</li><li>ElasticSearch</li></ul><p>æœ¬æ–‡æµ‹è¯•ä¸‹mongodb geoç´¢å¼• å‡½æ•°è¿ç®—çš„æ€§èƒ½</p><span id="more"></span><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><h3 id="åˆ›å»ºæ•°æ®è¡¨"><a href="#åˆ›å»ºæ•°æ®è¡¨" class="headerlink" title="åˆ›å»ºæ•°æ®è¡¨"></a>åˆ›å»ºæ•°æ®è¡¨</h3><pre class="language-sql" data-language="sql"><code class="language-sql">db<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>createIndex<span class="token punctuation">(</span>&#123;loc: <span class="token string">"2dsphere"</span>&#125;<span class="token punctuation">)</span></code></pre><h2 id="åˆ›å»ºæ•°æ®pythonè„šæœ¬"><a href="#åˆ›å»ºæ•°æ®pythonè„šæœ¬" class="headerlink" title="åˆ›å»ºæ•°æ®pythonè„šæœ¬"></a>åˆ›å»ºæ•°æ®pythonè„šæœ¬</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># coding=utf-8</span><span class="token keyword">from</span> pymongo <span class="token keyword">import</span> MongoClient<span class="token keyword">import</span> logging<span class="token keyword">import</span> random<span class="token keyword">import</span> threading<span class="token triple-quoted-string string">""" ä¸­å›½çš„ç»çº¬åº¦èŒƒå›´ çº¬åº¦3.86~53.55ï¼Œç»åº¦73.66~135.05ã€‚å¤§æ¦‚0.00001åº¦å·®è·1ç±³ """</span><span class="token comment"># åˆ›å»º æ—¥å¿— å¯¹è±¡</span>logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span><span class="token punctuation">)</span>handler <span class="token operator">=</span> logging<span class="token punctuation">.</span>StreamHandler<span class="token punctuation">(</span><span class="token punctuation">)</span>formatter <span class="token operator">=</span> logging<span class="token punctuation">.</span>Formatter<span class="token punctuation">(</span>    <span class="token string">'%(asctime)s %(name)-12s %(levelname)-8s %(message)s'</span><span class="token punctuation">)</span>handler<span class="token punctuation">.</span>setFormatter<span class="token punctuation">(</span>formatter<span class="token punctuation">)</span>logger<span class="token punctuation">.</span>addHandler<span class="token punctuation">(</span>handler<span class="token punctuation">)</span>logger<span class="token punctuation">.</span>setLevel<span class="token punctuation">(</span>logging<span class="token punctuation">.</span>DEBUG<span class="token punctuation">)</span><span class="token comment"># Connect to the mongodb database</span>mongoconn <span class="token operator">=</span> MongoClient<span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">27017</span><span class="token punctuation">)</span>mdb <span class="token operator">=</span> mongoconn<span class="token punctuation">.</span>geo_analysisdriver_collection <span class="token operator">=</span> mdb<span class="token punctuation">.</span>driver<span class="token keyword">def</span> <span class="token function">ins_driver</span><span class="token punctuation">(</span>thread_name<span class="token punctuation">,</span> nums<span class="token punctuation">)</span><span class="token punctuation">:</span>    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'å¼€å¯çº¿ç¨‹%s'</span> <span class="token operator">%</span> thread_name<span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">:</span>        lng <span class="token operator">=</span> <span class="token string">'%.5f'</span> <span class="token operator">%</span> random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">73.66</span><span class="token punctuation">,</span> <span class="token number">135.05</span><span class="token punctuation">)</span>        lat <span class="token operator">=</span> <span class="token string">'%.5f'</span> <span class="token operator">%</span> random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">3.86</span><span class="token punctuation">,</span> <span class="token number">53.55</span><span class="token punctuation">)</span>        logging<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">'æ’å…¥è®°å½•:%s'</span> <span class="token operator">%</span> i<span class="token punctuation">)</span>        driver_collection<span class="token punctuation">.</span>insert_one<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>            <span class="token string">"loc"</span><span class="token punctuation">:</span><span class="token punctuation">[</span>                <span class="token builtin">float</span><span class="token punctuation">(</span>lng<span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token builtin">float</span><span class="token punctuation">(</span>lat<span class="token punctuation">)</span>            <span class="token punctuation">]</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>thread_nums <span class="token operator">=</span> <span class="token number">10</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>thread_nums<span class="token punctuation">)</span><span class="token punctuation">:</span>    t <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>ins_driver<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">40000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p><img src="http://upload-images.jianshu.io/upload_images/4033700-dda526bdfcc5c759.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p>ä»¥ä¸Šè„šæœ¬åˆ›å»º10ä¸ªçº¿ç¨‹ï¼Œ10ä¸ªçº¿ç¨‹æ’å…¥4ä¸‡æ¡æ•°æ®ã€‚è€—è´¹52.43sæ‰§è¡Œå®Œ,æ€»å…±æ’å…¥40ä¸‡æ¡æ•°æ®</p><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><ul><li>æµ‹è¯•ç¯å¢ƒ</li></ul><p>ç³»ç»Ÿï¼šmac os</p><p>å†…å­˜ï¼š16G</p><p>cpu: intel core i5</p><p>ç¡¬ç›˜: 500g å›ºæ€ç¡¬ç›˜</p><p>æµ‹è¯•ä¸‹æŸ¥æ‰¾è·ç¦»(134.38753,18.56734)é™„è¿‘20å…¬é‡Œçš„å¸æœº</p><pre class="language-js" data-language="js"><code class="language-js">db<span class="token punctuation">.</span><span class="token function">runCommand</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>geoNear<span class="token operator">:</span><span class="token string">'driver'</span><span class="token punctuation">,</span> near<span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">134.38753</span><span class="token punctuation">,</span><span class="token number">18.56734</span><span class="token punctuation">]</span><span class="token punctuation">,</span> spherical<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span> maxDistance<span class="token operator">:</span><span class="token number">20000</span><span class="token operator">/</span><span class="token number">6378000</span><span class="token punctuation">,</span> distanceMultiplier<span class="token operator">:</span><span class="token number">6378000</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><ul><li>è€—æ—¶ï¼š0.001s</li><li>explain:ä½¿ç”¨ç´¢å¼•</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> æ–¹æ¡ˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¨‹åºå‘˜ä»£ç ä¸‹çš„è®¸è±ªæ°(æŠ€æœ¯ç¯‡)</title>
      <link href="2017/08/05/python/%E7%A8%8B%E5%BA%8F%E5%91%98%E4%BB%A3%E7%A0%81%E4%B8%8B%E7%9A%84%E8%AE%B8%E8%B1%AA%E6%9D%B0-%E6%8A%80%E6%9C%AF%E7%AF%87/"/>
      <url>2017/08/05/python/%E7%A8%8B%E5%BA%8F%E5%91%98%E4%BB%A3%E7%A0%81%E4%B8%8B%E7%9A%84%E8%AE%B8%E8%B1%AA%E6%9D%B0-%E6%8A%80%E6%9C%AF%E7%AF%87/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æ¥ä¸Šç¯‡ï¼Œè¿™ä¸€ç¯‡å°†ä»æŠ€æœ¯å±‚é¢è®²è®²æ˜¯å¦‚ä½•å®ç°çš„ã€‚é˜…è¯»æœ¬æ–‡æ‚¨å°†ä¼šäº†è§£å¦‚ä½•ç”¨pythonçˆ¬å–å¾®åšçš„è¯„è®ºä»¥åŠå¦‚ä½•ç”¨python word_cloudåº“è¿›è¡Œæ•°æ®å¯è§†åŒ–ã€‚</p></blockquote><p>ä¸Šä¸€ç¯‡:<a href="http://www.jianshu.com/p/ab49113c1fda">ç¨‹åºå‘˜ä»£ç ä¸‹çš„è®¸è±ªæ°</a></p><span id="more"></span><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><p>æ‰“å¼€å¾®åšpc mç«™å¹¶æ‰¾åˆ°è®¸è±ªæ°è¯¥æ¡å¾®åšåœ°å€:<a href="https://m.weibo.cn/status/4132385564040383">https://m.weibo.cn/status/4132385564040383</a></p><p><strong>ä¸ºä»€ä¹ˆè¦ç”¨mç«™åœ°å€ï¼Ÿå› ä¸ºmç«™å¯ä»¥ç›´æ¥æŠ“å–åˆ°api jsonæ•°æ®,è€Œpcç«™è™½ç„¶ä¹Ÿæœ‰apiè¿”å›çš„æ˜¯html,ç›¸æ¯”è€Œè¨€é€‰å–mç«™ä¼šçœå»å¾ˆå¤šéº»çƒ¦</strong></p><p>æ‰“å¼€è¯¥é¡µé¢ï¼Œå¹¶ä¸”ç”¨chrome çš„æ£€æŸ¥å·¥å…· æŸ¥çœ‹networkï¼Œå¯ä»¥è·å–åˆ°è¯„è®ºçš„apiåœ°å€ã€‚</p><p><img src="http://upload-images.jianshu.io/upload_images/4033700-382e5a613595bc1c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="chromeæŸ¥çœ‹"></p><h2 id="æ•°æ®æŠ“å–"><a href="#æ•°æ®æŠ“å–" class="headerlink" title="æ•°æ®æŠ“å–"></a>æ•°æ®æŠ“å–</h2><p>é¦–å…ˆè§‚å¯Ÿapiè¿”å›</p><p><img src="http://upload-images.jianshu.io/upload_images/4033700-f2aa3ddad169fe31.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p>ä»è¿”å›åœ°å€ä¸Šå¯ä»¥çœ‹åˆ°å¯ä»¥é€šè¿‡å‚æ•°page æ”¹å˜è¯·æ±‚çš„é¡µç ,å¹¶ä¸”æ¯é¡µéƒ½å›è¿”å›æ€»æ¡æ•°å’Œæ€»é¡µç æ•°ã€‚è¿™é‡Œæˆ‘å†³å®šé‡‡ç”¨<strong>å¤šçº¿ç¨‹æ¥æŠ“å»</strong>(å…¶å®æ•°æ®é‡ä¸å¤§,ä¹Ÿå¯ä»¥å•çº¿ç¨‹è·‘)ã€‚</p><h3 id="å…¶ä¸­åœ¨çˆ¬å–æ•°æ®çš„æ—¶å€™ä¼šé¢ä¸´å‡ ä¸ªé—®é¢˜ï¼š"><a href="#å…¶ä¸­åœ¨çˆ¬å–æ•°æ®çš„æ—¶å€™ä¼šé¢ä¸´å‡ ä¸ªé—®é¢˜ï¼š" class="headerlink" title="å…¶ä¸­åœ¨çˆ¬å–æ•°æ®çš„æ—¶å€™ä¼šé¢ä¸´å‡ ä¸ªé—®é¢˜ï¼š"></a>å…¶ä¸­åœ¨çˆ¬å–æ•°æ®çš„æ—¶å€™ä¼šé¢ä¸´å‡ ä¸ªé—®é¢˜ï¼š</h3><p><strong>1.å­˜å‚¨é€‰æ‹©</strong></p><p>æˆ‘è¿™é‡Œé€‰ç”¨äº†MongoDBä½œä¸ºæ•°æ®å­˜å‚¨ï¼Œå› ä¸ºapié€šå¸¸è¿”å›çš„æ˜¯jsonæ•°æ®è€Œjsonç»“æ„å’ŒMongoDBçš„å­˜å‚¨æ–¹å¼å¯ä»¥ç»“åˆçš„å¾ˆé»˜å¥‘ï¼Œä¸éœ€è¦ç»è¿‡ä»»ä½•å¤„ç†å¯ä»¥ç›´æ¥çš„è¿›è¡Œæ’å…¥ã€‚</p><p><strong>2.é˜²çˆ¬è™«</strong></p><p>å¾ˆå¤šç½‘ç«™å¯èƒ½ä¼šåšä¸€äº›é˜²çˆ¬è™«çš„å¤„ç†ï¼Œé¢å¯¹åŒä¸€ä¸ªè¯·æ±‚ipçš„çŸ­æ—¶é—´çš„é«˜é¢‘ç‡è¯·æ±‚ä¼šè¿›è¡ŒæœåŠ¡éš”æ–­(ç›´æ¥å‘Šè¯‰ä½ æœåŠ¡ä¸å¯ç”¨)ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥å»ç½‘ä¸Šæ‰¾ä¸€äº›ä»£ç†è¿›è¡Œè¯·æ±‚ã€‚</p><p><strong>3.å¤šçº¿ç¨‹çš„ä»»åŠ¡åˆ†é…</strong></p><p>é‡‡ç”¨å¤šçº¿ç¨‹çˆ¬å–ä½ å½“ç„¶ä¸èƒ½è®©å¤šä¸ªçº¿ç¨‹å»çˆ¬å–åŒæ ·çš„é“¾æ¥åšåˆ«äººå·²ç»åšè¿‡çš„äº‹æƒ…ï¼Œé‚£æ ·å¤šçº¿ç¨‹æ¯«æ— æ„ä¹‰ã€‚æ‰€ä»¥ä½ éœ€è¦åˆ¶å®šä¸€å¥—è§„åˆ™ï¼Œè®©ä¸åŒçº¿ç¨‹çˆ¬å–ä¸åŒçš„é“¾æ¥ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># coding=utf-8</span><span class="token keyword">from</span> __future__ <span class="token keyword">import</span> division<span class="token keyword">from</span> pymongo <span class="token keyword">import</span> MongoClient<span class="token keyword">import</span> requests<span class="token keyword">import</span> sys<span class="token keyword">import</span> re<span class="token keyword">import</span> random<span class="token keyword">import</span> time<span class="token keyword">import</span> logging<span class="token keyword">import</span> threading<span class="token keyword">import</span> json<span class="token keyword">from</span> os <span class="token keyword">import</span> path<span class="token keyword">import</span> math<span class="token comment"># çˆ¬å–å¾®åšè¯„è®º</span><span class="token comment"># mç«™å¾®åšåœ°å€</span>weibo_url <span class="token operator">=</span> <span class="token string">'https://m.weibo.cn/status/4132385564040383'</span> thread_nums <span class="token operator">=</span> <span class="token number">5</span>  <span class="token comment">#çº¿ç¨‹æ•°</span><span class="token comment">#ä»£ç†åœ°å€</span>proxies <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token string">"http"</span><span class="token punctuation">:</span> <span class="token string">"http://171.92.4.67:9000"</span><span class="token punctuation">,</span>  <span class="token string">"http"</span><span class="token punctuation">:</span> <span class="token string">"http://163.125.222.240:8118"</span><span class="token punctuation">,</span>  <span class="token string">"http"</span><span class="token punctuation">:</span> <span class="token string">"http://121.232.145.251:9000"</span><span class="token punctuation">,</span>  <span class="token string">"http"</span><span class="token punctuation">:</span> <span class="token string">"http://121.232.147.247:9000"</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token comment"># åˆ›å»º æ—¥å¿— å¯¹è±¡</span>logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span><span class="token punctuation">)</span>handler <span class="token operator">=</span> logging<span class="token punctuation">.</span>StreamHandler<span class="token punctuation">(</span><span class="token punctuation">)</span>formatter <span class="token operator">=</span> logging<span class="token punctuation">.</span>Formatter<span class="token punctuation">(</span>    <span class="token string">'%(asctime)s %(name)-12s %(levelname)-8s %(message)s'</span><span class="token punctuation">)</span>handler<span class="token punctuation">.</span>setFormatter<span class="token punctuation">(</span>formatter<span class="token punctuation">)</span>logger<span class="token punctuation">.</span>addHandler<span class="token punctuation">(</span>handler<span class="token punctuation">)</span>logger<span class="token punctuation">.</span>setLevel<span class="token punctuation">(</span>logging<span class="token punctuation">.</span>DEBUG<span class="token punctuation">)</span>mongoconn <span class="token operator">=</span> MongoClient<span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">27017</span><span class="token punctuation">)</span>mdb <span class="token operator">=</span> mongoconn<span class="token punctuation">.</span>data_analysisdas_collection <span class="token operator">=</span> mdb<span class="token punctuation">.</span>weiboweiboid_reobj <span class="token operator">=</span> re<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string">r'.*status/(\d+)'</span><span class="token punctuation">,</span> weibo_url<span class="token punctuation">)</span>weibo_id <span class="token operator">=</span> weiboid_reobj<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">scrapy_comments</span><span class="token punctuation">(</span>weibo_id<span class="token punctuation">,</span> page<span class="token punctuation">)</span><span class="token punctuation">:</span>    weibo_comment_url <span class="token operator">=</span> <span class="token string">'https://m.weibo.cn/api/comments/show?id=%s&amp;page=%d'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>        weibo_id<span class="token punctuation">,</span> page<span class="token punctuation">)</span>    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>weibo_comment_url<span class="token punctuation">)</span>    res_obj <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>res<span class="token punctuation">.</span>content<span class="token punctuation">)</span>    <span class="token keyword">return</span> res_obj<span class="token keyword">def</span> <span class="token function">import_comments</span><span class="token punctuation">(</span>threadName<span class="token punctuation">,</span> weibo_id<span class="token punctuation">,</span> page_start<span class="token punctuation">,</span> page_end<span class="token punctuation">)</span><span class="token punctuation">:</span>    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'å¼€å§‹çº¿ç¨‹:%s'</span> <span class="token operator">%</span> threadName<span class="token punctuation">)</span>    <span class="token keyword">for</span> page <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>page_start<span class="token punctuation">,</span> page_end <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'è¯»å–ç¬¬%sé¡µ'</span> <span class="token operator">%</span> page<span class="token punctuation">)</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token comment"># continue</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            res_obj <span class="token operator">=</span> scrapy_comments<span class="token punctuation">(</span>weibo_id<span class="token punctuation">,</span> page<span class="token punctuation">)</span>            logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'è¯¥é¡µæœ‰%sæ¡è®°å½•'</span> <span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>res_obj<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">except</span><span class="token punctuation">:</span>            logging<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">'è¯»å–%sé¡µæ—¶å‘ç”Ÿé”™è¯¯'</span> <span class="token operator">%</span> page<span class="token punctuation">)</span>            <span class="token keyword">continue</span>        <span class="token keyword">if</span> res_obj<span class="token punctuation">[</span><span class="token string">'ok'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>            comments <span class="token operator">=</span> res_obj<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span>            <span class="token keyword">for</span> comment <span class="token keyword">in</span> comments<span class="token punctuation">:</span>                comment_text <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span>                    <span class="token string">r'&lt;/?\w+[^>]*>'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> comment<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'å›å¤@.*:'</span><span class="token punctuation">,</span> comment_text<span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token comment"># è¿‡æ»¤æ‰å›å¤åˆ«äººçš„è¯„è®º</span>                    <span class="token keyword">continue</span>                comment<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span> <span class="token operator">=</span> comment_text                comment<span class="token punctuation">[</span><span class="token string">'weibo_id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> weibo_id                logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'è¯»å–è¯„è®º:%s'</span> <span class="token operator">%</span> comment<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                <span class="token keyword">try</span><span class="token punctuation">:</span>                    <span class="token keyword">if</span> das_collection<span class="token punctuation">.</span>find_one<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'id'</span><span class="token punctuation">:</span> comment<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                        logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'åœ¨mongodbä¸­å­˜åœ¨'</span><span class="token punctuation">)</span>                    <span class="token keyword">else</span><span class="token punctuation">:</span>                        logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'æ’å…¥è®°å½•:%s'</span> <span class="token operator">%</span> comment<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                        das_collection<span class="token punctuation">.</span>insert_one<span class="token punctuation">(</span>comment<span class="token punctuation">)</span>                <span class="token keyword">except</span><span class="token punctuation">:</span>                    logging<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">'mongodbå‘ç”Ÿé”™è¯¯'</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            logging<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">'è¯»å–ç¬¬%sé¡µæ—¶å‘ç”Ÿé”™è¯¯'</span> <span class="token operator">%</span> page<span class="token punctuation">)</span>    logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'çº¿ç¨‹%sç»“æŸ'</span> <span class="token operator">%</span> threadName<span class="token punctuation">)</span>    <span class="token comment"># res_obj = scrapy_comments(weibo_id, page)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    <span class="token comment"># åˆ†é…ä¸åŒé“¾æ¥åˆ°ä¸åŒçš„çº¿ç¨‹ä¸Šå»</span>    res_obj <span class="token operator">=</span> scrapy_comments<span class="token punctuation">(</span>weibo_id<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> res_obj<span class="token punctuation">[</span><span class="token string">'ok'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>        total_number <span class="token operator">=</span> res_obj<span class="token punctuation">[</span><span class="token string">'total_number'</span><span class="token punctuation">]</span>        logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'è¯¥æ¡å¾®åšæœ‰:%sæ¡è¯„è®º'</span> <span class="token operator">%</span> total_number<span class="token punctuation">)</span>        max_page <span class="token operator">=</span> res_obj<span class="token punctuation">[</span><span class="token string">'max'</span><span class="token punctuation">]</span>        page_nums <span class="token operator">=</span> math<span class="token punctuation">.</span>ceil<span class="token punctuation">(</span>max_page <span class="token operator">/</span> thread_nums<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">raise</span>    <span class="token comment"># print max_page</span>    <span class="token comment"># print page_nums</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> thread_nums <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> i <span class="token operator">&lt;</span> thread_nums<span class="token punctuation">:</span>            page_end <span class="token operator">=</span> page_nums <span class="token operator">*</span> i        <span class="token keyword">else</span><span class="token punctuation">:</span>            page_end <span class="token operator">=</span> max_page        page_start <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> page_nums <span class="token operator">+</span> <span class="token number">1</span>        t <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>import_comments<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>            i<span class="token punctuation">,</span> weibo_id<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>page_start<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>page_end<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h2 id="æ•°æ®æ•´ç†å¯è§†åŒ–-data-visualization"><a href="#æ•°æ®æ•´ç†å¯è§†åŒ–-data-visualization" class="headerlink" title="æ•°æ®æ•´ç†å¯è§†åŒ–(data visualization)"></a>æ•°æ®æ•´ç†å¯è§†åŒ–(data visualization)</h2><p>è¿è¡Œè„šæœ¬å®Œæ¯•ï¼Œæˆ‘çš„MongoDBå¾—åˆ°äº†2ä¸‡å¤šæ¡è¯„è®ºæ•°æ®ï¼Œæ¥ä¸‹æ¥è¦åšçš„äº‹æ˜¯å¯¹è¿™éƒ¨åˆ†æ•°æ®è¿›è¡Œæå–ã€æ¸…æ´—ã€ç»“æ„åŒ–ç­‰æ“ä½œã€‚è¿™é‡Œé¡ºä¾¿è¯´æ˜ä¸€ä¸‹python æ•°æ®åˆ†æçš„ å¤§è‡´åŸºæœ¬æµç¨‹ã€‚</p><p><strong>1.ä¸å¤–ç•Œè¿›è¡Œäº¤äº’</strong><br>è¿™ä¸ªè¿‡ç¨‹åŒ…æ‹¬æ•°æ®çš„è·å–ã€è¯»å–ã€‚ä¸ç®¡æ˜¯ä»ç½‘ç»œèµ„æºä¸Šçˆ¬å–ã€è¿˜æ˜¯ä»ç°æœ‰èµ„æº(å„æ ·çš„æ–‡ä»¶å¦‚æ–‡æœ¬ã€excelã€æ•°æ®åº“å­˜å‚¨å¯¹è±¡)</p><p><strong>2.å‡†å¤‡å·¥ä½œ</strong><br>å¯¹æ•°æ®è¿›è¡Œæ¸…æ´—(cleaning)ã€ä¿®æ•´(munging)ã€æ•´åˆ(combining)ã€è§„èŒƒåŒ–(normalizing)ã€é‡å¡‘(reshaping)ã€åˆ‡ç‰‡(slicing)å’Œåˆ‡å—(dicing)</p><p><strong>3.è½¬æ¢</strong><br>å¯¹æ•°æ®é›†åšä¸€äº›æ•°å­¦å’Œç»Ÿè®¡è¿ç®—äº§ç”Ÿæ–°çš„æ•°æ®é›†</p><p><strong>4.å»ºæ¨¡å’Œè®¡ç®—</strong><br>å°†æ•°æ®è·Ÿç»Ÿè®¡æ¨¡å‹ã€æœºå™¨å­¦ä¹ ç®—æ³•æˆ–å…¶ä»–è®¡ç®—å·¥å…·è”ç³»èµ·æ¥</p><p><strong>5.å±•ç¤º</strong><br>åˆ›å»ºäº¤äº’å¼çš„æˆ–é™æ€çš„å›¾ç‰‡æˆ–æ–‡å­—æ‘˜è¦</p><p>ä¸‹é¢æˆ‘ä»¬æ¥è¿›è¡Œ2ã€3åŠ5çš„å·¥ä½œ:</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># coding=utf-8</span><span class="token keyword">import</span> sys<span class="token keyword">from</span> pymongo <span class="token keyword">import</span> MongoClient<span class="token keyword">import</span> random<span class="token comment"># åˆ†è¯åº“</span><span class="token comment"># from snownlp import SnowNLP</span><span class="token keyword">import</span> jieba<span class="token keyword">import</span> uniout<span class="token keyword">from</span> collections <span class="token keyword">import</span> Counter<span class="token punctuation">,</span> OrderedDict<span class="token comment"># è¯è¯­äº‘ æ–‡æœ¬ç»Ÿè®¡å¯è§†åŒ–åº“</span><span class="token keyword">from</span> wordcloud <span class="token keyword">import</span> WordCloudmongoconn <span class="token operator">=</span> MongoClient<span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">27017</span><span class="token punctuation">)</span>mdb <span class="token operator">=</span> mongoconn<span class="token punctuation">.</span>data_analysisdas_collection <span class="token operator">=</span> mdb<span class="token punctuation">.</span>weibototal_counts <span class="token operator">=</span> das_collection<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># random_int = random.randint(0, total_counts - 1)</span>docs <span class="token operator">=</span> das_collection<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span> docs<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>words_counts <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">for</span> doc <span class="token keyword">in</span> docs<span class="token punctuation">:</span>    <span class="token keyword">print</span> doc    comment_text <span class="token operator">=</span> doc<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>comment_text<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">continue</span>    words <span class="token operator">=</span> jieba<span class="token punctuation">.</span>cut<span class="token punctuation">(</span>comment_text<span class="token punctuation">)</span>    <span class="token keyword">for</span> word <span class="token keyword">in</span> words<span class="token punctuation">:</span>        <span class="token keyword">if</span> word <span class="token keyword">not</span> <span class="token keyword">in</span> words_counts<span class="token punctuation">:</span>            words_counts<span class="token punctuation">[</span>word<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            words_counts<span class="token punctuation">[</span>word<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span><span class="token keyword">for</span> word <span class="token keyword">in</span> words_counts<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> words_counts<span class="token punctuation">[</span>word<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">2</span> <span class="token keyword">or</span> <span class="token builtin">len</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">:</span>        <span class="token keyword">del</span> words_counts<span class="token punctuation">[</span>word<span class="token punctuation">]</span><span class="token comment"># print words_counts.items()</span><span class="token comment">#æ³¨æ„è¦è®©ä¸­æ–‡ä¸ä¹±ç è¦æŒ‡å®šä¸­æ–‡å­—ä½“</span><span class="token comment">#fit_words æ¥æ”¶å‚æ•°æ˜¯dict  eg:&#123;'ä½ ':333,'å¥½':23&#125;  æ–‡å­—:å‡ºç°æ¬¡æ•°</span>wordcloud <span class="token operator">=</span> WordCloud<span class="token punctuation">(</span>    font_path<span class="token operator">=</span><span class="token string">'/Users/cwp/font/msyh.ttf'</span><span class="token punctuation">,</span>    background_color<span class="token operator">=</span><span class="token string">'white'</span><span class="token punctuation">,</span>    width<span class="token operator">=</span><span class="token number">1200</span><span class="token punctuation">,</span>    height<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fit_words<span class="token punctuation">(</span>words_counts<span class="token punctuation">)</span><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> pltplt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>wordcloud<span class="token punctuation">,</span> interpolation<span class="token operator">=</span><span class="token string">'bilinear'</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">"off"</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>ä»‹ç»ä¸‹ä»¥ä¸Šä»£ç ï¼š<br>æˆ‘ä»¬ä¸»è¦ç”¨åˆ°äº†2ä¸ªå·¥å…·ï¼Œjiebaå’Œword_cloudã€‚å‰è€…å¯¹ä¸­æ–‡è¿›è¡Œåˆ†è¯åè€…å›¾å½¢åŒ–å±•ç¤ºè¯è¯­çš„å‡ºç°é¢‘ç‡ã€‚<br>ä¼—æ‰€å‘¨çŸ¥ï¼Œä¸­æ–‡ç³»çš„è¯­è¨€å¤„ç†ææ€•æ˜¯æœ€éš¾çš„è‡ªç„¶è¯­è¨€å¤„ç†(NLP)çš„è¯­ç§ã€‚å°±åŸºæœ¬çš„åˆ†è¯è€Œè¨€éƒ½æ˜¯ä¸€é¡¹æ¯”è¾ƒå›°éš¾çš„å·¥ä½œ,(è‹±è¯­å¥å­ä¸­æ¯ä¸ªå•è¯éƒ½æ˜¯æœ‰ç©ºæ ¼åˆ†å¼€çš„ï¼Œè€Œä¸­æ–‡æ˜¯ç”±å•ä¸ªå­—ç»„æˆè¯è¿æ¥æˆä¸²ç»„æˆå¥).<br>ä¸¾ä¸ªä¾‹å­,è¯·ç”¨â€œå­©æâ€é€ å¥,â€é‚£ä¸ªç”·å­©æäº¤å®Œä»£ç å°±ä¸‹ç­äº†â€ã€‚å¦‚æœäººå·¥åˆ†è¯ï¼Œå¯ä»¥çŸ¥é“â€ç”·å­©â€å’Œâ€æäº¤â€åº”è¯¥æ˜¯åˆ†å¼€çš„2ä¸ªè¯ï¼Œ<strong>ä½†æ˜¯å¯¹äºæœºå™¨è€Œè¨€ï¼Œè¦è¾¨åˆ«â€æâ€åº”è¯¥ä¸â€ç”·â€è¿˜æ˜¯â€äº¤â€è¿›è¡Œç»„è¯å°±å¾ˆéš¾åŠäº†</strong>ã€‚è¦æƒ³æœºå™¨èƒ½å¤Ÿæ›´ç²¾ç¡®çš„è¾¨åˆ«è¿™ç±»é—®é¢˜ï¼Œå°±éœ€è¦è®©æœºå™¨ä¸åœå­¦ä¹ ï¼Œè®©å®ƒçŸ¥é“è¿™ç§æƒ…å†µè¯¥è¿™ä¹ˆåˆ†è€Œä¸æ˜¯é‚£ä¹ˆåˆ†ã€‚ç ”ç©¶ä¸­æ–‡è‡ªç„¶è¯­è¨€å¤„ç†å°†æ˜¯ä¸€ä¸ªé•¿ä¹…è€Œå¤§çš„å·¥ç¨‹ï¼Œå¯¹äºåˆ†ææ•°æ®(æˆ‘ä»¬ä¸æ˜¯è¦ç ”ç©¶è‡ªç„¶è¯­è¨€å¤„ç†ğŸ˜)ï¼Œè¿™é‡Œå°±å€ŸåŠ©jiebaè¿™ä¸ªåº“è¿›è¡Œå·¥ä½œäº†.</p><p>å¯¹äºword_cloud,å›¾å½¢åŒ–æ–‡æœ¬ç»Ÿè®¡ï¼Œç½‘ä¸Šæœ‰ä¸å°‘çš„åšæ–‡éƒ½è´´äº†ä»£ç ï¼Œä½†æˆ‘æƒ³è¯´çš„æ˜¯æˆ‘ä¸äº†è§£å®ƒä»¬æ˜¯ä¸æ˜¯çœŸçš„è¿è¡Œå‡ºäº†ç»“æœã€‚å› ä¸ºfit_words è¿™ä¸ªå‡½æ•°æ¥æ”¶çš„æ˜¯dictè€Œä¸æ˜¯listï¼Œå®˜æ–¹æ–‡æ¡£å’Œå‡½æ•°docå…¶å®å†™é”™äº†,åœ¨githubä¸Šæœ‰æŠ«éœ²ã€‚</p><p>æœ€åå¾—åˆ°ç»“æœ:</p><p><img src="http://upload-images.jianshu.io/upload_images/4033700-dfbee241840ea23e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç»“æœ"></p><h2 id="ä¸€äº›ç”¨åˆ°çš„å·¥å…·"><a href="#ä¸€äº›ç”¨åˆ°çš„å·¥å…·" class="headerlink" title="ä¸€äº›ç”¨åˆ°çš„å·¥å…·"></a>ä¸€äº›ç”¨åˆ°çš„å·¥å…·</h2><p>1.<a href="https://github.com/amueller/word_cloud">word_cloud A little word cloud generator in Python</a></p><p>2.<a href="https://github.com/fxsjy/jieba">jieba ç»“å·´ä¸­æ–‡åˆ†è¯</a></p><p>3.<a href="http://docs.python-requests.org/en/master/">Requests is the only Non-GMO HTTP library for Python, safe for human consumption.</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
